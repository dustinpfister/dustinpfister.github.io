/*
   canvas-example-pointer-manager-mouse-and-touch
   Copyright 2020 by Dustin Pfister
   https://raw.githubusercontent.com/dustinpfister/canvas-examples/master/LICENSE
 
   https://github.com/dustinpfister/canvas-examples
*/
var utils={};utils.createCanvas=function(opt){opt=opt||{};opt.container=opt.container||document.getElementById("canvas-app")||document.body;opt.canvas=document.createElement("canvas");opt.ctx=opt.canvas.getContext("2d");opt.canvas.className="canvas_example";opt.canvas.width=opt.width===undefined?320:opt.width;opt.canvas.height=opt.height===undefined?240:opt.height;opt.ctx.translate(.5,.5);opt.canvas.onselectstart=function(){return false};opt.canvas.style.imageRendering="pixelated";opt.ctx.imageSmoothingEnabled=false;opt.container.appendChild(opt.canvas);return opt};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect(),pos={x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};pos.x=Math.floor(pos.x/canvas.scrollWidth*canvas.width);pos.y=Math.floor(pos.y/canvas.scrollHeight*canvas.height);e.preventDefault();return pos};var PMMT=function(){var outOfCanvas=function(sm,pos){return pos.x<0||pos.x>=sm.canvas.width||pos.y<0||pos.y>=sm.canvas.height};var getPointer=function(sm){var stateObj=sm[sm.currentState]||{};if(stateObj.pointer){return stateObj.pointer}return false};var attachPointerEvent=function(sm,domType,smType){sm.canvas.addEventListener(domType,function(e){var pos=utils.getCanvasRelative(e),pointer=getPointer(sm),hander,endHander;e.preventDefault();if(pointer){handler=pointer[smType];if(handler){if(outOfCanvas(sm,pos)){endHandler=pointer.end;if(endHandler){endHandler(pos,sm,e)}}else{handler(pos,sm,e)}}}})};return function(sm){attachPointerEvent(sm,"mousedown","start");attachPointerEvent(sm,"mousemove","move");attachPointerEvent(sm,"mouseup","end");attachPointerEvent(sm,"mouseout","end");attachPointerEvent(sm,"touchstart","start");attachPointerEvent(sm,"touchmove","move");attachPointerEvent(sm,"touchend","end");attachPointerEvent(sm,"touchcancel","end")}}();var draw=function(){var api={};api.background=function(ctx,canvas,sm){ctx.fillStyle=sm.backgroundStyle||"black";ctx.fillRect(0,0,canvas.width,canvas.height);var img=sm.backgroundImage;if(img){ctx.drawImage(sm.backgroundImage,0,0,img.width,img.height,0,0,canvas.width,canvas.height)}};api.pointerObj=function(ctx,canvas,pt){ctx.strokeStyle="white";ctx.beginPath();ctx.arc(pt.x,pt.y,pt.r,0,Math.PI*2);ctx.stroke()};api.ver=function(ctx,canvas,sm){ctx.fillStyle="#0a0a0a";ctx.textBaseline="top";ctx.textAlign="left";ctx.font="10px arial";ctx.fillText("v"+sm.ver,5,canvas.height-15)};return api}();var canvasObj=utils.createCanvas(),canvas=canvasObj.canvas,ctx=canvasObj.ctx;var sm={ver:"0.0.1",currentState:"init",canvas:canvas,ctx:ctx,backgroundStyle:"gray",model:{x:canvas.width/2,y:canvas.height/2,r:10},init:{tick:function(model,sm){PMMT(sm);sm.currentState="demo"}},demo:{tick:function(model,sm){draw.background(sm.ctx,sm.canvas,sm);draw.pointerObj(sm.ctx,sm.canvas,sm.model);draw.ver(sm.ctx,sm.canvas,sm)},pointer:{start:function(pos,sm,e){sm.model.down=true},move:function(pos,sm,e){var m=sm.model;if(m.down){m.x=pos.x;m.y=pos.y}},end:function(){var m=sm.model;m.down=false;m.x=canvas.width/2,m.y=canvas.height/2}}}};var loop=function(){requestAnimationFrame(loop);sm[sm.currentState].tick(sm.model,sm)};loop();
