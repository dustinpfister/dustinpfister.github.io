/*
   canvas-example-animation-fractal by Dustin Pfister
*/
var utils={};utils.createCanvas=function(opt){opt=opt||{};opt.container=opt.container||document.getElementById("canvas-app")||document.body;opt.canvas=document.createElement("canvas");opt.canvas.className="canvas_example";opt.ctx=opt.canvas.getContext("2d");opt.container.appendChild(opt.canvas);opt.canvas.width=opt.width===undefined?320:opt.width;opt.canvas.height=opt.height===undefined?240:opt.height;opt.ctx.translate(.5,.5);return opt};var FF=function(opt){var api={};opt=opt||{};api.ani={ver:opt.ver||"0.0.a"};api.forFrame=opt.forFrame||function(){};var setMainPerAndBias=function(api){api.per=api.frameIndex/api.maxFrame;api.bias=1-Math.abs(.5-api.per)/.5};var forFrame=function(frameIndex,maxFrame){api.frameIndex=frameIndex;api.maxFrame=maxFrame;setMainPerAndBias(api);api.forFrame.call(api,api,frameIndex,maxFrame);return api.ani};return function(frame,maxFrame){frame=frame===undefined?0:frame;maxFrame=maxFrame===undefined?50:maxFrame;frame=frame>maxFrame?frame%maxFrame:frame;frame=frame<0?maxFrame-Math.abs(frame)%maxFrame:frame;forFrame(frame,maxFrame);return api.ani}};var draw={};draw.bx=function(ctx,bx){ctx.strokeStyle="rgba(0,255,0,"+bx.per.toFixed(2)+")";ctx.lineWidth=6;ctx.beginPath();ctx.rect(bx.x,bx.y,bx.w,bx.h);ctx.stroke()};draw.bxArr=function(ctx,ani){var i=0,len=ani.bxArr.length,box;while(i<len){box=ani.bxArr[i];ctx.save();ctx.translate(box.x+box.w/2,box.y+box.h/2);ctx.rotate(box.radian);draw.bx(ctx,{x:box.w/2*-1,y:box.h/2*-1,w:box.w,h:box.h,per:1-box.per});ctx.restore();i+=1}};draw.back=function(ctx,canvas){ctx.fillStyle="black";ctx.fillRect(0,0,canvas.width,canvas.height)};draw.ver=function(ctx,canvas,ani){ctx.fillStyle="white";ctx.textBaseline="top";ctx.font="10px courier";ctx.fillText("v"+ani.ver,10,canvas.height-15)};var canvasObj=utils.createCanvas(),canvas=canvasObj.canvas,ctx=canvasObj.ctx;var opt={ver:"0.1.0",maxFrame:400,forFrame:function(api,f,mf){var bxArr=api.ani.bxArr=[];var i=0,per,bxCount=15,maxSize=canvas.width*1.75;while(i<bxCount){per=api.per+1/bxCount*i;per%=1;bx={};bx.w=maxSize*per;bx.h=maxSize*per;bx.x=canvas.width*.25+(canvas.width*.5*api.bias-bx.w/2);bx.y=canvas.height/2-bx.h/2;bx.radian=Math.PI/180*(-180+360*api.bias)*per;bx.per=bx.w/maxSize;bxArr.push(bx);i+=1}bxArr.sort(function(a,b){if(a.per>b.per){return 1}return-1})}};var ani=FF(opt);var frame=0;var loop=function(){requestAnimationFrame(loop);var state=ani(frame,opt.maxFrame);draw.back(ctx,canvas);draw.bxArr(ctx,state);draw.ver(ctx,canvas,state);frame+=1;frame%=opt.maxFrame};loop();
