/*
   canvas-example-button-layout
   Copyright 2020 by Dustin Pfister
   https://raw.githubusercontent.com/dustinpfister/canvas-examples/master/LICENSE
 
   https://github.com/dustinpfister/canvas-examples
*/
var utils={};utils.mkButtonLayout=function(opt){var blObj={};opt=opt||{};blObj.buttons=opt.buttons||[];blObj.attachTo=opt.attachTo||window;blObj.handler=function(e){e.preventDefault();var pos=utils.getCanvasRelative(e),i=opt.buttons.length,b;while(i--){b=opt.buttons[i];if(utils.boundingBox(pos.x,pos.y,1,1,b.x,b.y,b.w,b.h)){if(b.onAction){b.onAction.call({opt:opt,pos:pos,button:b,e:e},pos,opt,b,e)}break}}return false};blObj.attachTo.addEventListener("click",blObj.handler);return blObj};utils.createCanvas=function(opt){opt=opt||{};opt.container=opt.container||document.getElementById("canvas-app")||document.body;opt.canvas=document.createElement("canvas");opt.ctx=opt.canvas.getContext("2d");opt.canvas.className="canvas_example";opt.canvas.width=opt.width===undefined?320:opt.width;opt.canvas.height=opt.height===undefined?240:opt.height;opt.ctx.translate(.5,.5);opt.canvas.onselectstart=function(){return false};opt.container.appendChild(opt.canvas);return opt};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect(),pos={x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};pos.x=Math.floor(pos.x/canvas.scrollWidth*canvas.width);pos.y=Math.floor(pos.y/canvas.scrollHeight*canvas.height);e.preventDefault();return pos};utils.mod=function(x,m){return(x%m+m)%m};utils.boundingBox=function(x1,y1,w1,h1,x2,y2,w2,h2){return!(y1+h1<y2||y1>y2+h2||x1+w1<x2||x1>x2+w2)};var draw={};draw.background=function(ctx,canvas){ctx.fillStyle="black";ctx.fillRect(0,0,canvas.width,canvas.height)};draw.buttonLayout=function(ctx,blObj){var i=blObj.buttons.length,b;while(i--){b=blObj.buttons[i];ctx.fillStyle="red";ctx.fillRect(b.x,b.y,b.w,b.h);ctx.fillStyle="white";ctx.textBaseline="middle";ctx.textAlign="center";ctx.fillText(b.label||"",b.x+b.w/2,b.y+b.h/2)}};draw.circle=function(ctx,canvas,state){var r=state.i/state.iMax*(Math.PI*2);ctx.fillStyle="green";ctx.beginPath();ctx.arc(state.cx,state.cy,state.radius,r-1.57,r+1.57);ctx.fill();ctx.stroke()};draw.info=function(ctx,canvas,state){ctx.fillStyle="white";ctx.textBaseline="top";ctx.textAlign="left";ctx.font="10px arial";ctx.fillText("i= "+state.i+"/"+state.iMax,10,10)};draw.ver=function(ctx,canvas,state){ctx.fillStyle="white";ctx.textBaseline="top";ctx.textAlign="left";ctx.font="10px arial";ctx.fillText("v"+state.ver,5,canvas.height-15)};var canvasObj=utils.createCanvas(),canvas=canvasObj.canvas,ctx=canvasObj.ctx;var state={ver:"0.1.0",i:0,iMax:16,cx:canvas.width/2,cy:canvas.height/2,radius:32};var wrapIndex=function(state){state.i=utils.mod(state.i,state.iMax)};var blObj=utils.mkButtonLayout({attachTo:canvas,buttons:[{x:canvas.width/2-48,y:180,w:32,h:32,label:"i+",onAction:function(pos,opt,button,e){state.i+=1;wrapIndex(state)}},{x:canvas.height/2+48,y:180,w:32,h:32,label:"i-",onAction:function(pos,opt,button,e){state.i-=1;wrapIndex(state)}}]});var loop=function(){requestAnimationFrame(loop);draw.background(ctx,canvas);draw.buttonLayout(ctx,blObj);draw.circle(ctx,canvas,state);draw.info(ctx,canvas,state);draw.ver(ctx,canvas,state)};loop();
