/*
   canvas-example-image-limits
   Copyright 2020 by Dustin Pfister
   https://raw.githubusercontent.com/dustinpfister/canvas-examples/master/LICENSE
 
   https://github.com/dustinpfister/canvas-examples
*/
var utils={};utils.createCanvas=function(opt){opt=opt||{};opt.container=opt.container||document.getElementById("canvas-app")||document.body;opt.canvas=document.createElement("canvas");opt.ctx=opt.canvas.getContext("2d");opt.canvas.className="canvas_example";opt.canvas.width=opt.width===undefined?320:opt.width;opt.canvas.height=opt.height===undefined?240:opt.height;opt.ctx.translate(.5,.5);opt.canvas.onselectstart=function(){return false};opt.canvas.style.imageRendering="pixelated";opt.ctx.imageSmoothingEnabled=false;opt.container.appendChild(opt.canvas);return opt};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect(),pos={x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};pos.x=Math.floor(pos.x/canvas.scrollWidth*canvas.width);pos.y=Math.floor(pos.y/canvas.scrollHeight*canvas.height);e.preventDefault();return pos};var IMG={};IMG.totalImages=function(w,h,colorDepth){return Math.pow(colorDepth,w*h)};IMG.pastSafe=function(w,h,colorDepth){return totalImages(w,h,colorDepth)>=Number.MAX_SAFE_INTEGER};IMG.indexFromString=function(string,colorDepth){colorDepth=colorDepth||2;var index=0;string.split("").forEach(function(pix,i){index+=Math.pow(colorDepth,i)*parseInt(pix,colorDepth)});return index};IMG.stringFromIndex=function(index,colorDepth,size){index=index||0;size=size||7*7;colorDepth=colorDepth||2;var maxIndex=Math.pow(colorDepth,size)-1,num,baseStr;if(index>maxIndex){index=maxIndex}if(index<0){index=0}num=index.toString(colorDepth);baseStr=new Array(size).fill("0").join("");return String(baseStr+num).slice(size*-1).split("").reverse().join("")};IMG.stringToChunk=function(str,w){var i=0,strArr=str.split(""),arr=[];while(i<str.length){arr.push(strArr.slice(i,i+w));i+=w}return arr};IMG.chunkToString=function(chunk,colorDepth){colorDepth=colorDepth||2;var str="";chunk.forEach(function(row,y){row.forEach(function(px,x){str+=Number(px)})});return str.split("").reverse().join("")};IMG.draw=function(canvas,chunk,pal){pal=pal||["white","black","red","green","blue"];var ctx=canvas.getContext("2d"),size=canvas.width/chunk[0].length;chunk.forEach(function(row,y){row.forEach(function(px,x){ctx.fillStyle=pal[px]||"black";ctx.fillRect(x*size,y*size,size,size)})})};var canvasObj=utils.createCanvas(),canvas=canvasObj.canvas,ctx=canvasObj.ctx;container=canvasObj.container;var inputStr=document.createElement("input");inputStr.setAttribute("id","img-str");inputStr.setAttribute("type","text");canvasObj.container.appendChild(inputStr);var w=4,h=4,colorDepth=2,str=IMG.stringFromIndex(38505,colorDepth,w*h),matrix=IMG.stringToChunk(str,w);inputStr.value=parseInt(str,colorDepth);IMG.draw(canvas,matrix);canvas.addEventListener("click",function(e){var pos=utils.getCanvasRelative(e),size=canvas.width/w,x=Math.floor(pos.x/size),y=Math.floor(pos.y/size),px=matrix[y][x];px+=1;if(px>=colorDepth){px=0}matrix[y][x]=px;str=IMG.chunkToString(matrix,colorDepth);inputStr.value=parseInt(str,colorDepth);IMG.draw(canvas,matrix);ctx.fillStyle="lime";ctx.textBaseline="top";ctx.font="10px arial";ctx.fillText("v0.0.0",5,canvas.height-15)});inputStr.addEventListener("keyup",function(e){var text=e.target.value,n=parseInt(text);if(n.toString()!="NaN"){if(n>=IMG.totalImages(w,h,colorDepth)){n=e.target.value=IMG.totalImages(w,h,colorDepth)-1}if(n<0){n=e.target.value=0}str=IMG.stringFromIndex(n,colorDepth,w*h);matrix=IMG.stringToChunk(str,w);IMG.draw(canvas,matrix)}});
