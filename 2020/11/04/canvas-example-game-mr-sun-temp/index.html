<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Mr sun Temp and Fusion plug-ins canvas example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I am going to try something new when it comes to todays canvas example post, I am not going to just start a whole new example from the ground up. Often I do borrow a little code here and there from ot">
<meta property="og:type" content="article">
<meta property="og:title" content="Mr sun Temp and Fusion plug-ins canvas example">
<meta property="og:url" content="https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="I am going to try something new when it comes to todays canvas example post, I am not going to just start a whole new example from the ground up. Often I do borrow a little code here and there from ot">
<meta property="og:updated_time" content="2020-11-06T22:18:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mr sun Temp and Fusion plug-ins canvas example">
<meta name="twitter:description" content="I am going to try something new when it comes to todays canvas example post, I am not going to just start a whole new example from the ground up. Often I do borrow a little code here and there from ot">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83195184-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas-Examples</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-canvas-example-game-mr-sun-temp" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/04/canvas-example-game-mr-sun-temp/" class="article-date"> Published:
  <time datetime="2020-11-04T18:28:00.000Z" itemprop="datePublished">2020-11-04</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2020/11/04/canvas-example-game-mr-sun-temp/" class="article-date"> Modified:
  <time datetime="2020-11-06T22:18:49.000Z" itemprop="dateModified">2020-11-06</time>
</a>

    <span class="article-date">V1.21</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/canvas/">canvas</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Mr sun Temp and Fusion plug-ins canvas example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>I am going to try something new when it comes to todays <a href="/2020/03/23/canvas-example/">canvas example</a> post, I am not going to just start a whole new example from the ground up. Often I do borrow a little code here and there from other examples, and projects when and where doing so is called for. However today I am going to just copy the whole source code of my Mr sun example at version 0.1.0 and start from there by just adding a few plug-ins to it, and making any changes that are needed to the source in the process if any.</p>
<p>So this way I am not starting over from the beginning, but if I need to I can make some changes that will not effect the other project. I can however add them to it later on if I feel as though such changes should be added.</p>
<p>Anyway this canvas example will then be a continuation of sorts on my Mr Sun game that I think might have some potential if I put a bit more time into it. In the game the player controls the position of a Sun object that effects the other word section objects that are centered around the sun object. In this post I am using the same core source code more or less, but I am adding two plug-ins to it that have to do with setting an updating a temp property for each section. In addition I am also starting another plug-in that has to do with fusion in the game, which I think would be another cool feature.</p>
<a id="more"></a>
<p><div id="canvas-app" style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div></p>
<script>var utils={};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect();return{x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx}};utils.distance=function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))};utils.logPer=function(per,a,b){a=a===undefined?2:a;b=b===undefined?a:b;per=per<0?0:per;per=per>1?1:per;return Math.log(1+a-2+per)/Math.log(b)};utils.createLogPerObject=function(i,len,base,max,a,b){a=a===undefined?2:a;b=b===undefined?a:b;base=base===undefined?0:base;max=max===undefined?1:max;var per=i/len,logPer=utils.logPer(per,a,b);return{i:i,len:len,per:per,logPer:logPer,n:base+logPer*(max-base),valueOf:function(){return this.n}}};utils.createLogPerCollection=function(opt){opt=opt||{};opt.len=opt.len===undefined?100:opt.len;opt.base=opt.base===undefined?0:opt.base;opt.max=opt.max===undefined?50:opt.max;opt.a=opt.a===undefined?2:opt.a;opt.b=opt.b===undefined?opt.a:opt.b;var i=0,obj,collection={len:opt.len,base:opt.base,max:opt.max,a:opt.a,b:opt.b};collection.data=[];while(i<opt.len){obj=utils.createLogPerObject(i,opt.len,opt.base,opt.max,opt.a,opt.b);collection.data.push(obj);i+=1}return collection};var gameMod=function(){var plugs={};var getCallPrioritySorted=function(){var keys=Object.keys(plugs);return keys.sort(function(a,b){var plugObjA=plugs[a],plugObjB=plugs[b];if(plugObjA.callPriority>plugObjB.callPriority){return 1}if(plugObjA.callPriority<plugObjB.callPriority){return-1}return 0})};var usePlugs=function(game,methodName,args){methodName=methodName||"create";args=args||[game];var keys=getCallPrioritySorted();keys.forEach(function(plugKey){var plugObj=plugs[plugKey],method=plugObj[methodName];if(method){method.apply(plugObj,args)}})};var api={};api.create=function(opt){opt=opt||{};opt.canvas=opt.canvas||{width:320,height:240};var game={};game.centerX=opt.centerX||opt.canvas.width/2;game.centerY=opt.centerY||opt.canvas.height/2;game.sectionRadius=opt.sectionRadius||16;game.worldRadius=opt.worldRadius||100;game.secs=0;game.year=0;game.yearRate=opt.yearRate||1;game.sun={radius:16,x:game.centerX,y:game.centerY,sunGrid:{}};var i=0,sections=[],total=opt.sectionCount||20,radian,cx=game.centerX,cy=game.centerY;while(i<total){radian=Math.PI*2/total*i;sections.push({i:i,x:Math.cos(radian)*game.worldRadius+cx,y:Math.sin(radian)*game.worldRadius+cy,radius:game.sectionRadius,per:1});i+=1}game.sections=sections;usePlugs(game,"create",[game,opt]);gameMod.updateSections(game);return game};api.updateSections=function(game){var sun=game.sun;game.sections.forEach(function(section){var ajust=section.radius+sun.radius;var d=utils.distance(section.x,section.y,sun.x,sun.y)-ajust;var per=d/(game.worldRadius*2-ajust*2);per=per>1?1:per;per=per<0?0:per;per=1-per;section.per=per})};api.getSectionByPos=function(game,x,y){var section,i=game.sections.length;while(i--){section=game.sections[i];if(utils.distance(section.x,section.y,x,y)<=section.radius){return section}}return false};var boundToCircle=function(obj,cx,cy,radius){if(utils.distance(obj.x,obj.y,cx,cy)>radius){var a=Math.atan2(obj.y-cy,obj.x-cx);obj.x=cx+Math.cos(a)*radius;obj.y=cy+Math.sin(a)*radius}};api.moveSun=function(game,pos){var ajust=game.sun.radius+game.sectionRadius;game.sun.x=pos.x;game.sun.y=pos.y;boundToCircle(game.sun,game.centerX,game.centerY,game.worldRadius-ajust);api.updateSections(sm.game)};api.update=function(game,secs){game.secs+=secs;var deltaYears=Math.floor(game.secs/game.yearRate);if(deltaYears>=1){game.year+=deltaYears;game.secs%=game.yearRate;usePlugs(game,"onDeltaYear",[game,deltaYears])}};api.load=function(plugObj){var len=Object.keys(plugs).length;plugObj.name=plugObj.name||len;plugObj.callPriority=plugObj.callPriority||len;plugs[plugObj.name]=plugObj};return api}();var draw=function(){var api={};var drawMineralList=function(ctx,obj,startY,fontSize){startY=startY===undefined?0:startY;fontSize=fontSize||10;if(obj.minerals){ctx.font=fontSize+"px arial";Object.keys(obj.minerals).forEach(function(min,i){ctx.fillText(min+": "+obj.minerals[min].toFixed(2),10,startY+i*fontSize)})}};api.sectionData=function(sm,section){ctx.fillStyle="white";ctx.textAlign="left";ctx.textBaseline="top";ctx.font="15px arial";ctx.fillText("section "+section.i,10,10);ctx.font="10px arial";ctx.fillText("groundTemp: "+section.groundTemp.toFixed(2),10,30);ctx.fillText("temp: "+section.temp.toFixed(2),10,40);drawMineralList(ctx,section,50,10)};api.sections=function(sm){var ctx=sm.ctx;sm.game.sections.forEach(function(section){var b=50+Math.round(section.per*128);ctx.fillStyle="rgb(0,0,"+b+")";ctx.beginPath();ctx.arc(section.x,section.y,section.radius,0,Math.PI*2);ctx.fill();ctx.fillStyle="white";ctx.textAlign="center";ctx.textBaseline="middle";ctx.font="8px arial";ctx.fillText(section.per.toFixed(2),section.x,section.y-5);ctx.fillText(section.temp.toFixed(2),section.x,section.y+5)})};api.sunData=function(sm,sun){var game=sm.game;ctx.fillStyle="white";ctx.textAlign="left";ctx.textBaseline="top";ctx.font="15px arial";ctx.fillText("Sun Status: ",10,10);ctx.font="10px arial";ctx.fillText("status: "+game.sun.state,10,30);ctx.fillText("years: "+game.tempData.years,10,40);ctx.fillText("temp: "+sun.temp.toFixed(2),10,50);ctx.fillText("tempLevel: "+game.tempData.i+"/"+Number(game.tempData.len-1),10,60);drawMineralList(ctx,sun,70,10);var h=100,w=100,sy=150,sx=200;ctx.fillStyle="#5f5f5f";ctx.fillRect(sx,sy-h,w,h);ctx.beginPath();sun.sunGrid.data.forEach(function(tempObj){ctx.strokeStyle="white";ctx.fillStyle="black";var temp=tempObj.valueOf(),y=sy-h*(temp/sun.sunGrid.max),x=sx+w*tempObj.per;if(tempObj.i===0){ctx.moveTo(x,y)}else{ctx.lineTo(x,y)}if(tempObj.i===game.tempData.i){ctx.stroke();ctx.beginPath();ctx.arc(x,y,2,0,Math.PI*2);ctx.stroke();ctx.fill();ctx.beginPath()}});ctx.stroke()};api.sun=function(sm){var sun=sm.game.sun,color="yellow",textColor="black",ctx=sm.ctx;if(sun.state==="dead"){color="black";textColor="white"}ctx.fillStyle=color;ctx.beginPath();ctx.arc(sun.x,sun.y,sun.radius,0,Math.PI*2);ctx.fill();ctx.fillStyle=textColor;ctx.font="10px arial";if(sun.state==="alive"){ctx.fillText(Math.round(sun.temp),sun.x,sun.y)}if(sun.state==="dead"){ctx.fillText(Math.round(sun.toAlivePer*100),sun.x,sun.y)}};api.back=function(sm){sm.ctx.fillStyle="#202020";sm.ctx.fillRect(0,0,sm.canvas.width,sm.canvas.height)};api.disp=function(sm){var ctx=sm.ctx;ctx.fillStyle="white";ctx.textAlign="left";ctx.textBaseline="top";ctx.font="10px courier";ctx.fillText("year: "+sm.game.year,3,3)};api.ver=function(sm){var ctx=sm.ctx;ctx.fillStyle="white";ctx.textAlign="left";ctx.textBaseline="top";ctx.font="10px courier";ctx.fillText("v"+sm.ver,10,sm.canvas.height-15)};return api}();gameMod.load({name:"sun",callPriority:"0",create:function(game,opt){var sun=game.sun;sun.state="dead";sun.spawnRate=20;sun.deadYears=0;sun.toAlivePer=0;sun.lifeSpan=0},onDeltaYear:function(game,deltaYears){var sun=game.sun;if(sun.state==="explode"){sun.deadYears=0;sun.toAlivePer=0;sun.state="dead"}if(sun.state==="dead"){sun.deadYears+=deltaYears;sun.deadYears=sun.deadYears>sun.spawnRate?sun.spawnRate:sun.deadYears;sun.toAlivePer=sun.deadYears/sun.spawnRate;if(sun.toAlivePer>=1){sun.state="alive";sun.lifeSpan=1e3}}if(sun.state==="alive"){sun.lifeSpan-=deltaYears;sun.lifeSpan=sun.lifeSpan<0?0:sun.lifeSpan;if(sun.lifeSpan===0){sun.state="explode"}}}});gameMod.load(function(){var updateSun=function(game,deltaYears){var td=game.tempData;if(game.sun.state==="dead"){game.sun.temp=0;td.years=0;td.i=0;td.globalMaxGroundTemp=game.tempData.max}if(game.sun.state==="alive"){updateLiveSun(game,deltaYears)}};var updateLiveSun=function(game,deltaYears){var td=game.tempData;td.years+=deltaYears;td.i=Math.floor(td.years/td.iAtYears);td.i=td.i>=td.len?td.len-1:td.i;td.temp=utils.createLogPerObject(td.i,td.len,td.base,td.max);game.sun.temp=td.temp.valueOf();td.globalMaxGroundTemp=game.sun.temp/10};var updateTempSections=function(game,deltaYears){var i=game.sections.length,td=game.tempData,section;while(i--){section=game.sections[i];if(Math.floor(section.per*100)>=49){section.groundTemp+=game.sun.temp/10*section.per}else{section.groundTemp-=section.groundTemp/100}section.maxGroundTemp=td.globalMaxGroundTemp*section.per;section.groundTemp=section.groundTemp<.25?0:section.groundTemp;section.groundTemp=section.groundTemp>section.maxGroundTemp?section.maxGroundTemp:section.groundTemp;section.temp=section.groundTemp+game.sun.temp*section.per}};return{name:"temp",callPriority:"1.0",create:function(game,opt){var td=game.tempData={i:0,len:100,base:10,max:500,years:0,iAtYears:100,temp:{},globalMaxGroundTemp:0};updateSun(game,0);game.sections=game.sections.map(function(section){section.temp=0;section.groundTemp=0;return section})},onDeltaYear:function(game,deltaYears){updateSun(game,deltaYears);updateTempSections(game,deltaYears)}}}());gameMod.load(function(){var getMinDelta=function(sun,rate,temp,deltaYears){return rate*Math.floor(sun.temp/temp)*deltaYears};var createMineralsObj=function(){return{copper:0,iron:0}};return{name:"fusion",callPriority:"1.1",create:function(game,opt){game.sun.minerals=createMineralsObj();var i=game.sections.length,section;while(i--){section=game.sections[i];section.minerals=createMineralsObj()}},onDeltaYear:function(game,deltaYears){var sun=game.sun;if(sun.state==="alive"){if(sun.temp>=10){sun.minerals.iron+=getMinDelta(sun,1,10,deltaYears)}if(sun.temp>=25){sun.minerals.copper+=getMinDelta(sun,.5,25,deltaYears)}var i=game.sections.length,section;while(i--){section=game.sections[i];if(section.per>.95){Object.keys(sun.minerals).forEach(function(minKey){var minCount=sun.minerals[minKey];var transferAmount=1*deltaYears;if(minCount>=transferAmount){section.minerals[minKey]+=transferAmount;sun.minerals[minKey]-=transferAmount}})}}}if(sun.state==="explode"){Object.keys(sun.minerals).forEach(function(minKey){var minCount=sun.minerals[minKey],i=game.sections.length,section;if(minCount>0){while(i--){section=game.sections[i];section.minerals[minKey]+=Math.floor(minCount/game.sections.length*section.per)}sun.minerals[minKey]=0}})}}}}());var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),container=document.getElementById("canvas-app")||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(.5,.5);var changeState=function(sm,stateKey,opt){opt=opt||{};var newState=sm.states[stateKey];if(newState.start){newState.start(sm,opt)}sm.currentState=stateKey};var states={game:{init:function(sm){sm.game=gameMod.create({canvas:sm.canvas,sectionCount:19,worldRadius:100,yearRate:.01})},update:function(sm,secs){gameMod.update(sm.game,secs);draw.back(sm);draw.sections(sm);draw.sun(sm);draw.disp(sm);draw.ver(sm)},pointerStart:function(sm,pos,e){},pointerMove:function(sm,pos,e){var sun=sm.game.sun;if(sm.input.pointerDown){gameMod.moveSun(sm.game,pos)}},pointerEnd:function(sm,pos){if(sm.input.d<3){var section=gameMod.getSectionByPos(sm.game,pos.x,pos.y);if(section){changeState(sm,"observe_section",{section:section})}if(utils.distance(sm.game.sun.x,sm.game.sun.y,pos.x,pos.y)<=sm.game.sun.radius){changeState(sm,"observe_sun",{})}}}},observe_section:{data:{section:{}},start:function(sm,opt){sm.states["observe_section"].data.section=opt.section},update:function(sm,secs){gameMod.update(sm.game,secs);draw.back(sm);draw.sectionData(sm,sm.states["observe_section"].data.section)},pointerEnd:function(sm){changeState(sm,"game",{})}},observe_sun:{data:{},start:function(sm,opt){},update:function(sm,secs){var state=sm.states["observe_sun"],td=sm.game.tempData;gameMod.update(sm.game,secs);sm.game.sun.sunGrid=utils.createLogPerCollection({len:td.len,base:td.base,max:td.max});draw.back(sm);draw.sunData(sm,sm.game.sun)},pointerEnd:function(sm){changeState(sm,"game",{})}}};var sm={ver:"0.5.0",canvas:canvas,currentState:"game",ctx:ctx,game:{},states:states,input:{pointerDown:false,d:0,startPos:{x:0,y:0},pos:{x:0,y:0}}};var pointerHanders={start:function(sm,pos,e){var pos=sm.input.pos;sm.input.pointerDown=true;sm.input.startPos={x:pos.x,y:pos.y};sm.input.d=0;var method=states[sm.currentState].pointerStart;if(method){method(sm,pos,e)}},move:function(sm,pos,e){var method=states[sm.currentState].pointerMove,startPos=sm.input.startPos;sm.input.d=utils.distance(startPos.x,startPos.y,pos.x,pos.y);if(method){method(sm,pos,e)}},end:function(sm,pos,e){sm.input.pointerDown=false;var method=states[sm.currentState].pointerEnd;if(method){method(sm,pos,e)}}};var createPointerHandler=function(sm,type){return function(e){var pos=utils.getCanvasRelative(e);sm.input.pos=pos;e.preventDefault();pointerHanders[type](sm,pos,e)}};canvas.addEventListener("mousedown",createPointerHandler(sm,"start"));canvas.addEventListener("mousemove",createPointerHandler(sm,"move"));canvas.addEventListener("mouseup",createPointerHandler(sm,"end"));canvas.addEventListener("touchstart",createPointerHandler(sm,"start"));canvas.addEventListener("touchmove",createPointerHandler(sm,"move"));canvas.addEventListener("touchend",createPointerHandler(sm,"end"));states[sm.currentState].init(sm);var lt=new Date,FPS_target=30;var loop=function(){var now=new Date,t=now-lt,secs=t/1e3;requestAnimationFrame(loop);if(t>=1e3/FPS_target){states[sm.currentState].update(sm,secs);lt=now}};loop();</script>

<h2 id="1-What-to-know-before-hand"><a href="#1-What-to-know-before-hand" class="headerlink" title="1 - What to know before hand"></a>1 - What to know before hand</h2><p>This canvas example is a fork of my starting Mr Sun canvas example. The source code is not to different from that example at least when it comes to the core of the application itself. I have made a few changes here that I might add to the core example at a later point, but for now this post, and example is more about the plug-ins.</p>
<p>I wanted to create at least two plug-ins as a way to test out how the system works thus far, and maybe add some features as needed. This far as of 0.2.0 of this example I have just added a way to set a call priory for plug-ins which is just a way to make sure that a plug-in that depends on smoother plug in is called in the proper order.</p>
<h2 id="2-The-sun-js-plug-in"><a href="#2-The-sun-js-plug-in" class="headerlink" title="2 - The sun.js plug-in"></a>2 - The sun.js plug-in</h2><p>The sun plug-in has to do with adding, and updating some additional advanced properties for the sun object. mainly thus far it has to do with spawning the sun object from a dead state to an alive state, and also back again once it reaches the end of its life cycle.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// sun.js plug-in</span></div><div class="line"><span class="comment">// append advanced properties to the sun</span></div><div class="line"><span class="comment">// object made with gameMod.create</span></div><div class="line">gameMod.load(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'sun'</span>,</div><div class="line">    <span class="attr">callPriority</span>: <span class="string">'0'</span>,</div><div class="line">    <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, opt</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> sun = game.sun;</div><div class="line">        sun.state = <span class="string">'dead'</span>;</div><div class="line">        sun.spawnRate = <span class="number">20</span>;</div><div class="line">        sun.deadYears = <span class="number">0</span>;</div><div class="line">        sun.toAlivePer = <span class="number">0</span>;</div><div class="line">        sun.lifeSpan = <span class="number">0</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onDeltaYear</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> sun = game.sun;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'explode'</span>)&#123;</div><div class="line">            sun.deadYears = <span class="number">0</span>;</div><div class="line">            sun.toAlivePer = <span class="number">0</span>;</div><div class="line">            sun.state = <span class="string">'dead'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'dead'</span>)&#123;</div><div class="line">            sun.deadYears += deltaYears;</div><div class="line">            sun.deadYears = sun.deadYears &gt; sun.spawnRate ? sun.spawnRate: sun.deadYears;</div><div class="line">            sun.toAlivePer = sun.deadYears / sun.spawnRate;</div><div class="line">            <span class="keyword">if</span>(sun.toAlivePer &gt;= <span class="number">1</span>)&#123;</div><div class="line">                sun.state = <span class="string">'alive'</span>;</div><div class="line">                sun.lifeSpan = <span class="number">1000</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'alive'</span>)&#123;</div><div class="line">            sun.lifeSpan -= deltaYears;</div><div class="line">            sun.lifeSpan = sun.lifeSpan &lt; <span class="number">0</span> ? <span class="number">0</span> : sun.lifeSpan;</div><div class="line">            <span class="keyword">if</span>(sun.lifeSpan === <span class="number">0</span>)&#123;</div><div class="line">                sun.state = <span class="string">'explode'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="3-The-temp-js-plug-in"><a href="#3-The-temp-js-plug-in" class="headerlink" title="3 - The temp.js plug-in"></a>3 - The temp.js plug-in</h2><p>One of the core reasons of this fork of Mr Sun is to work out the plug-in that will be used to set a temperature value for the sun object itself, as well as all the sections around the sun. The current distance between the Sun object, and a section is of course the core feature of the game that will impact this, as well as many other things in the game. However there is more to it then just working out a single expression and moving on with this, there are a few things that come to mind when it comes to how temperature will be set for the sections actually, and this plug-in alone will probably eat up a fair amount of time to get just right.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">gameMod.load((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// update sun temp</span></div><div class="line">    <span class="keyword">var</span> updateSun = <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> td = game.tempData;</div><div class="line">        <span class="keyword">if</span>(game.sun.state === <span class="string">'dead'</span>)&#123;</div><div class="line">            game.sun.temp = <span class="number">0</span>;</div><div class="line">            td.years = <span class="number">0</span>;</div><div class="line">            td.i = <span class="number">0</span>;</div><div class="line">            td.globalMaxGroundTemp = game.tempData.max;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(game.sun.state === <span class="string">'alive'</span>)&#123;</div><div class="line">            updateLiveSun(game, deltaYears);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a live sun</span></div><div class="line">    <span class="keyword">var</span> updateLiveSun = <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">        <span class="comment">// sun will gain temp over time</span></div><div class="line">        <span class="keyword">var</span> td = game.tempData;</div><div class="line">        td.years += deltaYears;</div><div class="line">        td.i = <span class="built_in">Math</span>.floor(td.years / td.iAtYears);</div><div class="line">        td.i = td.i &gt;= td.len ? td.len - <span class="number">1</span> : td.i;</div><div class="line">        td.temp = utils.createLogPerObject(td.i, td.len, td.base, td.max);</div><div class="line">        <span class="comment">// SET SUN TEMP</span></div><div class="line">        game.sun.temp = td.temp.valueOf();</div><div class="line">        <span class="comment">// I think globalMaxGroundTemp should not be fixed, but should also not be the same as the sun</span></div><div class="line">        <span class="comment">// something crude like just dividing by 10 might work for now.</span></div><div class="line">        td.globalMaxGroundTemp = game.sun.temp / <span class="number">10</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update temp for sections</span></div><div class="line">    <span class="keyword">var</span> updateTempSections = <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">        <span class="comment">// update temp of sections</span></div><div class="line">        <span class="keyword">var</span> i = game.sections.length,</div><div class="line">        td = game.tempData,</div><div class="line">        section;</div><div class="line">        <span class="keyword">while</span>(i--)&#123;</div><div class="line">            section = game.sections[i];</div><div class="line">            <span class="comment">// ground temp goes up when section.per &gt;= 49</span></div><div class="line">            <span class="keyword">if</span>(<span class="built_in">Math</span>.floor(section.per * <span class="number">100</span>) &gt;= <span class="number">49</span>)&#123;</div><div class="line">                section.groundTemp += game.sun.temp / <span class="number">10</span> * section.per;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                section.groundTemp -= section.groundTemp / <span class="number">100</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// section max ground temp set by section.per and global max ground temp value</span></div><div class="line">            section.maxGroundTemp = td.globalMaxGroundTemp * section.per;</div><div class="line">            section.groundTemp = section.groundTemp &lt; <span class="number">0.25</span> ? <span class="number">0</span>: section.groundTemp;</div><div class="line">            section.groundTemp = section.groundTemp &gt; section.maxGroundTemp ? section.maxGroundTemp: section.groundTemp;</div><div class="line">            <span class="comment">// SET SECTION TEMP</span></div><div class="line">            section.temp = section.groundTemp + game.sun.temp * section.per;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// plugObj for temp.js</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'temp'</span>,</div><div class="line">        <span class="attr">callPriority</span>: <span class="string">'1.0'</span>,</div><div class="line">        <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, opt</span>)</span>&#123;</div><div class="line">            <span class="comment">// create tempData object</span></div><div class="line">            <span class="keyword">var</span> td = game.tempData = &#123;</div><div class="line">                <span class="attr">i</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">len</span>: <span class="number">100</span>,</div><div class="line">                <span class="attr">base</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">max</span>: <span class="number">500</span>,</div><div class="line">                <span class="attr">years</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">iAtYears</span>: <span class="number">100</span>,</div><div class="line">                <span class="attr">temp</span>: &#123;&#125;,</div><div class="line">                <span class="attr">globalMaxGroundTemp</span>: <span class="number">0</span></div><div class="line">            &#125;;</div><div class="line">            <span class="comment">// update for first time</span></div><div class="line">            updateSun(game, <span class="number">0</span>);</div><div class="line">            <span class="comment">// set section temp values</span></div><div class="line">            game.sections = game.sections.map(<span class="function"><span class="keyword">function</span>(<span class="params">section</span>)</span>&#123;</div><div class="line">                section.temp = <span class="number">0</span>;</div><div class="line">                section.groundTemp = <span class="number">0</span>;</div><div class="line">                <span class="keyword">return</span> section;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">onDeltaYear</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">            updateSun(game, deltaYears);</div><div class="line">            updateTempSections(game, deltaYears);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;()));</div></pre></td></tr></table></figure>
<h2 id="4-The-fusion-js-plug-in"><a href="#4-The-fusion-js-plug-in" class="headerlink" title="4 - The fusion.js plug-in"></a>4 - The fusion.js plug-in</h2><p>Another idea I have for a plug-in was a fusion plug-in that is a way for minerals to be produce in the game. I am thinking that minerals will just be one aspect of what will need to happen in this little game world of mine, and like the temp plug-in, it is another core aspect of the game mechanics that other future plug-ins will depend on. In time I aim to create additional plug-ins that will have to do with geology, the atmosphere, basic life, and civilization all of which have to do with elements, and molecules composed of elements. So in this game it makes sense to have a plug-in that serves as a way to create these resources.</p>
<p>The plug-in design started out with making fusion something that happens in the world sections, rather than the sun. In this game I am not making an effort to make some kind of realistic simulation of course, this is very much just a game, and the goal is to just simply have fun. So this mechanic of having fusion just be something that happens in the world sections does strike me as one way to go about handling this aspect of the game mechanics. However the idea of making fusion something that happens in the sun object would make more sense when it comes to a real world understanding of fusion, so with that said I chose to take things in that direction.</p>
<p>So then this plug-in creates mineral count objects for both the sun object, and each world section object. Fusion is then something that takes place in the sun object where minerals are produced. Minerals can then end up in the world section by two different ways. One way is when the sun dies, when this happens all mineral get transferred to the world sections. The other way is when the sun object gets real close to a world section minerals transfer to the section that way.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// fusion.js</span></div><div class="line">gameMod.load((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// helper for creating a delta value for mineral production</span></div><div class="line">    <span class="keyword">var</span> getMinDelta = <span class="function"><span class="keyword">function</span>(<span class="params">sun, rate, temp, deltaYears</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> rate * <span class="built_in">Math</span>.floor(sun.temp / temp) * deltaYears;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create a minerals object</span></div><div class="line">    <span class="keyword">var</span> createMineralsObj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">copper</span>: <span class="number">0</span>, </div><div class="line">            <span class="attr">iron</span>: <span class="number">0</span> </div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// the plugObj for fusion</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'fusion'</span>,</div><div class="line">        <span class="attr">callPriority</span>: <span class="string">'1.1'</span>,</div><div class="line">        <span class="attr">create</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, opt</span>)</span>&#123;</div><div class="line">            <span class="comment">// minerals object for the sun</span></div><div class="line">            game.sun.minerals = createMineralsObj();</div><div class="line">            <span class="comment">// minerals objects for each section</span></div><div class="line">            <span class="keyword">var</span> i = game.sections.length,</div><div class="line">            section;</div><div class="line">            <span class="keyword">while</span>(i--)&#123;</div><div class="line">                section = game.sections[i];</div><div class="line">                section.minerals = createMineralsObj();</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">onDeltaYear</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, deltaYears</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> sun = game.sun;</div><div class="line"> </div><div class="line">            <span class="comment">// fusion happens in the sun</span></div><div class="line">            <span class="keyword">if</span>(sun.state === <span class="string">'alive'</span>)&#123;</div><div class="line">                <span class="keyword">if</span>(sun.temp &gt;= <span class="number">10</span>)&#123;</div><div class="line">                    sun.minerals.iron += getMinDelta(sun, <span class="number">1</span>, <span class="number">10</span>, deltaYears);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(sun.temp &gt;= <span class="number">25</span>)&#123;</div><div class="line">                    sun.minerals.copper += getMinDelta(sun, <span class="number">0.5</span>, <span class="number">25</span>, deltaYears);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// transfer to sections</span></div><div class="line">                <span class="keyword">var</span> i = game.sections.length,</div><div class="line">                section;</div><div class="line">                <span class="keyword">while</span>(i--)&#123;</div><div class="line">                    section = game.sections[i];</div><div class="line">                    <span class="keyword">if</span>(section.per &gt; <span class="number">0.95</span>)&#123;</div><div class="line">                       <span class="built_in">Object</span>.keys(sun.minerals).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">minKey</span>)</span>&#123;</div><div class="line">                           <span class="keyword">var</span> minCount = sun.minerals[minKey];</div><div class="line">                           <span class="keyword">var</span> transferAmount = <span class="number">1</span> * deltaYears;</div><div class="line">                           <span class="keyword">if</span>(minCount &gt;= transferAmount)&#123;</div><div class="line">                               section.minerals[minKey] += transferAmount;</div><div class="line">                               sun.minerals[minKey] -= transferAmount;</div><div class="line">                           &#125;</div><div class="line">                       &#125;);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span>(sun.state === <span class="string">'explode'</span>)&#123;</div><div class="line">                <span class="built_in">Object</span>.keys(sun.minerals).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">minKey</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> minCount = sun.minerals[minKey],</div><div class="line">                    i = game.sections.length,</div><div class="line">                    section;</div><div class="line">                    <span class="keyword">if</span>(minCount &gt; <span class="number">0</span>)&#123;</div><div class="line">                        <span class="keyword">while</span>(i--)&#123;</div><div class="line">                            section = game.sections[i];</div><div class="line">                            section.minerals[minKey] += <span class="built_in">Math</span>.floor(minCount / game.sections.length * section.per);</div><div class="line">                        &#125;</div><div class="line">                        sun.minerals[minKey] = <span class="number">0</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line"> </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;()));</div></pre></td></tr></table></figure>
<h2 id="5-utils-js"><a href="#5-utils-js" class="headerlink" title="5 - utils.js"></a>5 - utils.js</h2><p>I wanted to add a few methods to the utils.js module for mr sun that I worked out in another canvas example, mainly the utils.logPer method. I have not yet worked out an experience point system that I am truly happy with, but that is not to say that I do not have systems work out for that. There is my post an an experience point system module, and also the canvas example that has to do with creating a logarithmic percentage value from a linear one.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"> </div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect();</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">x</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientX : e.clientX) - bx.left,</div><div class="line">        <span class="attr">y</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientY : e.clientY) - bx.top,</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.logPer = <span class="function"><span class="keyword">function</span> (<span class="params">per, a, b</span>) </span>&#123;</div><div class="line">    a = a === <span class="literal">undefined</span> ? <span class="number">2</span> : a;</div><div class="line">    b = b === <span class="literal">undefined</span> ? a : b;</div><div class="line">    per = per &lt; <span class="number">0</span> ? <span class="number">0</span> : per;</div><div class="line">    per = per &gt; <span class="number">1</span> ? <span class="number">1</span> : per;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.log((<span class="number">1</span> + a - <span class="number">2</span>) + per) / <span class="built_in">Math</span>.log(b);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.createLogPerObject = <span class="function"><span class="keyword">function</span>(<span class="params">i, len, base, max, a, b</span>)</span>&#123;</div><div class="line">    a = a === <span class="literal">undefined</span> ? <span class="number">2</span>: a;</div><div class="line">    b = b === <span class="literal">undefined</span> ? a: b;</div><div class="line">    base = base === <span class="literal">undefined</span> ? <span class="number">0</span>: base;</div><div class="line">    max = max === <span class="literal">undefined</span> ? <span class="number">1</span>: max;</div><div class="line">    <span class="keyword">var</span> per = i / len,</div><div class="line">    logPer = utils.logPer(per, a, b);</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">i</span>: i,</div><div class="line">        <span class="attr">len</span>: len,</div><div class="line">        <span class="attr">per</span>: per,</div><div class="line">        <span class="attr">logPer</span>: logPer,</div><div class="line">        <span class="attr">n</span>: base + logPer * ( max - base ),</div><div class="line">        <span class="attr">valueOf</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.n;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.createLogPerCollection = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.len = opt.len === <span class="literal">undefined</span> ? <span class="number">100</span> : opt.len;</div><div class="line">    opt.base = opt.base === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.base;</div><div class="line">    opt.max = opt.max === <span class="literal">undefined</span> ? <span class="number">50</span> : opt.max;</div><div class="line">    opt.a = opt.a === <span class="literal">undefined</span> ? <span class="number">2</span> : opt.a;</div><div class="line">    opt.b = opt.b === <span class="literal">undefined</span> ? opt.a : opt.b;</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>, obj, collection = &#123;</div><div class="line">       <span class="attr">len</span>: opt.len,</div><div class="line">       <span class="attr">base</span>: opt.base,</div><div class="line">       <span class="attr">max</span>: opt.max,</div><div class="line">       <span class="attr">a</span>: opt.a,</div><div class="line">       <span class="attr">b</span>: opt.b</div><div class="line">    &#125;;</div><div class="line">    collection.data = [];</div><div class="line">    <span class="keyword">while</span>(i &lt; opt.len)&#123;</div><div class="line">        obj = utils.createLogPerObject(i, opt.len, opt.base, opt.max, opt.a, opt.b);</div><div class="line">        collection.data.push(obj);</div><div class="line">        i += <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> collection;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="6-The-game-js-module"><a href="#6-The-game-js-module" class="headerlink" title="6 - The game.js module"></a>6 - The game.js module</h2><p>In this fork of the Mr Sun source code I made just a few basic changes to the main game module. I think that it would be best to only make changes as they are needed rather than spending time adding features that I might not really want or need for this project.</p>
<p>Another method that I ended up working out this time is a simple get section by position helper. This method is used to get a section by way of an x and y position relative to the canvas element. In time I might want to add additional methods such as this, but for now this one alone was truly needed. I added some new states to the state machine in the main.js file that make use of it when it comes to switching to other states that are views for the sun and a single given section object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// the plug-in object</span></div><div class="line">    <span class="keyword">var</span> plugs = &#123;&#125;;</div><div class="line">    <span class="keyword">var</span> getCallPrioritySorted = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(plugs);</div><div class="line">        <span class="keyword">return</span> keys.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> plugObjA = plugs[a],</div><div class="line">            plugObjB = plugs[b];</div><div class="line">            <span class="keyword">if</span>(plugObjA.callPriority &gt; plugObjB.callPriority)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(plugObjA.callPriority &lt; plugObjB.callPriority)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// use plugins for the given method</span></div><div class="line">    <span class="keyword">var</span> usePlugs = <span class="function"><span class="keyword">function</span>(<span class="params">game, methodName, args</span>)</span>&#123;</div><div class="line">        methodName = methodName || <span class="string">'create'</span>;</div><div class="line">        args = args || [game]</div><div class="line">        <span class="keyword">var</span> keys = getCallPrioritySorted();</div><div class="line">        keys.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">plugKey</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> plugObj = plugs[plugKey],</div><div class="line">            method = plugObj[methodName];</div><div class="line">            <span class="keyword">if</span>(method)&#123;</div><div class="line">                method.apply(plugObj, args);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// create a new game state object</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.canvas = opt.canvas || &#123;<span class="attr">width</span>: <span class="number">320</span>, <span class="attr">height</span>: <span class="number">240</span> &#125;;</div><div class="line">        <span class="comment">// create base game object</span></div><div class="line">        <span class="keyword">var</span> game = &#123;&#125;;</div><div class="line">        game.centerX = opt.centerX || opt.canvas.width / <span class="number">2</span>;</div><div class="line">        game.centerY = opt.centerY || opt.canvas.height / <span class="number">2</span>;</div><div class="line">        game.sectionRadius = opt.sectionRadius || <span class="number">16</span>;</div><div class="line">        game.worldRadius = opt.worldRadius || <span class="number">100</span>;</div><div class="line">        game.secs = <span class="number">0</span>;</div><div class="line">        game.year = <span class="number">0</span>;</div><div class="line">        game.yearRate = opt.yearRate || <span class="number">1</span>;</div><div class="line">        <span class="comment">// create base sun object</span></div><div class="line">        game.sun = &#123;</div><div class="line">            <span class="attr">radius</span>: <span class="number">16</span>,</div><div class="line">            <span class="attr">x</span>: game.centerX,</div><div class="line">            <span class="attr">y</span>: game.centerY,</div><div class="line">            <span class="attr">sunGrid</span>: &#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// create sections</span></div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        sections = [],</div><div class="line">        total = opt.sectionCount || <span class="number">20</span>,</div><div class="line">        radian,	</div><div class="line">        cx = game.centerX,</div><div class="line">        cy = game.centerY;</div><div class="line">        <span class="keyword">while</span>(i &lt; total)&#123;</div><div class="line">            radian = <span class="built_in">Math</span>.PI * <span class="number">2</span> / total * i;</div><div class="line">            sections.push(&#123;</div><div class="line">                <span class="attr">i</span>: i,</div><div class="line">                <span class="attr">x</span>: <span class="built_in">Math</span>.cos(radian) * game.worldRadius + cx,</div><div class="line">                <span class="attr">y</span>: <span class="built_in">Math</span>.sin(radian) * game.worldRadius + cy,</div><div class="line">                <span class="attr">radius</span>: game.sectionRadius,</div><div class="line">                <span class="attr">per</span>: <span class="number">1</span></div><div class="line">            &#125;);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        game.sections = sections;</div><div class="line">        <span class="comment">// use 'create' method of all plug-ins</span></div><div class="line">        usePlugs(game, <span class="string">'create'</span>, [game, opt]);</div><div class="line">        gameMod.updateSections(game);</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update sections</span></div><div class="line">    api.updateSections = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> sun = game.sun;</div><div class="line">        game.sections.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">section</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> ajust = section.radius + sun.radius;</div><div class="line">            <span class="keyword">var</span> d = utils.distance(section.x, section.y, sun.x, sun.y) - ajust;</div><div class="line">            <span class="keyword">var</span> per = d / (game.worldRadius * <span class="number">2</span> - ajust * <span class="number">2</span>);</div><div class="line">            per = per &gt; <span class="number">1</span> ? <span class="number">1</span>: per;</div><div class="line">            per = per &lt; <span class="number">0</span> ? <span class="number">0</span>: per;</div><div class="line">            per = <span class="number">1</span> - per;</div><div class="line">            section.per = per;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a section by canvas position</span></div><div class="line">    api.getSectionByPos = <span class="function"><span class="keyword">function</span>(<span class="params">game, x, y</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> section,</div><div class="line">        i = game.sections.length;</div><div class="line">        <span class="keyword">while</span>(i--)&#123;</div><div class="line">            section = game.sections[i];</div><div class="line">            <span class="keyword">if</span>(utils.distance(section.x, section.y, x, y) &lt;= section.radius)&#123;</div><div class="line">                <span class="keyword">return</span> section;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move sun</span></div><div class="line">    <span class="keyword">var</span> boundToCircle = <span class="function"><span class="keyword">function</span>(<span class="params">obj, cx, cy, radius</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(utils.distance(obj.x, obj.y, cx, cy) &gt; radius)&#123;</div><div class="line">            <span class="keyword">var</span> a = <span class="built_in">Math</span>.atan2(obj.y - cy, obj.x - cx);</div><div class="line">            obj.x = cx + <span class="built_in">Math</span>.cos(a) * radius;</div><div class="line">            obj.y = cy + <span class="built_in">Math</span>.sin(a) * radius;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    api.moveSun = <span class="function"><span class="keyword">function</span>(<span class="params">game, pos</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> ajust = game.sun.radius + game.sectionRadius;</div><div class="line">        game.sun.x = pos.x;</div><div class="line">        game.sun.y = pos.y;</div><div class="line">        boundToCircle(game.sun, game.centerX, game.centerY, game.worldRadius - ajust);</div><div class="line">        api.updateSections(sm.game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update method</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        game.secs += secs;</div><div class="line">        <span class="keyword">var</span> deltaYears = <span class="built_in">Math</span>.floor(game.secs / game.yearRate);</div><div class="line">        <span class="keyword">if</span>(deltaYears &gt;= <span class="number">1</span>)&#123;</div><div class="line">            game.year	 += deltaYears;</div><div class="line">            game.secs %= game.yearRate;</div><div class="line">            usePlugs(game, <span class="string">'onDeltaYear'</span>, [game, deltaYears]);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// load a plug-in</span></div><div class="line">    api.load = <span class="function"><span class="keyword">function</span>(<span class="params">plugObj</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> len = <span class="built_in">Object</span>.keys(plugs).length;</div><div class="line">        <span class="comment">// use given key name, or else use number of public keys in plugs</span></div><div class="line">        plugObj.name = plugObj.name || len;</div><div class="line">        <span class="comment">// callPriority defaults to len</span></div><div class="line">        plugObj.callPriority = plugObj.callPriority || len;</div><div class="line">        <span class="comment">// just reference the object for now</span></div><div class="line">        plugs[plugObj.name] = plugObj;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the Public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="7-The-draw-js-module"><a href="#7-The-draw-js-module" class="headerlink" title="7 - The draw.js module"></a>7 - The draw.js module</h2><p>The draw module is back with some of the usual suspects when it comes to one of my canvas example projects, such as a draw background method. One note worth additional that was added in this fork is sunData draw method in which I am drawing a graph that illustrates the current and future status of the sun.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// HELPERS</span></div><div class="line">    <span class="keyword">var</span> drawMineralList = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj, startY, fontSize</span>)</span>&#123;</div><div class="line">        startY = startY === <span class="literal">undefined</span> ? <span class="number">0</span> : startY;</div><div class="line">        fontSize = fontSize || <span class="number">10</span>;</div><div class="line">        <span class="keyword">if</span>(obj.minerals)&#123;</div><div class="line">            ctx.font = fontSize + <span class="string">'px arial'</span>;</div><div class="line">            <span class="built_in">Object</span>.keys(obj.minerals).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">min, i</span>)</span>&#123;</div><div class="line">                ctx.fillText(min + <span class="string">': '</span> + obj.minerals[min].toFixed(<span class="number">2</span>), <span class="number">10</span>, startY + i * fontSize);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// SECTIONS:</span></div><div class="line">    api.sectionData = <span class="function"><span class="keyword">function</span>(<span class="params">sm, section</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font = <span class="string">'15px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'section '</span> + section.i, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line">        ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'groundTemp: '</span> + section.groundTemp.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">30</span>);</div><div class="line">        ctx.fillText(<span class="string">'temp: '</span> + section.temp.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">40</span>);</div><div class="line">        drawMineralList(ctx, section, <span class="number">50</span>, <span class="number">10</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw sections</span></div><div class="line">    api.sections = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">        sm.game.sections.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">section</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> b = <span class="number">50</span> + <span class="built_in">Math</span>.round(section.per * <span class="number">128</span>);</div><div class="line">            ctx.fillStyle = <span class="string">'rgb(0,0,'</span> + b + <span class="string">')'</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.arc(section.x, section.y, section.radius, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">            ctx.fill();</div><div class="line">            ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">            ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">            ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">            ctx.font = <span class="string">'8px arial'</span>;</div><div class="line">            ctx.fillText(section.per.toFixed(<span class="number">2</span>), section.x, section.y<span class="number">-5</span>);</div><div class="line">            <span class="comment">//ctx.fillText(section.groundTemp.toFixed(2) + ':' + section.temp.toFixed(2), section.x, section.y+5);</span></div><div class="line">            <span class="comment">//var min = section.minerals;</span></div><div class="line">            <span class="comment">//ctx.fillText(min.copper + ':' + min.gold, section.x, section.y-5);</span></div><div class="line">            ctx.fillText(section.temp.toFixed(<span class="number">2</span>), section.x, section.y + <span class="number">5</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// SUN</span></div><div class="line">    api.sunData = <span class="function"><span class="keyword">function</span>(<span class="params">sm, sun</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font = <span class="string">'15px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'Sun Status: '</span>, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line">        ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'status: '</span> + game.sun.state, <span class="number">10</span>, <span class="number">30</span>);</div><div class="line">        ctx.fillText(<span class="string">'years: '</span> + game.tempData.years, <span class="number">10</span>, <span class="number">40</span>);</div><div class="line">        ctx.fillText(<span class="string">'temp: '</span> + sun.temp.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">50</span>);</div><div class="line">        ctx.fillText(<span class="string">'tempLevel: '</span> + game.tempData.i + <span class="string">'/'</span> + <span class="built_in">Number</span>(game.tempData.len - <span class="number">1</span>), <span class="number">10</span>, <span class="number">60</span>);</div><div class="line"> </div><div class="line">        drawMineralList(ctx, sun, <span class="number">70</span>, <span class="number">10</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// draw graph</span></div><div class="line">        <span class="keyword">var</span> h = <span class="number">100</span>,</div><div class="line">        w = <span class="number">100</span>,</div><div class="line">        sy = <span class="number">150</span>,</div><div class="line">        sx = <span class="number">200</span>;</div><div class="line">        ctx.fillStyle = <span class="string">'#5f5f5f'</span>;</div><div class="line">        ctx.fillRect(sx, sy - h, w, h);</div><div class="line">        ctx.beginPath();</div><div class="line">        sun.sunGrid.data.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">tempObj</span>)</span>&#123;</div><div class="line">            ctx.strokeStyle = <span class="string">'white'</span>;</div><div class="line">            ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">            <span class="keyword">var</span> temp = tempObj.valueOf(),</div><div class="line">            y = sy - h * (temp / sun.sunGrid.max),</div><div class="line">            x = sx + w * tempObj.per;</div><div class="line">            <span class="keyword">if</span>(tempObj.i === <span class="number">0</span>)&#123;</div><div class="line">                ctx.moveTo(x, y);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                ctx.lineTo(x, y);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(tempObj.i === game.tempData.i)&#123;</div><div class="line">                ctx.stroke();</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.arc( x, y, <span class="number">2</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">                ctx.stroke();</div><div class="line">                ctx.fill();</div><div class="line">                ctx.beginPath();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        ctx.stroke();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw sun</span></div><div class="line">    api.sun = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> sun = sm.game.sun,</div><div class="line">        color = <span class="string">'yellow'</span>,</div><div class="line">        textColor = <span class="string">'black'</span>,</div><div class="line">        ctx = sm.ctx;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'dead'</span>)&#123;</div><div class="line">            color = <span class="string">'black'</span>;</div><div class="line">            textColor = <span class="string">'white'</span>;</div><div class="line">        &#125;</div><div class="line">        ctx.fillStyle = color;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.arc(sun.x, sun.y, sun.radius, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">        ctx.fill();</div><div class="line">        ctx.fillStyle = textColor;</div><div class="line">        ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'alive'</span>)&#123;</div><div class="line">            ctx.fillText(<span class="built_in">Math</span>.round(sun.temp), sun.x, sun.y);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sun.state === <span class="string">'dead'</span>)&#123;</div><div class="line">            ctx.fillText(<span class="built_in">Math</span>.round(sun.toAlivePer * <span class="number">100</span>), sun.x, sun.y);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// MISC</span></div><div class="line"> </div><div class="line">    <span class="comment">// draw background</span></div><div class="line">    api.back = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        sm.ctx.fillStyle = <span class="string">'#202020'</span>;</div><div class="line">        sm.ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, sm.canvas.width, sm.canvas.height);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// display</span></div><div class="line">    api.disp = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font = <span class="string">'10px courier'</span>;</div><div class="line">        ctx.fillText(<span class="string">'year: '</span> + sm.game.year, <span class="number">3</span>, <span class="number">3</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw version number</span></div><div class="line">    api.ver = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font = <span class="string">'10px courier'</span>;</div><div class="line">        ctx.fillText(<span class="string">'v'</span> + sm.ver, <span class="number">10</span>, sm.canvas.height - <span class="number">15</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the Public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="8-main-js"><a href="#8-main-js" class="headerlink" title="8 - main.js"></a>8 - main.js</h2><p>Some additional have been made to the main.js of the Mr Sun source code in this fork also. For the most part it was just the addition of two new state objects for the current state machine, but no radical changes have been made to it beyond that. In future forks of this I thnk I am going to need to do something similar to what I have done with the game module, but for now I am taking a more monolithic approach here, like I did in crosshairs.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>),</div><div class="line">ctx = canvas.getContext(<span class="string">'2d'</span>),</div><div class="line">container = <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">container.appendChild(canvas);</div><div class="line">canvas.width = <span class="number">320</span>;</div><div class="line">canvas.height = <span class="number">240</span>;</div><div class="line">ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> changeState = <span class="function"><span class="keyword">function</span>(<span class="params">sm, stateKey, opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    <span class="keyword">var</span> newState = sm.states[stateKey];</div><div class="line">    <span class="keyword">if</span>(newState.start)&#123;</div><div class="line">        newState.start(sm, opt);</div><div class="line">    &#125;</div><div class="line">    sm.currentState = stateKey;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> states = &#123;</div><div class="line">    <span class="attr">game</span>: &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm</span>)</span>&#123;</div><div class="line">            <span class="comment">// setup sun object</span></div><div class="line">            sm.game = gameMod.create(&#123;</div><div class="line">                <span class="attr">canvas</span>: sm.canvas,</div><div class="line">                <span class="attr">sectionCount</span>: <span class="number">19</span>,</div><div class="line">                <span class="attr">worldRadius</span>: <span class="number">100</span>,</div><div class="line">                <span class="attr">yearRate</span>: <span class="number">0.01</span></div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// for each update tick</span></div><div class="line">        update: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            gameMod.update(sm.game, secs);</div><div class="line">            draw.back(sm);</div><div class="line">            draw.sections(sm);</div><div class="line">            draw.sun(sm);</div><div class="line">            draw.disp(sm);</div><div class="line">            draw.ver(sm);</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// events</span></div><div class="line">        pointerStart: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;&#125;,</div><div class="line">        <span class="attr">pointerMove</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> sun = sm.game.sun;</div><div class="line">            <span class="keyword">if</span>(sm.input.pointerDown)&#123;</div><div class="line">                gameMod.moveSun(sm.game, pos);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pointerEnd</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos</span>) </span>&#123;</div><div class="line">             <span class="keyword">if</span>(sm.input.d &lt; <span class="number">3</span>)&#123;</div><div class="line">                 <span class="comment">// if section click</span></div><div class="line">                 <span class="keyword">var</span> section = gameMod.getSectionByPos(sm.game, pos.x, pos.y);</div><div class="line">                 <span class="keyword">if</span>(section)&#123;</div><div class="line">                     changeState(sm, <span class="string">'observe_section'</span>, &#123;</div><div class="line">                         <span class="attr">section</span>: section</div><div class="line">                     &#125;);</div><div class="line">                 &#125;</div><div class="line">                 <span class="comment">// if sun click</span></div><div class="line">                 <span class="keyword">if</span>(utils.distance(sm.game.sun.x, sm.game.sun.y, pos.x, pos.y) &lt;= sm.game.sun.radius)&#123;</div><div class="line">                     changeState(sm, <span class="string">'observe_sun'</span>, &#123;&#125;);</div><div class="line">                 &#125;</div><div class="line">             &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">observe_section</span>: &#123;</div><div class="line">        <span class="attr">data</span>: &#123;</div><div class="line">            <span class="attr">section</span>:&#123;&#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">start</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, opt</span>)</span>&#123;</div><div class="line">            sm.states[<span class="string">'observe_section'</span>].data.section = opt.section;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, secs</span>)</span>&#123;</div><div class="line">            gameMod.update(sm.game, secs);</div><div class="line">            draw.back(sm);</div><div class="line">            draw.sectionData(sm, sm.states[<span class="string">'observe_section'</span>].data.section);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pointerEnd</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">             changeState(sm, <span class="string">'game'</span>, &#123;&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">observe_sun</span>: &#123;</div><div class="line">        <span class="attr">data</span>: &#123;</div><div class="line">            <span class="comment">//sunGrid: []</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">start</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, opt</span>)</span>&#123;</div><div class="line">            </div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> state = sm.states[<span class="string">'observe_sun'</span>],</div><div class="line">            <span class="comment">//td = sm.game.sun.tempData;</span></div><div class="line">            td = sm.game.tempData;</div><div class="line">            gameMod.update(sm.game, secs);</div><div class="line">            sm.game.sun.sunGrid = utils.createLogPerCollection(&#123;</div><div class="line">               <span class="attr">len</span>: td.len,</div><div class="line">               <span class="attr">base</span>: td.base,</div><div class="line">               <span class="attr">max</span>: td.max</div><div class="line">            &#125;);</div><div class="line">            draw.back(sm);</div><div class="line">            draw.sunData(sm, sm.game.sun);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pointerEnd</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">             changeState(sm, <span class="string">'game'</span>, &#123;&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> sm = &#123;</div><div class="line">    <span class="attr">ver</span>: <span class="string">'0.5.0'</span>,</div><div class="line">    <span class="attr">canvas</span>: canvas,</div><div class="line">    <span class="attr">currentState</span>: <span class="string">'game'</span>,</div><div class="line">    <span class="attr">ctx</span>: ctx,</div><div class="line">    <span class="attr">game</span>: &#123;&#125;,</div><div class="line">    <span class="attr">states</span>: states,</div><div class="line">    <span class="attr">input</span>: &#123;</div><div class="line">        <span class="attr">pointerDown</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">d</span>:<span class="number">0</span>,</div><div class="line">        <span class="attr">startPos</span>:&#123;</div><div class="line">             <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">             <span class="attr">y</span>: <span class="number">0</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pos</span>: &#123;</div><div class="line">            <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">y</span>: <span class="number">0</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// Pointer Events</span></div><div class="line"><span class="keyword">var</span> pointerHanders = &#123;</div><div class="line">    <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = sm.input.pos;</div><div class="line">        sm.input.pointerDown = <span class="literal">true</span>;</div><div class="line">        sm.input.startPos = &#123;</div><div class="line">            <span class="attr">x</span>: pos.x,</div><div class="line">            <span class="attr">y</span>: pos.y</div><div class="line">        &#125;;</div><div class="line">        sm.input.d = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> method = states[sm.currentState].pointerStart;</div><div class="line">        <span class="keyword">if</span>(method)&#123;</div><div class="line">            method(sm, pos, e);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">move</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> method = states[sm.currentState].pointerMove,</div><div class="line">        startPos = sm.input.startPos;</div><div class="line">        sm.input.d = utils.distance(startPos.x, startPos.y, pos.x, pos.y);</div><div class="line">        <span class="keyword">if</span>(method)&#123;</div><div class="line">            method(sm, pos, e);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">end</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">        sm.input.pointerDown = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">var</span> method = states[sm.currentState].pointerEnd;</div><div class="line">        <span class="keyword">if</span>(method)&#123;</div><div class="line">            method(sm, pos, e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> createPointerHandler = <span class="function"><span class="keyword">function</span> (<span class="params">sm, type</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = utils.getCanvasRelative(e);</div><div class="line">        sm.input.pos = pos;</div><div class="line">        e.preventDefault();</div><div class="line">        pointerHanders[type](sm, pos, e);</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// attach for mouse and touch</span></div><div class="line">canvas.addEventListener(<span class="string">'mousedown'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'mousemove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'mouseup'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'touchstart'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'touchmove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'touchend'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div><div class="line"> </div><div class="line"><span class="comment">// init current state</span></div><div class="line">states[sm.currentState].init(sm);</div><div class="line"> </div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">var</span> lt = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">FPS_target = <span class="number">30</span>;</div><div class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    t = now - lt,</div><div class="line">    secs = t / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span> (t &gt;= <span class="number">1000</span> / FPS_target) &#123;</div><div class="line">        states[sm.currentState].update(sm, secs);</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="9-Conclusion"><a href="#9-Conclusion" class="headerlink" title="9 - Conclusion"></a>9 - Conclusion</h2><p>So far I am Liking how this project is going, but there is indeed much more work that needs to be done until I have something that I can call a done deal. I think I will continue working on just this fork alone when it comes to working out additional changes that need to happen with the temp plug-in, and at least one or two additional plug-ins that are closely related to it. The focus here is on a single core plug-in that has to do with temperature, and as I move forward with additional forks.</p>
<p>Speaking of additional forks, I have started one additional fork off of this example that I am calling <a href="/2020/110/06/canvas-example-game-mr-sun-geo/">Mr Sun Geo</a>. This example just strikes me as the next logic step from here, not that I have some of the core basics of the game worked out. So then Mr Sun Geo is just a few additional improvements to the source code of the core of the application, and yet even more plug-ins that add additional features to the game. features that have to do with Geology, the water cycle, and the Atmosphere of the game world.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/" data-id="ckkbku66w004kacv1vogumwzo" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/06/canvas-example-game-mr-sun-geo/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Mr Sun Geo.js and additional plug-ins
        
      </div>
    </a>
  
  
    <a href="/2020/11/03/canvas-example-game-mr-sun/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Mr sun canvas example</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/index.html';
    this.page.identifier = '736';
    this.page.title = 'Mr sun Temp and Fusion plug-ins canvas example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.63px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.53px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.68px;">angular</a> <a href="/tags/animation/" style="font-size: 12.11px;">animation</a> <a href="/tags/automation/" style="font-size: 12.11px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.63px;">backbone</a> <a href="/tags/blog/" style="font-size: 14.74px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.95px;">canvas</a> <a href="/tags/corejs/" style="font-size: 13.16px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11.05px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.58px;">ejs</a> <a href="/tags/express/" style="font-size: 16.84px;">express</a> <a href="/tags/games/" style="font-size: 17.37px;">games</a> <a href="/tags/git/" style="font-size: 13.16px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 14.74px;">hapi</a> <a href="/tags/heroku/" style="font-size: 13.68px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.21px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.53px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.58px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 16.32px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.42px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.21px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.47px;">node.js</a> <a href="/tags/phaser/" style="font-size: 17.89px;">phaser</a> <a href="/tags/python/" style="font-size: 15.26px;">python</a> <a href="/tags/statistics/" style="font-size: 12.63px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 16.32px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 15.79px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/22/python-standard-library-random/">Random Numbers in Python</a>
          </li>
        
          <li>
            <a href="/2021/01/21/python-standard-library-datetime/">Date objects in Python</a>
          </li>
        
          <li>
            <a href="/2021/01/20/python-standard-library-re/">regular expressions in Python</a>
          </li>
        
          <li>
            <a href="/2021/01/19/python-standard-library-argparse/">Named arguments for python scripts using the argparse standard library</a>
          </li>
        
          <li>
            <a href="/2021/01/18/python-string/">Strings in python</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas-Examples</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2020/11/04/canvas-example-game-mr-sun-temp/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>