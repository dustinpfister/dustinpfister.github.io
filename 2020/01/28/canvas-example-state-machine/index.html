<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>State Machine canvas example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="For todays canvas example I made a state machine that helps to keep code broken down into many independent state objects. For simple canvas examples and projects a state machine is not needed, but if">
<meta property="og:type" content="article">
<meta property="og:title" content="State Machine canvas example">
<meta property="og:url" content="https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="For todays canvas example I made a state machine that helps to keep code broken down into many independent state objects. For simple canvas examples and projects a state machine is not needed, but if">
<meta property="og:updated_time" content="2021-03-06T20:18:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="State Machine canvas example">
<meta name="twitter:description" content="For todays canvas example I made a state machine that helps to keep code broken down into many independent state objects. For simple canvas examples and projects a state machine is not needed, but if">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83195184-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas-Examples</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-canvas-example-state-machine" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/28/canvas-example-state-machine/" class="article-date"> Published:
  <time datetime="2020-01-28T18:49:00.000Z" itemprop="datePublished">2020-01-28</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2020/01/28/canvas-example-state-machine/" class="article-date"> Modified:
  <time datetime="2021-03-06T20:18:03.000Z" itemprop="dateModified">2021-03-06</time>
</a>

    <span class="article-date">V1.32</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/canvas/">canvas</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      State Machine canvas example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>For todays <a href="/2020/03/23/canvas-example/">canvas example</a> I made a <a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="external">state machine</a> that helps to keep code broken down into many independent state objects. For simple canvas examples and projects a state machine is not needed, but if I am starting to make a serious project the use of a state machine becomes more important as a way to keep things better organized.</p>
<p>Say you want to make a project that is fairly complex and there are many states that the project needs to preform before it can even be used. For example content needs to be downloaded, and then some objects need to be initialized before the project can be started at which point the user can interact with it. </p>
<p>In addition even when a game is up and running there are many menus that the user can navigate between before starting a main game state. Once a game is over there are often two kind of outcomes to the end of the game, and how they should be treated when updating a game save. So in that kind of situation some way to compartmentalize all these different states of sorts needs to be implemented and such a thing if often referred to as a state machine.</p>
<p>Many frameworks such as phaser will have a state machine as part of the functionality of the framework, but when it comes to starting a vanilla javaScript project this aspect of the game would need to be created from the ground up. When it comes to making a canvas framework I often think that a state machine should be a part of such a framework, but I guess it does not have to be when it comes to making such a project. In any case this post will be on just one way to go about making a state machine by itself without much more beyond that.</p>
<p>So in this post I will be going over the current state of a state machine example for a canvas project. As of this writing the state of the code of this state machine is in an Alpha state for sure. When it comes to my collection of canvas examples I generally like to start each canvas example from the ground up. However this example represents the current state of a step in a new direction in which I am starting to put something together that is my own framework of sorts.</p>
<a id="more"></a>
<h2 id="1-The-utils-module"><a href="#1-The-utils-module" class="headerlink" title="1 - The utils module"></a>1 - The utils module</h2><p>First off just like any other canvas example of mine I want to start out with a generic utility library. This utility library contains methods that I might use across different modules, and also methods that I might share across other canvas examples. So they are all a bunch of stand alone methods that do something specific, and are often pure function like. For this utility library I am just using my usual create canvas method, and another typical methods that I use to get a canvas relative pointer position.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"> </div><div class="line">utils.createCanvas = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.container = opt.container || <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">    opt.canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</div><div class="line">    opt.ctx = opt.canvas.getContext(<span class="string">'2d'</span>);</div><div class="line">    <span class="comment">// assign the 'canvas_example' className</span></div><div class="line">    opt.canvas.className = <span class="string">'canvas_example'</span>;</div><div class="line">    <span class="comment">// set native width</span></div><div class="line">    opt.canvas.width = opt.width === <span class="literal">undefined</span> ? <span class="number">320</span> : opt.width;</div><div class="line">    opt.canvas.height = opt.height === <span class="literal">undefined</span> ? <span class="number">240</span> : opt.height;</div><div class="line">    <span class="comment">// translate by 0.5, 0.5</span></div><div class="line">    opt.ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line">    <span class="comment">// disable default action for onselectstart</span></div><div class="line">    opt.canvas.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line">    opt.canvas.style.imageRendering = <span class="string">'pixelated'</span>;</div><div class="line">    opt.ctx.imageSmoothingEnabled = <span class="literal">false</span>;</div><div class="line">    <span class="comment">// append canvas to container</span></div><div class="line">    opt.container.appendChild(opt.canvas);</div><div class="line">    <span class="keyword">return</span> opt;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect(),</div><div class="line">    pos = &#123;</div><div class="line">        <span class="attr">x</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientX : e.clientX) - bx.left,</div><div class="line">        <span class="attr">y</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientY : e.clientY) - bx.top,</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// ajust for native canvas matrix size</span></div><div class="line">    pos.x = <span class="built_in">Math</span>.floor((pos.x / canvas.scrollWidth) * canvas.width);</div><div class="line">    pos.y = <span class="built_in">Math</span>.floor((pos.y / canvas.scrollHeight) * canvas.height);</div><div class="line">    <span class="comment">// prevent default</span></div><div class="line">    e.preventDefault();</div><div class="line">    <span class="keyword">return</span> pos;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="2-The-State-Machine-module-for-canvas-examples"><a href="#2-The-State-Machine-module-for-canvas-examples" class="headerlink" title="2 - The State Machine module for canvas examples"></a>2 - The State Machine module for canvas examples</h2><p>In this section I will be going over the source code of the state machine module that I worked out for this post, and might use in future canvas examples and projects as is, or in a custom mutated form. The module makes use of the IFFE pattern and returns a public API as a single function that creates a state machine object. Once I have a state machine object I can then call the load method as a way to start defining state objects.</p>
<h3 id="2-1-Attach-event-handers-to-a-canvas-element"><a href="#2-1-Attach-event-handers-to-a-canvas-element" class="headerlink" title="2.1 - Attach event handers to a canvas element"></a>2.1 - Attach event handers to a canvas element</h3><p>This is the method that I worked out for attaching events to the canvas for event types like mouse down. The state manager instance should be passed as the first argument, and the canvas element should be created and append before this method is used.</p>
<p>In the body of the hander that is attached for this given DOM event type the get canvas relative position helper that I wrote about earlier in this section is used to get a canvas relative position for the event. This position will be passed to the actual hander defined in the state object as the first argument for that kind of hander, along with the state machine instance and the original event object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Machine = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// attach a canvas event</span></div><div class="line">    <span class="keyword">var</span> attachCanvasEvent = <span class="function"><span class="keyword">function</span> (<span class="params">sm, DOMType, smType</span>) </span>&#123;</div><div class="line">        sm.canvas.addEventListener(DOMType, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> pos = utils.getCanvasRelative(e),</div><div class="line">            stateObj = sm.states[sm.currentState],</div><div class="line">            handler,</div><div class="line">            mode;</div><div class="line">            <span class="comment">// prevent default</span></div><div class="line">            e.preventDefault();</div><div class="line">            <span class="comment">// call top level if there</span></div><div class="line">            <span class="keyword">if</span> (stateObj.userPointer) &#123;</div><div class="line">                handler = stateObj.userPointer[smType];</div><div class="line">                <span class="keyword">if</span> (handler) &#123;</div><div class="line">                    handler(pos, sm, e);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// call for current mode if there</span></div><div class="line">            <span class="keyword">if</span> (stateObj.modes &amp;&amp; sm.currentMode) &#123;</div><div class="line">                mode = stateObj.modes[sm.currentMode];</div><div class="line">                <span class="keyword">if</span> (mode.userPointer) &#123;</div><div class="line">                    handler = mode.userPointer[smType];</div><div class="line">                    <span class="keyword">if</span> (handler) &#123;</div><div class="line">                        handler(pos, sm, e);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// attach canvas events for the given state machine</span></div><div class="line">    <span class="keyword">var</span> attachAllCanvasEvents = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        attachCanvasEvent(sm, <span class="string">'mousedown'</span>, <span class="string">'start'</span>);</div><div class="line">        attachCanvasEvent(sm, <span class="string">'mousemove'</span>, <span class="string">'move'</span>);</div><div class="line">        attachCanvasEvent(sm, <span class="string">'mouseup'</span>, <span class="string">'end'</span>);</div><div class="line">        attachCanvasEvent(sm, <span class="string">'touchstart'</span>, <span class="string">'start'</span>);</div><div class="line">        attachCanvasEvent(sm, <span class="string">'touchmove'</span>, <span class="string">'move'</span>);</div><div class="line">        attachCanvasEvent(sm, <span class="string">'touchend'</span>, <span class="string">'end'</span>);</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<h3 id="2-2-The-public-function-that-creates-a-state-machine-object"><a href="#2-2-The-public-function-that-creates-a-state-machine-object" class="headerlink" title="2.2 - The public function that creates a state machine object"></a>2.2 - The public function that creates a state machine object</h3><p>So now it is time for the public function that is used to create the state machine instance when making a project with this state machine module. In the body of the main function I am using the utils create canvas method to create a canvas object to which I am then using to set main state machine properties for canvas and context. In the state machine object I have values for the current state that is running that will serve as a way to call the current state.</p>
<p>The state machine object also provides a load function that is how I will go about adding state objects to the state machine object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">// create a new state machine</span></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">container, w, h</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> canvasObj = utils.createCanvas();</div><div class="line">        <span class="comment">// state machine Object</span></div><div class="line">        <span class="keyword">var</span> sm = &#123;</div><div class="line">            <span class="attr">ver</span>: <span class="string">'0.0.0'</span>,</div><div class="line">            <span class="attr">currentState</span>: <span class="literal">null</span>,</div><div class="line">            <span class="attr">currentMode</span>: <span class="literal">null</span>,</div><div class="line">            <span class="attr">game</span>: &#123;&#125;,</div><div class="line">            <span class="attr">draw</span>: &#123;&#125;,</div><div class="line">            <span class="attr">states</span>: &#123;&#125;,</div><div class="line">            <span class="attr">canvas</span>: canvasObj.canvas,</div><div class="line">            <span class="attr">container</span>: canvasObj.container,  <span class="comment">//parseContainer(container),</span></div><div class="line">            ctx: canvasObj.ctx,</div><div class="line">            <span class="attr">load</span>: <span class="function"><span class="keyword">function</span> (<span class="params">stateObj</span>) </span>&#123;</div><div class="line">                <span class="comment">// just reference the object for now as long as</span></div><div class="line">                <span class="comment">// that works okay</span></div><div class="line">                sm.states[stateObj.name || <span class="string">'game'</span>] = stateObj;</div><div class="line">                <span class="keyword">if</span> (stateObj.bootState) &#123;</div><div class="line">                    sm.currentState = stateObj.name;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params">stateName</span>) </span>&#123;</div><div class="line">                sm.currentState = stateName || sm.currentState;</div><div class="line">                <span class="keyword">var</span> init = sm.states[sm.currentState].init || <span class="literal">null</span>;</div><div class="line">                <span class="keyword">if</span> (init) &#123;</div><div class="line">                    init(sm);</div><div class="line">                &#125;</div><div class="line">                loop();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// create canvas and attach event handlers</span></div><div class="line">        <span class="comment">//createCanvas(sm, w, h);</span></div><div class="line">        attachAllCanvasEvents(sm);</div><div class="line">        <span class="comment">// main loop</span></div><div class="line">        <span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            requestAnimationFrame(loop);</div><div class="line">            <span class="keyword">var</span> stateObj = sm.states[sm.currentState] || &#123;&#125;;</div><div class="line">            <span class="comment">// call top level tick</span></div><div class="line">            <span class="keyword">if</span> (stateObj.tick) &#123;</div><div class="line">                stateObj.tick(sm);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// call mode tick</span></div><div class="line">            <span class="keyword">if</span> (stateObj.modes &amp;&amp; sm.currentMode) &#123;</div><div class="line">                <span class="keyword">var</span> mode = stateObj.modes[sm.currentMode];</div><div class="line">                <span class="keyword">if</span> (mode.tick) &#123;</div><div class="line">                    mode.tick(sm);</div><div class="line">                &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> sm;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<p>In the body of the main pubic method I also have the main app loop, however I am not sure if this is something that I will keep here or not.</p>
<h2 id="3-Simple-use-case-example"><a href="#3-Simple-use-case-example" class="headerlink" title="3 - Simple use case example"></a>3 - Simple use case example</h2><p>So here is a simple use case example of the state machine module in action. This results in a very basic clicker type demo of what it is that I have worked out thus far. I am just creating a single state object for now that will also be the boot state called game. In the init method I set up some starting values for a main game object, and in the tick method I mutate that game object. For now I am also drawing to the canvas in the tick methods, also but in any future versions that I might make for this that will of course change. I am also able to define what will happen for pointer events.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sm = Machine(<span class="string">'canvas-app'</span>);</div><div class="line"> </div><div class="line">sm.load(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'game'</span>,</div><div class="line">    <span class="attr">bootState</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="keyword">var</span> g = sm.game;</div><div class="line">        g.manual = <span class="number">0</span>;</div><div class="line">        g.perManual = <span class="number">0.25</span>;</div><div class="line">        g.auto = <span class="number">0</span>;</div><div class="line">        g.autoTickRate = <span class="number">3000</span>;</div><div class="line">        g.perAutoTick = <span class="number">1</span>;</div><div class="line">        g.pos = &#123;<span class="attr">x</span>:<span class="number">0</span>,<span class="attr">y</span>:<span class="number">0</span>&#125;;</div><div class="line">        g.lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"> </div><div class="line">    &#125;,</div><div class="line">    <span class="attr">tick</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="keyword">var</span> g = sm.game,</div><div class="line">        ctx = sm.ctx,</div><div class="line">        now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        t = now - g.lt;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span> (t &gt;= g.autoTickRate) &#123;</div><div class="line">            <span class="keyword">var</span> ticks = t / g.autoTickRate;</div><div class="line">            g.auto += ticks * g.perAutoTick;</div><div class="line">            g.lt = now;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, sm.canvas.width, sm.canvas.height);</div><div class="line"> </div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.fillText(<span class="string">'manual: '</span> + g.manual.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">20</span>);</div><div class="line">        ctx.fillText(<span class="string">'auto: '</span> + g.auto.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">30</span>);</div><div class="line">        ctx.fillText(<span class="string">'pos: '</span> + g.pos.x.toFixed(<span class="number">2</span>) + <span class="string">', '</span> + g.pos.y.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">40</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// ver</span></div><div class="line">        ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'v'</span> + sm.ver, <span class="number">5</span>, sm.canvas.height - <span class="number">15</span> );</div><div class="line"> </div><div class="line">    &#125;,</div><div class="line">    <span class="attr">userPointer</span>: &#123;</div><div class="line">        <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params">pt, sm, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> g = sm.game;</div><div class="line">            g.manual += sm.game.perManual;</div><div class="line">            g.pos.x = pt.x;</div><div class="line">            g.pos.y = pt.y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">sm.start();</div></pre></td></tr></table></figure>
<p>So when it comes to this there is not much to write about just yet, but I have the basic idea of what I wanted up and running at least. If I get around to it I might start to create some kind of actual game example on top of this, but there are so many other canvas examples that I also want to work on.</p>
<h2 id="4-Conclusion"><a href="#4-Conclusion" class="headerlink" title="4 - Conclusion"></a>4 - Conclusion</h2><p>So with this canvas example I have together what looks like a somewhat useful state machine module. I have not battle tested this though, so I would not really go about using this just yet aside from a hobby project maybe. If I get around to it I might get to spending some more time into this one though, and also pull this together with a whole bunch of other components that I am working out to make my own canvas framework or sorts that I might use to make a few games with. </p>
<p>The core of a game framework should have a way to go about creating a state machine, but then there would also have to be an object pool, input controller, and if not an image loader something to help load some kind of image asset that is stored via some hard coded data like with my pixmaps example that I have started. If I get something like that together it would then make the process of making games a whole world faster, and help keep me from writing the same code over and over again. Do not hold your breath with that one though, I have way to many competing ideas when it comes to what I want to focus on. Also when it comes to using a framework there are many great frameworks out there all ready, I guess I should just be happy with one and use it if I do not want to put the time in to make my own.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/" data-id="ckq9vboxl007cfsv1oad1v51x" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/01/29/canvas-example-pointer-manager-mouse-and-touch/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Pointer manager mouse and touch canvas example
        
      </div>
    </a>
  
  
    <a href="/2020/01/27/js-array-from/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">The Array from static method and other ways of creating an array from something else</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/index.html';
    this.page.identifier = '598';
    this.page.title = 'State Machine canvas example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.38px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.48px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.33px;">angular</a> <a href="/tags/animation/" style="font-size: 11.9px;">animation</a> <a href="/tags/automation/" style="font-size: 11.9px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.38px;">backbone</a> <a href="/tags/blog/" style="font-size: 14.76px;">blog</a> <a href="/tags/canvas/" style="font-size: 19.05px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.86px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.95px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.43px;">ejs</a> <a href="/tags/express/" style="font-size: 16.19px;">express</a> <a href="/tags/games/" style="font-size: 17.14px;">games</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 14.76px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.9px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.29px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.48px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.43px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.1px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.29px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.52px;">node.js</a> <a href="/tags/phaser/" style="font-size: 17.62px;">phaser</a> <a href="/tags/python/" style="font-size: 15.24px;">python</a> <a href="/tags/statistics/" style="font-size: 13.81px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 18.57px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 15.71px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/23/threejs-normal-material/">The normal material in threejs</a>
          </li>
        
          <li>
            <a href="/2021/06/22/threejs-emissive-map/">Emissive maps in threejs</a>
          </li>
        
          <li>
            <a href="/2021/06/21/threejs-texture-loader/">The texture loader in threejs</a>
          </li>
        
          <li>
            <a href="/2021/06/18/threejs-vector3-apply-euler/">Apply Euler angles to a Vector3 in threejs</a>
          </li>
        
          <li>
            <a href="/2021/06/17/threejs-vector3-apply-axis-angle/">Vector3 apply axis method</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas-Examples</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2020/01/28/canvas-example-state-machine/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>