<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Hyper Casual Space Shooter canvas example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I have made a few canvas examples so far, but I think it is time to try something new. I started one other canvas example thus far that I have called a kind of hyper casual type game called to the bla">
<meta property="og:type" content="article">
<meta property="og:title" content="Hyper Casual Space Shooter canvas example">
<meta property="og:url" content="https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="I have made a few canvas examples so far, but I think it is time to try something new. I started one other canvas example thus far that I have called a kind of hyper casual type game called to the bla">
<meta property="og:updated_time" content="2021-05-13T15:14:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hyper Casual Space Shooter canvas example">
<meta name="twitter:description" content="I have made a few canvas examples so far, but I think it is time to try something new. I started one other canvas example thus far that I have called a kind of hyper casual type game called to the bla">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83195184-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS-Examples</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas-Examples</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-canvas-example-hyper-casual-space-shooter" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/12/11/canvas-example-hyper-casual-space-shooter/" class="article-date"> Published:
  <time datetime="2020-12-11T22:06:00.000Z" itemprop="datePublished">2020-12-11</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2020/12/11/canvas-example-hyper-casual-space-shooter/" class="article-date"> Modified:
  <time datetime="2021-05-13T15:14:18.000Z" itemprop="dateModified">2021-05-13</time>
</a>

    <span class="article-date">V1.32</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/canvas/">canvas</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hyper Casual Space Shooter canvas example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>I have made a few <a href="/2020/03/23/canvas-example/">canvas examples</a> so far, but I think it is time to try something new. I started one other canvas example thus far that I have called a kind of <a href="https://en.wikipedia.org/wiki/Hyper-casual_game" target="_blank" rel="external">hyper casual</a> type game called <a href="/2020/09/19/canvas-example-hyper-casual-to-the-black/">to the black</a>. The idea that I had in mind for that example was very basic, I just wanted a ship that goes forward threw space at a given rate, and I have an estimate as to how long it would take for the ship to reach Max Safe integer. It was a fun, simple little project that I was able to put together in a sort time frame.</p>
<p>With this canvas example I want to continue with making a collection of games where I just have a very basic general idea as the whole of the example, or as a starting point for something I might put a fair amount of time into. In other words set the bar very low in terms of complexity and therefore have an idea for a game in which I can end up having a working proof of concept in a short time frame. Once I have the basic idea working from that point forward it is just a question of what I need to add in order to make the game more fun.</p>
<p>So then for this next hyper casual canvas example I had an idea to just make a simple, basic game in which I just fly around space and destroy blocks, thats it. So of course I was able to get that up and working in a flash, and now I just need to think in terms of what I want to add moving forward from here. Unlike the to the black example, with this one I put over a month worth of time into, and as such there is much more going on. Still the basic idea was done right away, at this point I am just continuing to pile more features on top of it. I have a half way decent example together now as of v0.25.0 of the example, I might put a little more time into it, but I think I am getting to the point where there really is only so much more to do. The core of the idea is there along with a great deal more, and now I might start some additional examples based off of this.</p>
<a id="more"></a>
<p><div id="canvas-app"></div></p>
<script src="/js/canvas-examples/hyper-casual-space-shooter/0.25.0/pkg.js"></script>

<h2 id="If-you-just-want-to-play-the-game"><a href="#If-you-just-want-to-play-the-game" class="headerlink" title="If you just want to play the game"></a>If you just want to play the game</h2><p>If you just want to play the game it might still not be such a good idea to spend a great deal of time playing this. I might still continue working on it, and at this time I might end up adding game state breaking changes. For the most part this should not be a problem, because the game can be finished fairly quickly anyway. Just keep in might that if you do play the game, do not get to attached to your save state at this time.</p>
<h3 id="How-to-play"><a href="#How-to-play" class="headerlink" title="How to play"></a>How to play</h3><p>When it comes to just playing the game the general idea is to move out from the main base area and just go out and blast blocks with the current ship weapon. When doing so money is made each time a block is destroyed, the money can then be used to upgrade the ship back at the base area. As you move farther from the base area block values will go up, this includes values like money, but also values like armor.</p>
<h3 id="Controls"><a href="#Controls" class="headerlink" title="Controls"></a>Controls</h3><p>If you are on a desktop client the keyboard can be used to preform a number of actions.</p>
<ul>
<li>w - speed up</li>
<li>s - slow down</li>
<li>a - change heading</li>
<li><p>d - change heading</p>
</li>
<li><p>v - debug display on/off</p>
</li>
<li>b - auto fire on/off</li>
<li><p>l - fire</p>
</li>
<li><p>1,2,3 - change weapon (when at base)</p>
</li>
</ul>
<p>The mouse can also be used to click buttons when at base mouse, and it can also be used to move the ship and control speed. To control the speed of the ship click the speed bar on the left of the canvas, to change heading click in the circle in the lower right. This is also the way that one would have to do everything on a mobile device that does not have a keyboard.</p>
<h2 id="This-example-and-many-others-are-in-my-canvas-example-github-repo"><a href="#This-example-and-many-others-are-in-my-canvas-example-github-repo" class="headerlink" title="This example and many others are in my canvas-example github repo"></a>This example and many others are in my canvas-example github repo</h2><p>The version number in the <a href="https://github.com/dustinpfister/canvas-examples/tree/master/forpost/canvas-example-hyper-casual-space-shooter" target="_blank" rel="external">github repo</a> might be higher than what I have deployed here. I will get around to editing this post now and then, and when I do so I will update the content of the post, but to reflect the state of the source code at the version that I have published here. For the latest on what is going on with this canvas example, and all the other canvas examples that I have made thus far, it would be best to check out the github repository.</p>
<p>When it comes to going over the source code below I do not care to get into much detail just yet. Because I aim to keep working on this at least a little while longer so I do not want to have to wring about everything all over again when I come around to edit this post later. So for now I am going to keep things very general when it comes to writing about the code.</p>
<h2 id="1-The-utility-library"><a href="#1-The-utility-library" class="headerlink" title="1 - The utility library"></a>1 - The utility library</h2><p>First off as with any of my other canvas examples I start off with a main.js file and often a utility library that contains a bunch of methods that I know I am going to want. This utility library is packed with methods that are often reused across other canvas examples, so many of the functions might just be copied and pasted in from other utility libraries. </p>
<p>I keep making a new utils.js file for each canvas example, the reason why is because I do not want to have this part of the canvas example packed with code that I am not actually going to use in the project. In addition although many of these might be usual suspects such as a distance formula, some of theme might be closely related to the nature of the example. If often add in at least a few new ones when I start to create new features that I have never added to a project before.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// format number as money</span></div><div class="line"><span class="comment">// https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-string</span></div><div class="line">utils.format_money = <span class="function"><span class="keyword">function</span>(<span class="params">number</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> formatter = <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">'en-US'</span>, &#123;</div><div class="line">        <span class="attr">style</span>: <span class="string">'currency'</span>,</div><div class="line">        <span class="attr">currency</span>: <span class="string">'USD'</span>,</div><div class="line">        <span class="comment">// These options are needed to round to whole numbers if that's what you want.</span></div><div class="line">        minimumFractionDigits: <span class="number">0</span>, <span class="comment">// (this suffices for whole numbers, but will print 2500.10 as $2,500.1)</span></div><div class="line">        maximumFractionDigits: <span class="number">2</span> <span class="comment">// (causes 2500.99 to be printed as $2,501)</span></div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> formatter.format(number); <span class="comment">/* $2,500.00 */</span></div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// mathematical modulo</span></div><div class="line">utils.mod = <span class="function"><span class="keyword">function</span>(<span class="params">x, m</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (x % m + m) % m;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// return a canvas realtive point from the given Mouse or Touch event Object</span></div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect();</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">x</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientX : e.clientX) - bx.left,</div><div class="line">        <span class="attr">y</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientY : e.clientY) - bx.top,</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// get a distance between two points</span></div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, w1, h1, x2, y2, w2, h2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !(</div><div class="line">        (y1 + h1) &lt; (y2) ||</div><div class="line">        y1 &gt; (y2 + h2) ||</div><div class="line">        (x1 + w1) &lt; x2 ||</div><div class="line">        x1 &gt; (x2 + w2));</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// ANGLES</span></div><div class="line"> </div><div class="line"><span class="comment">// Wrap a radian value</span></div><div class="line">utils.wrapRadian = <span class="function"><span class="keyword">function</span>(<span class="params">radian</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> utils.mod(radian, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// get the angle from one point to another</span></div><div class="line">utils.angleTo = <span class="function"><span class="keyword">function</span>(<span class="params">toX, toY, fromX, fromY</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> utils.wrapRadian(<span class="built_in">Math</span>.atan2(fromY - toY, fromX - toX) + <span class="built_in">Math</span>.PI);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.normalizeHalf = <span class="function"><span class="keyword">function</span>(<span class="params">n, scale</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> c = scale || <span class="built_in">Math</span>.PI * <span class="number">2</span>;</div><div class="line">    <span class="keyword">var</span> h = c / <span class="number">2</span>;</div><div class="line">    <span class="keyword">return</span> utils.mod(n + h, c) - h;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">utils.shortestDirection = <span class="function"><span class="keyword">function</span>(<span class="params">from, to, scale</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> z = <span class="keyword">from</span> - to;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">from</span> === to) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (utils.normalizeHalf(z, scale) &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// Left</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> +<span class="number">1</span>; <span class="comment">// Right</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// deep clone an object</span></div><div class="line"><span class="comment">//utils.deepClone = function (obj) &#123;</span></div><div class="line"><span class="comment">//    return JSON.parse(JSON.stringify(obj));</span></div><div class="line"><span class="comment">//&#125;;</span></div><div class="line">utils.deepClone = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> clone = &#123;&#125;; <span class="comment">// clone is a new object</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span>(obj[i])==<span class="string">"object"</span> &amp;&amp; obj[i] != <span class="literal">null</span>)&#123;</div><div class="line">            clone[i] = utils.deepClone(obj[i]);</div><div class="line">            <span class="comment">// create as Array if source object is Array</span></div><div class="line">            <span class="keyword">if</span>(obj[i].constructor.name === <span class="string">'Array'</span>)&#123;</div><div class="line">                clone[i].length = <span class="built_in">Object</span>.keys(clone[i]).length;</div><div class="line">                clone[i] = <span class="built_in">Array</span>.from(clone[i]);</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            clone[i] = obj[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> clone;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// PERCENT METHODS</span></div><div class="line"> </div><div class="line"><span class="comment">// clamp a percent value</span></div><div class="line">utils.clampPer = <span class="function"><span class="keyword">function</span> (<span class="params">per</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (per &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (per &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> per;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// basic percent method that will return a percent or numerator depeding on mode</span></div><div class="line">utils.per = <span class="function"><span class="keyword">function</span>(<span class="params">a, d, mode</span>)</span>&#123;</div><div class="line">    mode = mode === <span class="literal">undefined</span> ? <span class="string">'per'</span> : mode;</div><div class="line">    <span class="keyword">if</span>(mode === <span class="string">'per'</span>)&#123;</div><div class="line">        <span class="comment">// a is a numerator return a percent value</span></div><div class="line">        <span class="keyword">return</span> utils.clampPer(a / d);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// a is a percent return a numerator</span></div><div class="line">    <span class="keyword">return</span> a * d;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// basic percent method that makes use of Math.log</span></div><div class="line">utils.log1 = <span class="function"><span class="keyword">function</span> (<span class="params">a, d, mode</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> per;</div><div class="line">    <span class="keyword">if</span>(mode === <span class="string">'per'</span>)&#123;</div><div class="line">        <span class="comment">// a = 'numerator value', return a percent value</span></div><div class="line">        per = utils.per(a, d, <span class="string">'per'</span>);</div><div class="line">        <span class="keyword">return</span> utils.clampPer(<span class="built_in">Math</span>.log(<span class="number">1</span> + per) / <span class="built_in">Math</span>.log(<span class="number">2</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// a = 'percent value', return a numerator</span></div><div class="line">    per = a;</div><div class="line">    <span class="keyword">return</span> (<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">1</span> + per) / <span class="number">2</span> - <span class="number">1</span>) * d;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// 'log2' percent method that uses Math.log with a range between a base and max per</span></div><div class="line">utils.log2 = <span class="function"><span class="keyword">function</span> (<span class="params">a, d, mode, basePer, maxPer</span>) </span>&#123;</div><div class="line">    basePer = basePer === <span class="literal">undefined</span> ? <span class="number">0.25</span> : basePer;</div><div class="line">    maxPer = maxPer === <span class="literal">undefined</span> ? <span class="number">0.75</span> : maxPer;</div><div class="line">    <span class="keyword">var</span> logPer = utils.log1(a, d, <span class="string">'per'</span>),</div><div class="line">    range = maxPer - basePer,</div><div class="line">    per = basePer + range * logPer;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span>(mode === <span class="string">'per'</span>)&#123;</div><div class="line">        <span class="keyword">return</span> utils.clampPer(per);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// no 'n' mode for log2 yet</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// log3 percent method</span></div><div class="line">utils.log3 = <span class="function"><span class="keyword">function</span> (<span class="params">a, d, mode, p1</span>) </span>&#123;</div><div class="line">    mode = mode === <span class="literal">undefined</span> ? <span class="string">'per'</span> : mode;</div><div class="line">    p1 = p1 === <span class="literal">undefined</span> ? <span class="number">12</span> : p1;</div><div class="line">    <span class="keyword">if</span>(mode === <span class="string">'per'</span>)&#123;</div><div class="line">        <span class="comment">// a = 'numerator value', return a percent value</span></div><div class="line">        <span class="keyword">var</span> n = a;</div><div class="line">        <span class="keyword">var</span> per = utils.per(n, d, <span class="string">'per'</span>);</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.log(<span class="number">1</span> + per) / <span class="built_in">Math</span>.log(<span class="number">2</span> + p1);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// a = 'percent value', return a numerator</span></div><div class="line">    <span class="keyword">var</span> per = a;</div><div class="line">    <span class="keyword">var</span> base = <span class="number">2</span> + p1;</div><div class="line">    <span class="keyword">return</span> ((<span class="built_in">Math</span>.pow(base, <span class="number">1</span> + per) / base - <span class="number">1</span>) * d);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// LEVEL OBJECT</span></div><div class="line"> </div><div class="line">utils.xp = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// public API for utils.xp</span></div><div class="line">    <span class="keyword">var</span> xpAPI = &#123;&#125;;</div><div class="line">    <span class="comment">// create an options object to use with byLevel and byExp methods</span></div><div class="line">    xpAPI.createOptions = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">levelCap</span>: opt.levelCap || <span class="number">100</span>,</div><div class="line">            <span class="attr">expCap</span>: opt.expCap || <span class="number">1000</span>,</div><div class="line">            <span class="attr">perMethod</span>: opt.perMethod || <span class="string">'log1'</span>, <span class="comment">//'log3',</span></div><div class="line">            perArgs: opt.perArgs || [<span class="number">0</span>],</div><div class="line">            <span class="attr">tableWidth</span>: opt.tableWidth || <span class="number">25</span>,</div><div class="line">            <span class="attr">tableHeight</span>: opt.tableHeight || <span class="number">25</span>,</div><div class="line">            <span class="attr">tableX</span>: opt.tableX === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.tableX,</div><div class="line">            <span class="attr">tableY</span>: opt.tableY === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.tableY</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a standard level Object</span></div><div class="line">    <span class="keyword">var</span> createLevelObject = <span class="function"><span class="keyword">function</span>(<span class="params">xp, opt</span>)</span>&#123;</div><div class="line">        xp = xp &gt;= opt.expCap ? opt.expCap : xp;</div><div class="line">        xp = xp &lt; <span class="number">0</span> ? <span class="number">0</span> : xp;</div><div class="line">        <span class="keyword">var</span> l = utils[opt.perMethod].apply(<span class="literal">null</span>, [xp / opt.expCap, opt.levelCap, <span class="string">'n'</span>].concat(opt.perArgs));</div><div class="line">        l = l &gt;= opt.levelCap ? opt.levelCap - <span class="number">1</span> : l;</div><div class="line">        l = l &lt; <span class="number">0</span> ? <span class="number">0</span> : l;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">opt</span>: opt,</div><div class="line">            <span class="attr">l</span>: l,</div><div class="line">            <span class="attr">level</span>: <span class="built_in">Math</span>.round(l) + <span class="number">1</span>,</div><div class="line">            <span class="attr">levelCap</span>: opt.levelCap,</div><div class="line">            <span class="attr">perToLevelCap</span>: l / ( opt.levelCap - <span class="number">1</span> ),</div><div class="line">            <span class="attr">xp</span>: xp,</div><div class="line">            <span class="attr">xpForNext</span>: <span class="literal">null</span>,</div><div class="line">            <span class="attr">expCap</span>: opt.expCap,</div><div class="line">            <span class="attr">valueOf</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.level;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> getXPByLevel = <span class="function"><span class="keyword">function</span>(<span class="params">l, opt</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> per = utils[opt.perMethod].apply(<span class="literal">null</span>, [l, opt.levelCap, <span class="string">'per'</span>].concat(opt.perArgs));</div><div class="line">        <span class="keyword">return</span> opt.expCap * per;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> appendXPForNext = <span class="function"><span class="keyword">function</span>(<span class="params">levelObj</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(levelObj.level &lt; levelObj.levelCap)&#123;</div><div class="line">            levelObj.xpForNext = getXPByLevel(levelObj.level, levelObj.opt)</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">// what to set xp for next when the current level is at level cap</span></div><div class="line">            levelObj.xpForNext = <span class="literal">Infinity</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a levelObject by 'l' and 'opt' where 'l' is a ZERO RELATIVE level number that</span></div><div class="line">    <span class="comment">// can be a function, and 'opt' is an options object that contains values for levelCap, ect</span></div><div class="line">    xpAPI.byLevel = <span class="function"><span class="keyword">function</span>(<span class="params">l, opt</span>)</span>&#123;</div><div class="line">        opt = xpAPI.createOptions(opt);</div><div class="line">        l = l &gt;= opt.levelCap ? opt.levelCap - <span class="number">1</span> : l;</div><div class="line">        l = l &lt; <span class="number">0</span> ? <span class="number">0</span> : l;</div><div class="line">        <span class="keyword">var</span> per = utils[opt.perMethod].apply(<span class="literal">null</span>, [l, opt.levelCap, <span class="string">'per'</span>].concat(opt.perArgs));</div><div class="line">        <span class="keyword">var</span> levelObj = createLevelObject(opt.expCap * per, opt);</div><div class="line">        appendXPForNext(levelObj);</div><div class="line">        <span class="keyword">return</span> levelObj;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a levelObject by a 'xp' value where 'xp' is a number between 0 and opt.expCap</span></div><div class="line">    <span class="comment">// and 'opt' is an options object the contains properties such as opt.expCap</span></div><div class="line">    xpAPI.byExp = <span class="function"><span class="keyword">function</span>(<span class="params">xp, opt</span>)</span>&#123;</div><div class="line">        opt = xpAPI.createOptions(opt);</div><div class="line">        <span class="keyword">var</span> levelObj = createLevelObject(xp, opt);</div><div class="line">        appendXPForNext(levelObj);</div><div class="line">        <span class="keyword">return</span> levelObj;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a table of levelObjects for the given options object</span></div><div class="line">    xpAPI.createTable = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        opt = xpAPI.createOptions(opt);</div><div class="line">        <span class="keyword">var</span> l = <span class="number">0</span>,</div><div class="line">        levelObj,</div><div class="line">        table = &#123;</div><div class="line">            <span class="attr">levelObjArray</span> : [],</div><div class="line">            <span class="attr">points</span>: [],</div><div class="line">            <span class="attr">w</span>: opt.tableWidth,</div><div class="line">            <span class="attr">h</span>: opt.tableHeight,</div><div class="line">            <span class="attr">x</span>: opt.tableX,</div><div class="line">            <span class="attr">y</span>: opt.tableY</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">while</span>(l &lt; opt.levelCap)&#123;</div><div class="line">            levelObj = table.levelObjArray[l] = xpAPI.byLevel(l, opt);</div><div class="line">            table.points[l] = &#123;</div><div class="line">                <span class="attr">x</span>: table.w / (opt.levelCap<span class="number">-1</span>) * levelObj.l,</div><div class="line">                <span class="attr">y</span>: table.h - (levelObj.xp / levelObj.expCap) * table.h</div><div class="line">                <span class="comment">//x: table.w / opt.levelCap * levelObj.level,</span></div><div class="line">                <span class="comment">//y: table.h - (levelObj.level / levelObj.levelCap) * table.h</span></div><div class="line">            &#125;;</div><div class="line">            l += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> table;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create an upgrade object</span></div><div class="line">    xpAPI.createUpgrade = <span class="function"><span class="keyword">function</span>(<span class="params">desc, levelIndex, applyToState, opt</span>)</span>&#123;</div><div class="line">        opt = xpAPI.createOptions(opt);</div><div class="line">        <span class="keyword">var</span> upgrade = xpAPI.createTable(opt);</div><div class="line">        upgrade.opt = opt; <span class="comment">// store the options used to create a level object</span></div><div class="line">        upgrade.desc = desc || <span class="string">''</span>;</div><div class="line">        upgrade.levelIndex = levelIndex || <span class="number">0</span>;</div><div class="line">        upgrade.levelObj = upgrade.levelObjArray[upgrade.levelIndex];</div><div class="line">        upgrade.applyToState = applyToState || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">        <span class="keyword">return</span> upgrade;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> xpAPI;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="2-The-Pool-js-module-for-creating-and-updating-Object-pools"><a href="#2-The-Pool-js-module-for-creating-and-updating-Object-pools" class="headerlink" title="2 - The Pool.js module for creating and updating Object pools"></a>2 - The Pool.js module for creating and updating Object pools</h2><p>I have made another canvas example a while back in which I made a module that is an object pool type project. After many years of experience writing javaScript code for various projects such as this I have come to find that I like to have fixed object pools to work with when it comes to display objects. I just like this kind of approach compared to the alternative system in which these kinds of objects are created and purged as needed. This object pool module is modified from what I was working with in the object pool canvas example. I of course made some revisions to the source code to make it more custom cut for this specific project.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Object Pool Module for canvas-example-hyper-casual-space-shooter</span></div><div class="line"> </div><div class="line"><span class="keyword">var</span> poolMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// Public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// OBJECT TYPES</span></div><div class="line">    <span class="keyword">var</span> OBJECT_TYPES = &#123;</div><div class="line">        <span class="attr">block</span>: &#123; </div><div class="line">            <span class="attr">spawn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">block, pool, state, opt</span>)</span>&#123;</div><div class="line">                <span class="comment">// blocks have an effects array</span></div><div class="line">                block.effects = [];</div><div class="line">                block.effectStats = &#123;&#125;;</div><div class="line">                block.awardBlockMoney = <span class="literal">false</span>; <span class="comment">// if true award money on effect death</span></div><div class="line">                block.armor = &#123;</div><div class="line">                   <span class="attr">minDam</span>: <span class="number">0</span></div><div class="line">                &#125;;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, secs</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span>(obj.effects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">                    Effects.update(obj, pool, state, secs);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// EFFECTS</span></div><div class="line">    <span class="keyword">var</span> EFFECTS_MAX = <span class="number">10</span>; <span class="comment">// max number of effects per object</span></div><div class="line">    <span class="keyword">var</span> EFFECT_TYPES = api.EFFECT_TYPES = &#123;</div><div class="line">        <span class="attr">burn</span> : &#123;</div><div class="line">            <span class="attr">effectType</span>: <span class="string">'burn'</span>,</div><div class="line">            <span class="attr">chance</span>: <span class="number">0.1</span>,</div><div class="line">            <span class="attr">maxStack</span>: <span class="number">3</span>,</div><div class="line">            <span class="attr">damagePer</span>: <span class="number">0.01</span>,</div><div class="line">            <span class="attr">every</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">count</span>: <span class="number">5</span>,</div><div class="line">            <span class="attr">upStat</span>: &#123;</div><div class="line">                <span class="attr">maxStack</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">1</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">round</span>: <span class="string">'floor'</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">chance</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">0.10</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">0.75</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">damagePer</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">0.01</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">0.1</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">acid</span> : &#123;</div><div class="line">            <span class="attr">effectType</span>: <span class="string">'acid'</span>,</div><div class="line">            <span class="attr">chance</span>: <span class="number">0.1</span>,</div><div class="line">            <span class="attr">maxStack</span>: <span class="number">3</span>,</div><div class="line">            <span class="attr">damageMulti</span>: <span class="number">1</span>,   <span class="comment">// number of times extra damage is applyed</span></div><div class="line">            upStat: &#123;</div><div class="line">                <span class="attr">maxStack</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">1</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">5</span>,</div><div class="line">                    <span class="attr">round</span>: <span class="string">'floor'</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">chance</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">0.10</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">0.75</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">damageMulti</span>: &#123;</div><div class="line">                    <span class="attr">min</span>: <span class="number">1.5</span>,</div><div class="line">                    <span class="attr">max</span>: <span class="number">4</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// helper for an over time effect such as 'burn'</span></div><div class="line">    <span class="keyword">var</span> overTimeEffect = <span class="function"><span class="keyword">function</span>(<span class="params">i, effect, obj, secs</span>)</span>&#123;</div><div class="line">        effect.secs += secs;</div><div class="line">        <span class="keyword">if</span>(effect.secs &gt;= effect.every)&#123;</div><div class="line">            effect.secs = utils.mod(effect.secs, effect.every);</div><div class="line">            <span class="comment">// if damagePer apply that</span></div><div class="line">            <span class="keyword">if</span>(effect.damagePer)&#123;</div><div class="line">                <span class="keyword">var</span> damage = obj.hp.max * effect.damagePer;</div><div class="line">                obj.hp.current -= damage; <span class="comment">//effect.damage;</span></div><div class="line">            &#125;</div><div class="line">            effect.count -= <span class="number">1</span>;</div><div class="line">            <span class="comment">// effect ends when count === 0</span></div><div class="line">            <span class="keyword">if</span>(effect.count &lt;= <span class="number">0</span> )&#123;</div><div class="line">                obj.effects.splice(i, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// Effects create an update methods</span></div><div class="line">    <span class="keyword">var</span> Effects = &#123;</div><div class="line">        <span class="comment">// create a new effect object for an effects array</span></div><div class="line">        create: <span class="function"><span class="keyword">function</span>(<span class="params">obj, effectObj</span>)</span>&#123;</div><div class="line">            effectObj = effectObj || &#123;&#125;;</div><div class="line">            <span class="keyword">if</span>(obj.effects.length &lt; EFFECTS_MAX)&#123;</div><div class="line">                obj.awardBlockMoney = <span class="literal">true</span>; <span class="comment">// just set this true here for now as there is just one effect</span></div><div class="line">                effectObj = utils.deepClone(effectObj);</div><div class="line">                effectObj.secs = <span class="number">0</span>;</div><div class="line">                obj.effects.push(effectObj);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// for effects that are updated over time</span></div><div class="line">        update: <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool, state, secs</span>)</span>&#123;</div><div class="line">            <span class="comment">// update effects</span></div><div class="line">            <span class="keyword">var</span> i = obj.effects.length, effect;</div><div class="line">            <span class="comment">// awardBlockMoney should be false if there are not effects at all in place</span></div><div class="line">            <span class="keyword">if</span>(obj.effects.length === <span class="number">0</span>)&#123;</div><div class="line">                obj.awardBlockMoney = <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">while</span>(i--)&#123;</div><div class="line">                effect = obj.effects[i];</div><div class="line"> </div><div class="line">                <span class="keyword">if</span>(effect.effectType === <span class="string">'burn'</span>)&#123;</div><div class="line">                    overTimeEffect(i, effect, obj, secs);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// clamp hit points</span></div><div class="line">                obj.hp.current = obj.hp.current &gt; obj.hp.max ? obj.hp.max : obj.hp.current;</div><div class="line">                obj.hp.current = obj.hp.current &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.hp.current;</div><div class="line">                obj.hp.per = obj.hp.current / obj.hp.max;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// for effects that are updated per attack</span></div><div class="line">        onAttack: <span class="function"><span class="keyword">function</span>(<span class="params">obj, damage</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> i = obj.effects.length, effect;</div><div class="line">            <span class="keyword">while</span>(i--)&#123;</div><div class="line">                effect = obj.effects[i];</div><div class="line">                </div><div class="line">                <span class="keyword">if</span>(effect.effectType === <span class="string">'acid'</span>)&#123;</div><div class="line">                    <span class="comment">//console.log('acid: ',  damage, effect.damageMulti, damage * effect.damageMulti);</span></div><div class="line">                    <span class="keyword">var</span> extraDamage = effect.damageMulti * damage;</div><div class="line">                    obj.hp.current -= extraDamage;</div><div class="line">                &#125;</div><div class="line"> </div><div class="line">                <span class="comment">// clamp hit points</span></div><div class="line">                obj.hp.current = obj.hp.current &gt; obj.hp.max ? obj.hp.max : obj.hp.current;</div><div class="line">                obj.hp.current = obj.hp.current &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.hp.current;</div><div class="line">                obj.hp.per = obj.hp.current / obj.hp.max;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get next inactive object in the given pool</span></div><div class="line">    <span class="keyword">var</span> getInactive = <span class="function"><span class="keyword">function</span> (<span class="params">pool</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    api.applyOnAttackEffects = <span class="function"><span class="keyword">function</span>(<span class="params">obj, damage</span>)</span>&#123;</div><div class="line">        Effects.onAttack(obj, damage);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create and return a single display object</span></div><div class="line">    api.createDisplayObject = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = &#123;</div><div class="line">            <span class="attr">type</span>: opt.type || <span class="string">''</span>,</div><div class="line">            <span class="attr">active</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">i</span>: opt.i === <span class="literal">undefined</span> ? <span class="literal">null</span> : opt.i,</div><div class="line">            <span class="attr">x</span>: opt.x === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.x,</div><div class="line">            <span class="attr">y</span>: opt.y === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.y,</div><div class="line">            <span class="attr">r</span>: opt.r === <span class="literal">undefined</span> ? <span class="number">16</span> : opt.r,</div><div class="line">            <span class="attr">radian</span>: opt.radian === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.radian,</div><div class="line">            <span class="attr">pps</span>: opt.pps === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.pps,</div><div class="line">            <span class="attr">lifespan</span>: opt.lifespan || <span class="number">3</span>,</div><div class="line">            <span class="comment">// basic style</span></div><div class="line">            fillStyle: opt.fillStyle || <span class="string">'red'</span>,</div><div class="line">            <span class="attr">data</span>: &#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> obj;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return a vaild effect object from a given string of an effect type, or incompleate object</span></div><div class="line">    api.parseEffectObject = <span class="function"><span class="keyword">function</span>(<span class="params">effectSource</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> effect;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> effectSource === <span class="string">'string'</span>)&#123;</div><div class="line">            effect = &#123;</div><div class="line">                <span class="attr">effectType</span> : effectSource</div><div class="line">            &#125;;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            effect = utils.deepClone(effectSource);</div><div class="line">            effect.effectType = effect.effectType || <span class="string">'burn'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// get a ref tp the object for the effect type in EFFECT_TYPES</span></div><div class="line">        <span class="keyword">var</span> effectData = EFFECT_TYPES[effect.effectType];</div><div class="line">        <span class="built_in">Object</span>.keys(effectData).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</div><div class="line">             effect[key] = effect[key] === <span class="literal">undefined</span> ? effectData[key] : effect[key];</div><div class="line">        &#125;);</div><div class="line"> </div><div class="line">        effect.secs = <span class="number">0</span>;</div><div class="line">        <span class="keyword">return</span> effect;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// start an effect for the given display object</span></div><div class="line">    api.createEffect = <span class="function"><span class="keyword">function</span>(<span class="params">obj, opt</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> stackCount = obj.effectStats[opt.effectType] || <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>( stackCount &lt; opt.maxStack)&#123;</div><div class="line">            Effects.create(obj, opt);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get an object of effect types and count from the given object</span></div><div class="line">    api.getEffectStats = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> stats = &#123;&#125;;</div><div class="line">        obj.effects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effect</span>)</span>&#123;</div><div class="line">            stats[effect.effectType] = stats[effect.effectType] === <span class="literal">undefined</span> ? <span class="number">1</span> : stats[effect.effectType] += <span class="number">1</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> stats;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create a new pool</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.count = opt.count || <span class="number">10</span>;</div><div class="line">        opt.type = opt.type || <span class="string">''</span>;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        spawn = opt.spawn || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, opt</span>) </span>&#123;&#125;,</div><div class="line">        update = opt.update || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, secs</span>) </span>&#123;&#125;,</div><div class="line">        pool = &#123;</div><div class="line">            <span class="attr">type</span>: opt.type,</div><div class="line">            <span class="attr">objects</span>: [],</div><div class="line">            <span class="attr">data</span>: opt.data || &#123;&#125;,</div><div class="line">            <span class="attr">spawn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool, state, opt</span>)</span>&#123;</div><div class="line">                <span class="comment">// call any built in spawn method for the type first</span></div><div class="line">                <span class="keyword">if</span>(pool.type <span class="keyword">in</span> OBJECT_TYPES)&#123;</div><div class="line">                    OBJECT_TYPES[pool.type].spawn(obj, pool, state, opt);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// call custom spawn</span></div><div class="line">                spawn(obj, pool, state, opt);</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">purge</span>: opt.purge || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool, state, opt</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(pool.type <span class="keyword">in</span> OBJECT_TYPES)&#123;</div><div class="line">                    OBJECT_TYPES[obj.type].update(obj, pool, state, opt);</div><div class="line">                &#125;</div><div class="line">                update(obj, pool, state, opt);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">while</span> (i &lt; opt.count) &#123;</div><div class="line">            pool.objects.push(api.createDisplayObject(opt));</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> pool;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// spawn the next inactive object in the given pool</span></div><div class="line">    api.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">pool, state, opt</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = getInactive(pool);</div><div class="line">        state = state || &#123;&#125;;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (obj) &#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active = <span class="literal">true</span>;</div><div class="line">                pool.spawn.call(pool, obj, pool, state, opt);</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a pool object by a secs value</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">pool, secs, state</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        state = state || &#123;&#125;; <span class="comment">// your projects state object</span></div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                pool.update.call(pool, obj, pool, state, secs);</div><div class="line">                obj.lifespan -= secs;</div><div class="line">                obj.lifespan = obj.lifespan &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.lifespan;</div><div class="line">                <span class="keyword">if</span> (obj.lifespan === <span class="number">0</span>) &#123;</div><div class="line">                    obj.active = <span class="literal">false</span>;</div><div class="line">                    pool.purge.call(pool, obj, pool, state);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get all objects with the gieven activeState</span></div><div class="line">    api.getAllActive = <span class="function"><span class="keyword">function</span>(<span class="params">pool, activeState</span>)</span>&#123;</div><div class="line">        activeState = activeState === <span class="literal">undefined</span> ? <span class="literal">true</span> : activeState;</div><div class="line">        <span class="keyword">return</span> pool.objects.filter(<span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> object.active === activeState;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// set all to inActive or active state</span></div><div class="line">    api.setActiveStateForAll = <span class="function"><span class="keyword">function</span> (<span class="params">pool, bool</span>) </span>&#123;</div><div class="line">        bool = bool === <span class="literal">undefined</span> ? <span class="literal">false</span> : bool;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            obj.active = bool;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="3-The-main-game-js-module"><a href="#3-The-main-game-js-module" class="headerlink" title="3 - The main game.js module"></a>3 - The main game.js module</h2><p>I then have a main game module that will be used to create, and update the main game state object for the canvas example. This module then contains a large list of constants for certain rules when it comes to the mechanics of the game, as well as a wide range of helper methods used to create objects pools for blocks and shots. There are then also a number of public methods that I will be using in my main.js file to create and update the main game object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div><div class="line">1150</div><div class="line">1151</div><div class="line">1152</div><div class="line">1153</div><div class="line">1154</div><div class="line">1155</div><div class="line">1156</div><div class="line">1157</div><div class="line">1158</div><div class="line">1159</div><div class="line">1160</div><div class="line">1161</div><div class="line">1162</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">// CONSTANTS</span></div><div class="line"> </div><div class="line">    <span class="comment">// MONEY</span></div><div class="line">    <span class="keyword">var</span> GAME_MONEY_START = <span class="number">0</span>,                <span class="comment">// The amount of money to start a new game with</span></div><div class="line">    GAME_UPDATE_MAX_SECS = <span class="number">0.8</span>,              <span class="comment">// max secs value for main update loop</span></div><div class="line">    MONEY_PERLOSS_ON_DEATH = <span class="number">0.1</span>,            <span class="comment">// percent of money loss on death 0-1</span></div><div class="line"> </div><div class="line">    <span class="comment">// BLOCK CONSTANTS</span></div><div class="line">    BLOCK_COUNT = <span class="number">40</span>,                        <span class="comment">// max number of blocks in the game.blocks pool</span></div><div class="line">    BLOCK_POS_MAX_DIST = <span class="number">1500</span>,               <span class="comment">// max distnace the a black can have from a ship until it becomes inactive</span></div><div class="line">    BLOCK_SPAWN_DIST = <span class="number">250</span>,                  <span class="comment">// the distance the ship needs to go from last block spawn, for another block spawn</span></div><div class="line">    BLOCK_SPAWN_COUNT_PER_DIST_MIN = <span class="number">3</span>,      <span class="comment">// the MIN count of poolMod.spawn calls when spawn dist is reached</span></div><div class="line">    BLOCK_POS_SLOT_DIST = <span class="number">15</span>,                <span class="comment">// used in setting the position of blocks ( see getFreePositions helper )</span></div><div class="line">    BLOCK_HP_MIN = <span class="number">10</span>,                       <span class="comment">// min hit points for a block</span></div><div class="line">    BLOCK_HP_MAX = <span class="number">1000</span>,                     <span class="comment">// max hit points for a block</span></div><div class="line">    BLOCK_MONEY_BASE = <span class="number">1</span>,                    <span class="comment">// base amount of money a block is worth</span></div><div class="line">    BLOCK_MONEY_DIST = <span class="number">999</span>,                  <span class="comment">// max about of money that a block is worth based on distance from map pos 0,0</span></div><div class="line">    BLOCK_ARMOR_MINDAM_MIN = <span class="number">0</span>,              <span class="comment">// min and max values for armor min damage prop</span></div><div class="line">    BLOCK_ARMOR_MINDAM_MAX = <span class="number">45</span>,</div><div class="line"> </div><div class="line">    <span class="comment">// SHIP AND MAP VALUES</span></div><div class="line">    SHIP_AUTOFIRE = <span class="literal">true</span>,                    <span class="comment">// auto fire on or off by default</span></div><div class="line">    SHIP_HP = <span class="number">100</span>,                           <span class="comment">// ship hit points</span></div><div class="line">    SHIP_AUTOHEAL_ENABLED=<span class="literal">true</span>,              <span class="comment">// auto heal values for ship</span></div><div class="line">    SHIP_AUTOHEAL_RATE = <span class="number">3</span>,</div><div class="line">    SHIP_AUTOHEAL_AMOUNT = <span class="number">1</span>,</div><div class="line">    SHIP_ROTATION_RATE_MIN = <span class="number">45</span>,             <span class="comment">// min and max rotattion rates in degrees</span></div><div class="line">    SHIP_ROTATION_RATE_MAX = <span class="number">180</span>,</div><div class="line">    SHIP_MAX_SPEED_START = <span class="number">128</span>,              <span class="comment">// starting max ship speed in pps</span></div><div class="line">    SHIP_MAX_SPEED_MAX = <span class="number">1024</span>,               <span class="comment">// fully upgraded max ship speed in pps</span></div><div class="line">    SHIP_ACC_START = <span class="number">64</span>,                     <span class="comment">// starting Acceleration in ppsps</span></div><div class="line">    SHIP_ACC_MAX = <span class="number">256</span>,                      <span class="comment">// fully upgraded max ship speed in pps</span></div><div class="line">    MAP_MAX_DIST = <span class="number">2.5</span> * <span class="built_in">Math</span>.pow(<span class="number">10</span>,<span class="number">5</span>),     <span class="comment">// max distance from BASE (0,0) ( set to Number.MAX_SAFE_INTEGER ? )</span></div><div class="line"> </div><div class="line">    <span class="comment">// energy</span></div><div class="line">    ENERGY_MAX = <span class="number">100</span>,                        <span class="comment">// energy max and auto heal cost</span></div><div class="line">    ENERGY_AUTOHEAL_COST=<span class="number">3</span>,</div><div class="line"> </div><div class="line">    <span class="comment">// HOME BASE VALUES</span></div><div class="line">    <span class="comment">// values for the base area at the origin</span></div><div class="line">    BASE_DIST = <span class="number">100</span>;</div><div class="line"> </div><div class="line">    <span class="comment">// main WEAPONS Object that will be used to create DEFAULT_WEAPONS and append DEFAULT_UPGRADES</span></div><div class="line">    <span class="keyword">var</span> WEAPONS = &#123;</div><div class="line">        <span class="number">0</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'Pulse Gun'</span>,</div><div class="line">            <span class="attr">firesPerSecond</span>: &#123; <span class="comment">// min and max range for fires per second</span></div><div class="line">                min: <span class="number">2</span>,</div><div class="line">                <span class="attr">max</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">levelOpt</span>: &#123;</div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">1000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> - <span class="number">30</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">shotDamage</span>: &#123; <span class="comment">// min and max range for shot damage</span></div><div class="line">                min: <span class="number">0.25</span>,</div><div class="line">                <span class="attr">max</span>: <span class="built_in">Math</span>.floor(BLOCK_HP_MAX * <span class="number">0.05</span>),</div><div class="line">                <span class="attr">levelOpt</span>: &#123; </div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">1500</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">effects</span>: [<span class="string">'burn'</span>, <span class="string">'acid'</span>],</div><div class="line">            <span class="comment">//effects:[],</span></div><div class="line">            shotRange: <span class="number">128</span>,</div><div class="line">            <span class="attr">shotPPS</span>: <span class="number">96</span>,</div><div class="line">            <span class="attr">shotsPerFire</span>: [<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>],</div><div class="line">            <span class="attr">onFireStart</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> weapon = game.weapons[game.ship.weaponIndex];</div><div class="line">                <span class="keyword">var</span> shotIndex = <span class="number">0</span>;</div><div class="line">                <span class="keyword">var</span> radianStart = state.game.map.radian;</div><div class="line">                <span class="keyword">var</span> shotsPerFire = weapon.shotsPerFire[weapon.shotsPerFireIndex];</div><div class="line">                <span class="keyword">while</span>(shotIndex &lt; shotsPerFire)&#123;</div><div class="line">                    <span class="keyword">var</span> side = shotIndex % <span class="number">2</span> === <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">                    <span class="keyword">var</span> dist = <span class="number">8</span>;</div><div class="line">                    <span class="keyword">if</span>(shotsPerFire === <span class="number">1</span>)&#123;</div><div class="line">                        dist = <span class="number">0</span>;</div><div class="line">                    &#125;</div><div class="line">                    poolMod.spawn(game.shots, state, &#123;</div><div class="line">                        <span class="attr">radian</span>: radianStart,</div><div class="line">                        <span class="attr">x</span>: <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.PI - radianStart) * dist * side,</div><div class="line">                        <span class="attr">y</span>: <span class="built_in">Math</span>.cos(<span class="built_in">Math</span>.PI + radianStart) * dist * side</div><div class="line">                    &#125;);</div><div class="line">                    shotIndex += <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="number">1</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'Cannon'</span>,</div><div class="line">            <span class="attr">firesPerSecond</span>: &#123; </div><div class="line">                <span class="attr">min</span>: <span class="number">4</span>,</div><div class="line">                <span class="attr">max</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">levelOpt</span>: &#123; </div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">15000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> - <span class="number">30</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">shotDamage</span>: &#123; </div><div class="line">                <span class="attr">min</span>: <span class="built_in">Math</span>.floor(BLOCK_HP_MAX * <span class="number">0.05</span>),</div><div class="line">                <span class="attr">max</span>: <span class="built_in">Math</span>.floor(BLOCK_HP_MAX * <span class="number">0.10</span>),</div><div class="line">                <span class="attr">levelOpt</span>: &#123; </div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">50000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">effects</span>: [<span class="string">'burn'</span>, <span class="string">'acid'</span>],</div><div class="line">            <span class="attr">shotRange</span>: <span class="number">256</span>,</div><div class="line">            <span class="attr">shotsPerFire</span>: [<span class="number">3</span>, <span class="number">2</span>],</div><div class="line">            <span class="attr">onFireStart</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> weapon = game.weapons[game.ship.weaponIndex];</div><div class="line">                <span class="keyword">var</span> shotIndex = <span class="number">0</span>;</div><div class="line">                <span class="keyword">var</span> radianStart = state.game.map.radian - <span class="built_in">Math</span>.PI / <span class="number">180</span> * <span class="number">20</span>;</div><div class="line">                <span class="keyword">while</span>(shotIndex &lt; weapon.shotsPerFire[weapon.shotsPerFireIndex])&#123;</div><div class="line">                    <span class="keyword">var</span> shotPer = shotIndex / (weapon.shotsPerFire[weapon.shotsPerFireIndex] - <span class="number">1</span>);</div><div class="line">                    <span class="keyword">var</span> radianDelta = <span class="built_in">Math</span>.PI / <span class="number">180</span> * <span class="number">40</span> * shotPer;</div><div class="line">                    poolMod.spawn(game.shots, state, &#123;</div><div class="line">                        <span class="attr">radian</span>: radianStart + radianDelta</div><div class="line">                    &#125;);</div><div class="line">                    shotIndex += <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="number">2</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'Atom'</span>,</div><div class="line">            <span class="attr">firesPerSecond</span>: &#123; </div><div class="line">                <span class="attr">min</span>: <span class="number">1</span>,</div><div class="line">                <span class="attr">max</span>: <span class="number">5</span>,</div><div class="line">                <span class="attr">levelOpt</span>: &#123; </div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">25000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> - <span class="number">30</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">shotDamage</span>: &#123; </div><div class="line">                <span class="attr">min</span>: <span class="built_in">Math</span>.floor(BLOCK_HP_MAX * <span class="number">0.10</span>),</div><div class="line">                <span class="attr">max</span>: <span class="built_in">Math</span>.floor(BLOCK_HP_MAX * <span class="number">0.25</span>),</div><div class="line">                <span class="attr">levelOpt</span>: &#123; </div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">30000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                    <span class="attr">perArgs</span>: [],</div><div class="line">                    <span class="attr">tableX</span>: <span class="number">160</span> - <span class="number">12</span>,</div><div class="line">                    <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span></div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">effects</span>: [<span class="string">'acid'</span>],</div><div class="line">            <span class="attr">shotRange</span>: <span class="number">64</span>,</div><div class="line">            <span class="attr">shotsPerFire</span>: [<span class="number">1</span>]</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// a helper to create DEFAULT_WERAPONS from WEAPONS</span></div><div class="line">    <span class="keyword">var</span> create_DEFAULT_WEAPONS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(WEAPONS).map(<span class="function"><span class="keyword">function</span>(<span class="params">weaponKey</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> weaponDATA = WEAPONS[weaponKey];</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">name</span>: weaponDATA.name,</div><div class="line">                <span class="attr">firesPerSecond</span>: weaponDATA.firesPerSecond.min,</div><div class="line">                <span class="attr">shotDamage</span>: weaponDATA.shotDamage.min,</div><div class="line">                <span class="attr">shotRange</span>: weaponDATA.shotRange || <span class="number">64</span>,</div><div class="line">                <span class="attr">shotsPerFire</span>: weaponDATA.shotsPerFire || [<span class="number">1</span>],</div><div class="line">                <span class="attr">onFireStart</span>: weaponDATA.onFireStart || <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line">                    poolMod.spawn(game.shots, state, &#123;</div><div class="line">                        <span class="attr">radian</span>: state.game.map.radian</div><div class="line">                    &#125;);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">shotPPS</span>: weaponDATA.shotPPS || <span class="number">128</span>,</div><div class="line">                <span class="attr">shotsPerFireIndex</span> : <span class="number">0</span>,</div><div class="line">                <span class="attr">effects</span>: weaponDATA.effects || []</div><div class="line">            &#125;;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// DEFAULT WEAPON OBJECT that will be cloned as game.weapons</span></div><div class="line">    <span class="keyword">var</span> DEFAULT_WEAPONS = create_DEFAULT_WEAPONS();</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> SPACE_BUTTONS = &#123;</div><div class="line">        <span class="attr">main</span>: &#123;</div><div class="line">            <span class="number">0</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Auto Fire'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">130</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">40</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    <span class="built_in">console</span>.log(<span class="string">'click auto fire'</span>);</div><div class="line">                    game.autoFire = !game.autoFire;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> BASE_BUTTONS = &#123;</div><div class="line">        <span class="attr">main</span>: &#123;</div><div class="line">            <span class="number">0</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Weapons'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">-32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'weapons'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">1</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Ship'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'ship'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">2</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Effects'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">96</span> + <span class="number">8</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">-32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'effects'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">weapons</span>:&#123;</div><div class="line">            <span class="number">0</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Back'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'main'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">1</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Change Weapon'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.ship.weaponIndex += <span class="number">1</span>;</div><div class="line">                    game.ship.weaponIndex = utils.mod(game.ship.weaponIndex, <span class="built_in">Object</span>.keys(game.weapons).length);</div><div class="line">                    game.ship.weapon = game.weapons[game.ship.weaponIndex];</div><div class="line">                    updateButtons(game);</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">2</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Fires Per Second'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">-64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">-32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>:<span class="number">0</span>,</div><div class="line">                <span class="attr">type</span>: <span class="string">'weaponUpgrade'</span>,</div><div class="line">                <span class="attr">weaponProp</span>: <span class="string">'firesPerSecond'</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgradeID = <span class="string">'w-'</span> + game.ship.weaponIndex + <span class="string">'-firesPerSecond'</span>,</div><div class="line">                    upgrade = getUpgradeById(game, upgradeID);</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">3</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Damage'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">-64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>:<span class="number">0</span>,</div><div class="line">                <span class="attr">type</span>: <span class="string">'weaponUpgrade'</span>,</div><div class="line">                <span class="attr">weaponProp</span>: <span class="string">'shotDamage'</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgradeID = <span class="string">'w-'</span> + game.ship.weaponIndex + <span class="string">'-shotDamage'</span>,</div><div class="line">                    upgrade = getUpgradeById(game, upgradeID);</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">ship</span>:&#123;</div><div class="line">            <span class="number">0</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Back'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'main'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">1</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Max Speed'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">-32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">upgradeID</span>: <span class="string">'s1'</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgrade = button.upgrade;</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">2</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Max Acc'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">upgradeID</span>: <span class="string">'s2'</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgrade = button.upgrade;</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">3</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Rotation'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">upgradeID</span>: <span class="string">'s3'</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgrade = button.upgrade;</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">effects</span>: &#123;</div><div class="line">           <span class="number">0</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Back'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">                    game.buttons.currentPage = <span class="string">'main'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">1</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'Burn'</span>,</div><div class="line">                <span class="attr">type</span>: <span class="string">'effectUpgrade'</span>,</div><div class="line">                <span class="attr">effectType</span>: <span class="string">'burn'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgrade = button.upgrade;</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="number">2</span>: &#123;</div><div class="line">                <span class="attr">desc</span>: <span class="string">'ACID'</span>,</div><div class="line">                <span class="attr">type</span>: <span class="string">'effectUpgrade'</span>,</div><div class="line">                <span class="attr">effectType</span>: <span class="string">'acid'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">64</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">-32</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">cost</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, button</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> upgrade = button.upgrade;</div><div class="line">                    buyUpgrade(game, upgrade);</div><div class="line">                    button.cost = upgrade.levelObj.xpForNext;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create upgrade object references and cost/display info</span></div><div class="line">    <span class="keyword">var</span> updateButtons = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        [<span class="string">'base'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mode</span>)</span>&#123;</div><div class="line">             <span class="built_in">Object</span>.keys(game.buttons[mode]).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">pageKey</span>)</span>&#123;</div><div class="line">                 <span class="built_in">Object</span>.keys(game.buttons[mode][pageKey]).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">buttonKey</span>)</span>&#123;</div><div class="line">                     <span class="keyword">var</span> button = game.buttons[mode][pageKey][buttonKey];</div><div class="line">                     <span class="comment">// attach a single upgrade ref</span></div><div class="line">                     <span class="keyword">if</span>(button.upgradeID)&#123;</div><div class="line">                         <span class="comment">// create a ref to upgrade, and set start cost</span></div><div class="line">                         button.upgrade = getUpgradeById(game, button.upgradeID);</div><div class="line">                     &#125;</div><div class="line">                     <span class="keyword">if</span>(button.type)&#123;</div><div class="line">                         <span class="comment">// if the button is for a weapon upgrade</span></div><div class="line">                         <span class="keyword">if</span>(button.type === <span class="string">'weaponUpgrade'</span>)&#123;</div><div class="line">                             <span class="keyword">var</span> upgradeID = <span class="string">'w-'</span> + game.ship.weaponIndex + <span class="string">'-'</span> + button.weaponProp;</div><div class="line">                             button.upgrade = getUpgradeById(game, upgradeID);</div><div class="line">                         &#125;</div><div class="line">                         <span class="keyword">if</span>(button.type === <span class="string">'effectUpgrade'</span>)&#123;</div><div class="line">                             <span class="keyword">var</span> upgradeID = <span class="string">'e-'</span> + button.effectType;</div><div class="line">                             button.upgrade = getUpgradeById(game, upgradeID);</div><div class="line">                         &#125;</div><div class="line">                     &#125;</div><div class="line">                     <span class="keyword">if</span>(button.upgrade &amp;&amp; button.cost != <span class="literal">undefined</span>)&#123;</div><div class="line">                             button.cost = button.upgrade.levelObj.xpForNext;</div><div class="line">                     &#125;</div><div class="line">                 &#125;);</div><div class="line">             &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// UPGRADES</span></div><div class="line"> </div><div class="line">    <span class="keyword">var</span> DEFAULT_UPGRADES = [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">id</span>: <span class="string">'s1'</span>,</div><div class="line">            <span class="attr">desc</span>: <span class="string">'Max Speed'</span>,</div><div class="line">            <span class="attr">applyToState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, levelObj, upgrade</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> delta = SHIP_MAX_SPEED_MAX - SHIP_MAX_SPEED_START;</div><div class="line">                game.map.maxPPS = SHIP_MAX_SPEED_START + delta * levelObj.perToLevelCap;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">levelOpt</span>: &#123; </div><div class="line">                <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">expCap</span>: <span class="number">10000</span>,</div><div class="line">                <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                <span class="attr">perArgs</span>: [],</div><div class="line">                <span class="attr">tableX</span>: <span class="number">260</span>,</div><div class="line">                <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> - <span class="number">32</span></div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">id</span>: <span class="string">'s2'</span>,</div><div class="line">            <span class="attr">desc</span>: <span class="string">'Ship Acceleration'</span>,</div><div class="line">            <span class="attr">applyToState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, levelObj, upgrade</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> delta = SHIP_ACC_MAX - SHIP_ACC_START;</div><div class="line">                game.map.ppsDelta = SHIP_ACC_START + delta * levelObj.perToLevelCap;</div><div class="line">                </div><div class="line">            &#125;,</div><div class="line">            <span class="attr">levelOpt</span>: &#123;</div><div class="line">                <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">expCap</span>: <span class="number">7500</span>,</div><div class="line">                <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                <span class="attr">perArgs</span>: [],</div><div class="line">                <span class="attr">tableX</span>: <span class="number">260</span>,</div><div class="line">                <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> + <span class="number">32</span></div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">id</span>: <span class="string">'s3'</span>,</div><div class="line">            <span class="attr">desc</span>: <span class="string">'Rotation'</span>,</div><div class="line">            <span class="attr">applyToState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, levelObj, upgrade</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> delta = SHIP_ROTATION_RATE_MAX - SHIP_ROTATION_RATE_MIN;</div><div class="line">                game.map.degreesPerSecond = SHIP_ROTATION_RATE_MIN + delta * levelObj.perToLevelCap;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">levelOpt</span>: &#123;</div><div class="line">                <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                <span class="attr">expCap</span>: <span class="number">5000</span>,</div><div class="line">                <span class="attr">perMethod</span>: <span class="string">'log1'</span>,</div><div class="line">                <span class="attr">perArgs</span>: [],</div><div class="line">                <span class="attr">tableX</span>: <span class="number">260</span>,</div><div class="line">                <span class="attr">tableY</span>: <span class="number">120</span> - <span class="number">12</span> + <span class="number">64</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    ];</div><div class="line"> </div><div class="line">    <span class="comment">// append upgrade objects to DEFAULT_UPGRADES from WEAPONS</span></div><div class="line">    <span class="keyword">var</span> append_WEAPON_UPGRADES = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">// loop all WEAPONS</span></div><div class="line">        <span class="built_in">Object</span>.keys(WEAPONS).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">weaponKey</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> weapon = WEAPONS[weaponKey];</div><div class="line">            <span class="comment">// create upgrades for these properties</span></div><div class="line">            [<span class="string">'firesPerSecond'</span>, <span class="string">'shotDamage'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">weaponProp</span>)</span>&#123;</div><div class="line">                levelOpt = utils.deepClone(weapon[weaponProp].levelOpt || &#123;&#125;);</div><div class="line">                levelOpt.levelCap = levelOpt.levelCap || <span class="number">30</span>;</div><div class="line">                levelOpt.expCap = levelOpt.expCap || <span class="number">10000</span>;</div><div class="line">                levelOpt.perArgs = levelOpt.perArgs || [<span class="number">0</span>];</div><div class="line">                <span class="comment">//levelOpt.tableX = 0;</span></div><div class="line">                <span class="comment">//levelOpt.tableY = 0;</span></div><div class="line">                <span class="keyword">var</span> upgrade = &#123;</div><div class="line">                    <span class="attr">id</span>: <span class="string">'w-'</span> + weaponKey + <span class="string">'-'</span> + weaponProp,</div><div class="line">                    <span class="attr">desc</span>: weapon.name + <span class="string">' '</span> + weaponProp,</div><div class="line">                    <span class="attr">applyToState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, levelObj, upgrade</span>)</span>&#123;</div><div class="line">                        <span class="keyword">var</span> weaponIndex = <span class="built_in">Number</span>(upgrade.id.split(<span class="string">'-'</span>)[<span class="number">1</span>]),</div><div class="line">                        weapon = game.weapons[weaponIndex],</div><div class="line">                        weaponDATA = WEAPONS[weaponIndex],</div><div class="line">                        weaponProp = upgrade.id.split(<span class="string">'-'</span>)[<span class="number">2</span>];</div><div class="line">                        <span class="comment">// expression to set property of game.weapon object</span></div><div class="line">                        <span class="keyword">var</span> delta = weaponDATA[weaponProp].max - weaponDATA[weaponProp].min;</div><div class="line">                        weapon[weaponProp] = weaponDATA[weaponProp].min + delta * levelObj.perToLevelCap;</div><div class="line">                    &#125;,</div><div class="line">                    <span class="attr">levelOpt</span>: levelOpt</div><div class="line">                &#125;;</div><div class="line">                DEFAULT_UPGRADES.push(upgrade);</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create and append upgrade objects for EFFECTS</span></div><div class="line">    <span class="keyword">var</span> append_EFFECT_UPGRADES = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">Object</span>.keys(poolMod.EFFECT_TYPES).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> effectDATA = poolMod.EFFECT_TYPES[key];</div><div class="line">            DEFAULT_UPGRADES.push(&#123;</div><div class="line">                <span class="attr">id</span>: <span class="string">'e-'</span> + key,</div><div class="line">                <span class="attr">desc</span>: key,</div><div class="line">                <span class="attr">applyToState</span>: <span class="function"><span class="keyword">function</span>(<span class="params">game, levelObj, upgrade</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> effect = game.effects[upgrade.id.split(<span class="string">'-'</span>)[<span class="number">1</span>]];</div><div class="line">                    <span class="built_in">Object</span>.keys(effect.upStat).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effectKey</span>)</span>&#123;</div><div class="line">                        <span class="keyword">var</span> upStat = effect.upStat[effectKey];</div><div class="line">                        <span class="keyword">var</span> delta = (upStat.max - upStat.min) * levelObj.perToLevelCap;</div><div class="line">                        effect[effectKey] = upStat.min + delta;</div><div class="line">                        <span class="keyword">if</span>(upStat.round)&#123;</div><div class="line">                            effect[effectKey] = <span class="built_in">Math</span>[upStat.round](effect[effectKey]);</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">levelOpt</span>: utils.deepClone(&#123;</div><div class="line">                    <span class="attr">levelCap</span>: <span class="number">10</span>,</div><div class="line">                    <span class="attr">expCap</span>: <span class="number">50000</span>,</div><div class="line">                    <span class="attr">perMethod</span>: <span class="string">'log1'</span></div><div class="line">                &#125;)</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// call append_WEAPON_UPGRADES here to compleate DEFAULT_UPGRADES</span></div><div class="line">    append_WEAPON_UPGRADES();</div><div class="line">    append_EFFECT_UPGRADES();</div><div class="line"> </div><div class="line">    <span class="comment">// get an upgrade object by id</span></div><div class="line">    <span class="keyword">var</span> getUpgradeById = <span class="function"><span class="keyword">function</span>(<span class="params">game, id</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> i = game.upgrades.length;</div><div class="line">        <span class="keyword">while</span>(i--)&#123;</div><div class="line">            <span class="keyword">var</span> upgrade = game.upgrades[i];</div><div class="line">            <span class="keyword">if</span>(id === upgrade.id)&#123;</div><div class="line">                <span class="keyword">return</span> upgrade;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// buy an upgrade if there is enough money</span></div><div class="line">    <span class="keyword">var</span> buyUpgrade = <span class="function"><span class="keyword">function</span>(<span class="params">game, upgrade</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> lvCurrent = upgrade.levelObj,</div><div class="line">        lvNext;</div><div class="line">        <span class="comment">// if the current level is not at the level cap</span></div><div class="line">        <span class="keyword">if</span>(lvCurrent.level &lt; upgrade.opt.levelCap)&#123;</div><div class="line">            lvNext = upgrade.levelObjArray[lvCurrent.level];</div><div class="line">            <span class="keyword">if</span>(game.money &gt;= lvNext.xp)&#123;</div><div class="line">                upgrade.levelIndex = lvNext.level <span class="number">-1</span>; <span class="comment">//Math.floor(Math.floor(lvCurrent.l) + 1);</span></div><div class="line">                upgrade.levelObj = lvNext;</div><div class="line">                game.money -= lvNext.xp;</div><div class="line">                <span class="comment">// call apply to state</span></div><div class="line">                upgrade.applyToState(game, upgrade.levelObj, upgrade);</div><div class="line">                <span class="comment">//'level up for ' + upgrade.desc</span></div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">// not enough money for upgrade</span></div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">// level cap reached.</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// HIT POINTS</span></div><div class="line">    <span class="keyword">var</span> createHPObject = <span class="function"><span class="keyword">function</span>(<span class="params">maxHP</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">current</span>: maxHP || <span class="number">100</span>,</div><div class="line">            <span class="attr">max</span>: maxHP || <span class="number">100</span>,</div><div class="line">            <span class="attr">per</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">autoHeal</span>: &#123; <span class="comment">// every RATE heal AMOUNT</span></div><div class="line">                enabled: <span class="literal">false</span>,</div><div class="line">                <span class="attr">rate</span>: <span class="number">5</span>,</div><div class="line">                <span class="attr">amount</span>: <span class="number">-1</span>,</div><div class="line">                <span class="attr">secs</span>: <span class="number">0</span></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update autoHeal stats</span></div><div class="line">    <span class="keyword">var</span> autoHealObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(obj.hp)&#123;</div><div class="line">            <span class="keyword">if</span>(obj.hp.autoHeal.enabled)&#123;</div><div class="line">                obj.hp.autoHeal.secs += secs;</div><div class="line">                <span class="keyword">if</span>(obj.hp.autoHeal.secs &gt;= obj.hp.autoHeal.rate)&#123;</div><div class="line">                    obj.hp.current += obj.hp.autoHeal.amount;</div><div class="line">                    obj.hp.current = obj.hp.current &gt; obj.hp.max ? obj.hp.max : obj.hp.current;</div><div class="line">                    obj.hp.current = obj.hp.current &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.hp.current;</div><div class="line">                    obj.hp.per = obj.hp.current / obj.hp.max;</div><div class="line">                    obj.hp.autoHeal.secs = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                obj.hp.autoHeal.secs = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// what to do when the player ship dies</span></div><div class="line">    <span class="keyword">var</span> onShipDeath = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        game.ship = createShip(game);</div><div class="line">        game.map.x = <span class="number">0</span>;</div><div class="line">        game.map.y = <span class="number">0</span>;</div><div class="line">        game.map.pps = <span class="number">0</span>;</div><div class="line">        <span class="comment">// set all blocks inactive</span></div><div class="line">        poolMod.getAllActive(game.blocks).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">block</span>)</span>&#123;</div><div class="line">           block.active = <span class="literal">false</span>;</div><div class="line">           block.lifespan = <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// game money effected</span></div><div class="line">        game.money = game.money &gt; <span class="number">0</span> ? game.money * ( <span class="number">1</span> - MONEY_PERLOSS_ON_DEATH) : <span class="number">0</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// attack the given TARGET object with the given ATTACKER object</span></div><div class="line">    <span class="keyword">var</span> attackObject = <span class="function"><span class="keyword">function</span>(<span class="params">game, target, attacker</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(target.hp)&#123;</div><div class="line">            <span class="keyword">if</span>(target.armor)&#123;</div><div class="line">                <span class="comment">// return out of function if damage is two low</span></div><div class="line">                <span class="keyword">if</span>(attacker.damage &lt; target.armor.minDam)&#123;</div><div class="line">                    attacker.damage = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(target.type === <span class="string">'block'</span>)&#123;</div><div class="line">                poolMod.applyOnAttackEffects(target, attacker.damage);</div><div class="line">                <span class="comment">// create any effects the shot might have</span></div><div class="line">                attacker.effects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effect</span>)</span>&#123;</div><div class="line">                    poolMod.createEffect(target, effect);</div><div class="line">                    <span class="comment">// effect stats</span></div><div class="line">                    target.effectStats=poolMod.getEffectStats(target);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">            target.hp.current -= attacker.damage;</div><div class="line">            target.hp.current = target.hp.current &lt; <span class="number">0</span> ? <span class="number">0</span> : target.hp.current;</div><div class="line">            target.hp.per = target.hp.current / target.hp.max;</div><div class="line">            <span class="comment">// if ship death</span></div><div class="line">            <span class="keyword">if</span>(target.hp.current === <span class="number">0</span> &amp;&amp; target.type === <span class="string">'ship'</span>)&#123;</div><div class="line">                onShipDeath(game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// ENERGY</span></div><div class="line"> </div><div class="line">    <span class="comment">// create and return am energy object</span></div><div class="line">    <span class="keyword">var</span> createEnergyObject = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">current</span>: ENERGY_MAX * <span class="number">0.5</span>,</div><div class="line">            <span class="attr">max</span>: ENERGY_MAX,</div><div class="line">            <span class="attr">per</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">rate</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">secs</span>: <span class="number">0</span></div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// clamp energy helper</span></div><div class="line">    <span class="keyword">var</span> clampEnergy = <span class="function"><span class="keyword">function</span>(<span class="params">energy</span>)</span>&#123;</div><div class="line">        energy.current = energy.current &gt; energy.max ? energy.max: energy.current;</div><div class="line">        energy.current = energy.current &lt; <span class="number">0</span> ? <span class="number">0</span>: energy.current;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// update energy</span></div><div class="line">    <span class="keyword">var</span> updateEnergy = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> energy = game.ship.energy;</div><div class="line">        energy.per = energy.current / energy.max;</div><div class="line">        <span class="comment">// add to energy by current rate</span></div><div class="line">        energy.current += energy.rate * secs;</div><div class="line">        <span class="comment">// clamp energy</span></div><div class="line">        clampEnergy(energy);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// SHOTS</span></div><div class="line">    </div><div class="line">    <span class="comment">// shot style data</span></div><div class="line">    <span class="keyword">var</span> shotStyleHelper = <span class="function"><span class="keyword">function</span>(<span class="params">shot</span>)</span>&#123;</div><div class="line">        shot.fillStyle = <span class="string">'rgba(255,255,255,0.2)'</span>;</div><div class="line">        shot.r = <span class="number">2</span>;</div><div class="line">        <span class="keyword">if</span>(shot.effects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> r = <span class="number">0</span>, b = <span class="number">0</span>, g = <span class="number">0</span>;</div><div class="line">            shot.effects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effect</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(effect.effectType === <span class="string">'burn'</span>)&#123;</div><div class="line">                    r = <span class="number">255</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(effect.effectType === <span class="string">'acid'</span>)&#123;</div><div class="line">                    b = <span class="number">255</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            shot.fillStyle = <span class="string">'rgb('</span> + r + <span class="string">','</span> + g + <span class="string">', '</span> + b + <span class="string">')'</span>;</div><div class="line">            shot.r = <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create shots pool helper</span></div><div class="line">    <span class="keyword">var</span> createShotsPool = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> poolMod.create(&#123;</div><div class="line">                <span class="attr">type</span>: <span class="string">'shot'</span>,</div><div class="line">                <span class="attr">count</span>: <span class="number">60</span>,</div><div class="line">                <span class="attr">fillStyle</span>: <span class="string">'white'</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">2</span>,</div><div class="line">                <span class="attr">spawn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">shot, pool, state, opt</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> weapon = state.game.ship.weapon,</div><div class="line">                    range = weapon.shotRange || <span class="number">32</span>;</div><div class="line">                    shot.x = opt.x === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.x;</div><div class="line">                    shot.y = opt.y === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.y;</div><div class="line">                    <span class="comment">// shot radian should be set to current map radian</span></div><div class="line">                    shot.radian = opt.radian; <span class="comment">//state.game.map.radian;</span></div><div class="line">                    shot.pps = weapon.shotPPS;</div><div class="line">                    shot.lifespan = <span class="number">1</span> / shot.pps * range;</div><div class="line">                    shot.damage = weapon.shotDamage; <span class="comment">// damage when shot hits a block</span></div><div class="line"> </div><div class="line">                    <span class="comment">// shot effects</span></div><div class="line">                    shot.effects = [];</div><div class="line">                    weapon.effects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effectType</span>)</span>&#123;</div><div class="line">                        <span class="keyword">var</span> effect = poolMod.parseEffectObject(state.game.effects[effectType]);</div><div class="line">                        <span class="keyword">var</span> roll = <span class="built_in">Math</span>.random();</div><div class="line">                        <span class="keyword">if</span>(roll &lt; effect.chance)&#123;</div><div class="line">                            <span class="comment">// push a refernce to the effect object</span></div><div class="line">                            shot.effects.push(effect);</div><div class="line"> </div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                    shotStyleHelper(shot);</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">shot, pool, state, secs</span>)</span>&#123;</div><div class="line">                    <span class="keyword">var</span> objDeltaX = <span class="built_in">Math</span>.cos(shot.radian) * shot.pps * secs;</div><div class="line">                    <span class="keyword">var</span> objDeltaY = <span class="built_in">Math</span>.sin(shot.radian) * shot.pps * secs;</div><div class="line">                    shot.x += objDeltaX;</div><div class="line">                    shot.y += objDeltaY;</div><div class="line">                    <span class="comment">// check if the shot has hit an active block</span></div><div class="line">                    <span class="keyword">var</span> blocks = poolMod.getAllActive(state.game.blocks, <span class="literal">true</span>);</div><div class="line">                    <span class="keyword">var</span> i = blocks.length;</div><div class="line">                    <span class="keyword">while</span>(i--)&#123;</div><div class="line">                        <span class="keyword">var</span> block = blocks[i];</div><div class="line">                        <span class="keyword">var</span> dist = utils.distance(shot.x, shot.y, block.x, block.y);</div><div class="line">                        <span class="comment">// if a shot hits a block</span></div><div class="line">                        <span class="keyword">if</span>(dist &lt;= block.r + shot.r)&#123;</div><div class="line">                            shot.lifespan = <span class="number">0</span>;</div><div class="line">                            attackObject(state.game, block, shot);</div><div class="line"> </div><div class="line">                            <span class="comment">// if the block is dead</span></div><div class="line">                            <span class="keyword">if</span>(block.hp.current &lt;= <span class="number">0</span> )&#123;</div><div class="line">                                <span class="comment">// aways give block money on a 'shot death'</span></div><div class="line">                                state.game.money += block.money;</div><div class="line">                                block.lifespan = <span class="number">0</span>;</div><div class="line">                                block.active = <span class="literal">false</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">break</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// BLOCK POOL</span></div><div class="line"> </div><div class="line">    <span class="comment">// get all free positions where a block can go</span></div><div class="line">    <span class="comment">// will retrun an empty array in the event that there are none</span></div><div class="line">    <span class="keyword">var</span> getFreePositions = <span class="function"><span class="keyword">function</span>(<span class="params">game, blockPool</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.map,</div><div class="line">        activeBlocks = poolMod.getAllActive(blockPool || game.blocks, <span class="literal">true</span>),</div><div class="line">        xMapAjust = utils.mod(game.map.x, <span class="number">32</span>), <span class="comment">// take into account current map position</span></div><div class="line">        yMapAjust = utils.mod(game.map.y, <span class="number">32</span>),</div><div class="line">        spotX, <span class="comment">// the position relative to 0,0</span></div><div class="line">        spotY,</div><div class="line">        blockIndex,</div><div class="line">        block,</div><div class="line">        free = [],</div><div class="line">        gridH = <span class="number">10</span>,</div><div class="line">        gridW = <span class="number">10</span>,</div><div class="line">        slotDist = BLOCK_POS_SLOT_DIST,</div><div class="line">        <span class="comment">// starting position of grid</span></div><div class="line">        sx = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.cos(game.map.radian) * (gridH / <span class="number">2</span> + slotDist) - gridW / <span class="number">2</span>),</div><div class="line">        sy = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.sin(game.map.radian) * (gridH / <span class="number">2</span> + slotDist) - gridH / <span class="number">2</span>),</div><div class="line">        x = sx, <span class="comment">// grid position</span></div><div class="line">        y = sy;</div><div class="line">        <span class="keyword">while</span>(y &lt; gridH + sy)&#123;</div><div class="line">            x = sx;</div><div class="line">            spotY =  y * <span class="number">32</span> - yMapAjust;</div><div class="line">            loopx:<span class="keyword">while</span>(x &lt; gridW + sx)&#123;</div><div class="line">                spotX = x * <span class="number">32</span> - xMapAjust;</div><div class="line">                blockIndex = activeBlocks.length;</div><div class="line">                <span class="keyword">while</span>(blockIndex--)&#123;</div><div class="line">                    block = activeBlocks[blockIndex];</div><div class="line">                    <span class="keyword">if</span>(utils.distance(block.x, block.y, spotX, spotY) &lt;= block.r)&#123;</div><div class="line">                       x+=<span class="number">1</span>;</div><div class="line">                       <span class="keyword">continue</span> loopx;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                free.push(&#123;</div><div class="line">                    <span class="attr">x</span>: spotX,</div><div class="line">                    <span class="attr">y</span>: spotY</div><div class="line">                &#125;);</div><div class="line">                x += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            y += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> free;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// position a block</span></div><div class="line">    <span class="keyword">var</span> positionBlock = <span class="function"><span class="keyword">function</span>(<span class="params">state, obj</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game;</div><div class="line">        <span class="keyword">var</span> freeSlots = getFreePositions(game);</div><div class="line">        <span class="keyword">if</span>(freeSlots.length === <span class="number">0</span>)&#123;</div><div class="line">            obj.active = <span class="literal">false</span>;</div><div class="line">            obj.lifespan = <span class="number">0</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">var</span> slot = freeSlots.splice(<span class="built_in">Math</span>.floor(freeSlots.length * <span class="built_in">Math</span>.random()), <span class="number">1</span>)[<span class="number">0</span>];</div><div class="line">            obj.x = slot.x;</div><div class="line">            obj.y = slot.y;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get a value by map dist, and additional options like a minVal and maxVal </span></div><div class="line">    <span class="keyword">var</span> getValueByMapDist = <span class="function"><span class="keyword">function</span>(<span class="params">game, opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.minVal = opt.minVal || <span class="number">0</span>; <span class="comment">// min value of the result</span></div><div class="line">        opt.maxVal = opt.maxVal || <span class="number">1</span>; <span class="comment">// max value of the result</span></div><div class="line">        opt.roundFunc = opt.roundFunc || <span class="built_in">Math</span>.round; <span class="comment">// rounding method to use, false for none</span></div><div class="line">        opt.perFunc = opt.perFunc || utils.log1; <span class="comment">// the percent function to use, false for none</span></div><div class="line">        opt.perFuncArgs = opt.perFuncArgs || [];</div><div class="line">        <span class="comment">// default per to game.map.per</span></div><div class="line">        <span class="keyword">var</span> per = game.map.per,</div><div class="line">        delta = opt.maxVal - opt.minVal;</div><div class="line">        <span class="keyword">if</span>(opt.perFunc)&#123;</div><div class="line">            per = opt.perFunc.apply(<span class="literal">null</span>, [per, <span class="number">1</span>, <span class="string">'per'</span>].concat(opt.perFuncArgs));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// use a percent method</span></div><div class="line">        <span class="keyword">var</span> result = opt.minVal + delta * per;</div><div class="line">        <span class="keyword">if</span>(opt.roundFunc)&#123;</div><div class="line">            <span class="keyword">return</span> opt.roundFunc(result);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// CREATE</span></div><div class="line"> </div><div class="line">    <span class="comment">// create block pool helper</span></div><div class="line">    <span class="keyword">var</span> createBlocksPool = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> poolMod.create(&#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'block'</span>,</div><div class="line">            <span class="attr">data</span>: &#123;&#125;,</div><div class="line">            <span class="attr">fillStyle</span>: <span class="string">'#1a1a1a'</span>,</div><div class="line">            <span class="attr">count</span>: BLOCK_COUNT,</div><div class="line">            <span class="attr">spawn</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool, state, opt</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> game = state.game,</div><div class="line">                map = game.map;</div><div class="line">                <span class="comment">// set starting position of block</span></div><div class="line">                positionBlock(state, obj);</div><div class="line">                obj.radian = utils.wrapRadian(map.radian + <span class="built_in">Math</span>.PI);</div><div class="line">                obj.pps = map.pps;</div><div class="line">                obj.lifespan = <span class="number">1</span>;</div><div class="line"> </div><div class="line">                <span class="comment">// block props</span></div><div class="line">                obj.hp = createHPObject( BLOCK_HP_MIN + <span class="built_in">Math</span>.round( (BLOCK_HP_MAX - BLOCK_HP_MIN) ) * map.per );</div><div class="line">                obj.damage = getValueByMapDist(game, &#123;</div><div class="line">                    <span class="attr">minVal</span>: <span class="number">1</span>, </div><div class="line">                    <span class="attr">maxVal</span>: <span class="number">100</span>,</div><div class="line">                    <span class="attr">perFunc</span>: utils.log1,</div><div class="line">                    <span class="attr">roundFunc</span>: <span class="built_in">Math</span>.floor</div><div class="line">                &#125;);</div><div class="line">                <span class="comment">// block money based on BASE amount plus DIST AMOUNT</span></div><div class="line">                obj.money = BLOCK_MONEY_BASE + <span class="built_in">Math</span>.round(game.map.per * BLOCK_MONEY_DIST);</div><div class="line"> </div><div class="line">                <span class="comment">// block armor</span></div><div class="line">                <span class="comment">//var minVal = BLOCK_ARMOR_MINDAM_MIN,</span></div><div class="line">                <span class="comment">//maxVal = BLOCK_ARMOR_MINDAM_MAX;</span></div><div class="line">                <span class="comment">//obj.armor.minDam = Math.round( minVal + ( maxVal - minVal ) * map.per);</span></div><div class="line">                obj.armor.minDam = getValueByMapDist(game, &#123;</div><div class="line">                    <span class="attr">minVal</span>: BLOCK_ARMOR_MINDAM_MIN, </div><div class="line">                    <span class="attr">maxVal</span>: BLOCK_ARMOR_MINDAM_MAX,</div><div class="line">                    <span class="attr">perFunc</span>: utils.log1,</div><div class="line">                    <span class="attr">roundFunc</span>: <span class="built_in">Math</span>.floor</div><div class="line">                &#125;);</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">block, pool, state, secs</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> game = state.game;</div><div class="line">                <span class="keyword">var</span> map = state.game.map;</div><div class="line">                <span class="comment">// keep reseting lifespan</span></div><div class="line">                block.lifespan = <span class="number">1</span>;</div><div class="line">                <span class="comment">// set block radain and pps based off of current map radian and pps</span></div><div class="line">                block.radian = utils.wrapRadian(state.game.map.radian + <span class="built_in">Math</span>.PI);</div><div class="line">                block.pps = state.game.map.pps;</div><div class="line">                <span class="comment">// move block</span></div><div class="line">                <span class="keyword">var</span> objDeltaX = <span class="built_in">Math</span>.cos(block.radian) * block.pps * secs;</div><div class="line">                <span class="keyword">var</span> objDeltaY = <span class="built_in">Math</span>.sin(block.radian) * block.pps * secs;</div><div class="line">                block.x += objDeltaX;</div><div class="line">                block.y += objDeltaY;</div><div class="line">                <span class="comment">// data object for 'block'</span></div><div class="line">                block.data.dist = utils.distance(block.x, block.y, state.game.ship.x, state.game.ship.y);</div><div class="line">                <span class="comment">// apply current autoHeal values</span></div><div class="line">                autoHealObject(block, secs);</div><div class="line">                <span class="comment">// become inactive if</span></div><div class="line">                <span class="comment">// block hits ship</span></div><div class="line">                <span class="keyword">if</span>(block.data.dist &lt;= game.ship.r + block.r)&#123;</div><div class="line">                    attackObject(game, game.ship, block);</div><div class="line">                    block.lifespan = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// block goes out of range</span></div><div class="line">                <span class="keyword">if</span>(block.data.dist &gt;= BLOCK_POS_MAX_DIST)&#123;</div><div class="line">                    block.lifespan = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// if bloxk hp === 0</span></div><div class="line">                <span class="keyword">if</span>(block.hp.current &lt;= <span class="number">0</span>)&#123;</div><div class="line">                    <span class="comment">// award money on 'effect death' if awardBlockMoney is true</span></div><div class="line">                    <span class="keyword">if</span>(block.awardBlockMoney)&#123;</div><div class="line">                        game.money += block.money;</div><div class="line">                    &#125;</div><div class="line">                    block.lifespan = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// effect stats</span></div><div class="line">                block.effectStats=poolMod.getEffectStats(block);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create ship object</span></div><div class="line">    <span class="keyword">var</span> createShip = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> ship = &#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'ship'</span>,</div><div class="line">            <span class="attr">x</span>: <span class="number">0</span>, <span class="comment">// ship position relative to map position</span></div><div class="line">            y: <span class="number">0</span>,</div><div class="line">            <span class="attr">r</span>: <span class="number">8</span>,</div><div class="line">            <span class="attr">newShip</span>: <span class="literal">true</span>, <span class="comment">// used in main app loop to reset things</span></div><div class="line">            hp: createHPObject(SHIP_HP),</div><div class="line">            <span class="attr">energy</span>: createEnergyObject(),</div><div class="line">            <span class="attr">fillStyle</span>: <span class="string">'blue'</span>,</div><div class="line">            <span class="attr">weaponSecs</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">weaponIndex</span>:<span class="number">0</span>,</div><div class="line">            <span class="attr">weapon</span>: game.weapons[<span class="number">0</span>] <span class="comment">// reference to the current weapon</span></div><div class="line">        &#125;;</div><div class="line">        ship.hp.autoHeal.enabled = SHIP_AUTOHEAL_ENABLED;</div><div class="line">        ship.hp.autoHeal.rate = SHIP_AUTOHEAL_RATE;</div><div class="line">        ship.hp.autoHeal.amount = SHIP_AUTOHEAL_AMOUNT;</div><div class="line">        <span class="keyword">return</span> ship;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// public create method</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> game = &#123;</div><div class="line">            <span class="attr">money</span>: opt.money === <span class="literal">undefined</span> ? GAME_MONEY_START : opt.money,</div><div class="line">            <span class="attr">mode</span>: <span class="string">'space'</span>,</div><div class="line">            <span class="attr">autoFire</span>: SHIP_AUTOFIRE,</div><div class="line">            <span class="attr">weapons</span>: utils.deepClone(DEFAULT_WEAPONS),</div><div class="line">            <span class="attr">effects</span>: utils.deepClone(poolMod.EFFECT_TYPES),</div><div class="line">            <span class="attr">upgrades</span>: [],</div><div class="line">            <span class="attr">ship</span>: &#123;&#125;,</div><div class="line">            <span class="attr">shots</span>: createShotsPool(),</div><div class="line">            <span class="attr">blocks</span>: createBlocksPool(),</div><div class="line">            <span class="attr">blockSpawn</span>: &#123;</div><div class="line">                <span class="attr">dist</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">lastPos</span>: &#123;<span class="attr">x</span>:<span class="number">0</span>, <span class="attr">y</span>:<span class="number">0</span>&#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">map</span>: &#123; <span class="comment">// map position</span></div><div class="line">                x: opt.mapX === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.mapX,</div><div class="line">                <span class="attr">y</span>: opt.mapY === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.mapY,</div><div class="line">                <span class="attr">degree</span>: <span class="number">270</span>,</div><div class="line">                <span class="attr">degreesPerSecond</span>: SHIP_ROTATION_RATE_MIN,</div><div class="line">                <span class="attr">radian</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">aToOrigin</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">pps</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">ppsDelta</span>: SHIP_ACC_START,</div><div class="line">                <span class="attr">maxPPS</span>: SHIP_MAX_SPEED_START,</div><div class="line">                <span class="attr">dist</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">per</span>: <span class="number">0</span> <span class="comment">// map.dist / MAX_MAX_DIST</span></div><div class="line">            &#125;,</div><div class="line">            <span class="comment">//baseButtons: BASE_BUTTONS,</span></div><div class="line">            buttons: &#123;</div><div class="line">               <span class="attr">currentPage</span>: <span class="string">'main'</span>,</div><div class="line">               <span class="attr">base</span>: utils.deepClone(BASE_BUTTONS),</div><div class="line">               <span class="attr">space</span>: utils.deepClone(SPACE_BUTTONS)</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">baseObj</span> : &#123;</div><div class="line">                <span class="attr">fillStyle</span>: <span class="string">'#282828'</span>,</div><div class="line">                <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">r</span>: BASE_DIST</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// set current weapon</span></div><div class="line">        game.ship = createShip(game);</div><div class="line">        <span class="comment">// create game.upgrades</span></div><div class="line">        <span class="keyword">var</span> upgradeIndices = opt.upgradeIndices || &#123;</div><div class="line">            <span class="attr">s1</span>: <span class="number">1</span></div><div class="line">        &#125;;</div><div class="line">        game.upgrades = DEFAULT_UPGRADES.map(<span class="function"><span class="keyword">function</span>(<span class="params">upDef</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> upgrade = utils.xp.createUpgrade(upDef.desc, <span class="number">0</span>, upDef.applyToState, upDef.levelOpt);</div><div class="line">            upgrade.id = upDef.id;</div><div class="line">            upgrade.levelIndex = upgradeIndices[upgrade.id] || <span class="number">0</span>;</div><div class="line">            upgrade.levelObj = upgrade.levelObjArray[upgrade.levelIndex];</div><div class="line">            <span class="keyword">if</span>(upgrade.id == <span class="string">'s1'</span>)&#123;</div><div class="line">                <span class="built_in">console</span>.log(upgrade.levelIndex);</div><div class="line">                <span class="built_in">console</span>.log(upgrade.levelObjArray[upgrade.levelIndex]);</div><div class="line">            &#125;</div><div class="line">            upgrade.applyToState(game, upgrade.levelObj, upgrade);</div><div class="line">            <span class="keyword">return</span> upgrade;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// create upgrade refernces and set starting cost values for buttons</span></div><div class="line">        updateButtons(game);</div><div class="line"> </div><div class="line">        <span class="comment">// buy starting upgrades</span></div><div class="line"><span class="comment">/*</span></div><div class="line">        var upgrade = getUpgradeById(game, 'e-burn');</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line"> </div><div class="line">        var upgrade = getUpgradeById(game, 'e-acid');</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line">        buyUpgrade(game, upgrade);</div><div class="line">*/</div><div class="line">        <span class="comment">// log upgrades</span></div><div class="line"><span class="comment">/*</span></div><div class="line">        console.log(game.upgrades.map(function(upgrade)&#123;</div><div class="line">            return upgrade.levelObjArray.map(function(levelObj)&#123;</div><div class="line">               //var lvNext = utils.xp.byLevel(levelObj.l + 1, upgrade.opt);</div><div class="line">               //return lvNext.l;</div><div class="line">               return levelObj.xp;</div><div class="line">            &#125;);</div><div class="line">        &#125;));</div><div class="line">*/</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// set map movment values and wrap or clamp anything that might go out of range</span></div><div class="line">    api.setMapMovement = <span class="function"><span class="keyword">function</span>(<span class="params">game, degree, pps</span>)</span>&#123;</div><div class="line">        game.map.radian = utils.wrapRadian(<span class="built_in">Math</span>.PI / <span class="number">180</span> * degree);</div><div class="line">        <span class="comment">// clamp PPS</span></div><div class="line">        game.map.pps = pps;</div><div class="line">        game.map.pps = game.map.pps &lt; <span class="number">0</span> ? <span class="number">0</span> : game.map.pps;</div><div class="line">        game.map.pps = game.map.pps &gt; game.map.maxPPS ? game.map.maxPPS : game.map.pps;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// clamp map pos helper for map updater</span></div><div class="line">    <span class="keyword">var</span> clampMapPos = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(map.dist &gt;= MAP_MAX_DIST)&#123;</div><div class="line">          <span class="keyword">var</span> radian = utils.wrapRadian(map.radian + <span class="built_in">Math</span>.PI);</div><div class="line">          map.x = <span class="built_in">Math</span>.cos(radian) * MAP_MAX_DIST;</div><div class="line">          map.y = <span class="built_in">Math</span>.sin(radian) * MAP_MAX_DIST;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update the MAP </span></div><div class="line">    <span class="keyword">var</span> updateMap = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.map;</div><div class="line">        <span class="comment">//map.radian = utils.wrapRadian(Math.PI / 180 * map.degree);</span></div><div class="line">        map.x += <span class="built_in">Math</span>.cos(map.radian) * map.pps * secs;</div><div class="line">        map.y += <span class="built_in">Math</span>.sin(map.radian) * map.pps * secs;</div><div class="line">        map.dist = utils.distance(<span class="number">0</span>, <span class="number">0</span>, map.x, map.y);</div><div class="line">        clampMapPos(map);</div><div class="line">        map.per = game.map.dist / MAP_MAX_DIST;</div><div class="line">        map.aToOrigin = utils.angleTo(<span class="number">0</span>, <span class="number">0</span>, map.x, map.y);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> updateBlocks = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> blockSpawn = game.blockSpawn,</div><div class="line">        spawnIndex;</div><div class="line">        <span class="comment">// only spawn blocks in space mode</span></div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'space'</span>)&#123;</div><div class="line"> </div><div class="line">            poolMod.update(game.blocks, secs, state);</div><div class="line">            blockSpawn.dist = utils.distance(game.map.x, game.map.y, blockSpawn.lastPos.x, blockSpawn.lastPos.y);</div><div class="line">            <span class="keyword">if</span>(blockSpawn.dist &gt;= BLOCK_SPAWN_DIST)&#123;</div><div class="line">                blockSpawn.lastPos.x = game.map.x;</div><div class="line">                blockSpawn.lastPos.y = game.map.y;</div><div class="line">                spawnIndex = BLOCK_SPAWN_COUNT_PER_DIST_MIN;</div><div class="line">                <span class="keyword">while</span>(spawnIndex--)&#123;</div><div class="line">                    poolMod.spawn(game.blocks, state, &#123;&#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// all blocks are inactive in base mode</span></div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'base'</span>)&#123;</div><div class="line">            poolMod.setActiveStateForAll(game.blocks, <span class="literal">false</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> updateShots = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> ship = game.ship,</div><div class="line">        weapon = ship.weapon;</div><div class="line">        <span class="comment">// only shoot new shots in 'space' mode</span></div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'space'</span>)&#123;</div><div class="line">            ship.weaponSecs += secs;</div><div class="line">            <span class="keyword">if</span>(game.autoFire || state.input.fire)&#123;</div><div class="line">                <span class="keyword">if</span>(ship.weaponSecs &gt;= <span class="number">1</span> / weapon.firesPerSecond)&#123;</div><div class="line">                    weapon.onFireStart(game, secs, state);</div><div class="line">                    weapon.shotsPerFireIndex += <span class="number">1</span>;</div><div class="line">                    weapon.shotsPerFireIndex %= weapon.shotsPerFire.length;</div><div class="line">                    ship.weaponSecs = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// always update shot pool</span></div><div class="line">        poolMod.update(game.shots, secs, state);;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    api.update = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs, state</span>)</span>&#123;</div><div class="line"> </div><div class="line">        <span class="comment">// clamp secs between 0 and GAME_UPDATE_MAX_SECS const</span></div><div class="line">        secs = secs &gt; GAME_UPDATE_MAX_SECS ? GAME_UPDATE_MAX_SECS : secs;</div><div class="line">        secs = secs &lt; <span class="number">0</span> ? <span class="number">0</span> : secs;</div><div class="line"> </div><div class="line">        <span class="comment">// move baseObject</span></div><div class="line">        game.baseObj.x = game.map.x * <span class="number">-1</span>;</div><div class="line">        game.baseObj.y = game.map.y * <span class="number">-1</span>;</div><div class="line">        <span class="comment">// update map, blocks, shots</span></div><div class="line">        updateMap(game, secs);</div><div class="line">        <span class="comment">// switch modes based on map.dist</span></div><div class="line">        <span class="keyword">if</span>(game.map.dist &gt; BASE_DIST &amp;&amp; game.mode === <span class="string">'base'</span>)&#123;</div><div class="line">            game.buttons.currentPage= <span class="string">'main'</span>;</div><div class="line">            game.mode = <span class="string">'space'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(game.map.dist &lt;= BASE_DIST &amp;&amp; game.mode === <span class="string">'space'</span>)&#123;</div><div class="line">            <span class="comment">// set all shots and blocks to inactive state</span></div><div class="line">            poolMod.setActiveStateForAll(game.shots, <span class="literal">false</span>);</div><div class="line">            poolMod.setActiveStateForAll(game.shots, <span class="literal">false</span>);</div><div class="line">            game.buttons.currentPage = <span class="string">'main'</span>;</div><div class="line">            game.mode = <span class="string">'base'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'space'</span>)&#123;</div><div class="line">            updateBlocks(game, secs, state);</div><div class="line">            updateShots(game, secs, state);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// energy</span></div><div class="line">        updateEnergy(game, secs);</div><div class="line">        <span class="comment">// autoHeal ship</span></div><div class="line">        <span class="keyword">if</span>(game.ship.hp.current &lt; game.ship.hp.max &amp;&amp; game.ship.energy.current &gt; ENERGY_AUTOHEAL_COST * secs)&#123;</div><div class="line">            game.ship.energy.current -= ENERGY_AUTOHEAL_COST * secs;</div><div class="line">            autoHealObject(game.ship, secs);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> buttonCheck = <span class="function"><span class="keyword">function</span>(<span class="params">button, pos</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(utils.distance(button.x, button.y, pos.x - <span class="number">160</span>, pos.y - <span class="number">120</span>) &lt;= button.r)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// check current mode and page of buttons</span></div><div class="line">    api.checkButtons = <span class="function"><span class="keyword">function</span>(<span class="params">game, pos, e</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> buttons_mode = game.buttons[game.mode],</div><div class="line">        i;</div><div class="line">        <span class="keyword">if</span>(buttons_mode)&#123;</div><div class="line">            i = <span class="built_in">Object</span>.keys(buttons_mode[game.buttons.currentPage]).length;</div><div class="line">            <span class="keyword">while</span>(i--)&#123;</div><div class="line">                button = buttons_mode[game.buttons.currentPage][i];</div><div class="line">                <span class="keyword">if</span>(buttonCheck(button, pos))&#123;</div><div class="line">                    button.onClick(game, button, e);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// make update buttons public</span></div><div class="line">    api.updateButtons = updateButtons;</div><div class="line"> </div><div class="line">    <span class="comment">// return the Public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="4-The-draw-js-module-as-this-is-a-canvas-example"><a href="#4-The-draw-js-module-as-this-is-a-canvas-example" class="headerlink" title="4 - The draw.js module as this is a canvas example"></a>4 - The draw.js module as this is a canvas example</h2><p>So this is a canvas example after all, and just like every other canvas example I often end up with a draw module. This us where I park all my methods and code that has to do with drawing a view for a game state object to a canvas element. It is generally a good idea to pull this code away from other files that have to do with the main app loop, the game object, and general reusable utility functions.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> TRANSLATE_TO = &#123;</div><div class="line">        <span class="attr">x</span>: <span class="number">160</span>,</div><div class="line">        <span class="attr">y</span>: <span class="number">120</span></div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// THE GRIDLINES</span></div><div class="line">    <span class="comment">// ( playing around with diff settings, but this should be just a single object)</span></div><div class="line">    <span class="keyword">var</span> GRIDLINES = [</div><div class="line">        &#123;  <span class="comment">// large grid size might be best</span></div><div class="line">            cellSize:   <span class="number">128</span>,</div><div class="line">            <span class="attr">cellWidth</span>:  <span class="number">5</span>,</div><div class="line">            <span class="attr">cellHeight</span>: <span class="number">5</span>,</div><div class="line">            <span class="attr">lineWidth</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">strokeStyle</span>: <span class="string">'rgba(255,255,255,0.1)'</span>,</div><div class="line">            <span class="comment">//fillStyle: 'rgba(0,0,0,0.1)'</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">cellSize</span>:   <span class="number">32</span>,</div><div class="line">            <span class="attr">cellWidth</span>:  <span class="number">14</span>,</div><div class="line">            <span class="attr">cellHeight</span>: <span class="number">14</span>,</div><div class="line">            <span class="attr">lineWidth</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">strokeStyle</span>: <span class="string">'white'</span>,</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">cellSize</span>:   <span class="number">16</span>,</div><div class="line">            <span class="attr">cellWidth</span>:  <span class="number">28</span>,</div><div class="line">            <span class="attr">cellHeight</span>: <span class="number">28</span></div><div class="line">        &#125;,</div><div class="line">    ][<span class="number">0</span>];</div><div class="line"> </div><div class="line">    <span class="comment">// base draw object helper</span></div><div class="line">    <span class="keyword">var</span> baseObjectDraw = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj, render</span>)</span>&#123;</div><div class="line">        ctx.save();</div><div class="line">        ctx.translate(TRANSLATE_TO.x, TRANSLATE_TO.y);</div><div class="line">        ctx.fillStyle= obj.fillStyle || <span class="string">'gray'</span>;</div><div class="line">        ctx.strokeStyle= obj.strokeStyle || <span class="string">'white'</span>;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.lineWidth = <span class="number">1</span>;</div><div class="line">        ctx.arc(obj.x, obj.y, obj.r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">        ctx.fill();</div><div class="line">        ctx.stroke();</div><div class="line">        <span class="keyword">if</span>(render)&#123;</div><div class="line">            render(ctx, obj);</div><div class="line">        &#125;</div><div class="line">        ctx.restore();</div><div class="line">        ctx.save();</div><div class="line">        <span class="comment">// draw an hp bar for the object if it has one</span></div><div class="line">        <span class="keyword">if</span>(obj.hp)&#123;</div><div class="line">            ctx.translate(TRANSLATE_TO.x, TRANSLATE_TO.y);</div><div class="line">            drawHealthBar(ctx, obj);</div><div class="line">        &#125;</div><div class="line">        ctx.restore();</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw an 'arrow' to the base</span></div><div class="line">    <span class="keyword">var</span> drawArrowToBase = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, game</span>)</span>&#123;</div><div class="line"> </div><div class="line">        baseObjectDraw(ctx, &#123;</div><div class="line">            <span class="attr">x</span>: <span class="built_in">Math</span>.cos(game.map.aToOrigin) * <span class="number">32</span>,</div><div class="line">            <span class="attr">y</span>: <span class="built_in">Math</span>.sin(game.map.aToOrigin) * <span class="number">32</span>,</div><div class="line">            <span class="attr">r</span>: <span class="number">5</span>,</div><div class="line">            <span class="attr">fillStyle</span>: <span class="string">'black'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">            ctx.fillStyle = <span class="string">'red'</span>,</div><div class="line">            ctx.translate(obj.x, obj.y);</div><div class="line">            ctx.rotate(game.map.aToOrigin);</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.moveTo(obj.r, <span class="number">0</span>);</div><div class="line">            ctx.lineTo(obj.r * <span class="number">-1</span>, obj.r);</div><div class="line">            ctx.lineTo(obj.r * <span class="number">-1</span>, obj.r * <span class="number">-1</span>);</div><div class="line">            ctx.closePath();</div><div class="line">            ctx.lineWidth = <span class="number">2</span>;</div><div class="line">            ctx.stroke();</div><div class="line">            ctx.fill();</div><div class="line">        &#125;);</div><div class="line"> </div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw background</span></div><div class="line">    <span class="keyword">var</span> background = <span class="function"><span class="keyword">function</span> (<span class="params">ctx, state, style</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = state.canvas,</div><div class="line">        map = state.game.map,</div><div class="line">        r = <span class="built_in">Math</span>.floor(map.per * <span class="number">255</span>);</div><div class="line">        ctx.fillStyle = style || <span class="string">'rgba('</span> + r + <span class="string">',0,0,1)'</span>;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw a mini map that will help me to get a better idea of where I am</span></div><div class="line">    <span class="keyword">var</span> positionMap = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = state.game.map;</div><div class="line">        <span class="keyword">var</span> minMap = &#123;</div><div class="line">            <span class="attr">x</span>: <span class="number">20</span>,</div><div class="line">            <span class="attr">y</span>: <span class="number">-20</span>,</div><div class="line">            <span class="attr">r</span>: <span class="number">10</span>,</div><div class="line">            <span class="attr">fillStyle</span>: <span class="string">'rgba(255,0,0,0.2)'</span></div><div class="line">        &#125;;</div><div class="line"> </div><div class="line">        baseObjectDraw(ctx, minMap, <span class="function"><span class="keyword">function</span>(<span class="params">ctx, minMap</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> radian = map.aToOrigin + <span class="built_in">Math</span>.PI;</div><div class="line">            <span class="keyword">var</span> x = <span class="built_in">Math</span>.cos(radian) * minMap.r * map.per,</div><div class="line">            y = <span class="built_in">Math</span>.sin(radian) * minMap.r * map.per;</div><div class="line">            ctx.translate(minMap.x, minMap.y);</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.lineWidth=<span class="number">2</span>;</div><div class="line">            ctx.arc(x,y,<span class="number">1</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>);</div><div class="line">            ctx.stroke();</div><div class="line">        &#125;);</div><div class="line"> </div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// position status</span></div><div class="line">    <span class="keyword">var</span> positionStatus = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game,</div><div class="line">        map = game.map;</div><div class="line">        </div><div class="line">        <span class="comment">// base text style</span></div><div class="line">        ctx.fillStyle=<span class="string">'yellow'</span>;</div><div class="line">        ctx.textBaseline=<span class="string">'top'</span>;</div><div class="line">        ctx.textAlign=<span class="string">'left'</span>;</div><div class="line">        ctx.font=<span class="string">'8px courier'</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">var</span> sx = <span class="number">160</span>, sy = <span class="number">200</span>;</div><div class="line">        ctx.fillText(<span class="string">'position status: '</span>, sx, sy);</div><div class="line">        ctx.fillText(<span class="string">'pos: ('</span> + <span class="built_in">Math</span>.floor(map.x) + <span class="string">','</span> + <span class="built_in">Math</span>.floor(map.y) + <span class="string">')'</span>, sx, sy + <span class="number">8</span>);</div><div class="line">        ctx.fillText(<span class="string">'dist: '</span> + <span class="built_in">Math</span>.floor(map.dist), sx, sy + <span class="number">16</span>);</div><div class="line">        ctx.fillText(<span class="string">'per: '</span> + <span class="built_in">Math</span>.floor(map.per * <span class="number">100</span>) + <span class="string">'%'</span>, sx, sy + <span class="number">24</span>);</div><div class="line"> </div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// display effects info for current weapon</span></div><div class="line">    <span class="keyword">var</span> effectsInfo = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game,</div><div class="line">        weapon = game.ship.weapon;</div><div class="line">        </div><div class="line">        <span class="comment">// base text style</span></div><div class="line">        ctx.fillStyle=<span class="string">'lime'</span>;</div><div class="line">        ctx.textBaseline=<span class="string">'top'</span>;</div><div class="line">        ctx.textAlign=<span class="string">'left'</span>;</div><div class="line">        ctx.font=<span class="string">'8px courier'</span>;</div><div class="line"> </div><div class="line">        <span class="comment">//ctx.fillText('effects: ' + weapon.effects.length, 5, 40);</span></div><div class="line">        <span class="keyword">var</span> sx = <span class="number">25</span>;</div><div class="line">        weapon.effects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">effectType, index</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> sy = <span class="number">40</span> + <span class="number">50</span> * index,</div><div class="line">            effect = game.effects[effectType];</div><div class="line">            ctx.fillText(effect.effectType + <span class="string">':'</span>, sx, sy);</div><div class="line">            ctx.fillText(<span class="string">' chance  : '</span> + <span class="built_in">Math</span>.round(effect.chance * <span class="number">100</span>) + <span class="string">'%'</span>, sx, sy + <span class="number">8</span>);</div><div class="line">            ctx.fillText(<span class="string">' maxStack: '</span> + effect.maxStack, sx, sy + <span class="number">16</span>);</div><div class="line">            <span class="keyword">if</span>(effect.effectType === <span class="string">'burn'</span>)&#123;</div><div class="line">                ctx.fillText(<span class="string">' damage%: '</span> + <span class="built_in">Math</span>.round(effect.damagePer * <span class="number">100</span>) + <span class="string">'%'</span>, sx, sy + <span class="number">24</span>);</div><div class="line">                ctx.fillText(<span class="string">' count '</span> + effect.count, sx, sy + <span class="number">32</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(effect.effectType === <span class="string">'acid'</span>)&#123;</div><div class="line">                ctx.fillText(<span class="string">' damage: '</span> + effect.damageMulti.toFixed(<span class="number">2</span>) + <span class="string">'X'</span>, sx, sy + <span class="number">24</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw game status bar info</span></div><div class="line">    <span class="keyword">var</span> statusBar = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game,</div><div class="line">        ship = game.ship,</div><div class="line">        map = game.map,</div><div class="line">        weapon = game.ship.weapon,</div><div class="line">        grad = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>);</div><div class="line">        grad.addColorStop(<span class="number">0</span>, <span class="string">'#808080'</span>);</div><div class="line">        grad.addColorStop(<span class="number">1</span>, <span class="string">'rgba(0,0,255,0.07)'</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// backdrop for status bar</span></div><div class="line">        ctx.fillStyle=grad; <span class="comment">//"rgba(128,128,128,0.5)";</span></div><div class="line">        ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>, state.canvas.width, <span class="number">40</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// base text style</span></div><div class="line">        ctx.fillStyle=<span class="string">'white'</span>;</div><div class="line">        ctx.textBaseline=<span class="string">'top'</span>;</div><div class="line">        ctx.textAlign=<span class="string">'left'</span>;</div><div class="line"> </div><div class="line">        <span class="comment">// must display money</span></div><div class="line">        ctx.font=<span class="string">'10px courier'</span>;</div><div class="line">        ctx.fillText(utils.format_money(game.money), <span class="number">220</span>, <span class="number">5</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// ship speed and heading</span></div><div class="line">        ctx.font=<span class="string">'8px courier'</span>;</div><div class="line">        ctx.fillText(<span class="string">'speed  : '</span> + <span class="built_in">Math</span>.floor(map.pps) + <span class="string">' / '</span> + <span class="built_in">Math</span>.floor(map.maxPPS), <span class="number">220</span>, <span class="number">13</span>);</div><div class="line">        ctx.fillText(<span class="string">'heading: '</span> + map.degree.toFixed(<span class="number">2</span>), <span class="number">220</span>, <span class="number">20</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// basic weapon info</span></div><div class="line">        ctx.font=<span class="string">'10px courier'</span>;</div><div class="line">        ctx.fillText(weapon.name, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">        ctx.font=<span class="string">'8px courier'</span>;</div><div class="line">        ctx.fillText(<span class="string">'Shot Damage:'</span> + weapon.shotDamage.toFixed(<span class="number">2</span>), <span class="number">5</span>, <span class="number">13</span>);</div><div class="line">        ctx.fillText(<span class="string">'Fires/sec  :'</span> + weapon.firesPerSecond.toFixed(<span class="number">2</span>), <span class="number">5</span>, <span class="number">20</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// HP Bar</span></div><div class="line">        ctx.fillStyle=<span class="string">'#2a2a2a'</span>;</div><div class="line">        ctx.fillRect(<span class="number">160</span> - <span class="number">50</span>, <span class="number">5</span>, <span class="number">100</span>, <span class="number">15</span>);</div><div class="line">        ctx.fillStyle=<span class="string">'#af0000'</span>;</div><div class="line">        ctx.fillRect(<span class="number">160</span> - <span class="number">50</span>, <span class="number">5</span>, <span class="number">100</span> * ship.hp.per, <span class="number">15</span>);</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">        ctx.font=<span class="string">'8px arial'</span>;</div><div class="line">        ctx.fillText(ship.hp.current + <span class="string">' / '</span> + ship.hp.max, <span class="number">160</span>, <span class="number">9</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// Energy bar</span></div><div class="line">        ctx.fillStyle=<span class="string">'#2a2a2a'</span>;</div><div class="line">        ctx.fillRect(<span class="number">160</span> - <span class="number">50</span>, <span class="number">20</span>, <span class="number">100</span>, <span class="number">8</span>);</div><div class="line">        ctx.fillStyle=<span class="string">'#afaf00'</span>;</div><div class="line">        ctx.fillRect(<span class="number">160</span> - <span class="number">50</span>, <span class="number">20</span>, <span class="number">100</span> * ship.energy.per, <span class="number">8</span>);</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">        ctx.font=<span class="string">'8px arial'</span>;</div><div class="line">        ctx.fillText(<span class="built_in">Math</span>.round(ship.energy.current) + <span class="string">' / '</span> + ship.energy.max, <span class="number">160</span>, <span class="number">20</span>);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw a health bar for an object</span></div><div class="line">    <span class="keyword">var</span> drawHealthBar = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(obj.hp)&#123;</div><div class="line">            <span class="keyword">if</span>(obj.hp.per &lt; <span class="number">1</span>)&#123;</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.rect(obj.x - obj.r, obj.y + obj.r - <span class="number">5</span>, obj.r * <span class="number">2</span>, <span class="number">5</span>);</div><div class="line">                ctx.fillStyle=<span class="string">"rgba(120,120,120,0.7)"</span>;</div><div class="line">                ctx.fill();</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.rect(obj.x - obj.r, obj.y + obj.r - <span class="number">5</span>, obj.r * <span class="number">2</span> * obj.hp.per, <span class="number">5</span>);</div><div class="line">                ctx.fillStyle=<span class="string">"rgba(0,255,0,0.4)"</span>;</div><div class="line">                ctx.fill();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// darw shots</span></div><div class="line">    <span class="keyword">var</span> shots = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game;</div><div class="line">        state.game.shots.objects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">shot</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(shot.active)&#123;</div><div class="line">                baseObjectDraw(ctx, shot, <span class="function"><span class="keyword">function</span>(<span class="params">ctx, shot</span>)</span>&#123;</div><div class="line">                    ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">                    ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">                    ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw blocks</span></div><div class="line">    <span class="keyword">var</span> blocks = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game;</div><div class="line">        state.game.blocks.objects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">block</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(block.active)&#123;</div><div class="line">                baseObjectDraw(ctx, block, <span class="function"><span class="keyword">function</span>(<span class="params">ctx, block</span>)</span>&#123;</div><div class="line">                    ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">                    ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">                    ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">                    ctx.font = <span class="string">'9px arial'</span>;</div><div class="line">                    <span class="keyword">var</span> effectsText = <span class="built_in">Object</span>.keys(block.effectStats).map(<span class="function"><span class="keyword">function</span>(<span class="params">effectType</span>)</span>&#123;</div><div class="line">                        <span class="keyword">return</span> effectType + <span class="string">' '</span> + block.effectStats[effectType] + <span class="string">'x'</span>;</div><div class="line">                    &#125;).join(<span class="string">' : '</span>);</div><div class="line">                    ctx.fillText(effectsText, block.x, block.y - <span class="number">9</span>);</div><div class="line">                    ctx.fillText(<span class="built_in">Math</span>.floor(block.hp.current) + <span class="string">'/'</span> + <span class="built_in">Math</span>.floor(block.hp.max) , block.x, block.y);</div><div class="line">                    ctx.fillText(utils.format_money(block.money) + <span class="string">' ; '</span> +</div><div class="line">                        <span class="string">'A'</span> + block.armor.minDam + <span class="string">' ; '</span> +</div><div class="line">                        <span class="string">'D'</span> + block.damage, block.x, block.y + <span class="number">9</span>);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw the player ship</span></div><div class="line">    <span class="keyword">var</span> ship = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game;</div><div class="line">        ctx.fillStyle = <span class="string">'rgba(0,0,255,0.2)'</span>;</div><div class="line">        baseObjectDraw(ctx, game.ship, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> radian = game.map.radian;</div><div class="line">            ctx.rotate(radian);</div><div class="line">            ctx.strokeStyle = <span class="string">'white'</span>;</div><div class="line">            ctx.fillStyle=<span class="string">'#0060ff'</span></div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.moveTo(game.ship.r, <span class="number">0</span>);</div><div class="line">            ctx.lineTo(game.ship.r * <span class="number">-1</span>, game.ship.r);</div><div class="line">            ctx.lineTo(game.ship.r * <span class="number">-1</span>, game.ship.r * <span class="number">-1</span>);</div><div class="line">            ctx.closePath();</div><div class="line">            ctx.lineWidth = <span class="number">3</span>;</div><div class="line">            ctx.stroke();</div><div class="line">            ctx.fill();</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw grid lines so that we know that we are in fact moving</span></div><div class="line">    <span class="keyword">var</span> gridLines = <span class="function"><span class="keyword">function</span> (<span class="params">ctx, state, style</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> grid = GRIDLINES;</div><div class="line">        <span class="keyword">var</span> sx = grid.cellWidth * grid.cellSize / <span class="number">2</span> * <span class="number">-1</span> - (state.game.map.x % grid.cellSize),</div><div class="line">        sy = grid.cellHeight * grid.cellSize / <span class="number">2</span> * <span class="number">-1</span> + (state.game.map.y % grid.cellSize) * <span class="number">-1</span>,</div><div class="line">        x, y,</div><div class="line">        len = grid.cellWidth * grid.cellHeight,</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        ctx.strokeStyle = grid.strokeStyle || <span class="string">'red'</span>;</div><div class="line">        <span class="comment">//ctx.fillStyle = grid.fillStyle || 'lime';</span></div><div class="line">        ctx.lineWidth = grid.lineWidth || <span class="number">1</span>;</div><div class="line">        ctx.save();</div><div class="line">        ctx.translate(TRANSLATE_TO.x, TRANSLATE_TO.y);</div><div class="line">        <span class="keyword">while</span>(i &lt; len)&#123;</div><div class="line">            x = sx + (i % grid.cellWidth) * grid.cellSize;</div><div class="line">            y = sy + <span class="built_in">Math</span>.floor(i / grid.cellWidth) * grid.cellSize;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.rect(x,y,grid.cellSize, grid.cellSize);</div><div class="line">            ctx.stroke();</div><div class="line">            <span class="comment">//if(grid.fillStyle)&#123;</span></div><div class="line">            <span class="comment">//    ctx.fill();</span></div><div class="line">            <span class="comment">//&#125;</span></div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        ctx.restore();</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw game state info for debuging</span></div><div class="line">    <span class="keyword">var</span> info = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game,</div><div class="line">        ship = game.ship,</div><div class="line">        w = ship.weapon,</div><div class="line">        headCir = state.input.pointer.headCir,</div><div class="line">        map = game.map;</div><div class="line">        <span class="keyword">if</span>(state.debug)&#123;</div><div class="line">            background(ctx, state, <span class="string">'rgba(0,0,0,0.5)'</span>);</div><div class="line">            ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">            ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">            ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">            ctx.textAlign = <span class="string">'left'</span>;</div><div class="line"> </div><div class="line">            <span class="comment">// block spawning</span></div><div class="line">            <span class="keyword">var</span> activeBlocks = poolMod.getAllActive(game.blocks),</div><div class="line">            blockSpawn = game.blockSpawn;</div><div class="line">            ctx.fillText(<span class="string">'active blocks : '</span> + activeBlocks.length, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line">            ctx.fillText(<span class="string">'block spawn last pos : '</span> + blockSpawn.lastPos.x + <span class="string">','</span> + blockSpawn.lastPos.y, <span class="number">10</span>, <span class="number">20</span>);</div><div class="line">            ctx.fillText(<span class="string">'block spawn dist : '</span> + blockSpawn.dist, <span class="number">10</span>, <span class="number">30</span>);</div><div class="line">            ctx.fillText(<span class="string">'map pos: '</span> + <span class="built_in">Math</span>.floor(map.x) + <span class="string">' , '</span> + <span class="built_in">Math</span>.floor(map.y), <span class="number">10</span>, <span class="number">40</span>);</div><div class="line"> </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw current version number</span></div><div class="line">    <span class="keyword">var</span> ver = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">        ctx.font = <span class="string">'10px arial'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.fillText(<span class="string">'v'</span> + state.ver, <span class="number">5</span>, state.canvas.height - <span class="number">15</span>);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">   <span class="comment">// draw FPS info</span></div><div class="line">    <span class="keyword">var</span> FPS = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">        ctx.font = <span class="string">'8px arial'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.fillText(<span class="string">'FPS: '</span> + <span class="built_in">Math</span>.floor(state.FPS), <span class="number">50</span>, state.canvas.height - <span class="number">15</span>);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw an xp table or upgrade object</span></div><div class="line">    <span class="keyword">var</span> xpTable = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, table</span>)</span>&#123;</div><div class="line">        ctx.beginPath();</div><div class="line">        table.points.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">point, i</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(i===<span class="number">0</span>)&#123;</div><div class="line">                ctx.moveTo(table.x + point.x, table.y + point.y);</div><div class="line">            &#125;</div><div class="line">            ctx.lineTo(table.x + point.x, table.y + point.y);</div><div class="line">        &#125;);</div><div class="line">        ctx.strokeStyle = <span class="string">'green'</span>;</div><div class="line">        ctx.stroke();</div><div class="line">        ctx.strokeStyle = <span class="string">'gray'</span>;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.rect(table.x, table.y, table.w, table.h);</div><div class="line">        ctx.stroke();</div><div class="line">        <span class="comment">// if upgrate object draw circle over current level point</span></div><div class="line">        <span class="keyword">if</span>(table.levelIndex &gt;= <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> point = table.points[table.levelIndex];</div><div class="line">            ctx.strokeStyle = <span class="string">'lime'</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.arc(table.x + point.x, table.y + point.y, <span class="number">2</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">            ctx.stroke();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// PUBLIC API</span></div><div class="line"> </div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw current game mode</span></div><div class="line">    api.currentMode = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = state.game;</div><div class="line"> </div><div class="line">        <span class="comment">// draw background</span></div><div class="line">        background(ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw grid lines</span></div><div class="line">        gridLines(ctx, state, <span class="string">'rgba(255,255,255,0.1)'</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// draw base object</span></div><div class="line">        baseObjectDraw(ctx, game.baseObj, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</div><div class="line"> </div><div class="line">        <span class="comment">// draw any buttons for the current mode</span></div><div class="line">        <span class="keyword">var</span> buttons_mode = game.buttons[game.mode];</div><div class="line">        <span class="keyword">if</span>(buttons_mode)&#123;</div><div class="line">            <span class="keyword">var</span> buttons_page = buttons_mode[game.buttons.currentPage];</div><div class="line">            <span class="built_in">Object</span>.keys(buttons_page).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</div><div class="line">                baseObjectDraw(ctx, buttons_page[key], <span class="function"><span class="keyword">function</span>(<span class="params">ctx, button</span>)</span>&#123;</div><div class="line">                    ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">                    ctx.textAlign=<span class="string">'center'</span>;</div><div class="line">                    ctx.textBaseline=<span class="string">'middle'</span>;</div><div class="line">                    ctx.font=<span class="string">'8px arial'</span>;</div><div class="line">                    ctx.fillText(button.desc, button.x, button.y);</div><div class="line">                    <span class="keyword">var</span> cost = button.cost;</div><div class="line">                    <span class="keyword">if</span>(cost != <span class="literal">undefined</span>)&#123;</div><div class="line">                        ctx.fillText(utils.format_money(button.cost), button.x, button.y + <span class="number">10</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'base'</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(game.buttons.currentPage != <span class="string">'main'</span>)&#123;</div><div class="line">               <span class="comment">// statusBar(ctx, state);</span></div><div class="line">            &#125;</div><div class="line">            <span class="comment">// draw grids for the current weapon</span></div><div class="line">            <span class="keyword">if</span>(game.buttons.currentPage === <span class="string">'weapons'</span>)&#123;</div><div class="line">                <span class="keyword">var</span> upgradeIndex = game.ship.weaponIndex * <span class="number">2</span> + <span class="number">3</span>;</div><div class="line">                xpTable(ctx, game.upgrades[upgradeIndex]);</div><div class="line">                xpTable(ctx, game.upgrades[upgradeIndex + <span class="number">1</span>]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(game.buttons.currentPage === <span class="string">'ship'</span>)&#123;</div><div class="line">                xpTable(ctx, game.upgrades[<span class="number">0</span>]);</div><div class="line">                xpTable(ctx, game.upgrades[<span class="number">1</span>]);</div><div class="line">                xpTable(ctx, game.upgrades[<span class="number">2</span>]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(game.buttons.currentPage === <span class="string">'effects'</span>)&#123;</div><div class="line">                effectsInfo(ctx, state);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="comment">// draw an 'arrow' object that points to the base if in space mode</span></div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'space'</span>)&#123;</div><div class="line">            <span class="comment">// draw blocks and shots</span></div><div class="line">            blocks(ctx, state);</div><div class="line">            shots(ctx, state);</div><div class="line">            <span class="comment">// draw an arrow back to the base</span></div><div class="line">            drawArrowToBase(ctx, game);</div><div class="line">            <span class="comment">// position status and map</span></div><div class="line">            positionStatus(ctx, state);</div><div class="line">            positionMap(ctx, state);</div><div class="line">            effectsInfo(ctx, state);</div><div class="line">            <span class="comment">//statusBar(ctx, state);</span></div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="comment">// draw blocks, the ship, and shots</span></div><div class="line">        ship(ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw the games status bar</span></div><div class="line">        statusBar(ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw debug info</span></div><div class="line">        info(ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw version number</span></div><div class="line">        ver(ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw fps counter</span></div><div class="line">        FPS(ctx, state);</div><div class="line"> </div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// draw the pointer user interface</span></div><div class="line">    api.pointerUI = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, state</span>)</span>&#123;</div><div class="line">         <span class="keyword">var</span> headCir = state.input.pointer.headCir,</div><div class="line">         ppsBar = state.input.pointer.ppsBar;</div><div class="line">         <span class="comment">// draw headCir</span></div><div class="line">         ctx.strokeStyle=<span class="string">'white'</span>;</div><div class="line">         ctx.beginPath();</div><div class="line">         ctx.arc(headCir.x, headCir.y, headCir.r, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">         ctx.stroke();</div><div class="line">         <span class="comment">// draw pps bar</span></div><div class="line">         ctx.strokeStyle=<span class="string">'white'</span>;</div><div class="line">         ctx.beginPath();</div><div class="line">         ctx.rect(ppsBar.x,ppsBar.y,ppsBar.w,ppsBar.h);</div><div class="line">         ctx.stroke();</div><div class="line">         <span class="comment">// actual</span></div><div class="line">         ctx.fillStyle=<span class="string">'yellow'</span>;</div><div class="line">         ctx.beginPath();</div><div class="line">         <span class="keyword">var</span> h = ppsBar.h - ppsBar.h * ( ( ppsBar.actualY - ppsBar.y ) /  ppsBar.h);</div><div class="line">         ctx.rect(ppsBar.x, ppsBar.actualY, ppsBar.w, h);</div><div class="line">         ctx.fill();</div><div class="line">         <span class="comment">// target</span></div><div class="line">         ctx.fillStyle=<span class="string">'white'</span>;</div><div class="line">         ctx.beginPath();</div><div class="line">         ctx.rect(ppsBar.x - <span class="number">2</span>, ppsBar.targetY - <span class="number">3</span>, ppsBar.w + <span class="number">4</span>, <span class="number">6</span>);</div><div class="line">         ctx.fill();</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return draw api</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="5-The-main-js-file"><a href="#5-The-main-js-file" class="headerlink" title="5 - The main.js file"></a>5 - The main.js file</h2><p>For this canvas example I have a utility module, an Object pool module, a game module, and a draw module. There just needs to be a little more javaScript code that will make use of all of this. In many projects what is written here might often turn into a full blown state machine. However for this hyper casual style game I wanted to keep things simple, and to the point so I just have a single main.js file that just allows for a single app loop and state object.</p>
<p>So for this canvas example in the main.js file I just create the canvas element, and the main state object that also included the main game object. Beyond that I just have a simple app loop, and attach some event handlers for keyboard and pointer support. That is it, I wanted to focus on the logic of the game itself, however in future releases I might add a state machine, if I do in fact keep adding features, menus, and so forth, sooner or later I do need to just break things down more.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CANVAS</span></div><div class="line"><span class="keyword">var</span> createCanvas = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.container = opt.container || <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">    opt.canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</div><div class="line">    opt.ctx = opt.canvas.getContext(<span class="string">'2d'</span>);</div><div class="line">    opt.container.appendChild(opt.canvas);</div><div class="line">    opt.canvas.width = opt.width === <span class="literal">undefined</span> ? <span class="number">320</span> : opt.width;</div><div class="line">    opt.canvas.height = opt.height === <span class="literal">undefined</span> ? <span class="number">240</span> : opt.height;</div><div class="line">    opt.ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line">    <span class="keyword">return</span> opt;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> canvasObj = createCanvas(),</div><div class="line">canvas = canvasObj.canvas;</div><div class="line"><span class="comment">// STATE</span></div><div class="line"><span class="keyword">var</span> state = &#123;</div><div class="line">    <span class="attr">ver</span>: <span class="string">'0.26.0'</span>,</div><div class="line">    <span class="attr">canvas</span> : canvas,</div><div class="line">    <span class="attr">ctx</span>: canvasObj.ctx,</div><div class="line">    <span class="attr">game</span>: gameMod.create(&#123;<span class="attr">money</span>: <span class="number">100</span>&#125;),</div><div class="line">    <span class="attr">debug</span>: <span class="literal">false</span>, <span class="comment">// debug mode on or off</span></div><div class="line">    input: &#123;</div><div class="line">        <span class="attr">pointer</span>: &#123;</div><div class="line">            <span class="attr">down</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">pos</span>: &#123;<span class="attr">x</span>:<span class="number">0</span>,<span class="attr">y</span>:<span class="number">0</span>&#125;,</div><div class="line">            <span class="attr">dir</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">headCir</span>: &#123; <span class="comment">// the heading circle use to set a target heading for the ship</span></div><div class="line">                x: <span class="number">320</span> - <span class="number">30</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">240</span> - <span class="number">30</span>,</div><div class="line">                <span class="attr">r</span>: <span class="number">24</span>,</div><div class="line">                <span class="attr">dist</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">a</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">d</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">dir</span>: <span class="number">0</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">ppsBar</span>: &#123;</div><div class="line">                <span class="attr">x</span>: <span class="number">5</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">50</span>,</div><div class="line">                <span class="attr">w</span>: <span class="number">16</span>,</div><div class="line">                <span class="attr">h</span>: <span class="number">150</span>,</div><div class="line">                <span class="attr">targetY</span>: <span class="number">200</span>, <span class="comment">// the target Y value for the speed to get to</span></div><div class="line">                actualY: <span class="number">50</span> + <span class="number">75</span>  <span class="comment">// the actual Y value for the current speed</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">dist</span>: <span class="number">0</span> <span class="comment">// dist from 160, 120 ( or 0,0 when it comes to game state)</span></div><div class="line">        &#125;,</div><div class="line">        <span class="comment">//degree: 0,</span></div><div class="line">        <span class="comment">//degreesPerSecond: 90,</span></div><div class="line">        <span class="comment">//pps: 0,</span></div><div class="line">        <span class="comment">//ppsDelta: 1,</span></div><div class="line">        fire: <span class="literal">false</span>,</div><div class="line">        <span class="attr">keys</span>: &#123;&#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">lt</span> : <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    <span class="attr">FPS_target</span> : <span class="number">20</span>,</div><div class="line">    <span class="attr">FPS</span>: <span class="number">0</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">// update pointer object helper</span></div><div class="line"><span class="keyword">var</span> updatePointer = <span class="function"><span class="keyword">function</span>(<span class="params">game, pos</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> map = game.map,</div><div class="line">    input = state.input,</div><div class="line">    pointer = input.pointer,</div><div class="line">    headCir = pointer.headCir,</div><div class="line">    ppsBar = pointer.ppsBar;</div><div class="line">    <span class="comment">// update dir so that we know the shortest direction to go</span></div><div class="line">    <span class="keyword">var</span> d = <span class="built_in">Math</span>.floor(utils.angleTo(pos.x, pos.y, <span class="number">160</span>, <span class="number">120</span>) / ( <span class="built_in">Math</span>.PI * <span class="number">2</span> ) * <span class="number">360</span>);</div><div class="line">    pointer.dir = utils.shortestDirection(d, <span class="built_in">Math</span>.floor(map.degree), <span class="number">360</span>);</div><div class="line">    <span class="comment">// update main dist</span></div><div class="line">    pointer.dist = utils.distance(pos.x, pos.y, <span class="number">160</span>, <span class="number">120</span>);</div><div class="line">    <span class="comment">// update headCir</span></div><div class="line">    <span class="keyword">if</span>(pointer.down)&#123;</div><div class="line">        headCir.dist = utils.distance(pos.x, pos.y, headCir.x, headCir.y);</div><div class="line">        headCir.dist = headCir.dist &gt; headCir.r ? headCir.r: headCir.dist;</div><div class="line">        <span class="keyword">if</span>(headCir.dist &lt; headCir.r)&#123;</div><div class="line">            headCir.a = utils.angleTo(pos.x, pos.y, headCir.x, headCir.y);</div><div class="line">            headCir.d = <span class="built_in">Math</span>.floor(headCir.a / ( <span class="built_in">Math</span>.PI * <span class="number">2</span> ) * <span class="number">360</span>);</div><div class="line">            headCir.dir = utils.shortestDirection(headCir.d, <span class="built_in">Math</span>.floor(map.degree), <span class="number">360</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(utils.boundingBox(pos.x, pos.y, <span class="number">1</span>, <span class="number">1</span>, ppsBar.x, ppsBar.y, ppsBar.w, ppsBar.h))&#123;</div><div class="line">            ppsBar.targetY = pos.y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> numberButtonCheck = <span class="function"><span class="keyword">function</span>(<span class="params">game, input</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(game.mode === <span class="string">'base'</span>)&#123;</div><div class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(input.keys[n])&#123;</div><div class="line">                game.ship.weaponIndex = n - <span class="number">1</span>;</div><div class="line">                game.ship.weapon = game.weapons[n - <span class="number">1</span>];</div><div class="line">                game.buttons.currentPage = <span class="string">'weapons'</span>;</div><div class="line">                gameMod.updateButtons(game);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// SAVE STATE CHECK and LOOP START</span></div><div class="line"> </div><div class="line"><span class="keyword">var</span> save = &#123;</div><div class="line">   <span class="attr">appName</span>: <span class="string">'hyper-casual-space-shooter-save'</span>,</div><div class="line">   <span class="attr">gameSaves</span>:[],</div><div class="line">   <span class="attr">slotIndex</span>: <span class="number">0</span>,</div><div class="line">   <span class="comment">// update the current slotIndex with the given game object</span></div><div class="line">   updateSlot: <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">       <span class="keyword">var</span> createOptions = save.gameSaves[save.slotIndex];</div><div class="line">       <span class="comment">// save money to create options</span></div><div class="line">       createOptions.money = game.money;</div><div class="line">       <span class="comment">// save upgrades</span></div><div class="line">       createOptions.upgradeIndices = &#123;&#125;;</div><div class="line">       game.upgrades.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">upgrade</span>)</span>&#123;</div><div class="line">           createOptions.upgradeIndices[upgrade.id] = upgrade.levelIndex;</div><div class="line">       &#125;);</div><div class="line">       <span class="comment">// save map pos</span></div><div class="line">       createOptions.mapX = game.map.x;</div><div class="line">       createOptions.mapY = game.map.y;</div><div class="line">       <span class="comment">// update jason</span></div><div class="line">       localStorage.setItem(save.appName, <span class="built_in">JSON</span>.stringify(save.gameSaves));</div><div class="line">   &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">//localStorage.removeItem(save.appName);</span></div><div class="line"> </div><div class="line">save.gameSaves = localStorage.getItem(save.appName);</div><div class="line"><span class="keyword">if</span>(save.gameSaves)&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'save found, parsing'</span>);</div><div class="line">   save.gameSaves = <span class="built_in">JSON</span>.parse(save.gameSaves);</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'no save found, creating new one'</span>);</div><div class="line">   save.gameSaves=[&#123;<span class="attr">money</span>:<span class="number">10000</span>, <span class="attr">upgradeIndices</span>:&#123;&#125;, <span class="attr">mapX</span>:<span class="number">0</span>, <span class="attr">mapY</span>:<span class="number">0</span>&#125;];</div><div class="line">   <span class="comment">//localStorage.setItem(save.appName, JSON.stringify(save.gameSaves));</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> createOptions = save.gameSaves[save.slotIndex];</div><div class="line"> </div><div class="line"><span class="built_in">console</span>.log(save.gameSaves);</div><div class="line"><span class="built_in">console</span>.log(createOptions);</div><div class="line"> </div><div class="line">state.game = gameMod.create(createOptions);</div><div class="line"> </div><div class="line"><span class="comment">// LOOP</span></div><div class="line"><span class="comment">//var lt = new Date(),</span></div><div class="line"><span class="comment">//FPS_target = 1000 / 30;</span></div><div class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    t = now - state.lt,</div><div class="line">    game = state.game,</div><div class="line">    map = game.map,</div><div class="line">    input = state.input,</div><div class="line">    speedPer = map.pps / map.maxPPS,</div><div class="line">    ppsBar = input.pointer.ppsBar,</div><div class="line">    secs = t / <span class="number">1000</span>;</div><div class="line"> </div><div class="line">    requestAnimationFrame(loop);</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> (t &gt;= <span class="number">1000</span> / state.FPS_target) &#123;</div><div class="line"> </div><div class="line">        state.FPS = <span class="number">1</span> / secs;</div><div class="line"> </div><div class="line">        <span class="comment">// if new ship</span></div><div class="line">        <span class="keyword">if</span>(game.ship.newShip)&#123;</div><div class="line">            ppsBar.targetY = <span class="number">200</span>;</div><div class="line">            game.ship.newShip = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="comment">// update input.pointer</span></div><div class="line">        updatePointer(game, input.pointer.pos);</div><div class="line">        <span class="comment">// keyboard or pointer update map radian</span></div><div class="line"> </div><div class="line">        <span class="comment">// keyboard update map pps</span></div><div class="line">        <span class="keyword">if</span>(input.keys.w)&#123;</div><div class="line">            <span class="comment">//map.pps += map.ppsDelta * secs;</span></div><div class="line">            <span class="comment">//map.pps = map.pps &gt; map.maxPPS ? map.maxPPS : map.pps;</span></div><div class="line">            ppsBar.targetY -= <span class="number">100</span> * secs;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(input.keys.s)&#123;</div><div class="line">            <span class="comment">//map.pps -= map.ppsDelta * secs;</span></div><div class="line">            <span class="comment">//map.pps = map.pps &lt; 0 ? 0 : map.pps;</span></div><div class="line">            ppsBar.targetY += <span class="number">100</span> * secs;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(input.keys.a)&#123;</div><div class="line">            map.degree += map.degreesPerSecond * secs;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(input.keys.d)&#123;</div><div class="line">            map.degree -= map.degreesPerSecond * secs;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="comment">// clamp targetY</span></div><div class="line">        ppsBar.targetY = ppsBar.targetY &lt; ppsBar.y ? ppsBar.y: ppsBar.targetY;</div><div class="line">        ppsBar.targetY = ppsBar.targetY &gt; ppsBar.y + ppsBar.h ? ppsBar.y + ppsBar.h: ppsBar.targetY;</div><div class="line"> </div><div class="line">        <span class="comment">// update map pps based on targetY and actualY of the ppsBar</span></div><div class="line"> </div><div class="line">        <span class="keyword">if</span>(ppsBar.targetY != ppsBar.actualY)&#123;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span>(ppsBar.actualY &gt; ppsBar.targetY)&#123;</div><div class="line">                map.pps += map.ppsDelta * secs;</div><div class="line">                map.pps = map.pps &gt; map.maxPPS ? map.maxPPS : map.pps;</div><div class="line">                <span class="comment">// update ppsBar.actualY based on map.pps over map.maxPPS</span></div><div class="line">                ppsBar.actualY = ppsBar.y + ppsBar.h - ppsBar.h * speedPer;</div><div class="line">                <span class="keyword">if</span>(ppsBar.actualY &lt; ppsBar.targetY)&#123;</div><div class="line">                    ppsBar.actualY = ppsBar.targetY;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span>(ppsBar.actualY &lt; ppsBar.targetY)&#123;</div><div class="line">                map.pps -= map.ppsDelta * secs;</div><div class="line">                map.pps = map.pps &lt; <span class="number">0</span> ? <span class="number">0</span> : map.pps;</div><div class="line">                <span class="comment">// update ppsBar.actualY based on map.pps over map.maxPPS</span></div><div class="line">                ppsBar.actualY = ppsBar.y + ppsBar.h - ppsBar.h * speedPer;</div><div class="line">                <span class="keyword">if</span>(ppsBar.actualY &gt; ppsBar.targetY)&#123;</div><div class="line">                    ppsBar.actualY = ppsBar.targetY;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        <span class="comment">// pointer update map radian</span></div><div class="line">        <span class="keyword">var</span> headCir = input.pointer.headCir;</div><div class="line">        <span class="comment">//if(input.pointer.down &amp;&amp; input.pointer.dist &lt;= 32)&#123;</span></div><div class="line">        <span class="keyword">if</span>(input.pointer.down &amp;&amp; headCir.dist &lt; headCir.r)&#123;</div><div class="line">            <span class="comment">//if(input.pointer.dir === 1)&#123;</span></div><div class="line">            <span class="keyword">if</span>(headCir.dir === <span class="number">1</span>)&#123;</div><div class="line">                map.degree += map.degreesPerSecond * secs;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//if(input.pointer.dir === -1)&#123;</span></div><div class="line">            <span class="keyword">if</span>(headCir.dir === <span class="number">-1</span>)&#123;</div><div class="line">                map.degree -= map.degreesPerSecond * secs;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// pointer update map pps</span></div><div class="line">        <span class="keyword">if</span>(input.pointer.down &amp;&amp; input.pointer.dist &lt; <span class="number">32</span>)&#123;</div><div class="line">            <span class="keyword">var</span> per = input.pointer.dist / <span class="number">32</span>;</div><div class="line">            map.pps.pps = map.maxPPS * per;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// keyboard update fire</span></div><div class="line">        input.fire = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(input.keys.l)&#123;</div><div class="line">            input.fire = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// number button check</span></div><div class="line">        numberButtonCheck(game, input);</div><div class="line">        <span class="comment">// wrap degree</span></div><div class="line">        map.degree = utils.mod(map.degree, <span class="number">360</span>);</div><div class="line">        <span class="comment">// update game</span></div><div class="line">        <span class="comment">//gameMod.setMapMovement(game, input.degree, input.pps);</span></div><div class="line">        map.radian = utils.wrapRadian(<span class="built_in">Math</span>.PI / <span class="number">180</span> * map.degree);</div><div class="line">        gameMod.update(game, secs, state);</div><div class="line"> </div><div class="line">        <span class="comment">// draw</span></div><div class="line">        draw.currentMode(state.ctx, state);</div><div class="line">        draw.pointerUI(state.ctx, state);</div><div class="line"> </div><div class="line">        <span class="comment">// update slot</span></div><div class="line">        save.updateSlot(game);</div><div class="line"> </div><div class="line">        state.lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">loop();</div><div class="line"> </div><div class="line"><span class="comment">// KEYBOARD EVENTS</span></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'keydown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    <span class="comment">//e.preventDefault();</span></div><div class="line">    <span class="keyword">var</span> key = e.key.toLowerCase();</div><div class="line">    state.input.keys[key] = <span class="literal">true</span>;</div><div class="line">&#125;);</div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    <span class="comment">//e.preventDefault();</span></div><div class="line">    <span class="keyword">var</span> key = e.key.toLowerCase();</div><div class="line">    <span class="comment">// toggle debug mode</span></div><div class="line">    <span class="keyword">if</span>(key === <span class="string">'v'</span>)&#123;</div><div class="line">       state.debug = !state.debug;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(key === <span class="string">'b'</span>)&#123;</div><div class="line">       state.game.autoFire = !state.game.autoFire;</div><div class="line">    &#125;</div><div class="line">    state.input.keys[key] = <span class="literal">false</span>;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// MOUSE AND TOUCH</span></div><div class="line"><span class="keyword">var</span> pointerEvent = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">   <span class="keyword">var</span> pos = state.input.pointer.pos = utils.getCanvasRelative(e);</div><div class="line">   <span class="keyword">if</span>(e.type === <span class="string">'mousedown'</span> || e.type === <span class="string">'touchstart'</span>)&#123;</div><div class="line">       state.input.pointer.down = <span class="literal">true</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">//if((e.type === 'mousemove' || e.type === 'touchmove') &amp;&amp; state.input.pointer.down)&#123;</span></div><div class="line">   <span class="comment">//&#125;</span></div><div class="line">   <span class="keyword">if</span>(e.type === <span class="string">'mouseup'</span> || e.type === <span class="string">'touchend'</span>)&#123;</div><div class="line">       state.input.pointer.down = <span class="literal">false</span>;</div><div class="line">       gameMod.checkButtons(state.game, pos, e);</div><div class="line">   &#125;</div><div class="line">&#125;;</div><div class="line">canvas.addEventListener(<span class="string">'mousedown'</span>, pointerEvent);</div><div class="line">canvas.addEventListener(<span class="string">'mousemove'</span>, pointerEvent);</div><div class="line">canvas.addEventListener(<span class="string">'mouseup'</span>, pointerEvent);</div></pre></td></tr></table></figure>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6 - Conclusion"></a>6 - Conclusion</h2><p>I was able to get the basic idea of what I wanted together with this fairly quickly. However now the question is how much more do I need to add to this in order to make a project that people are actually going to want to play? The game started out with just shooting shot objects at block objects, and that was just it. When I take a moment to play the game for a while, just doing that alone is a little satisfying, but in order to have a real game of course I am going to need more than just that. So I started adding features that have to do with weapons, upgrades, block positioning, block properties, and effects on blocks. It is starting to feel like a bit og a game, but I am not sure if I can truly say that this one is a done deal just yet.</p>
<p>I think that maybe an important part of the process is to not just think of a canvas example as just another project that I need to get over with so I can move on to the next thing. I am guilty of this kind of problem with many of my examples thus far, I work on something until I get the basic idea up and running, and then I stop working on it so I can move on to something else. This is a bad habit that has something to do with entering a kind of developer mindset, but loosing sight of a gamer mindset. So I have made an effort to break that cycle by trying to get into playing my own game, this game, to experience what it is like to actually play it. So far I would say that it is fun for a little while, but I still quickly loose interest after a little while, so maybe I still have some work to do with this one.</p>
<p>I have some other examples where I have broke the cycle of not going beyond the basic core idea, only to end up stopping eventually anyway. The result then is ending up with a project that is just starting to feel like a game, but not just there yet. So maybe if I start with a very basic idea for a game, try to limit the number of features, and focus on what really truly matters, I can break this cycle once and for all. I should keep working on this game, but I should not just more forward with any little idea that comes to mind. The focus should be on what truly matters with this, what will truly make this game into a real game for once.</p>
<p>I have some additional work drafted out for additional features, but at this point I think that there is only so much more to add. Once I have all the features that I want from there I think I might just want to make some code readability improvements. I have a lot of ideas that might help to make this game a lot more fun, but maybe some of those ideas should be pursued in a fork of this source code actually. I think that in the ling term I would like to keep this example simple, in terms of the game play at least. Sore I have added a fair number of features all ready, but the basic idea is to just fly around, and blast some blocks all to hell. A basic as it might be, it seems to work okay as a kind of escape. Not just when working on it, but paying it also.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/" data-id="cl3hiy9mc02usv8v1jj3d21ad" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/12/14/python-getting-started/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Getting started with Python
        
      </div>
    </a>
  
  
    <a href="/2020/12/10/linux-bash-script-parameters-positional/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Positional Parameters in Linux Bash scripts</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/index.html';
    this.page.identifier = '760';
    this.page.title = 'Hyper Casual Space Shooter canvas example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.5px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.5px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.5px;">angular</a> <a href="/tags/animation/" style="font-size: 12px;">animation</a> <a href="/tags/automation/" style="font-size: 12px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.5px;">backbone</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.5px;">canvas</a> <a href="/tags/corejs/" style="font-size: 13px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.5px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.5px;">express</a> <a href="/tags/games/" style="font-size: 17px;">games</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 12px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.5px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.5px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.5px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.5px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.5px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.5px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.5px;">python</a> <a href="/tags/statistics/" style="font-size: 14px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/20/threejs-examples-object-grid-wrap/">Object grid wrap threejs javaScript module example</a>
          </li>
        
          <li>
            <a href="/2022/05/17/threejs-vector3-lerp/">Linear lerping with the Vector3 lerp method</a>
          </li>
        
          <li>
            <a href="/2022/05/12/threejs-examples-sequence-hooks/">threejs example using a sequence module with hooks</a>
          </li>
        
          <li>
            <a href="/2022/05/09/threejs-box3/">The Box3 class in threejs.</a>
          </li>
        
          <li>
            <a href="/2022/05/06/threejs-examples-lookat-with-apply-euler/">Object3d lookAt and Vector3 apply Euler methods threejs example</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS-Examples</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas-Examples</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2020/12/11/canvas-example-hyper-casual-space-shooter/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>