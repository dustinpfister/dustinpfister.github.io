<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>grid game unit movement javaScript example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="So this week I started working on a new canvas example prototype, and the very first minor release of the prototype thus far strikes me as something good to write about as a simple stand alone javaScr">
<meta property="og:type" content="article">
<meta property="og:title" content="grid game unit movement javaScript example">
<meta property="og:url" content="https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="So this week I started working on a new canvas example prototype, and the very first minor release of the prototype thus far strikes me as something good to write about as a simple stand alone javaScr">
<meta property="og:updated_time" content="2021-12-06T20:55:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="grid game unit movement javaScript example">
<meta name="twitter:description" content="So this week I started working on a new canvas example prototype, and the very first minor release of the prototype thus far strikes me as something good to write about as a simple stand alone javaScr">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS-Examples</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas-Examples</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-js-javascript-example-grid-game-unit-movement" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/11/js-javascript-example-grid-game-unit-movement/" class="article-date"> Published:
  <time datetime="2020-08-11T13:40:00.000Z" itemprop="datePublished">2020-08-11</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2020/08/11/js-javascript-example-grid-game-unit-movement/" class="article-date"> Modified:
  <time datetime="2021-12-06T20:55:37.000Z" itemprop="dateModified">2021-12-06</time>
</a>

    <span class="article-date">V1.47</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js/">js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      grid game unit movement javaScript example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>So this week I started working on a new canvas example prototype, and the very first minor release of the prototype thus far strikes me as something good to write about as a simple stand alone <a href="/2021/04/02/js-javascript-example/">javaScript example</a> post. Thus far it is just a simple example of having a grid, and having a player unit move around in the grid when a player clicks on a given cell location. The basic idea that I have together thus far with it could be taken in a whole range of different directions when it comes to making it into something that is more of a game beyond that of what I have in mind for the canvas example prototype. So I thought I would copy and past the source code over to another location and maintain it as just a simple starting point for a grid type game that involves moving a unit around a simple grid.</p>
<p>I have made many projects in the past that involve the use of a <a href="/2019/11/27/canvas-example-grid-defense/">grid in one form or another such as my grid defense canvas example</a>, I also have another canvas example when it comes to <a href="/2019/11/07/canvas-example-grid/">creating and drawing grids in general</a> with canvas. Shortly after I wrote this post for the first time I made another <a href="/2021/08/20/js-javascript-example-grid-module/">example where the aim is to make a grid module</a> that can be used over and over again from one project to another rather than making a custom solution for a single project or examples such as the case with this example that I am writing about here. The problem with that as I see it s far is that making a grid module is something that I never seem to get just right, so I need to keep making new ones. So maybe some times it is a good idea to just create a custom grid module on a project by project basis rather than trying to make some kind of magic grid module that will work well in every possible project.</p>
<p>However in this one I have an idea that I have not done yet with grids, and would like to move forward with it. Also in this post I am touching base on a lot of other topics when it comes to starting a foundation to which I will build on top of when it comes to making a real project rather than just yet another simple javaScript code example. This is a cycle that I would very much like to break at some point in my life.</p>
<p>It may seem as a very simple, trivial example, and for a veteran javaScript developer I suppose it is. However there are still many topics that are covered when it comes to just getting to this simple starting point, and also even when it comes to being an experienced javaScript developer there is the topic of how to go about structuring a complex projects that might at one point in the future consist of thousands of lines of code. This is a topic that I still strugle with even though I have many years of experience thus far. So then this should prove to be a nice little starting point for a simple game that involves a player controlled unit, so lets take a look at the source code.</p>
<a id="more"></a>
<p><div id="canvas-app" style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div></p>
<script>var utils={};utils.distance=function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))};utils.angleToPoint=function(x1,y1,x2,y2,scale){scale=scale===undefined?Math.PI*2:scale;var aTan=Math.atan2(y1-y2,x1-x2);return(aTan+Math.PI)/(Math.PI*2)*scale};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect();return{x:Math.floor((e.touches?e.touches[0].clientX:e.clientX)-bx.left),y:Math.floor((e.touches?e.touches[0].clientY:e.clientY)-bx.top),bx:bx}};utils.deepCloneJSON=function(obj){try{return JSON.parse(JSON.stringify(obj))}catch(e){console.log(e.message);console.log(obj);return{}}};var mapMod=function(){var createCells=function(map){var cells=[];var len=map.w*map.h,i=0;while(i<len){cells.push({i:i,x:i%map.w,y:Math.floor(i/map.w),walkable:true,closed:false,data:{},unit:null});i+=1}return cells};var api={};api.create=function(opt){opt=opt||{};var map={w:opt.w||9,h:opt.h||7,cellSize:32,margin:{x:opt.marginX==undefined?5:opt.marginX,y:opt.marginY==undefined?5:opt.marginY},cells:[]};map.cells=opt.cells||createCells(map);return map};api.get=function(map,xi,y){if(arguments.length===2){return map.cells[xi]}if(xi<0||y<0||xi>=map.w||y>=map.h){return false}return map.cells[y*map.w+xi]};api.getCellByPointer=function(map,x,y){var cx=Math.floor((x-map.margin.x)/map.cellSize),cy=Math.floor((y-map.margin.y)/map.cellSize);return api.get(map,cx,cy)};var sortOpen=function(opened){return opened.sort(function(nodeA,nodeB){if(nodeA.weight<nodeB.weight){return 1}if(nodeA.weight>nodeB.weight){return-1}return 0})};var setWeight=function(endNode,neighbor){return utils.distance(endNode.x,endNode.y,neighbor.x,neighbor.y)};var buildPath=function(node){var path=[];while(node.parent){path.push([node.x,node.y]);node=node.parent}return path};var forNeighbors=function(grid,node,endNode,opened){var neighbors=mapMod.getNeighbors(grid,node);var ni=0,nl=neighbors.length;while(ni<nl){var neighbor=neighbors[ni];if(neighbor.closed){ni+=1;continue}neighbor.weight=setWeight(endNode,neighbor);if(!neighbor.opened){neighbor.parent=node;opened.push(neighbor);neighbor.opened=true}ni+=1}};api.getPath=function(grid,sx,sy,ex,ey){var grid=utils.deepCloneJSON(grid),nodes=api.chunk(grid),path=[],opened=[],node;var startNode=nodes[sy][sx];endNode=nodes[ey][ex];opened.push(startNode);startNode.opened=true;startNode.weight=0;while(opened.length>0){node=opened.pop();node.closed=true;if(node===endNode){return buildPath(node)}forNeighbors(grid,node,endNode,opened);sortOpen(opened)}return[]};api.chunk=function(grid){var arr=[],row,i=0;while(i<grid.cells.length){row=grid.cells.slice(i,i+grid.w);arr.push(row);i+=grid.w}return arr};api.isInBounds=function(grid,x,y){return x>=0&&x<grid.w&&(y>=0&&y<grid.h)};api.isWalkable=function(grid,x,y){if(api.isInBounds(grid,x,y)){return api.get(grid,x,y).walkable}return false};api.getNeighbors=function(grid,node){var x=node.x,y=node.y,neighbors=[];if(api.isWalkable(grid,x,y-1)){neighbors.push(mapMod.get(grid,x,y-1))}if(api.isWalkable(grid,x,y+1)){neighbors.push(mapMod.get(grid,x,y+1))}if(api.isWalkable(grid,x-1,y)){neighbors.push(mapMod.get(grid,x-1,y))}if(api.isWalkable(grid,x+1,y)){neighbors.push(mapMod.get(grid,x+1,y))}return neighbors};return api}();var gameMod=function(){var getToIndex=function(game){var toIndex=null,p=game.player,map=game.maps[game.mapIndex],pCell=api.getPlayerCell(game),mwx=game.mapIndex%game.mapWorldWidth,mwy=Math.floor(game.mapIndex/game.mapWorldWidth);if(pCell.x===0){var x=mwx-1;x=x<0?game.mapWorldWidth-1:x;toIndex=mwy*game.mapWorldWidth+x}if(pCell.x===map.w-1){var x=mwx+1;x=x>=game.mapWorldWidth?0:x;toIndex=mwy*game.mapWorldWidth+x}if(pCell.y===0){var y=mwy-1;y=y<0?game.maps.length/game.mapWorldWidth-1:y;toIndex=y*game.mapWorldWidth+mwx}if(pCell.y===map.h-1){var y=mwy+1;y=y>=game.maps.length/game.mapWorldWidth?0:y;toIndex=y*game.mapWorldWidth+mwx}return toIndex};var isAtCorner=function(game,cell){var map=game.maps[game.mapIndex],w=map.w-1,h=map.h-1;return cell.x===0&&cell.y===0||cell.x===w&&cell.y===h||cell.x===0&&cell.y===h||cell.x===w&&cell.y===0};var getToMap=function(game){var toMap={};var map=game.maps[game.mapIndex];var pCell=api.getPlayerCell(game);var mi=toMap.index=getToIndex(game);if(isAtCorner(game,pCell)){if(pCell.y===map.h-1){toMap.x=pCell.x;toMap.y=0}else{toMap.x=pCell.x;toMap.y=map.h-1}}else{toMap.x=pCell.x===0?map.w-1:pCell.x;toMap.y=pCell.y===0?map.h-1:pCell.y;toMap.x=pCell.x===map.w-1?0:toMap.x;toMap.y=pCell.y===map.h-1?0:toMap.y}return toMap};var getMovePath=function(game,startCell,targetCell){var map=game.maps[game.mapIndex],unit=startCell.unit||null;var path=mapMod.getPath(map,startCell.x,startCell.y,targetCell.x,targetCell.y);if(unit){path=path.reverse().slice(0,unit.maxCellsPerTurn)}return path};var getMoveCells=function(game,startCell,targetCell){var map=game.maps[game.mapIndex];return getMovePath(game,startCell,targetCell).map(function(pos){var cell=mapMod.get(map,pos[0],pos[1]);return cell.i})};var getEnemeyMoveCells=function(game,eCell){var pCell=api.getPlayerCell(game),map=game.maps[game.mapIndex];var pCellNeighbors=mapMod.getNeighbors(map,pCell).filter(function(cell){return cell.walkable});var mtcOptions=pCellNeighbors.map(function(cell){return getMoveCells(game,eCell,cell)}).filter(function(mtcOptions){return mtcOptions.length>0});return mtcOptions[0]||[]};var createBaseUnit=function(){return{maxHP:1,maxCellsPerTurn:0,HP:1,weaponIndex:0,sheetIndex:0,type:null,meleeTarget:null,moveCells:[],currentCellIndex:null,active:false}};var createPlayerUnit=function(){var player=createBaseUnit();player.type="player";player.active=true;player.maxCellsPerTurn=3;player.sheetIndex=2;player.maxHP=30;return player};var createEnemyUnit=function(){var enemy=createBaseUnit();enemy.type="enemy";enemy.active=true;enemy.maxCellsPerTurn=2;enemy.sheetIndex=3;enemy.maxHP=5;return enemy};var createWallUnit=function(){var wall=createBaseUnit();wall.type="wall";wall.active=true;wall.sheetIndex=1;return wall};var placeUnit=function(game,unit,x,y){var map=game.maps[game.mapIndex];var newCell=mapMod.get(map,x,y);if(newCell){if(unit.currentCellIndex!=null){var oldCell=map.cells[unit.currentCellIndex];oldCell.walkable=true;map.cells[unit.currentCellIndex].unit=null}newCell.walkable=false;unit.currentCellIndex=newCell.i;map.cells[unit.currentCellIndex].unit=unit}};var placePlayer=function(game){var map=game.maps[game.mapIndex],toMap=game.toMap,toCell=null,i=map.cells.length;if(toMap.x!=null&&toMap.y!=null){toCell=mapMod.get(map,toMap.x,toMap.y)}if(toCell){if(!toCell.unit){placeUnit(game,game.player,toCell.x,toCell.y);game.toMap=getToMap(game);return}}while(i--){var cell=map.cells[i];if(cell.unit===null){placeUnit(game,game.player,cell.x,cell.y);game.toMap=getToMap(game);return}}};var moveUnit=function(game,unit){if(unit.moveCells.length>0){var ci=unit.moveCells.shift();var moveToCell=mapMod.get(game.maps[game.mapIndex],ci);if(!moveToCell.unit){placeUnit(game,unit,moveToCell.x,moveToCell.y)}if(unit.type==="player"){game.toMap=getToMap(game)}}};var getCellsByUnitType=function(map,type){return map.cells.reduce(function(acc,cell){if(cell.unit){if(cell.unit.type===type){acc.push(cell)}}return acc},[])};var setupGame=function(game,newGame){newGame=newGame===undefined?true:newGame;var playerPlaced=false,startMapIndex=0;game.mapIndex=0;game.player.HP=game.player.maxHP;if(newGame){game.remainingEnemies=0}game.maps=game.maps.map(function(map,mi){var mapStr=game.mapStrings[mi]||"";game.mapIndex=mi;map.cells=map.cells.map(function(cell,ci){var cellIndex=parseInt(mapStr[ci]||"0"),x=ci%map.w,y=Math.floor(ci/map.w);if(cellIndex===0&&newGame){var cell=mapMod.get(map,ci);cell.unit=null;cell.walkable=true}if(cellIndex===1){var wall=createWallUnit();placeUnit(game,wall,x,y)}if(cellIndex===2){playerPlaced=true;startMapIndex=mi;placeUnit(game,game.player,x,y)}if(cellIndex===3&&newGame){game.remainingEnemies+=1;var enemy=createEnemyUnit();enemy.HP=enemy.maxHP;placeUnit(game,enemy,x,y)}return cell});return map});if(!playerPlaced){placePlayer(game)}game.mapIndex=startMapIndex;game.toMap=getToMap(game)};var api={};api.create=function(opt){opt=opt||{};var game={turn:0,turnState:"wait",maps:[],mapIndex:0,mapWorldWidth:3,toMap:{index:null,x:null,y:null},mapStrings:opt.maps||["2"],player:createPlayerUnit(),remainingEnemies:0};game.mapStrings.forEach(function(){game.maps.push(mapMod.create({marginX:opt.marginX===undefined?32:opt.marginX,marginY:opt.marginY===undefined?32:opt.marginY,w:opt.w===undefined?4:opt.w,h:opt.h===undefined?4:opt.h}))});setupGame(game,true);return game};var processMeele=function(game,unit){var targetCellIndex=unit.meleeTarget,map=game.maps[game.mapIndex];if(targetCellIndex!=null){var targetCell=mapMod.get(map,targetCellIndex),tUnit=targetCell.unit;if(tUnit){tUnit.HP-=1;tUnit.HP=tUnit.HP<0?0:tUnit.HP;if(tUnit.HP<=0&&tUnit.type==="enemy"){targetCell.walkable=true;targetCell.unit=null}}unit.meleeTarget=null}};var getRemainingEnemies=function(game){return game.maps.reduce(function(acc,map){var eCells=getCellsByUnitType(map,"enemy");return acc+eCells.length},0)};var processTurn=function(game,secs){var map=game.maps[game.mapIndex],pCell=api.getPlayerCell(game),eCells=getCellsByUnitType(map,"enemy");if(game.turnState==="wait"){return}if(game.turnState==="start"){eCells.forEach(function(eCell){var d=utils.distance(eCell.x+16,eCell.y+16,pCell.x+16,pCell.y+16);if(d<=1.5){eCell.unit.meleeTarget=pCell.i}else{eCell.unit.moveCells=getEnemeyMoveCells(game,eCell)}});game.turnState="move"}if(game.turnState==="move"){moveUnit(game,game.player);eCells.forEach(function(eCell){moveUnit(game,eCell.unit)});var eCells=getCellsByUnitType(map,"enemy");if(game.player.moveCells.length===0&&eCells.every(function(eCell){return eCell.unit.moveCells.length===0})){game.turnState="melee"}}if(game.turnState==="melee"){processMeele(game,game.player);var eCells=getCellsByUnitType(map,"enemy");eCells.forEach(function(eCell){processMeele(game,eCell.unit)});game.turnState="end"}if(game.turnState==="end"){game.turn+=1;game.turnState="wait";if(game.player.HP<=0){pCell.unit=null;pCell.walkable=true;setupGame(game,false)}game.remainingEnemies=getRemainingEnemies(game);if(game.remainingEnemies===0){setupGame(game,true)}}};api.update=function(game,secs){processTurn(game,secs)};api.getPlayerCell=function(game){var p=game.player,map=game.maps[game.mapIndex];return map.cells[p.currentCellIndex]};api.playerPointer=function(game,x,y){var clickedCell=mapMod.getCellByPointer(game.maps[game.mapIndex],x,y),map=game.maps[game.mapIndex],pCell=api.getPlayerCell(game);if(clickedCell){if(clickedCell===pCell&&game.toMap.index!=null){game.mapIndex=game.toMap.index;game.toMap=getToMap(game);pCell.unit=null;pCell.walkable=true;game.player.currentCellIndex=null;placePlayer(game);return}if(clickedCell.unit){var unit=clickedCell.unit;if(unit.type==="enemy"){game.player.meleeTarget=clickedCell.i;game.turnState="start";return}}game.player.moveCells=getMoveCells(game,pCell,clickedCell);game.turnState="start"}};return api}();var draw=function(){var api={};var unitColors=["green","gray","blue","red"];var drawHPBar=function(sm,cell){var unit=cell.unit;var ctx=sm.ctx;var map=sm.game.maps[sm.game.mapIndex];var cs=map.cellSize;var x=map.margin.x+cell.x*cs;var y=map.margin.y+cell.y*cs;if(unit){if(unit.type=="player"||unit.type==="enemy"){ctx.fillStyle="gray";ctx.beginPath();ctx.rect(x,y,cs,5);ctx.fill();ctx.stroke();var per=unit.HP/unit.maxHP;ctx.fillStyle="lime";ctx.beginPath();ctx.rect(x,y,cs*per,5);ctx.fill();ctx.stroke()}}};var drawCell=function(sm,cell){var map=sm.game.maps[sm.game.mapIndex];var ctx=sm.ctx;var cs=map.cellSize;var x=map.margin.x+cell.x*cs;var y=map.margin.y+cell.y*cs;ctx.fillStyle=unitColors[0];if(cell.unit){ctx.fillStyle=unitColors[cell.unit.sheetIndex]}ctx.beginPath();ctx.rect(x,y,cs,cs);ctx.fill();ctx.stroke();drawHPBar(sm,cell)};api.back=function(sm){var canvas=sm.canvas,ctx=sm.ctx;ctx.fillStyle="black";ctx.fillRect(0,0,canvas.width,canvas.height)};api.map=function(sm){var map=sm.game.maps[sm.game.mapIndex],i=0,len=map.cells.length;while(i<len){drawCell(sm,map.cells[i]);i+=1}};api.info=function(sm){var ctx=sm.ctx,pos=sm.input.pos,pCell=gameMod.getPlayerCell(sm.game),canvas=sm.canvas,dy=14;ctx.fillStyle="yellow";ctx.font="12px courier";ctx.textBaseline="top";ctx.fillText("pos: "+pos.x+","+pos.y,5,5+dy*0);ctx.fillText("player pos: "+pCell.x+","+pCell.y,5,5+dy*1);var tm=sm.game.toMap;ctx.fillText("toMap: mi:"+tm.index+", x: "+tm.x+", y: "+tm.y,5,5+dy*2);ctx.fillText("turn:"+sm.game.turn+", turnState: "+sm.game.turnState,5,5+dy*3);ctx.fillText("enemies:"+sm.game.remainingEnemies,5,5+dy*4);ctx.fillText("v"+sm.ver,1,canvas.height-11)};return api}();(function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),container=document.getElementById("canvas-app")||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(.5,.5);canvas.onselectstart=function(){return false};var sm={ver:"0.7.0",fps:12,lt:new Date,game:gameMod.create({marginX:14,marginY:7,w:9,h:7,maps:["111111111"+"100000000"+"103030000"+"100000000"+"100000000"+"100000000"+"100000001","111111111"+"000000000"+"000000300"+"000000000"+"000000000"+"000000000"+"100100000","111111111"+"000000001"+"000000301"+"000000001"+"000000301"+"000000001"+"000000301","100000001"+"103000001"+"100000000"+"100000001"+"100000001"+"103000001"+"100000001","100100000"+"100111010"+"020001010"+"100101030"+"100100111"+"100100000"+"100100000","000000001"+"000000001"+"000000031"+"000111111"+"111100031"+"000000001"+"000000001","100000001"+"100000001"+"100000001"+"103000000"+"100000000"+"103030000"+"111111111","100100000"+"100000000"+"100000000"+"000000000"+"000000000"+"000000300"+"111111111","000000001"+"000000001"+"000000001"+"000000301"+"000000001"+"000000301"+"111111111"]}),canvas:canvas,ctx:ctx,input:{pointerDown:false,pos:{x:0,y:0}}};var pointerHanders={start:function(sm,e){var pos=sm.input.pos=utils.getCanvasRelative(e);if(e.type==="touchstart"){e.preventDefault()}sm.input.pointerDown=true;gameMod.playerPointer(sm.game,pos.x,pos.y)},move:function(sm,e){sm.input.pos=utils.getCanvasRelative(e)},end:function(sm,e){sm.input.pointerDown=false}};var createPointerHandler=function(sm,type){return function(e){pointerHanders[type](sm,e)}};canvas.addEventListener("touchstart",createPointerHandler(sm,"start"));canvas.addEventListener("touchmove",createPointerHandler(sm,"move"));canvas.addEventListener("touchend",createPointerHandler(sm,"end"));canvas.addEventListener("mousedown",createPointerHandler(sm,"start"));canvas.addEventListener("mousemove",createPointerHandler(sm,"move"));canvas.addEventListener("mouseup",createPointerHandler(sm,"end"));var loop=function(){var now=new Date,secs=(now-sm.lt)/1e3;requestAnimationFrame(loop);if(secs>=1/sm.fps){gameMod.update(sm.game);draw.back(sm);draw.map(sm);draw.info(sm);sm.lt=now}};loop()})();
</script>

<h2 id="1-Getting-started-and-the-utility-module-of-this-grid-unti-movement-javaScript-example"><a href="#1-Getting-started-and-the-utility-module-of-this-grid-unti-movement-javaScript-example" class="headerlink" title="1 - Getting started and the utility module of this grid unti movement javaScript example"></a>1 - Getting started and the utility module of this grid unti movement javaScript example</h2><p>This is a post on a simple client side javaScript example, so then it should go without saying that this is not a <a href="/2018/11/27/js-getting-started/">getting started with javaScript</a> type post. I assume that you have at least some background with the basics of javaScript as well as other client side web development languages which include HTML and CSS. With that out of the way in this section I will be going over just the utilities module of the example leaving the other various files for later sections of this post.</p>
<h3 id="Full-source-code-is-also-on-Github"><a href="#Full-source-code-is-also-on-Github" class="headerlink" title="Full source code is also on Github"></a>Full source code is also on Github</h3><p>If you are on Github and wondering if there is a location on Github where I am parking the source code that I am write about in this post there such a place will be found <a href="https://github.com/dustinpfister/test_vjs/tree/master/for_post/js-javascript-example-grid-game-unit-movement" target="_blank" rel="external">here in my test vjs repository</a>. This is also where I pack the source code examples for my <a href="/categories/js/">many other posts on native javaScript</a> features and examples.</p>
<h3 id="1-1-The-utility-module"><a href="#1-1-The-utility-module" class="headerlink" title="1.1 - The utility module"></a>1.1 - The utility module</h3><p>So first off here is a utility module that has some stand alone static methods that I am going to be using in one or more additional modules moving forward with the rest of the code. This is just a standard practice of sorts when it comes to making any kind of <a href="/2020/03/23/canvas-example/">canvas example</a>, or complex javaScript project. A popular javaScript library that can be described as a general unity library would of course be <a href="/2019/02/15/lodash/">lodash</a>, however with these javaScript example posts I like to do everything from the ground up, making my own custom cut libraries. I have another <a href="/2021/08/06/js-javascript-example-utils/">utilities library javaScript</a> example post in which it get into detail about making this kind of module that is packed with all kinds of usual suspect type methods that I will often park in a file such as this. However I often do make custom versions of this kind of library on a project by project, and example by example type basis.</p>
<p>One method that I have at the ready is a typical distance formula function. Thus far I am using this function in my map module now when it comes to figuring what the weight should be when preforming path detection. Moe on that later on in the post when it comes to the section on the map module.</p>
<p>In this javaScript example I have a simple gird where when a cell location is clicked a player object will move in the direction of that location by one cell at a time. So I have a angle to point method that can be used to get a direction from one position to another that will be used in my main game module. This method makes use of the <a href="/2019/03/19/js-math-atan2">Math.atan2</a> method which is useful for these kinds of situations that have to do with angles. I have also made yet another <a href="/2021/04/16/js-javascript-example-angles-module/">javaScript example where I am making an angles module</a> that is based of a library on angles that I like called just <a href="https://www.npmjs.com/package/angles" target="_blank" rel="external">simply angles.js</a>. </p>
<p>Another method that I have here is useful for getting a canvas relative rather than window relative location when it comes to pointer events. I will not be getting into this subject in detail as I have <a href="/2020/03/04/canvas-get-point-relative-to-canvas/">wrote a post on this topic before hand</a>, so if you want to learn more about this you can check that out if interested. In this javaScript example I will be using this method when it comes to my crude yet functional state machine in my main.js file that ties everything together. I will be getting into that module more so later in this post when it comes to the section on the main javaScript file of the example where I am using the method when working with event handlers.</p>
<p>I then also have a crude yet effecting deep clone method that makes use of JSON to quickly deep clone objects. Thus far I am just using this in my map module as a way to quickly create a copy of a grid, and then use this copy of a grid to preform path detection. I can not recommend that this is a good solution for all situations in which one will need to deep clone objects though. For more on this topic you might want to check out my post on the <a href="/2017/11/13/lodash_clonedeep">lodash clone deep method</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UTILS</span></div><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"><span class="comment">// distance</span></div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// angle from one point to another</span></div><div class="line">utils.angleToPoint = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2, scale</span>) </span>&#123;</div><div class="line">    scale = scale === <span class="literal">undefined</span> ? <span class="built_in">Math</span>.PI * <span class="number">2</span> : scale;</div><div class="line">    <span class="keyword">var</span> aTan = <span class="built_in">Math</span>.atan2(y1 - y2, x1 - x2);</div><div class="line">    <span class="keyword">return</span> (aTan + <span class="built_in">Math</span>.PI) / (<span class="built_in">Math</span>.PI * <span class="number">2</span>) * scale;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get a point relative to a canvas element rather than window</span></div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect();</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">x</span>: <span class="built_in">Math</span>.floor((e.touches ? e.touches[<span class="number">0</span>].clientX : e.clientX) - bx.left),</div><div class="line">        <span class="attr">y</span>: <span class="built_in">Math</span>.floor((e.touches ? e.touches[<span class="number">0</span>].clientY : e.clientY) - bx.top),</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// deep clone using JSON</span></div><div class="line">utils.deepCloneJSON = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</div><div class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">        <span class="built_in">console</span>.log(e.message);</div><div class="line">        <span class="built_in">console</span>.log(obj);</div><div class="line">        <span class="keyword">return</span> &#123;&#125;;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="2-The-map-module-that-will-be-used-to-create-the-grid"><a href="#2-The-map-module-that-will-be-used-to-create-the-grid" class="headerlink" title="2 - The map module that will be used to create the grid."></a>2 - The map module that will be used to create the grid.</h2><p>In order to get this example working I will need a grid in which to place the player object that will move on each grid location click. I could just have everything together in one module when it comes to a game project like this, but I am thinking ahead with this one and have decided to pull this part of the example into its own map module. For now I am going to be trying my best to keep this map module as simple as I can, however I am still going to want to add things like path detection so it is not going to be all that simple. With that said it has a few public methods that I may or may not expand on event more is I keep working on this project, but I am not sure there is much more I would want to add with this module at least. </p>
<p>There is of course a create method that I will be calling in my game module that I will be getting to in a later section in this post. When it comes to creating even a simple grid module there are all kinds of formats for the grid object that come to mind. Some developers might prefer some kind of format that involves an array of arrays, but as of late I prefer a solution that involves a single array and then using a formula to get or set the proper cell location.</p>
<p>After the create public method I have two methods that can be used to get a cell location in the map. One is just the basic get method that can get a cell by an index value, or an x and y cell location. The other method is what I will be using to get a cell location by way of a canvas relative pixel location.</p>
<p>In addition with a basic core set of methods to create and work with a map object, I have also added a number of methods that have to do with match detection. This code that I have for this is based off of what it is that I have worked out for my <a href="/2019/08/27/js-path-find/">post on path detection</a>. So now not only can I create a map, and get references to cells by a index or pixel location, but I can also get paths from one cell position to another. With that said by default all cells have a walkable property that by default is set to true. When it comes to my game module that will make use of this map module that is where I will want to set the walkable value of cells true and false as needed.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mapMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// create Cells helper</span></div><div class="line">    <span class="keyword">var</span> createCells = <span class="function"><span class="keyword">function</span> (<span class="params">map</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cells = [];</div><div class="line">        <span class="keyword">var</span> len = map.w * map.h,</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">            cells.push(&#123;</div><div class="line">                <span class="attr">i</span>: i,</div><div class="line">                <span class="attr">x</span>: i % map.w,</div><div class="line">                <span class="attr">y</span>: <span class="built_in">Math</span>.floor(i / map.w),</div><div class="line">                <span class="attr">walkable</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">closed</span>: <span class="literal">false</span>,</div><div class="line">                <span class="attr">data</span>: &#123;&#125;,</div><div class="line">                <span class="attr">unit</span>: <span class="literal">null</span> <span class="comment">// reference to current unit here or null if empty</span></div><div class="line">            &#125;);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> cells;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// PUBLIC API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// create a new map object</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> map = &#123;</div><div class="line">            <span class="attr">w</span>: opt.w || <span class="number">9</span>,</div><div class="line">            <span class="attr">h</span>: opt.h || <span class="number">7</span>,</div><div class="line">            <span class="attr">cellSize</span>: <span class="number">32</span>,</div><div class="line">            <span class="attr">margin</span>: &#123;</div><div class="line">                <span class="attr">x</span>: opt.marginX == <span class="literal">undefined</span> ? <span class="number">5</span> : opt.marginX,</div><div class="line">                <span class="attr">y</span>: opt.marginY == <span class="literal">undefined</span> ? <span class="number">5</span> : opt.marginY</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">cells</span>: []</div><div class="line">        &#125;;</div><div class="line">        map.cells = opt.cells || createCells(map);</div><div class="line">        <span class="keyword">return</span> map;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return a cell at the given position, or false for out of bounds values</span></div><div class="line">    api.get = <span class="function"><span class="keyword">function</span> (<span class="params">map, xi, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">arguments</span>.length === <span class="number">2</span>)&#123;</div><div class="line">            <span class="keyword">return</span> map.cells[xi];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (xi &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || xi &gt;= map.w || y &gt;= map.h) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> map.cells[y * map.w + xi];</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a cell in the current map by way of</span></div><div class="line">    <span class="comment">// a canvas relative x and y pixel pos</span></div><div class="line">    api.getCellByPointer = <span class="function"><span class="keyword">function</span> (<span class="params">map, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cx = <span class="built_in">Math</span>.floor((x - map.margin.x) / map.cellSize),</div><div class="line">        cy = <span class="built_in">Math</span>.floor((y - map.margin.y) / map.cellSize);</div><div class="line">        <span class="keyword">return</span> api.get(map, cx, cy)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">/***</span></div><div class="line">PATHS</div><div class="line">***/</div><div class="line"> </div><div class="line">    <span class="comment">// sort a list of open nodes</span></div><div class="line">    <span class="keyword">var</span> sortOpen = <span class="function"><span class="keyword">function</span> (<span class="params">opened</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> opened.sort(<span class="function"><span class="keyword">function</span> (<span class="params">nodeA, nodeB</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (nodeA.weight &lt; nodeB.weight) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (nodeA.weight &gt; nodeB.weight) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// set weight for a node</span></div><div class="line">    <span class="keyword">var</span> setWeight = <span class="function"><span class="keyword">function</span> (<span class="params">endNode, neighbor</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> utils.distance(endNode.x, endNode.y, neighbor.x, neighbor.y);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// build a path based an parent property</span></div><div class="line">    <span class="keyword">var</span> buildPath = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> path = [];</div><div class="line">        <span class="keyword">while</span> (node.parent) &#123;</div><div class="line">            path.push([node.x, node.y]);</div><div class="line">            node = node.parent;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//path.push([node.x, node.y]);</span></div><div class="line">        <span class="keyword">return</span> path;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// for Each Neighbor for the given grid, node, and open list</span></div><div class="line">    <span class="keyword">var</span> forNeighbors = <span class="function"><span class="keyword">function</span> (<span class="params">grid, node, endNode, opened</span>) </span>&#123;</div><div class="line">        <span class="comment">//var neighbors = grid.getNeighbors(node);</span></div><div class="line">        <span class="keyword">var</span> neighbors = mapMod.getNeighbors(grid, node);</div><div class="line">        <span class="keyword">var</span> ni = <span class="number">0</span>,</div><div class="line">        nl = neighbors.length;</div><div class="line">        <span class="keyword">while</span> (ni &lt; nl) &#123;</div><div class="line">            <span class="keyword">var</span> neighbor = neighbors[ni];</div><div class="line">            <span class="comment">// if the neighbor is closed continue looping</span></div><div class="line">            <span class="keyword">if</span> (neighbor.closed) &#123;</div><div class="line">                ni += <span class="number">1</span>;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// set weight for the neighbor</span></div><div class="line">            neighbor.weight = setWeight(endNode, neighbor);</div><div class="line">            <span class="comment">// if the node is not opened</span></div><div class="line">            <span class="keyword">if</span> (!neighbor.opened) &#123;</div><div class="line">                neighbor.parent = node;</div><div class="line">                opened.push(neighbor);</div><div class="line">                neighbor.opened = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            ni += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    api.getPath = <span class="function"><span class="keyword">function</span> (<span class="params">grid, sx, sy, ex, ey</span>) </span>&#123;</div><div class="line">        <span class="comment">// copy the given grid</span></div><div class="line">        <span class="comment">//var grid = Grid.fromMatrix(givenGrid.nodes),</span></div><div class="line"> </div><div class="line">        <span class="keyword">var</span> grid = utils.deepCloneJSON(grid),</div><div class="line">        <span class="comment">//var grid = utils.deepClone(grid, &#123;</span></div><div class="line">        <span class="comment">//    forRecursive: function()&#123; return &#123;&#125; &#125;</span></div><div class="line">        <span class="comment">//&#125;),</span></div><div class="line">        nodes = api.chunk(grid),</div><div class="line">        path = [],</div><div class="line">        opened = [],</div><div class="line">        node;</div><div class="line">        <span class="comment">// set startNode and End Node to copy of grid</span></div><div class="line">        <span class="keyword">var</span> startNode = nodes[sy][sx];</div><div class="line">        endNode = nodes[ey][ex];</div><div class="line">        <span class="comment">// push start Node to open list</span></div><div class="line">        opened.push(startNode);</div><div class="line">        startNode.opened = <span class="literal">true</span>;</div><div class="line">        startNode.weight = <span class="number">0</span>;</div><div class="line">        <span class="comment">// start walking</span></div><div class="line">        <span class="keyword">while</span> (opened.length &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// pop out next Node from open list</span></div><div class="line">            node = opened.pop();</div><div class="line">            node.closed = <span class="literal">true</span>;</div><div class="line">            <span class="comment">// if the node is the end node</span></div><div class="line">            <span class="keyword">if</span> (node === endNode) &#123;</div><div class="line">                <span class="keyword">return</span> buildPath(node);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// loop current neighbors</span></div><div class="line">            forNeighbors(grid, node, endNode, opened);</div><div class="line">            <span class="comment">// sort the list of nodes be weight value to end node</span></div><div class="line">            sortOpen(opened);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return an empty array if we get here (can not get to end node)</span></div><div class="line">        <span class="keyword">return</span> [];</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get a chunk form of a grid</span></div><div class="line">    api.chunk = <span class="function"><span class="keyword">function</span> (<span class="params">grid</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> arr = [],</div><div class="line">        row,</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i &lt; grid.cells.length) &#123;</div><div class="line">            row = grid.cells.slice(i, i + grid.w);</div><div class="line">            arr.push(row);</div><div class="line">            i += grid.w;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> arr;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return true if the given x and y position is in bounds</span></div><div class="line">    api.isInBounds = <span class="function"><span class="keyword">function</span> (<span class="params">grid, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> (x &gt;= <span class="number">0</span> &amp;&amp; x &lt; grid.w) &amp;&amp; (y &gt;= <span class="number">0</span> &amp;&amp; y &lt; grid.h);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// is the given cell location walkable?</span></div><div class="line">    api.isWalkable = <span class="function"><span class="keyword">function</span> (<span class="params">grid, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (api.isInBounds(grid, x, y)) &#123;</div><div class="line">            <span class="keyword">return</span> api.get(grid, x, y).walkable; <span class="comment">//grid.nodes[y][x].walkable;</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get the four Neighbors of a node</span></div><div class="line">    api.getNeighbors = <span class="function"><span class="keyword">function</span> (<span class="params">grid, node</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> x = node.x,</div><div class="line">        y = node.y,</div><div class="line">        neighbors = [];</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x, y - <span class="number">1</span>)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y - 1][x]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x, y - <span class="number">1</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x, y + <span class="number">1</span>)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y + 1][x]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x, y + <span class="number">1</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x - <span class="number">1</span>, y)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y][x - 1]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x - <span class="number">1</span>, y));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x + <span class="number">1</span>, y)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y][x + 1]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x + <span class="number">1</span>, y));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> neighbors;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="3-The-game-module"><a href="#3-The-game-module" class="headerlink" title="3 - The game module"></a>3 - The game module</h2><p>In this javaScript example the main module will be the state machine object that I will be getting to later in this post. However the game module is still a major component that will contain everything that has to do with the state of the game, rather than the application as a whole. This means the state of the map as well as the units that will be located in the map as well.</p>
<p>Here in the game module I have a create method that will be used to create a new game state that will contain at least one instance of a map object for starters, and helper methods that can be used to create the player object. So the game module is the main state object for the state of the actual game in terms of the state of the map, and any display objects that might be in the map, or out of it actually. For now it is just the player object, as well as just simple wall units that I am concern with, and in time as I develop this project much of the code here will be pulled into another module that has to do with object pools, and units in general when and if I get to it.</p>
<p>So for now I have all of my unit methods and various related helper functions at the top of this game module helper. I then have a create base unit helper that is used to create a unit object with all properties that the unit of any kind should have. As of revision 3 the only real properties of interest with a unit would be the sheetIndex, and currentCellIndex properties.</p>
<p>With path detection now added to the map module as revision 3 of the example the place unit method will not set the walkable property of a cell to true when a unit is located in the cell, as well as set the value back to false when moving the unit to a new cell location. Because of this and any additional factors of concern moving forward the place unit method should always be used when moving any unit from one location to another or placing a new unit into a map.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     TO MAP OBJECT</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// get to index helper use to get the map index to go to for the game.toMap object</span></div><div class="line">    <span class="keyword">var</span> getToIndex = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> toIndex = <span class="literal">null</span>,</div><div class="line">        p = game.player,</div><div class="line">        map = game.maps[game.mapIndex],</div><div class="line">        pCell = api.getPlayerCell(game),</div><div class="line">        mwx = game.mapIndex % game.mapWorldWidth,                 <span class="comment">// map world x and y</span></div><div class="line">        mwy = <span class="built_in">Math</span>.floor(game.mapIndex / game.mapWorldWidth );   </div><div class="line">        <span class="comment">// if player cell x equals 0 ( left side )</span></div><div class="line">        <span class="keyword">if</span>(pCell.x === <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> x = mwx - <span class="number">1</span>;</div><div class="line">            x = x &lt; <span class="number">0</span> ? game.mapWorldWidth - <span class="number">1</span> : x;</div><div class="line">            toIndex = mwy * game.mapWorldWidth + x;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if player cell x equals map.w - 1 ( right side )</span></div><div class="line">        <span class="keyword">if</span>(pCell.x === map.w - <span class="number">1</span>)&#123;</div><div class="line">            <span class="keyword">var</span> x = mwx + <span class="number">1</span>;</div><div class="line">            x = x &gt;= game.mapWorldWidth ? <span class="number">0</span> : x;</div><div class="line">            toIndex = mwy * game.mapWorldWidth + x;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if player cell y equals 0 ( top side )</span></div><div class="line">        <span class="keyword">if</span>(pCell.y === <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> y = mwy - <span class="number">1</span>;</div><div class="line">            y = y &lt; <span class="number">0</span> ? game.maps.length / game.mapWorldWidth - <span class="number">1</span> : y;</div><div class="line">            toIndex = y * game.mapWorldWidth + mwx;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if player cell y map.h - 1 ( bottom side )</span></div><div class="line">        <span class="keyword">if</span>(pCell.y === map.h - <span class="number">1</span>)&#123;</div><div class="line">            <span class="keyword">var</span> y = mwy + <span class="number">1</span>;</div><div class="line">            y = y &gt;= game.maps.length / game.mapWorldWidth ? <span class="number">0</span> : y;</div><div class="line">            toIndex = y * game.mapWorldWidth + mwx;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> toIndex;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// Is a given cell at a corner? Used to get adjust goto point for game.toMap object</span></div><div class="line">    <span class="keyword">var</span> isAtCorner = <span class="function"><span class="keyword">function</span>(<span class="params">game, cell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        w = map.w - <span class="number">1</span>,</div><div class="line">        h = map.h - <span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> (cell.x === <span class="number">0</span> &amp;&amp; cell.y === <span class="number">0</span>) || </div><div class="line">            (cell.x === w &amp;&amp; cell.y === h) || </div><div class="line">            (cell.x === <span class="number">0</span> &amp;&amp; cell.y === h) || </div><div class="line">            (cell.x === w &amp;&amp; cell.y === <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a toMap object that can be set to the game.toMap propery</span></div><div class="line">    <span class="keyword">var</span> getToMap = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> toMap = &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">var</span> pCell = api.getPlayerCell(game);</div><div class="line">        <span class="keyword">var</span> mi = toMap.index = getToIndex(game);</div><div class="line">        <span class="comment">// at corner?</span></div><div class="line">        <span class="keyword">if</span>(isAtCorner(game, pCell))&#123;</div><div class="line">           <span class="keyword">if</span>(pCell.y === map.h - <span class="number">1</span>)&#123;</div><div class="line">               toMap.x = pCell.x;</div><div class="line">               toMap.y = <span class="number">0</span>;</div><div class="line">           &#125;<span class="keyword">else</span>&#123;</div><div class="line">               toMap.x = pCell.x;</div><div class="line">               toMap.y = map.h - <span class="number">1</span>;</div><div class="line">           &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">// not at corner</span></div><div class="line">            toMap.x = pCell.x === <span class="number">0</span> ? map.w - <span class="number">1</span> : pCell.x;</div><div class="line">            toMap.y = pCell.y === <span class="number">0</span> ? map.h - <span class="number">1</span> : pCell.y;</div><div class="line">            toMap.x = pCell.x === map.w - <span class="number">1</span> ? <span class="number">0</span> : toMap.x;</div><div class="line">            toMap.y = pCell.y === map.h - <span class="number">1</span> ? <span class="number">0</span> : toMap.y;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> toMap;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MOVEMENT PATHS</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// get a move path in the from of a path created using mapMod.getPath that is cut</span></div><div class="line">    <span class="comment">// based on the maxCellsPerTurn value of the unit in the given start cell if any</span></div><div class="line">    <span class="keyword">var</span> getMovePath = <span class="function"><span class="keyword">function</span>(<span class="params">game, startCell, targetCell</span>)</span>&#123;</div><div class="line">        <span class="comment">// get current map</span></div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        unit = startCell.unit || <span class="literal">null</span>;</div><div class="line">        <span class="comment">// get the raw path to that target cell</span></div><div class="line">        <span class="keyword">var</span> path = mapMod.getPath(map, startCell.x, startCell.y, targetCell.x, targetCell.y);</div><div class="line">        <span class="comment">// get a slice of the raw path up to unit.maxCellsPerTurn</span></div><div class="line">        <span class="keyword">if</span>(unit)&#123;</div><div class="line">            path = path.reverse().slice(<span class="number">0</span>, unit.maxCellsPerTurn);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return the path</span></div><div class="line">        <span class="keyword">return</span> path;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get an arary of cell index values</span></div><div class="line">    <span class="keyword">var</span> getMoveCells = <span class="function"><span class="keyword">function</span>(<span class="params">game, startCell, targetCell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">return</span> getMovePath(game, startCell, targetCell).map(<span class="function"><span class="keyword">function</span>(<span class="params">pos</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> cell = mapMod.get(map, pos[<span class="number">0</span>], pos[<span class="number">1</span>]);</div><div class="line">            <span class="keyword">return</span> cell.i;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get enemy move cells options</span></div><div class="line">    <span class="keyword">var</span> getEnemeyMoveCells = <span class="function"><span class="keyword">function</span>(<span class="params">game, eCell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> pCell = api.getPlayerCell(game),</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="comment">// get neighbor cells of the player unit</span></div><div class="line">        <span class="keyword">var</span> pCellNeighbors = mapMod.getNeighbors(map, pCell).filter(<span class="function"><span class="keyword">function</span>(<span class="params">cell</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> cell.walkable;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// get an array of path options </span></div><div class="line">        <span class="keyword">var</span> mtcOptions = pCellNeighbors.map(<span class="function"><span class="keyword">function</span>(<span class="params">cell</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> getMoveCells(game, eCell, cell)</div><div class="line">        &#125;).filter(<span class="function"><span class="keyword">function</span>(<span class="params">mtcOptions</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> mtcOptions.length &gt; <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// rteurn first path or empty array</span></div><div class="line">        <span class="keyword">return</span> mtcOptions[<span class="number">0</span>] || [];</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     UNITS</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// create a base unit</span></div><div class="line">    <span class="keyword">var</span> createBaseUnit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="comment">// current unit stats</span></div><div class="line">            maxHP: <span class="number">1</span>,           <span class="comment">// max number of hit points for the unit</span></div><div class="line">            maxCellsPerTurn: <span class="number">0</span>,   <span class="comment">// the max number of cells a unit can move</span></div><div class="line">            <span class="comment">// current values</span></div><div class="line">            HP: <span class="number">1</span>,</div><div class="line">            <span class="attr">weaponIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">sheetIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">type</span>: <span class="literal">null</span>,</div><div class="line">            <span class="attr">meleeTarget</span>: <span class="literal">null</span>, <span class="comment">// cell index to attack in 'melee' processTurn state</span></div><div class="line">            moveCells: [], <span class="comment">// array of cells to move in 'move' processTurn state</span></div><div class="line">            currentCellIndex: <span class="literal">null</span>,</div><div class="line">            <span class="attr">active</span>: <span class="literal">false</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a player unit</span></div><div class="line">    <span class="keyword">var</span> createPlayerUnit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> player = createBaseUnit();</div><div class="line">        player.type = <span class="string">'player'</span>;</div><div class="line">        player.active = <span class="literal">true</span>;</div><div class="line">        player.maxCellsPerTurn = <span class="number">3</span>;</div><div class="line">        player.sheetIndex = <span class="number">2</span>; <span class="comment">// player sheet</span></div><div class="line">        player.maxHP = <span class="number">30</span>;</div><div class="line">        <span class="keyword">return</span> player;</div><div class="line">    &#125;;    <span class="comment">// create a player unit</span></div><div class="line">    <span class="keyword">var</span> createEnemyUnit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> enemy = createBaseUnit();</div><div class="line">        enemy.type = <span class="string">'enemy'</span>;</div><div class="line">        enemy.active = <span class="literal">true</span>;</div><div class="line">        enemy.maxCellsPerTurn = <span class="number">2</span>;</div><div class="line">        enemy.sheetIndex = <span class="number">3</span>;</div><div class="line">        enemy.maxHP = <span class="number">5</span>;</div><div class="line">        <span class="keyword">return</span> enemy;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a player unit</span></div><div class="line">    <span class="keyword">var</span> createWallUnit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> wall = createBaseUnit();</div><div class="line">        wall.type = <span class="string">'wall'</span>;</div><div class="line">        wall.active = <span class="literal">true</span>;</div><div class="line">        wall.sheetIndex = <span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> wall;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// place a unit at the given location in the current map</span></div><div class="line">    <span class="keyword">var</span> placeUnit = <span class="function"><span class="keyword">function</span> (<span class="params">game, unit, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">var</span> newCell = mapMod.get(map, x, y);</div><div class="line">        <span class="keyword">if</span> (newCell) &#123;</div><div class="line">            <span class="comment">// any old cellIndex that may need to have walkable</span></div><div class="line">            <span class="comment">// set back to true?</span></div><div class="line">            <span class="keyword">if</span> (unit.currentCellIndex != <span class="literal">null</span>) &#123;</div><div class="line">                <span class="keyword">var</span> oldCell = map.cells[unit.currentCellIndex];</div><div class="line">                oldCell.walkable = <span class="literal">true</span>;</div><div class="line">                <span class="comment">// set unit ref back to null</span></div><div class="line">                map.cells[unit.currentCellIndex].unit = <span class="literal">null</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// set new cell to not walkable as a unit is now located here</span></div><div class="line">            newCell.walkable = <span class="literal">false</span>;</div><div class="line">            <span class="comment">// set current cell index for the unit</span></div><div class="line">            unit.currentCellIndex = newCell.i;</div><div class="line">            <span class="comment">// place a ref to the unit in the map cell</span></div><div class="line">            map.cells[unit.currentCellIndex].unit = unit; <span class="comment">// map ref to unit</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// place player helper that is called when setting up a new game, and when the player</span></div><div class="line">    <span class="comment">// moves to a new map</span></div><div class="line">    <span class="keyword">var</span> placePlayer = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        toMap = game.toMap,</div><div class="line">        toCell = <span class="literal">null</span>,</div><div class="line">        i = map.cells.length;</div><div class="line">        <span class="comment">// get a toCell ref if we have a pos in game.toMap</span></div><div class="line">        <span class="keyword">if</span>(toMap.x != <span class="literal">null</span> &amp;&amp; toMap.y != <span class="literal">null</span>)&#123;</div><div class="line">            toCell = mapMod.get(map, toMap.x, toMap.y);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we have a toCell</span></div><div class="line">        <span class="keyword">if</span>(toCell)&#123;</div><div class="line">            <span class="keyword">if</span>(!toCell.unit)&#123;</div><div class="line">                placeUnit(game, game.player, toCell.x, toCell.y);</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we get this far just find a spot</span></div><div class="line">        <span class="keyword">while</span>(i--)&#123;</div><div class="line">            <span class="keyword">var</span> cell = map.cells[i];</div><div class="line">            <span class="keyword">if</span>(cell.unit === <span class="literal">null</span>)&#123;</div><div class="line">                placeUnit(game, game.player, cell.x, cell.y);</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move a unit by way of any cell index values in unit.moveCells</span></div><div class="line">    <span class="keyword">var</span> moveUnit = <span class="function"><span class="keyword">function</span>(<span class="params">game, unit</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(unit.moveCells.length &gt; <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> ci = unit.moveCells.shift();</div><div class="line">            <span class="keyword">var</span> moveToCell = mapMod.get(game.maps[game.mapIndex], ci);</div><div class="line">            <span class="comment">// if no unit at the move to cell</span></div><div class="line">            <span class="keyword">if</span>(!moveToCell.unit)&#123;</div><div class="line">                placeUnit(game, unit, moveToCell.x, moveToCell.y);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// !!! might not hurt to do this for all units</span></div><div class="line">            <span class="comment">// also this might not belong here but where this method</span></div><div class="line">            <span class="comment">// is called for the player unit maybe</span></div><div class="line">            <span class="keyword">if</span>(unit.type === <span class="string">'player'</span>)&#123;</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MAP HELPERS</div><div class="line">*********** *********/</div><div class="line"><span class="comment">// get an array of cell objects by a given unit type string in the given map</span></div><div class="line"><span class="keyword">var</span> getCellsByUnitType = <span class="function"><span class="keyword">function</span>(<span class="params">map, type</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> map.cells.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, cell</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(cell.unit)&#123;</div><div class="line">            <span class="keyword">if</span>(cell.unit.type === type)&#123;</div><div class="line">                acc.push(cell);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> acc;</div><div class="line">    &#125;,[]);</div><div class="line">&#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     SETUP GAME</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// setUp game helper with game object, and given maps</span></div><div class="line">    <span class="keyword">var</span> setupGame = <span class="function"><span class="keyword">function</span> (<span class="params">game, newGame</span>) </span>&#123;</div><div class="line">        newGame = newGame === <span class="literal">undefined</span> ? <span class="literal">true</span> : newGame;</div><div class="line">        <span class="keyword">var</span> playerPlaced = <span class="literal">false</span>,</div><div class="line">        startMapIndex = <span class="number">0</span>;</div><div class="line">        game.mapIndex = <span class="number">0</span>;</div><div class="line">        <span class="comment">// set player HP to max</span></div><div class="line">        game.player.HP = game.player.maxHP;</div><div class="line">        <span class="keyword">if</span>(newGame)&#123;</div><div class="line">            game.remainingEnemies = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// set up maps</span></div><div class="line">        game.maps = game.maps.map(<span class="function"><span class="keyword">function</span>(<span class="params">map, mi</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> mapStr = game.mapStrings[mi] || <span class="string">''</span>;</div><div class="line">            game.mapIndex = mi;</div><div class="line">            map.cells = map.cells.map(<span class="function"><span class="keyword">function</span>(<span class="params">cell, ci</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> cellIndex = <span class="built_in">parseInt</span>(mapStr[ci] || <span class="string">'0'</span>),</div><div class="line">                x = ci % map.w,</div><div class="line">                y = <span class="built_in">Math</span>.floor(ci / map.w);</div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">0</span> &amp;&amp; newGame)&#123;</div><div class="line">                    <span class="keyword">var</span> cell = mapMod.get(map, ci);</div><div class="line">                    cell.unit = <span class="literal">null</span>;</div><div class="line">                    cell.walkable = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// wall blocks set for new games and not</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">1</span>)&#123;</div><div class="line">                    <span class="keyword">var</span> wall = createWallUnit();</div><div class="line">                    placeUnit(game, wall, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// player always set</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">2</span>)&#123;</div><div class="line">                    playerPlaced = <span class="literal">true</span>;</div><div class="line">                    startMapIndex = mi;</div><div class="line">                    placeUnit(game, game.player, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// enemy</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">3</span> &amp;&amp; newGame)&#123;</div><div class="line">                    game.remainingEnemies += <span class="number">1</span>;</div><div class="line">                    <span class="keyword">var</span> enemy = createEnemyUnit();</div><div class="line">                    enemy.HP = enemy.maxHP;</div><div class="line">                    placeUnit(game, enemy, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> cell;</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">return</span> map;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// if player is not palced then place the player unit</span></div><div class="line">        <span class="comment">// at a null cell</span></div><div class="line">        <span class="keyword">if</span>(!playerPlaced)&#123;</div><div class="line">            placePlayer(game);</div><div class="line">        &#125;</div><div class="line">        game.mapIndex = startMapIndex;</div><div class="line">        game.toMap = getToMap(game);</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     gameMod.create PUBLIC METHOD</div><div class="line">*********** *********/</div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// create a new game state</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="comment">//var mapStrings = opt.maps || ['2'];</span></div><div class="line">        <span class="keyword">var</span> game = &#123;</div><div class="line">            <span class="comment">// mode: 'map', // not using game.mode at this time</span></div><div class="line">            turn: <span class="number">0</span>,</div><div class="line">            <span class="attr">turnState</span>: <span class="string">'wait'</span>,</div><div class="line">            <span class="attr">maps</span>: [],</div><div class="line">            <span class="attr">mapIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">mapWorldWidth</span>: <span class="number">3</span>, <span class="comment">// used to find toIndex</span></div><div class="line">            toMap: &#123;</div><div class="line">                <span class="attr">index</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">x</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">y</span>: <span class="literal">null</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">mapStrings</span>: opt.maps || [<span class="string">'2'</span>],</div><div class="line">            <span class="attr">player</span>: createPlayerUnit(),</div><div class="line">            <span class="attr">remainingEnemies</span>: <span class="number">0</span></div><div class="line">        &#125;;</div><div class="line">        game.mapStrings.forEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            game.maps.push(mapMod.create(&#123;</div><div class="line">                <span class="attr">marginX</span>: opt.marginX === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.marginX,</div><div class="line">                <span class="attr">marginY</span>: opt.marginY === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.marginY,</div><div class="line">                <span class="attr">w</span>:  opt.w === <span class="literal">undefined</span> ? <span class="number">4</span> : opt.w,</div><div class="line">                <span class="attr">h</span>:  opt.h === <span class="literal">undefined</span> ? <span class="number">4</span> : opt.h</div><div class="line">            &#125;));</div><div class="line">        &#125;);</div><div class="line">        setupGame(game, <span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     gameMod.update PUBLIC METHOD</div><div class="line">*********** *********/</div><div class="line">    <span class="keyword">var</span> processMeele = <span class="function"><span class="keyword">function</span>(<span class="params">game, unit</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> targetCellIndex = unit.meleeTarget,</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">if</span>(targetCellIndex != <span class="literal">null</span>)&#123;</div><div class="line">            <span class="keyword">var</span> targetCell = mapMod.get(map, targetCellIndex),</div><div class="line">            tUnit = targetCell.unit;</div><div class="line">            <span class="keyword">if</span>(tUnit)&#123;</div><div class="line">                tUnit.HP -= <span class="number">1</span>;</div><div class="line">                tUnit.HP = tUnit.HP &lt; <span class="number">0</span> ? <span class="number">0</span> : tUnit.HP;</div><div class="line">                <span class="comment">// enemy unit death check</span></div><div class="line">                <span class="keyword">if</span>(tUnit.HP &lt;= <span class="number">0</span> &amp;&amp; tUnit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">                    targetCell.walkable = <span class="literal">true</span>;</div><div class="line">                    targetCell.unit = <span class="literal">null</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            unit.meleeTarget = <span class="literal">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get remaining Enemies helper used to update game.remainingEnemies in 'end' process turn state</span></div><div class="line">    <span class="keyword">var</span> getRemainingEnemies = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> game.maps.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, map</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            <span class="keyword">return</span> acc + eCells.length;</div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// process turn method used in gameMod.update</span></div><div class="line">    <span class="keyword">var</span> processTurn = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        pCell = api.getPlayerCell(game),</div><div class="line">        eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">        <span class="comment">// do nothing for 'wait' state</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'wait'</span>)&#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// starting a new turn</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'start'</span>)&#123;</div><div class="line">            <span class="comment">// let enemy units figure paths</span></div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> d = utils.distance(eCell.x + <span class="number">16</span>, eCell.y + <span class="number">16</span>, pCell.x + <span class="number">16</span>, pCell.y + <span class="number">16</span>);</div><div class="line">                <span class="keyword">if</span>( d &lt;= <span class="number">1.5</span>)&#123;</div><div class="line">                    <span class="comment">// in melee range player</span></div><div class="line">                    eCell.unit.meleeTarget = pCell.i;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">// not in melee range of player</span></div><div class="line">                    eCell.unit.moveCells = getEnemeyMoveCells(game, eCell);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//console.log(eCell.unit.moveCells);</span></div><div class="line">            &#125;);</div><div class="line">            game.turnState = <span class="string">'move'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// move state</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'move'</span>)&#123;</div><div class="line">            <span class="comment">// move player unit</span></div><div class="line">            moveUnit(game, game.player);</div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                moveUnit(game, eCell.unit);</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            <span class="comment">// if moveCells array length of all units === 0 the move state is over</span></div><div class="line">            <span class="keyword">if</span>(game.player.moveCells.length === <span class="number">0</span> &amp;&amp; eCells.every(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> eCell.unit.moveCells.length === <span class="number">0</span>;</div><div class="line">            &#125;))&#123;</div><div class="line">                game.turnState = <span class="string">'melee'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// melee attack</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'melee'</span>)&#123;</div><div class="line">            <span class="comment">// process any player melee attack</span></div><div class="line">            processMeele(game, game.player);</div><div class="line">            <span class="comment">// process melee attacks for enemy units</span></div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                processMeele(game, eCell.unit);</div><div class="line">            &#125;);</div><div class="line">            game.turnState = <span class="string">'end'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// for end state step game.turn and set game.turnState back to wait</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'end'</span>)&#123;</div><div class="line">            game.turn += <span class="number">1</span>;</div><div class="line">            game.turnState = <span class="string">'wait'</span>;</div><div class="line">            <span class="comment">// check for player death</span></div><div class="line">            <span class="keyword">if</span>(game.player.HP &lt;= <span class="number">0</span>)&#123;</div><div class="line">                <span class="comment">// !!! for now just call setupGame</span></div><div class="line">                pCell.unit = <span class="literal">null</span>;</div><div class="line">                pCell.walkable = <span class="literal">true</span>;</div><div class="line">                setupGame(game, <span class="literal">false</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// check for all enemies dead</span></div><div class="line">            game.remainingEnemies = getRemainingEnemies(game);</div><div class="line">            <span class="keyword">if</span>(game.remainingEnemies === <span class="number">0</span>)&#123;</div><div class="line">                setupGame(game, <span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a game object</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">game, secs</span>) </span>&#123;</div><div class="line">        <span class="comment">// just call process turn for now</span></div><div class="line">        processTurn(game, secs);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get player cell</span></div><div class="line">    api.getPlayerCell = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> p = game.player,</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">return</span> map.cells[p.currentCellIndex];</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// preform what needs to happen for a player pointer event for the given pixel positon</span></div><div class="line">    api.playerPointer = <span class="function"><span class="keyword">function</span>(<span class="params">game, x, y</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> clickedCell = mapMod.getCellByPointer(game.maps[game.mapIndex], x, y),</div><div class="line">        map = game.maps[game.mapIndex],</div><div class="line">        pCell = api.getPlayerCell(game);</div><div class="line">        <span class="comment">// if we have a cell</span></div><div class="line">        <span class="keyword">if</span> (clickedCell) &#123;</div><div class="line">            <span class="comment">// if player cell is clicked and there is a toIndex value</span></div><div class="line">            <span class="keyword">if</span>(clickedCell === pCell &amp;&amp; game.toMap.index != <span class="literal">null</span>)&#123;</div><div class="line">                game.mapIndex = game.toMap.index;</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">                pCell.unit = <span class="literal">null</span>;</div><div class="line">                pCell.walkable = <span class="literal">true</span>;</div><div class="line">                game.player.currentCellIndex = <span class="literal">null</span>;</div><div class="line">                placePlayer(game);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// if cell has a unit on it</span></div><div class="line">            <span class="keyword">if</span>(clickedCell.unit)&#123;</div><div class="line">                <span class="keyword">var</span> unit = clickedCell.unit; </div><div class="line">                <span class="keyword">if</span>(unit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">                    <span class="comment">// set meleeTarget index</span></div><div class="line">                    game.player.meleeTarget = clickedCell.i;</div><div class="line">                    game.turnState = <span class="string">'start'</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// default action is to try to move to the cell</span></div><div class="line">            game.player.moveCells = getMoveCells(game, pCell, clickedCell);</div><div class="line">            game.turnState = <span class="string">'start'</span>;</div><div class="line"> </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="4-The-draw-module"><a href="#4-The-draw-module" class="headerlink" title="4 - The draw module"></a>4 - The draw module</h2><p>So now that I have all the modules that can be used to create a main game object state, I am going to want to have a way to create a view for this state object. So I will then need module that can be used to draw to a canvas element which will be this draw.js file. With this example this far I just have a few draw methods one of which is to just draw a simple static background, another is to draw the state of the map as a whole, and I have another that just draws some basic state info.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// public api</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// unit colors</span></div><div class="line">    <span class="keyword">var</span> unitColors = [<span class="string">'green'</span>, <span class="string">'gray'</span>, <span class="string">'blue'</span>, <span class="string">'red'</span>];</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     HELPERS</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line"><span class="comment">// draw an hp bar for the given cell, if it has a vaild unit</span></div><div class="line"><span class="keyword">var</span> drawHPBar = <span class="function"><span class="keyword">function</span>(<span class="params">sm, cell</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> unit = cell.unit;</div><div class="line">    <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">    <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex];</div><div class="line">    <span class="keyword">var</span> cs = map.cellSize;</div><div class="line">    <span class="keyword">var</span> x = map.margin.x + cell.x * cs;</div><div class="line">    <span class="keyword">var</span> y = map.margin.y + cell.y * cs;</div><div class="line">    <span class="keyword">if</span> (unit) &#123;</div><div class="line">        <span class="keyword">if</span>(unit.type == <span class="string">'player'</span> || unit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">             <span class="comment">// hp bar back</span></div><div class="line">             ctx.fillStyle = <span class="string">'gray'</span>;</div><div class="line">             ctx.beginPath();</div><div class="line">             ctx.rect(x, y, cs, <span class="number">5</span>);</div><div class="line">             ctx.fill();</div><div class="line">             ctx.stroke();</div><div class="line">             <span class="comment">// current hp</span></div><div class="line">             <span class="keyword">var</span> per = unit.HP / unit.maxHP;</div><div class="line">             ctx.fillStyle = <span class="string">'lime'</span>;</div><div class="line">             ctx.beginPath();</div><div class="line">             ctx.rect(x, y, cs * per, <span class="number">5</span>);</div><div class="line">             ctx.fill();</div><div class="line">             ctx.stroke();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// draw a cell helper</span></div><div class="line"><span class="keyword">var</span> drawCell = <span class="function"><span class="keyword">function</span>(<span class="params">sm, cell</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex];</div><div class="line">    <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">    <span class="keyword">var</span> cs = map.cellSize;</div><div class="line">    <span class="keyword">var</span> x = map.margin.x + cell.x * cs;</div><div class="line">    <span class="keyword">var</span> y = map.margin.y + cell.y * cs;</div><div class="line">    <span class="comment">// draw base cell</span></div><div class="line">    ctx.fillStyle = unitColors[<span class="number">0</span>];</div><div class="line">    <span class="comment">// if we have a unit</span></div><div class="line">    <span class="keyword">if</span> (cell.unit) &#123;</div><div class="line">        ctx.fillStyle = unitColors[cell.unit.sheetIndex];</div><div class="line">    &#125;</div><div class="line">    ctx.beginPath();</div><div class="line">    ctx.rect(x, y, cs, cs);</div><div class="line">    ctx.fill();</div><div class="line">    ctx.stroke();</div><div class="line">    drawHPBar(sm, cell);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     PUBLIC API</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line">    <span class="comment">// draw background</span></div><div class="line">    api.back = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = sm.canvas,</div><div class="line">        ctx = sm.ctx;</div><div class="line">        ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw the map</span></div><div class="line">    api.map = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex],</div><div class="line">        i = <span class="number">0</span>,</div><div class="line">        len = map.cells.length;</div><div class="line">        <span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">            drawCell(sm, map.cells[i]);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw info</span></div><div class="line">    api.info = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx,</div><div class="line">        pos = sm.input.pos,</div><div class="line">        pCell = gameMod.getPlayerCell(sm.game),</div><div class="line">        canvas = sm.canvas,</div><div class="line">        dy = <span class="number">14</span>;</div><div class="line">        <span class="comment">// text style</span></div><div class="line">        ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">        ctx.font = <span class="string">'12px courier'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        <span class="comment">// draw current pointer position</span></div><div class="line">        ctx.fillText(<span class="string">'pos: '</span> + pos.x + <span class="string">','</span> + pos.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">0</span>);</div><div class="line">        <span class="comment">// player cell pos</span></div><div class="line">        ctx.fillText(<span class="string">'player pos: '</span> + pCell.x + <span class="string">','</span> + pCell.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">1</span>);</div><div class="line">        <span class="comment">// to map values</span></div><div class="line">        <span class="keyword">var</span> tm = sm.game.toMap;</div><div class="line">        ctx.fillText(<span class="string">'toMap: mi:'</span> + tm.index + <span class="string">', x: '</span> + tm.x + <span class="string">', y: '</span> + tm.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">2</span>);</div><div class="line">        <span class="comment">// turn number and turnChange bool</span></div><div class="line">        ctx.fillText(<span class="string">'turn:'</span> + sm.game.turn + <span class="string">', turnState: '</span> + sm.game.turnState, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">3</span>);</div><div class="line">        <span class="comment">// enemies</span></div><div class="line">        ctx.fillText(<span class="string">'enemies:'</span> + sm.game.remainingEnemies, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">4</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// version number</span></div><div class="line">        ctx.fillText(<span class="string">'v'</span> + sm.ver, <span class="number">1</span>, canvas.height - <span class="number">11</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public api to draw variable</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="5-The-main-js-file-and-the-start-of-a-State-machine"><a href="#5-The-main-js-file-and-the-start-of-a-State-machine" class="headerlink" title="5 - The main.js file and the start of a State machine"></a>5 - The main.js file and the start of a State machine</h2><p>So now it is time to get to my main.js file for this javaScript example where I will make use of all the modules that I have put together for this example. Here I create the canvas element that I will be using, and set up a simple state machine object that for the same of this example is not really much of a state machine but just a place holder for such a thing. Also here in the main.js file I have my main application loop that is typically for any of my canvas examples.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>),</div><div class="line">    ctx = canvas.getContext(<span class="string">'2d'</span>),</div><div class="line">    container = <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">    container.appendChild(canvas);</div><div class="line">    canvas.width = <span class="number">320</span>;</div><div class="line">    canvas.height = <span class="number">240</span>;</div><div class="line">    ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line"> </div><div class="line">    <span class="comment">// disable default action for onselectstart</span></div><div class="line">    canvas.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> sm = &#123;</div><div class="line">        <span class="attr">ver</span>: <span class="string">'0.7.0'</span>,</div><div class="line">        <span class="attr">fps</span>: <span class="number">12</span>,</div><div class="line">        <span class="attr">lt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        <span class="attr">game</span>: gameMod.create(&#123;</div><div class="line">            <span class="attr">marginX</span> : <span class="number">14</span>,</div><div class="line">            <span class="attr">marginY</span> : <span class="number">7</span>,</div><div class="line">            <span class="attr">w</span>: <span class="number">9</span>,</div><div class="line">            <span class="attr">h</span>: <span class="number">7</span>,</div><div class="line">            <span class="attr">maps</span>: [</div><div class="line">                <span class="comment">// TOP</span></div><div class="line">                <span class="string">'111111111'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'103030000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'100000001'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'111111111'</span> +</div><div class="line">                <span class="string">'000000000'</span> +</div><div class="line">                <span class="string">'000000300'</span> + </div><div class="line">                <span class="string">'000000000'</span> + </div><div class="line">                <span class="string">'000000000'</span> +</div><div class="line">                <span class="string">'000000000'</span> +</div><div class="line">                <span class="string">'100100000'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'111111111'</span> +</div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000301'</span> +</div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000301'</span> +</div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000301'</span>,</div><div class="line">                </div><div class="line">                <span class="comment">// middle</span></div><div class="line">                <span class="string">'100000001'</span> +</div><div class="line">                <span class="string">'103000001'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'100000001'</span> + </div><div class="line">                <span class="string">'100000001'</span> + </div><div class="line">                <span class="string">'103000001'</span> + </div><div class="line">                <span class="string">'100000001'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'100100000'</span> +</div><div class="line">                <span class="string">'100111010'</span> +</div><div class="line">                <span class="string">'020001010'</span> +</div><div class="line">                <span class="string">'100101030'</span> +</div><div class="line">                <span class="string">'100100111'</span> +</div><div class="line">                <span class="string">'100100000'</span> +</div><div class="line">                <span class="string">'100100000'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000031'</span> +</div><div class="line">                <span class="string">'000111111'</span> +</div><div class="line">                <span class="string">'111100031'</span> +</div><div class="line">                <span class="string">'000000001'</span> +</div><div class="line">                <span class="string">'000000001'</span>,</div><div class="line">                </div><div class="line">                <span class="comment">// bottom   </span></div><div class="line">                <span class="string">'100000001'</span> + </div><div class="line">                <span class="string">'100000001'</span> + </div><div class="line">                <span class="string">'100000001'</span> + </div><div class="line">                <span class="string">'103000000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'103030000'</span> + </div><div class="line">                <span class="string">'111111111'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'100100000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'100000000'</span> + </div><div class="line">                <span class="string">'000000000'</span> + </div><div class="line">                <span class="string">'000000000'</span> + </div><div class="line">                <span class="string">'000000300'</span> + </div><div class="line">                <span class="string">'111111111'</span>,</div><div class="line"> </div><div class="line">                <span class="string">'000000001'</span> + </div><div class="line">                <span class="string">'000000001'</span> + </div><div class="line">                <span class="string">'000000001'</span> + </div><div class="line">                <span class="string">'000000301'</span> + </div><div class="line">                <span class="string">'000000001'</span> + </div><div class="line">                <span class="string">'000000301'</span> + </div><div class="line">                <span class="string">'111111111'</span></div><div class="line">                </div><div class="line">            ]</div><div class="line"> </div><div class="line">        &#125;),</div><div class="line">        <span class="attr">canvas</span>: canvas,</div><div class="line">        <span class="attr">ctx</span>: ctx,</div><div class="line">        <span class="attr">input</span>: &#123;</div><div class="line">            <span class="attr">pointerDown</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">pos</span>: &#123;</div><div class="line">                <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">                <span class="attr">y</span>: <span class="number">0</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> pointerHanders = &#123;</div><div class="line">        <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> pos = sm.input.pos = utils.getCanvasRelative(e);</div><div class="line">            <span class="keyword">if</span>(e.type === <span class="string">'touchstart'</span>)&#123;</div><div class="line">                e.preventDefault();</div><div class="line">            &#125;</div><div class="line">            sm.input.pointerDown = <span class="literal">true</span>;</div><div class="line">            <span class="comment">// call player pointer method in gameMod</span></div><div class="line">            gameMod.playerPointer(sm.game, pos.x, pos.y);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">move</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">            sm.input.pos = utils.getCanvasRelative(e);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">end</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">            sm.input.pointerDown = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> createPointerHandler = <span class="function"><span class="keyword">function</span> (<span class="params">sm, type</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">            pointerHanders[type](sm, e);</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    canvas.addEventListener(<span class="string">'touchstart'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">    canvas.addEventListener(<span class="string">'touchmove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">    canvas.addEventListener(<span class="string">'touchend'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div><div class="line">    canvas.addEventListener(<span class="string">'mousedown'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">    canvas.addEventListener(<span class="string">'mousemove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">    canvas.addEventListener(<span class="string">'mouseup'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div><div class="line"> </div><div class="line">    <span class="comment">// loop with frame capping set by sm.fps value</span></div><div class="line">    <span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        secs = (now - sm.lt) / <span class="number">1000</span>;</div><div class="line">        requestAnimationFrame(loop);</div><div class="line">        <span class="keyword">if</span>(secs &gt;= <span class="number">1</span> / sm.fps)&#123;</div><div class="line">            gameMod.update(sm.game);</div><div class="line">            draw.back(sm);</div><div class="line">            draw.map(sm);</div><div class="line">            draw.info(sm);</div><div class="line">            sm.lt = now;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    loop();</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6 - Conclusion"></a>6 - Conclusion</h2><p>So for now I have a decent starting point for a game, but there are all ready thins that I might choose to do differently when it comes to this basic starting point. Like many javaScript projects that make use of canvas I have a main update loop that is calling requestAnimationFrame over and over again. I decided to keep that, but the thought did occur that I might want to make this project completely event driven rather than having an update loop fire all the time. Also when it comes to keeping it there are many little subtle improvements that are needed that I have not got to yet, but have done in other projects.</p>
<p>Still for now I just wanted to get this the point where I am just moving a player object around in a grid, and that is it. I had it set in my mind as to what the first step is, and I completed that. There are going to be additional steps that involve making various invisible improvements that do not really change the behavior, or looks an feel of the project but that was not what I wanted to get done for the moment.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/" data-id="cl6s6czs400rktgv1f58p5d2d" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/17/canvas-example-grid-game-monster-smash/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Monster Smash canvas game example
        
      </div>
    </a>
  
  
    <a href="/2020/08/10/js-javascript-example-zig-zag-arc/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Linear percent values to other zig zag and arc percent values as a javaScript example</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/index.html';
    this.page.identifier = '694';
    this.page.title = 'grid game unit movement javaScript example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.5px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.5px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.5px;">angular</a> <a href="/tags/animation/" style="font-size: 12px;">animation</a> <a href="/tags/automation/" style="font-size: 12px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.5px;">backbone</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.5px;">canvas</a> <a href="/tags/corejs/" style="font-size: 13px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.5px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.5px;">express</a> <a href="/tags/games/" style="font-size: 17px;">games</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 12px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.5px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.5px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.5px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.5px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.5px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.5px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.5px;">python</a> <a href="/tags/statistics/" style="font-size: 14px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/12/threejs-cylinder-geometry/">Cylinder Geometry threejs example</a>
          </li>
        
          <li>
            <a href="/2022/08/05/threejs-examples-camera-kit/">Camera Kit module threejs example</a>
          </li>
        
          <li>
            <a href="/2022/07/29/threejs-examples-aplerp/">An advanced Lerping module threejs example</a>
          </li>
        
          <li>
            <a href="/2022/07/22/threejs-capsule-geometry/">Capsule geometry in threejs</a>
          </li>
        
          <li>
            <a href="/2022/07/15/threejs-examples-object-grid-wrap-land/">THREEJS Looping land animation using the Object grid wrap module</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS-Examples</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas-Examples</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2020/08/11/js-javascript-example-grid-game-unit-movement/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>