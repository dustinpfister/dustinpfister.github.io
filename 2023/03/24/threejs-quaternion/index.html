<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Quaternion rotation objects in threejs | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2023/03/24/threejs-quaternion/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="There is a lot of ground to cover when it comes to quaternions in threejs, but one has to start somewhere with them so here we are. Quaternions and prove to be very confusing at first compared to what">
<meta property="og:type" content="article">
<meta property="og:title" content="Quaternion rotation objects in threejs">
<meta property="og:url" content="https://dustinpfister.github.io/2023/03/24/threejs-quaternion/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="There is a lot of ground to cover when it comes to quaternions in threejs, but one has to start somewhere with them so here we are. Quaternions and prove to be very confusing at first compared to what">
<meta property="og:updated_time" content="2023-04-14T13:22:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Quaternion rotation objects in threejs">
<meta name="twitter:description" content="There is a lot of ground to cover when it comes to quaternions in threejs, but one has to start somewhere with them so here we are. Quaternions and prove to be very confusing at first compared to what">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-threejs-quaternion" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/03/24/threejs-quaternion/" class="article-date"> Published:
  <time datetime="2023-03-24T10:28:00.000Z" itemprop="datePublished">2023-03-24</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2023/03/24/threejs-quaternion/" class="article-date"> Modified:
  <time datetime="2023-04-14T13:22:43.000Z" itemprop="dateModified">2023-04-14</time>
</a>

    <span class="article-date">V1.22</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/three-js/">three.js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Quaternion rotation objects in threejs
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>There is a lot of ground to cover when it comes to <a href="https://threejs.org/docs/#api/en/math/Quaternion" target="_blank" rel="external">quaternions in threejs</a>, but one has to start somewhere with them so here we are. Quaternions and prove to be very confusing at first compared to what you might be used to for setting rotations, but with a little effort some of that confusion can be addressed to get to at least a basic, functional , level of understanding. They are far more complex than Euler objects, but that complexly is justified for some situations that can come up when working on projects.</p>
<p>When it comes to setting the rotation of an object such as a mesh object, camera, or any kind of object3d based object one might just use the <a href="/2021/05/13/threejs-object3d-lookat/">look at method of the object3d</a> class and move on with ones life. No judgment with that, it is a very useful method, I use it all the time myself. However I do so with an understanding that the look at method does have some limitations when it comes to setting the rotation of an object. The same can be said of directly working with the rotation property that stores the current object rotation in the form of a Euler object. Euler objects might be easy to understand in terms of what the deal is with the public properties of such objects, but I pay a price for that simplicity and can end up dealing with problems like <a href="https://en.wikipedia.org/wiki/Gimbal_lock" target="_blank" rel="external">Gimbel lock</a>.</p>
<a id="more"></a>
<iframe class="youtube_video" src="https://www.youtube.com/embed/4X4qaK0ei28" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<h2 id="Quaternion-objects-and-what-to-know-first"><a href="#Quaternion-objects-and-what-to-know-first" class="headerlink" title="Quaternion objects and what to know first"></a>Quaternion objects and what to know first</h2><p>In this post I am writing about <a href="https://en.wikipedia.org/wiki/Quaternion" target="_blank" rel="external">Quaternion</a> in the form of Quaternion class objects in the javaScript library known as threejs. This is not in any way a <a href="/2018/04/04/threejs-getting-started/">getting started post on threejs</a>, the javaScript programming language, and other basic skills that are required before hand. In the basic section of this post I do try to keep the source code examples as simple as possible, but it should go without saying that I am making a lot of assumptions here. It is okay if you find this subject a little overwhelming at first because this is very much a more advanced subject compared to a lot of other features of threejs. In any case, regardless of skill level or experience, you might want to learn more, or refresh on a few things first.</p>
<h3 id="Start-with-Euler-angles-buffer-geometry-rotation-methods-and-Object3d-lookAt-first-if-you-are-new-to-rotations"><a href="#Start-with-Euler-angles-buffer-geometry-rotation-methods-and-Object3d-lookAt-first-if-you-are-new-to-rotations" class="headerlink" title="Start with Euler angles, buffer geometry rotation methods, and Object3d.lookAt first if you are new to rotations"></a>Start with Euler angles, buffer geometry rotation methods, and Object3d.lookAt first if you are new to rotations</h3><p>If you are still fairly new to threejs and you have not looked into things like the <a href="/2021/04/28/threejs-euler/">Euler class</a>, and the <a href="/2021/05/13/threejs-object3d-lookat/">Object3d.lookAt</a> method I would suggest that would be a good starting point first. Working with those features are a whole world easier, it is only when you start to run into problems with them that you might want to start looking into alternatives to those features. Also when it comes to geometry there are a number of <a href="/2021/05/20/threejs-buffer-geometry-rotation/">rotation methods in the buffer geometry</a> class. Using those methods might be expensive in terms of system resources, but they are often used just once to adjust the state of a geometry, and in any case they are another way to go about rotating things.</p>
<h3 id="The-source-code-examples-here-are-also-on-github"><a href="#The-source-code-examples-here-are-also-on-github" class="headerlink" title="The source code examples here are also on github"></a>The source code examples here are also on github</h3><p>I have the source code examples that I am writing about here up on my test threejs repository on Github. This is also where I park all the source code examples for my many other blog posts on threejs as well. In addition cloning down the repo, installing the packages, and starting the server might be the fastest way to get these examples as well as the many others working on your end.</p>
<h3 id="Version-Numbers-matter"><a href="#Version-Numbers-matter" class="headerlink" title="Version Numbers matter"></a>Version Numbers matter</h3><p>When I first wrote this post I was using r146 of threejs, and as such the examples follow the style rules that I have set for that revision.<br>With that said I am still using old script tags over that of JSM with these examples. There are a lot of other little details with this revision and the direction that threejs is going. However in any case I have found that I just need to always have a little section such as this to make it clear what the deal is with this sort of thing. If you used threejs as long as I have then you know what the deal is, if not threejs is a fast moving project and code breaking changes are made to if often. </p>
<h2 id="1-Some-basic-getting-started-examples-of-Quaternion-objects"><a href="#1-Some-basic-getting-started-examples-of-Quaternion-objects" class="headerlink" title="1 - Some basic getting started examples of Quaternion objects"></a>1 - Some basic getting started examples of Quaternion objects</h2><p>In this section I will be writing about some basic examples of quaternions. However I think that I have to say that even when it comes to basic examples of quaternions things might prove to be not so basic. They are a little complex and that is just simply the nature of them compared to Euler objects. However they are still only so hard and with a little effort you can at least understand what the deal is with the public properties of these kinds of objects. SO I think that will be the main thing that I will focus on in this basic section.</p>
<h3 id="1-1-Directly-setting-the-quaternion-of-a-mesh-object-using-the-set-from-axis-method"><a href="#1-1-Directly-setting-the-quaternion-of-a-mesh-object-using-the-set-from-axis-method" class="headerlink" title="1.1 - Directly setting the quaternion of a mesh object using the set from axis method"></a>1.1 - Directly setting the quaternion of a mesh object using the set from axis method</h3><p>When it comes to mesh objects, and any object3d class based object for that matter, there is directly working with the <a href="https://threejs.org/docs/#api/en/core/Object3D.quaternion" target="_blank" rel="external">quaternion property of the object3d class</a>. This is an alternative to the <a href="/2022/04/08/threejs-object3d-rotation/">object3d rotation property</a> which is an instance of Euler rather than that of quaternion. As such any change to the quaternion object3d property should also update the state of the rotation property and vice versa as they are both ways to getting and setting the local rotation of an object.</p>
<p>Maybe the best way to get started with quaternion objects would be to start working with the set from axis angle method of the quaternion class. There is also directly working with the various properties, but doing so is not as easy as what you might be used to with the Euler class, more on that later in this section. For now there is just calling the set from axis angle method off of the quaternion property and passing a vector3 object that will be used to define the direction of the axis, and then an angle in radians. </p>
<p>Two points about these argument values to keep in mind, the vector3 normalize method and unit conversion of angles. The Vector3 object that is passed to the set from axis angle method should be normalized to a vector unit length of 1. That was the case to begin with but I am doing it anyway as a way to help be clear about this. If you are fuzzy on what what this is about then it might be a good idea to read up more on the <a href="/2021/06/14/threejs-vector3-normalize/">Vector3 normalize method</a>, and about vectors in general. When it comes the the angle value the method expects a radian value, if you would like to work with degrees then there is working out the simple expressions of making use of functions that there are to work with in the <a href="/2022/04/11/threejs-math-utils/">math utils object</a> to help with this kind of conversion.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SETTING ROTATION WITH QUATERNION</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> axis = <span class="keyword">new</span> THREE.Vector3( <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span> );</div><div class="line"><span class="keyword">const</span> degree = <span class="number">45</span>;</div><div class="line">mesh1.quaternion.setFromAxisAngle( axis.normalize(), THREE.MathUtils.degToRad(degree) );</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="1-2-The-deal-with-setting-properties-directly"><a href="#1-2-The-deal-with-setting-properties-directly" class="headerlink" title="1.2 - The deal with setting properties directly"></a>1.2 - The deal with setting properties directly</h3><p>Thus far when it comes to setting the rotation of an object I often end up just using the look at method or directly work with the Euler class instance stored in the rotation property. When working with a Euler object is is fairly easy to just directly mutate the public properties of the object. Each axis value of a Euler object is just simply a radian value so I just need to set a value in that range for x, y, and z and that is all there is to it. However doing the same with a quaternion is not so easy, and this is one thing that one should be aware of right away when starting to work with this kinds of objects. </p>
<p>If you are like me and you want to know how to directly work with these properties then maybe a good idea for a starting point would be to <a href="https://github.com/mrdoob/three.js/blob/r146/src/math/Quaternion.js" target="_blank" rel="external">look at the source code for the set from axis angle method</a>. At least this is what I did in order to start to get a better idea of what is going on here. For this demo I have a set rotation by axis helper function that works in a very similar way to that of the set from axis angle method. The reason why is because it is based on the actual threejs source code that is used for the method. I just made a few very simple changes that have to do with things like normalizing the given axis vector3 object and tagging a degree rather than radian value.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// Helpers</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> setRotationByAxis = <span class="function">(<span class="params">q, v_axis, n_degree</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> vector = v_axis.normalize();</div><div class="line">    <span class="keyword">const</span> radian = THREE.MathUtils.degToRad(n_degree);</div><div class="line">    <span class="keyword">const</span> halfAngle = radian / <span class="number">2</span>, s = <span class="built_in">Math</span>.sin( halfAngle );</div><div class="line">    q.x = vector.x * s;</div><div class="line">    q.y = vector.y * s;</div><div class="line">    q.z = vector.z * s;</div><div class="line">    q.w = <span class="built_in">Math</span>.cos( halfAngle );</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( <span class="keyword">new</span> THREE.CylinderGeometry(<span class="number">0</span>, <span class="number">0.25</span>, <span class="number">1</span>), <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">mesh1.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>);</div><div class="line"><span class="comment">//mesh1.lookAt(0, 0, 1);</span></div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SETTING ROTATION WITH QUATERNION</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> q = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line"><span class="comment">// vector does not need to be normalized, and</span></div><div class="line"><span class="comment">// I can use degree values for the angle with this custom</span></div><div class="line"><span class="comment">// set rotation by axis method</span></div><div class="line"><span class="keyword">const</span> v_axis = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> degree = <span class="number">45</span>;</div><div class="line">setRotationByAxis(q, v_axis, degree);</div><div class="line">mesh1.rotation.setFromQuaternion(q);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<p>The main point here is to look at what is going on when it comes to setting the x,y,z, and w values of Quaternion object. It is very different from what you might be used to when it comes to working with Euler objects. Just directly setting the values for the properties is not as straight forward. However there is a certain methodology here, it is a little hard to follow maybe, but still only so hard.</p>
<h2 id="2-Methods-of-the-Quaternion-class"><a href="#2-Methods-of-the-Quaternion-class" class="headerlink" title="2 - Methods of the Quaternion class"></a>2 - Methods of the Quaternion class</h2><p>Just like with any other class in threejs there are a number of prototype methods to work with. I am not going to be getting around to all of them here but I think I should have a section in this post where I wrote a thing or two about maybe some of the most impotent ones to be aware of for starters. In the basic section I wrote a thing or two about the set from axis angle method and it would seem that of you are only going to bother with one method that seems like a very impotent one. However I am sure that many others will prove to be useful as well.</p>
<h3 id="2-1-The-set-from-axis-angle-method"><a href="#2-1-The-set-from-axis-angle-method" class="headerlink" title="2.1 - The set from axis angle method"></a>2.1 - The set from axis angle method</h3><p>From what I have gathered this far it seems like often quaternions are described as having a vector part and a scalar part. This is what the set from axis angle method comes up a lot as this just seems like a fast easy way to set the vector and scalar part of these kinds of objects. When using the set from axis method the first argument shroud be a normalized vector3 object, and then the next argument should be an angle in radians.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">16</span>, <span class="number">16</span>);</div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;<span class="attr">wireframe</span>: <span class="literal">true</span>, <span class="attr">wireframeLinewidth</span>: <span class="number">6</span>&#125;);</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( geo, material);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> arrowHelper = <span class="keyword">new</span> THREE.ArrowHelper();</div><div class="line">arrowHelper.setLength(<span class="number">1.5</span>);</div><div class="line">arrowHelper.line.material.linewidth = <span class="number">6</span>;</div><div class="line">scene.add(arrowHelper);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">-2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">30</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">900</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> v_axis = <span class="keyword">new</span> THREE.Vector3();</div><div class="line"><span class="keyword">const</span> e_axis = <span class="keyword">new</span> THREE.Euler();</div><div class="line"><span class="comment">//mesh1.geometry.rotateZ(e.z); // can rotate the geometry once two if i want</span></div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    <span class="keyword">const</span> a2 = a1 * <span class="number">8</span> % <span class="number">1</span>;</div><div class="line">    <span class="keyword">const</span> a3 = <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.PI * (a1 * <span class="number">2</span> % <span class="number">1</span>) );</div><div class="line">    e_axis.z = <span class="built_in">Math</span>.PI / <span class="number">180</span> * (<span class="number">45</span> * a3);</div><div class="line">    v_axis.set(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>).applyEuler(e_axis);</div><div class="line">    mesh1.quaternion.setFromAxisAngle( v_axis, <span class="built_in">Math</span>.PI * <span class="number">2</span> * a2 );</div><div class="line">    mesh1.rotation.z += e_axis.z;</div><div class="line">    arrowHelper.setDirection(v_axis);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h3 id="2-2-The-slerp-method"><a href="#2-2-The-slerp-method" class="headerlink" title="2.2 - The slerp method"></a>2.2 - The slerp method</h3><p>There should be at least one or more methods that can be used to transition from one quaternion object to another quaternions object as this is often the case with many other objects in threejs. For example when it comes to the Vector3 class there is of course the lerp method that allows for me to quickly transition from one vector3 object to another vector3 object by passing the new target vector and then an alpha value that is the magnitude between the current vector and target vector to move. It would look like this is no lerp method, but there is a <a href="/2023/04/14/threejs-quaternion-slerp/">slerp method</a> which is more or less the quaternion equivalent of that.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// HELPER FUNCTIONS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> setQ = <span class="function">(<span class="params">q, x, y, z, degree</span>) =&gt;</span> &#123;</div><div class="line">    q.setFromAxisAngle( <span class="keyword">new</span> THREE.Vector3( x, y, z ).normalize(), THREE.MathUtils.degToRad(degree) );</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// QUATERNION OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> q1 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">setQ(q1,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> q2 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">setQ(q2,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>, <span class="number">-45</span>);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">800</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    <span class="keyword">const</span> a2 = <span class="number">1</span> - <span class="built_in">Math</span>.abs(<span class="number">0.5</span> - a1) / <span class="number">0.5</span>;</div><div class="line">    mesh1.quaternion.copy(q1).slerp(q2, a2);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h3 id="2-3-The-premultiply-method"><a href="#2-3-The-premultiply-method" class="headerlink" title="2.3 - The premultiply method"></a>2.3 - The premultiply method</h3><p>Often it would seem that I am in a situation in which I need to preform not one, but two or more rotations. With that said it would seem that the <a href="/2023/03/31/threejs-quaternion-premultiply/">premultiplication method</a> is a decent tool for preforming this kind of task with quaternions. In this demo I am creating not one, but two quaternion objects. I am then have three mesh objects, one of which I set to the state of the first quaternion, the next I set to the other quaternion, and then I use the copy method along with the premultiply to update the third mesh object to a Premultiplication of the first and second quatrenion object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> makeMesh = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;<span class="attr">wireframe</span>: <span class="literal">true</span>, <span class="attr">wireframeLinewidth</span>: <span class="number">2</span> &#125;);</div><div class="line">    <span class="keyword">const</span> mesh_parent = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">12</span>, <span class="number">12</span>),</div><div class="line">        material);</div><div class="line">    <span class="keyword">const</span> mesh_child = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.CylinderGeometry(<span class="number">0</span>, <span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">8</span>, <span class="number">8</span>),</div><div class="line">        material);</div><div class="line">    mesh_child.position.y = <span class="number">1.25</span>;</div><div class="line">    mesh_parent.add(mesh_child);</div><div class="line">    <span class="keyword">return</span> mesh_parent;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = makeMesh();</div><div class="line">mesh1.position.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-2.5</span>);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> mesh2 = makeMesh();</div><div class="line">mesh2.position.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">2.5</span>);</div><div class="line">scene.add(mesh2);</div><div class="line"><span class="keyword">const</span> mesh3 = makeMesh();</div><div class="line">mesh3.position.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">scene.add(mesh3);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SETTING ROTATION WITH QUATERNION</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> q = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line"><span class="keyword">const</span> q1 = q.clone();</div><div class="line"><span class="keyword">const</span> q2 = q.clone();</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set( <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span> );</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">900</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> axis1 = <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> );</div><div class="line"><span class="keyword">const</span> e1 = <span class="keyword">new</span> THREE.Euler();</div><div class="line"><span class="keyword">const</span> axis2 = <span class="keyword">new</span> THREE.Vector3( <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span> );</div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    <span class="keyword">const</span> a2 = a1 * <span class="number">1</span> % <span class="number">1</span>;</div><div class="line">    <span class="keyword">const</span> a3 = a1 * (<span class="number">16</span> * <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.PI * a1) ) % <span class="number">1</span>;</div><div class="line">    <span class="keyword">const</span> radian1 = <span class="built_in">Math</span>.PI * <span class="number">2</span> * a2;</div><div class="line">    e1.x = <span class="built_in">Math</span>.cos(radian1);</div><div class="line">    e1.y = <span class="number">0</span>;</div><div class="line">    e1.z = <span class="built_in">Math</span>.sin(radian1);</div><div class="line">    axis1.set( <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span> ).applyEuler(e1);</div><div class="line">    <span class="keyword">const</span> deg1 = <span class="number">90</span>;</div><div class="line">    <span class="keyword">const</span> deg2 = <span class="number">360</span> * a3;</div><div class="line">    <span class="comment">// set q1 and q2 using setFromAxisAngle method</span></div><div class="line">    q1.setFromAxisAngle( axis1.normalize(), THREE.MathUtils.degToRad(deg1) );</div><div class="line">    q2.setFromAxisAngle( axis2.normalize(), THREE.MathUtils.degToRad(deg2) );</div><div class="line">    <span class="comment">// update mesh object local rotations with quaternion objects</span></div><div class="line">    <span class="comment">// where mesh1 and mesh 2 are just the current state of q1 and q2</span></div><div class="line">    <span class="comment">// and the rotation of mesh3 is q1 premultiplyed by q2</span></div><div class="line">    mesh1.quaternion.copy(q1);</div><div class="line">    mesh2.quaternion.copy(q2);</div><div class="line">    mesh3.quaternion.copy(q1).premultiply(q2);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h3 id="2-4-The-set-from-unit-vectors-method"><a href="#2-4-The-set-from-unit-vectors-method" class="headerlink" title="2.4 - The set from unit vectors method"></a>2.4 - The set from unit vectors method</h3><p>For the most part I like to use the set from axis angle method as a way to define the state of a quaternion object. However another great method for this is the <a href="/2023/04/07/threejs-quaternion-setfromunitvectors/">set from unit vectors method</a> which allows me to define the state in the form of a from and to vector3 object. This way I can think in terms of having a vector3 object that is a direction that I want to set, and other vector3 that is the direction that I am coming from to this new direction. Because I am using the vector3 class here I can make <a href="/2022/05/17/threejs-vector3-lerp/">use of methods like the lerp method</a> of the vector3 class to update the state of the to vector3 object starting at the from vector3 to the desired end vector3 object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">scene.background = <span class="literal">null</span>;</div><div class="line">renderer.setClearColor(<span class="number">0x000000</span>, <span class="number">0</span>)</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line"><span class="keyword">const</span> canvas_2d = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</div><div class="line"><span class="keyword">const</span> ctx = canvas_2d.getContext(<span class="string">'2d'</span>);</div><div class="line">canvas_2d.width = <span class="number">640</span>;</div><div class="line">canvas_2d.height = <span class="number">480</span>;</div><div class="line"><span class="keyword">const</span> canvas_3d = renderer.domElement;</div><div class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body;</div><div class="line">container.appendChild(canvas_2d);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// V3 ARRAY</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> v3array = [</div><div class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</div><div class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</div><div class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</div><div class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</div><div class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</div><div class="line">].map( <span class="function">(<span class="params">arr</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> THREE.Vector3().fromArray(arr).normalize();</div><div class="line">&#125;);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">20</span>, <span class="number">20</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123; <span class="attr">wireframe</span>: <span class="literal">true</span>&#125;));</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// CONTROLS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">let</span> controls = <span class="literal">null</span>;</div><div class="line"><span class="keyword">if</span>(THREE.OrbitControls)&#123;</div><div class="line">    controls = <span class="keyword">new</span> THREE.OrbitControls(camera, canvas_2d);</div><div class="line">&#125;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> sm = &#123;</div><div class="line">   <span class="attr">FPS_UPDATE</span>: <span class="number">12</span>,     <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">   FPS_MOVEMENT: <span class="number">30</span>,  <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">   FRAME_MAX: <span class="number">900</span>,</div><div class="line">   <span class="attr">secs</span>: <span class="number">0</span>,</div><div class="line">   <span class="attr">frame_frac</span>: <span class="number">0</span>,     <span class="comment">// 30.888 / 450</span></div><div class="line">   frame: <span class="number">0</span>,          <span class="comment">// 30 / 450</span></div><div class="line">   tick: <span class="number">0</span>,           <span class="comment">//  1 / 450 ( about 1 FPS then )</span></div><div class="line">   now: <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">   <span class="attr">lt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> q_home = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">q_home.setFromAxisAngle( v3array[<span class="number">1</span>], <span class="built_in">Math</span>.PI * <span class="number">0.5</span> );</div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">sm</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = sm.frame / sm.FRAME_MAX;</div><div class="line">    <span class="keyword">const</span> a2 = a1 * v3array.length % <span class="number">1</span>;</div><div class="line">    <span class="keyword">const</span> a3 = <span class="number">1</span> - <span class="built_in">Math</span>.abs(<span class="number">0.5</span> - a2) / <span class="number">0.5</span>;</div><div class="line">    <span class="keyword">const</span> vi1 = <span class="built_in">Math</span>.floor( v3array.length * a1 );</div><div class="line">    <span class="keyword">const</span> vi2 = ( vi1 + <span class="number">1</span> ) % v3array.length;</div><div class="line">    <span class="keyword">const</span> v1 = v3array[vi1];</div><div class="line">    <span class="keyword">const</span> v2 = v3array[vi2];</div><div class="line">    <span class="keyword">const</span> v_from = v1.clone();</div><div class="line">    <span class="keyword">const</span> v_to = v_from.clone().lerp(v2, a3).normalize();</div><div class="line">    <span class="keyword">const</span> q2 = <span class="keyword">new</span> THREE.Quaternion().setFromUnitVectors(v_from, v_to);</div><div class="line">    mesh1.quaternion.copy(q2);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> render2d = <span class="function">(<span class="params">sm</span>) =&gt;</span> &#123;</div><div class="line">    ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">    ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>, canvas_2d.width, canvas_2d.height);</div><div class="line">    ctx.drawImage(canvas_3d, <span class="number">0</span>, <span class="number">0</span>, canvas_2d.width, canvas_2d.height);</div><div class="line">    ctx.fillStyle = <span class="string">'rgba(0,0,0,0.25)'</span>;</div><div class="line">    ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>, canvas_2d.width, canvas_2d.height);</div><div class="line">    ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">    ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">    ctx.font = <span class="string">'10px monospace'</span>;</div><div class="line">    ctx.fillText(<span class="string">'tick              : '</span> + sm.tick, <span class="number">5</span>, <span class="number">5</span>)</div><div class="line">    ctx.fillText(<span class="string">'frame_frac        : '</span> + sm.frame_frac.toFixed(<span class="number">3</span>), <span class="number">5</span>, <span class="number">20</span>);</div><div class="line">    ctx.fillText(<span class="string">'frame / FRAME_MAX : '</span> + sm.frame + <span class="string">'/'</span> + sm.FRAME_MAX, <span class="number">5</span>, <span class="number">35</span>);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    sm.now = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">    sm.secs = (sm.now - sm.lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(sm.secs &gt; <span class="number">1</span> / sm.FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render to 3d canvas, and then render to 2d canvas</span></div><div class="line">        update(sm);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        render2d(sm);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        sm.frame_frac += sm.FPS_MOVEMENT * sm.secs;</div><div class="line">        sm.frame_frac %= sm.FRAME_MAX;</div><div class="line">        sm.frame = <span class="built_in">Math</span>.floor(sm.frame_frac);</div><div class="line">        sm.tick = (sm.tick += <span class="number">1</span>) % sm.FRAME_MAX;</div><div class="line">        sm.lt = sm.now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="3-The-Euler-class-and-Quaternion-class"><a href="#3-The-Euler-class-and-Quaternion-class" class="headerlink" title="3 - The Euler class and Quaternion class"></a>3 - The Euler class and Quaternion class</h2><p>The Euler class is still often used to set an orientation of an object. Also there are a lot of reasons why I might want to use a Euler object over a Quaternion, for one thing they are easier to work with, and if I can use one without running into any major problems with it for the most part i would say they work fine. There are still limitations of Euler objects, so in this section I will be writing about what those limitations are and how Quaternions help to address them. Also I will want to touch base on how to convert from Euler to quaternion and back again as well, as well as anything else that might come up when it comes to Euler objects and how they related to quaternion.</p>
<h3 id="3-1-Converting-Euler-to-and-from-Quaternion"><a href="#3-1-Converting-Euler-to-and-from-Quaternion" class="headerlink" title="3.1 - Converting Euler to and from Quaternion"></a>3.1 - Converting Euler to and from Quaternion</h3><p>If I am dealing with the rotation and quaternion properties of any object3d class based object then conversion to and from Euler is done automatically. If I change the state of the Euler object stored at the rotation property of a mesh, camera, or any other object3d based object that in turn will also update the state of the quaternion property of such objects as well. It is only when dealing with stand alone objects where I might need to use the set from Euler method of the Quaternion class or the set from Quaternion method of the Euler class.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.background = <span class="keyword">new</span> THREE.Color(<span class="string">'#0f0f0f'</span>);</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> addMesh = <span class="function">(<span class="params">obj_parent, x, y, z</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh( <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">    mesh.position.set(x, y, z);</div><div class="line">    obj_parent.add(mesh);</div><div class="line">    <span class="keyword">return</span> mesh</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = addMesh(scene, <span class="number">-1</span>,  <span class="number">0</span>,  <span class="number">1</span>);</div><div class="line"><span class="keyword">const</span> mesh2 = addMesh(scene,  <span class="number">1</span>,  <span class="number">0</span>,  <span class="number">1</span>);</div><div class="line"><span class="keyword">const</span> mesh3 = addMesh(scene, <span class="number">-1</span>,  <span class="number">0</span>, <span class="number">-1</span>);</div><div class="line"><span class="keyword">const</span> mesh4 = addMesh(scene,  <span class="number">1</span>,  <span class="number">0</span>, <span class="number">-1</span>);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set( <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span> );</div><div class="line">camera.lookAt( <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> );</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">800</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    <span class="comment">// A CHANGE to the Euler of mesh1.rotation will also update mesh1.quaternion</span></div><div class="line">    <span class="comment">// the same happens the other way around. So with an Object3d class based object</span></div><div class="line">    <span class="comment">// conversion to and from Euler and quaternion is done automatically</span></div><div class="line">    mesh1.rotation.y = <span class="built_in">Math</span>.PI * <span class="number">2</span> * a1;</div><div class="line">    mesh2.quaternion.copy(mesh1.quaternion);</div><div class="line">    <span class="comment">// when working with Objects by themselves there are methods like the setFromEuler method</span></div><div class="line">    <span class="comment">// of the quaternion class...</span></div><div class="line">    <span class="keyword">const</span> e1 = <span class="keyword">new</span> THREE.Euler();</div><div class="line">    e1.x = <span class="built_in">Math</span>.PI * <span class="number">2</span> * a1;</div><div class="line">    <span class="keyword">const</span> q1 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">    q1.setFromEuler(e1);</div><div class="line">    mesh3.quaternion.copy(q1);</div><div class="line">    <span class="comment">// ...and the setFromQuaternion method of the Euler class</span></div><div class="line">    <span class="keyword">const</span> q2 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">    <span class="keyword">const</span> v_axis = <span class="keyword">new</span> THREE.Vector3(<span class="number">1</span> - <span class="number">2</span> * a1,<span class="number">1</span>,<span class="number">-1</span> + <span class="number">2</span> * a1).normalize();</div><div class="line">    q2.setFromAxisAngle( v_axis, <span class="built_in">Math</span>.PI * <span class="number">2</span> * a1 );</div><div class="line">    <span class="keyword">const</span> e2 = <span class="keyword">new</span> THREE.Euler();</div><div class="line">    e2.setFromQuaternion(q2)</div><div class="line">    mesh4.rotation.copy(e2);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h3 id="3-2-Gimbal-Lock-demo-Of-Euler-compared-to-doing-the-same-with-Quaternion"><a href="#3-2-Gimbal-Lock-demo-Of-Euler-compared-to-doing-the-same-with-Quaternion" class="headerlink" title="3.2 - Gimbal Lock demo Of Euler compared to doing the same with Quaternion"></a>3.2 - Gimbal Lock demo Of Euler compared to doing the same with Quaternion</h3><p>One major draw back with the Euler class is that I can end up running into problems that have to do with Gimbal lock. This is an issue where two axis of rotation will become aligned with each other and as such I and up losing an axis of control, or one kind of rotation will turn into another. For example in this demo I have two objects that are comped of a collection of mesh objects that look like airplanes kind of. I also have two rotation update methods for them, one of which makes use of Euler objects and the other makes use of Quaternion objects to do so. Both objects update just fine when pitch is at 90, but when I pitch both objects up 90 to 0 so they are both pointing up, yaw turns into roll for the object that is updated by way of Euler angles. However with the quaternion object yaw is still yaw and things are working as expected.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.background = <span class="keyword">new</span> THREE.Color(<span class="string">'#0f0f0f'</span>);</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> mkObject = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;&#125;);</div><div class="line">    <span class="keyword">const</span> mesh_body = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">       <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">0.5</span>, <span class="number">20</span>, <span class="number">20</span>),</div><div class="line">       material);</div><div class="line">    <span class="keyword">const</span> mesh_nose = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.CylinderGeometry(<span class="number">0</span>, <span class="number">0.25</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">20</span>),</div><div class="line">        material</div><div class="line">    );</div><div class="line">    mesh_nose.geometry.translate(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">    mesh_body.add(mesh_nose);</div><div class="line">    <span class="keyword">const</span> mesh_wing = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">0.125</span>,<span class="number">0.3</span>,<span class="number">3</span>),</div><div class="line">        material</div><div class="line">    );</div><div class="line">    mesh_body.add(mesh_wing);</div><div class="line">    <span class="keyword">const</span> mesh_tail = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">0.5</span>,<span class="number">0.4</span>,<span class="number">0.125</span>),</div><div class="line">        material</div><div class="line">    );</div><div class="line">    mesh_tail.geometry.translate(<span class="number">0.75</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    mesh_tail.geometry.rotateZ(<span class="built_in">Math</span>.PI / <span class="number">180</span> * <span class="number">-60</span>);</div><div class="line">    mesh_body.add(mesh_tail);</div><div class="line">    <span class="keyword">return</span> mesh_body;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get an alpha that is a part of an alpha</span></div><div class="line"><span class="keyword">const</span> getPartAlpha = <span class="function">(<span class="params">a1, a_start, a_length</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> (a1 - a_start) / a_length;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get pitch and yaw in deg values</span></div><div class="line"><span class="keyword">const</span> getPitchYaw = <span class="function">(<span class="params">a1</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> result = &#123; <span class="attr">yaw</span>:<span class="number">0</span>, <span class="attr">pitch</span>:<span class="number">90</span> &#125;;</div><div class="line">    <span class="keyword">if</span>(a1 &lt; <span class="number">0.25</span>)&#123;</div><div class="line">        <span class="keyword">const</span> a2 = getPartAlpha(a1, <span class="number">0</span>, <span class="number">0.25</span>);</div><div class="line">        result.yaw = <span class="number">45</span> * <span class="built_in">Math</span>.sin( <span class="built_in">Math</span>.PI * <span class="number">4</span> * a2 );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(a1 &gt;= <span class="number">0.25</span> &amp;&amp; a1 &lt; <span class="number">0.5</span>)&#123;</div><div class="line">       <span class="keyword">let</span> a2 = getPartAlpha(a1, <span class="number">0.25</span>, <span class="number">0.25</span>);</div><div class="line">       result.pitch = <span class="number">90</span> - <span class="number">90</span> * a2;</div><div class="line">       result.yaw = <span class="number">22</span> * <span class="built_in">Math</span>.sin( <span class="built_in">Math</span>.PI * <span class="number">8</span> * a2 );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(a1 &gt;= <span class="number">0.5</span> &amp;&amp; a1 &lt; <span class="number">0.75</span>)&#123;</div><div class="line">        <span class="keyword">const</span> a2 = getPartAlpha(a1, <span class="number">0.5</span>, <span class="number">0.25</span>);</div><div class="line">        result.pitch = <span class="number">0</span>;</div><div class="line">        result.yaw = <span class="number">45</span> * <span class="built_in">Math</span>.sin( <span class="built_in">Math</span>.PI * <span class="number">4</span> * a2 );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(a1 &gt;= <span class="number">0.75</span>)&#123;</div><div class="line">       <span class="keyword">let</span> a2 = getPartAlpha(a1, <span class="number">0.75</span>, <span class="number">0.25</span>);</div><div class="line">       result.pitch = <span class="number">90</span> * a2;</div><div class="line">       result.yaw = <span class="number">22</span> * <span class="built_in">Math</span>.sin( <span class="built_in">Math</span>.PI * <span class="number">8</span> * a2 );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// update By Euler ( object3d.rotation )</span></div><div class="line"><span class="keyword">const</span> updateByEuler = <span class="function">(<span class="params">obj, a1</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> result = getPitchYaw(a1);</div><div class="line">    obj.rotation.z = <span class="built_in">Math</span>.PI / <span class="number">180</span> * result.pitch;</div><div class="line">    obj.rotation.y = <span class="built_in">Math</span>.PI / <span class="number">180</span> * (<span class="number">90</span> - result.yaw);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// update By Quaternion ( object3d.quaternion )</span></div><div class="line"><span class="keyword">const</span> updateByQuaternion = <span class="function">(<span class="params">obj, a1</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> result = getPitchYaw(a1);</div><div class="line">    <span class="keyword">const</span> v_axis_pitch = <span class="keyword">new</span> THREE.Vector3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">const</span> q_pitch = <span class="keyword">new</span> THREE.Quaternion().setFromAxisAngle(v_axis_pitch, THREE.MathUtils.degToRad(result.pitch) );</div><div class="line">    <span class="keyword">const</span> v_axis_yaw = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="keyword">const</span> q_yaw = <span class="keyword">new</span> THREE.Quaternion().setFromAxisAngle(v_axis_yaw, THREE.MathUtils.degToRad(result.yaw) );</div><div class="line">    obj.quaternion.setFromUnitVectors(v_axis_yaw, v_axis_pitch).premultiply(q_yaw).premultiply(q_pitch);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> obj1 = mkObject();</div><div class="line">obj1.position.set(<span class="number">0</span>,<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">scene.add(obj1);</div><div class="line"><span class="keyword">const</span> obj2 = mkObject();</div><div class="line">obj1.position.set(<span class="number">0</span>,<span class="number">0</span>, <span class="number">-3</span>);</div><div class="line">scene.add(obj2);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">-4</span>, <span class="number">4</span>, <span class="number">4</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1.5</span>);</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">400</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    updateByEuler(obj1, a1);</div><div class="line">    updateByQuaternion(obj2, a1);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="4-User-space-methods-for-quaternions"><a href="#4-User-space-methods-for-quaternions" class="headerlink" title="4 - User space methods for quaternions"></a>4 - User space methods for quaternions</h2><p>There are a whole lot of great prototype methods to work with in the Quaternion class, however there is not going to be everything of course. Some times I might just need to have some kind of user space methods because some kind of function is just not baked into the prototype at all. Other times there might be something to work with, but there might be some reason to have something that does the same thing in a slightly different way.</p>
<h3 id="4-1-A-get-axis-angle-method"><a href="#4-1-A-get-axis-angle-method" class="headerlink" title="4.1 - A get axis angle method"></a>4.1 - A get axis angle method</h3><p>As I have covered in the methods section there is the set from axis angle method that can be used to set the state of a quaternion with a normalized vector3 object and an angle in radians for the scalar. However what if I need to <a href="https://stackoverflow.com/questions/62457529/how-do-you-get-the-axis-and-angle-representation-of-a-quaternion-in-three-js" target="_blank" rel="external">get those values from a quaternion in the event that they are not known</a>? For this demo I have a get axis radian from quaternion method that will get the axis angle from a quaternion. The w value of the quaternion is very much what I want when it comes to this. However I will need to make use of an expression that involves the use of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/acos" target="_blank" rel="external">Math.acos</a> in other to get a workable radian value.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// HELPER FUNCTIONS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> getAxisRadianFromQuaternion = <span class="function">(<span class="params">q</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.acos( q.w );</div><div class="line">&#125;;</div><div class="line"><span class="comment">//-------  ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// Getting axis angle from quaternion</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// creating a quaternion from Euler</span></div><div class="line"><span class="keyword">const</span> e1 = <span class="keyword">new</span> THREE.Euler();</div><div class="line">e1.y = THREE.MathUtils.degToRad(<span class="number">35</span>);</div><div class="line">e1.x = THREE.MathUtils.degToRad(<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> q1 = <span class="keyword">new</span> THREE.Quaternion().setFromEuler(e1);</div><div class="line">mesh1.quaternion.copy(q1);</div><div class="line"><span class="comment">// getting axis angle in radians</span></div><div class="line"><span class="keyword">const</span> radian_axis = getAxisRadianFromQuaternion(q1);</div><div class="line"><span class="built_in">console</span>.log(THREE.MathUtils.radToDeg(radian_axis)); <span class="comment">// 35</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="4-2-Get-axis-vector-method"><a href="#4-2-Get-axis-vector-method" class="headerlink" title="4.2 - Get axis vector method"></a>4.2 - Get axis vector method</h3><p>On top of getting a workable axis angle from a quantization in the event that it is not known I might also end up in situations in which I would want to get a vector3 object of the axis from a quaternion as well.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// helper functions</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> getAxisFromQuaternion = <span class="function">(<span class="params">q</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> s = <span class="number">1</span>;</div><div class="line">  <span class="keyword">if</span> ( !(<span class="number">1</span> - q.w * q.w &lt; <span class="built_in">Number</span>.MIN_VALUE) ) &#123;</div><div class="line">    s = <span class="built_in">Math</span>.sqrt(<span class="number">1</span> - q.w * q.w);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> THREE.Vector3(q.x / s, q.y / s, q.z / s);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> getAxisRadianFromQuaternion = <span class="function">(<span class="params">q</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.acos( q.w );</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get a vector to use to make an arrow for an angle</span></div><div class="line"><span class="keyword">const</span> getAngleVector = <span class="function">(<span class="params">deg</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> v = <span class="keyword">new</span> THREE.Vector3();</div><div class="line">    <span class="keyword">const</span> e = <span class="keyword">new</span> THREE.Euler();</div><div class="line">    e.y = THREE.MathUtils.degToRad(deg);</div><div class="line">    <span class="keyword">return</span> v.set(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>).applyEuler(e);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// create an arrow and set the direction to the given vector3</span></div><div class="line"><span class="keyword">const</span> createArrow = <span class="function">(<span class="params">v3, x</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> arrow = <span class="keyword">new</span> THREE.ArrowHelper();</div><div class="line">    arrow.position.set(x, <span class="number">0.01</span>, <span class="number">0</span>);</div><div class="line">    arrow.setDirection(v3);</div><div class="line">    <span class="keyword">return</span> arrow;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// QUATERNION</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> q = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line"><span class="keyword">const</span> v_axis = <span class="keyword">new</span> THREE.Vector3( <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span> ).normalize();</div><div class="line"><span class="keyword">const</span> deg = <span class="number">360</span> - <span class="number">0.001</span>;</div><div class="line">q.setFromAxisAngle( v_axis, <span class="built_in">Math</span>.PI / <span class="number">180</span> * deg );</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// GET AXIS AND ANGLE FROM QUATERNION</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> v_axis2 = getAxisFromQuaternion(q);</div><div class="line"><span class="keyword">const</span> deg2 = THREE.MathUtils.radToDeg( getAxisRadianFromQuaternion(q)  );</div><div class="line"><span class="built_in">console</span>.log( v_axis, deg);</div><div class="line"><span class="built_in">console</span>.log( v_axis2, deg2 );</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line">scene.add( createArrow(v_axis, <span class="number">0</span>) );</div><div class="line">scene.add( createArrow(v_axis2, <span class="number">1</span>) );</div><div class="line">scene.add( createArrow(getAngleVector(deg), <span class="number">0</span>) );</div><div class="line">scene.add( createArrow(getAngleVector(deg2), <span class="number">1</span>) );</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>);</div><div class="line">camera.lookAt(<span class="number">0.5</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="5-Sphere-rotation-animation-loop-project-using-the-Quaternion-Class"><a href="#5-Sphere-rotation-animation-loop-project-using-the-Quaternion-Class" class="headerlink" title="5 - Sphere rotation animation loop project using the Quaternion Class"></a>5 - Sphere rotation animation loop project using the Quaternion Class</h2><p>Thus far I have one decent animation loop example that I have made for this post that makes use of several features of the Quaternion Class. The goal here is to rotate a sphere, but do so in a way in which I am always rotating the sphere on the axis. This means that I am always going to want to have the very top and bottom of this sphere lined up with the axis. I am then going to want to move the axis around while always rotating the sphere on this axis. So then in a way I am going to need to always preform two rotations, one to make the sphere lined up with the axis, and then another to rotate it on the axis.</p>
<iframe class="youtube_video" src="https://www.youtube.com/embed/C_BMlJqrJIc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// OBJECTS</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>,<span class="number">10</span> ) );</div><div class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">16</span>, <span class="number">16</span>);</div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;<span class="attr">wireframe</span>: <span class="literal">true</span>, <span class="attr">wireframeLinewidth</span>: <span class="number">3</span>&#125;);</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( geo, material);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> arrowHelper = <span class="keyword">new</span> THREE.ArrowHelper();</div><div class="line">arrowHelper.setLength(<span class="number">1.5</span>);</div><div class="line">arrowHelper.line.material.linewidth = <span class="number">6</span>;</div><div class="line">scene.add(arrowHelper);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">900</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> v_up = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> a1 = frame / frameMax;</div><div class="line">    <span class="keyword">const</span> a2 = <span class="number">0.75</span> - <span class="number">0.75</span> * a1; <span class="comment">//1 - Math.abs(0.5 - (a1 * 4 % 1)) / 0.5;</span></div><div class="line">    <span class="keyword">const</span> a3 = a1 * <span class="number">1</span> % <span class="number">1</span>;</div><div class="line">    <span class="keyword">const</span> a4 = a1 * <span class="number">6</span> % <span class="number">1</span>;</div><div class="line">    <span class="comment">// axis vector</span></div><div class="line">    <span class="keyword">const</span> v_axis = v_up.clone();</div><div class="line">    <span class="keyword">const</span> e = <span class="keyword">new</span> THREE.Euler();</div><div class="line">    e.y = <span class="built_in">Math</span>.PI / <span class="number">180</span> * ( <span class="number">180</span> * a2);</div><div class="line">    e.z = <span class="built_in">Math</span>.PI / <span class="number">180</span> * ( <span class="number">360</span> * a3 );</div><div class="line">    v_axis.applyEuler(e);</div><div class="line">    <span class="comment">// two Quaternion objects using </span></div><div class="line">    <span class="comment">// setFromUnitVectors and setFromAxisAngle methods</span></div><div class="line">    <span class="keyword">const</span> q1 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">    q1.setFromUnitVectors(v_up, v_axis);</div><div class="line">    mesh1.quaternion.copy(q1);</div><div class="line">    <span class="keyword">const</span> q2 = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">    q2.setFromAxisAngle(v_axis, <span class="built_in">Math</span>.PI * <span class="number">2</span> * a4);</div><div class="line">    <span class="comment">// premultiply with q2</span></div><div class="line">    mesh1.quaternion.premultiply(q2);</div><div class="line">    arrowHelper.setDirection(v_axis);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>There is a whole lot more to wrote about when it comes to these kinds of objects of course. I am sure that I will come around to edit and expand this post a bit now and then sure. However there are many things where I think it would be best to write a whole other post maybe rather than going off the deep end when it comes to future edits of this.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2023/03/24/threejs-quaternion/" data-id="cliqch20u02pgiov1xb1ksf5a" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2023/03/24/threejs-quaternion/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/three-js/">three.js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/03/31/threejs-quaternion-premultiply/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Quaternion premultiply method in threejs
        
      </div>
    </a>
  
  
    <a href="/2023/03/17/threejs-examples-svg-tools/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">SVG tools module threejs example</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2023/03/24/threejs-quaternion/index.html';
    this.page.identifier = '1033';
    this.page.title = 'Quaternion rotation objects in threejs';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.27px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.45px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.18px;">angular</a> <a href="/tags/animation/" style="font-size: 11.82px;">animation</a> <a href="/tags/automation/" style="font-size: 11.82px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.27px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.45px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.64px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.73px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.91px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.36px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.64px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.82px;">express</a> <a href="/tags/games/" style="font-size: 17.27px;">games</a> <a href="/tags/git/" style="font-size: 13.64px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.82px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.55px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.45px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.36px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.73px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.64px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.55px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.55px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.91px;">python</a> <a href="/tags/statistics/" style="font-size: 14.09px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.09px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.36px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/06/09/threejs-vector2/">The Vector2 class for 2D curves, mouse pointers, ect</a>
          </li>
        
          <li>
            <a href="/2023/06/08/linux-dd/">Linux dd command and files</a>
          </li>
        
          <li>
            <a href="/2023/06/07/threejs-lathe-geometry/">Lathe Geometry in threejs</a>
          </li>
        
          <li>
            <a href="/2023/06/06/linux-sysbench/">Linux sysbench command for benchmarking a file system</a>
          </li>
        
          <li>
            <a href="/2023/06/02/threejs-tube-geometry/">Tube Geometry in threejs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2023/03/24/threejs-quaternion/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>