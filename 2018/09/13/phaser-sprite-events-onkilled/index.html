<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>The Sprite onKilled event in phaser | Dustin John Pfister at github pages</title>
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="When making a Phaser ce powered javaScript game project there are of course sprites, and when working with sprites there are useful events. In this post the focus will be on the sprite.events.onKilled">
<meta property="og:type" content="article">
<meta property="og:title" content="The Sprite onKilled event in phaser">
<meta property="og:url" content="https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="When making a Phaser ce powered javaScript game project there are of course sprites, and when working with sprites there are useful events. In this post the focus will be on the sprite.events.onKilled">
<meta property="og:updated_time" content="2018-09-14T21:36:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Sprite onKilled event in phaser">
<meta name="twitter:description" content="When making a Phaser ce powered javaScript game project there are of course sprites, and when working with sprites there are useful events. In this post the focus will be on the sprite.events.onKilled">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83195184-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense -->
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-phaser-sprite-events-onkilled" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/13/phaser-sprite-events-onkilled/" class="article-date"> Published:
  <time datetime="2018-09-14T00:54:00.000Z" itemprop="datePublished">2018-09-13</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2018/09/13/phaser-sprite-events-onkilled/" class="article-date"> Modified:
  <time datetime="2018-09-14T21:36:42.000Z" itemprop="dateModified">2018-09-14</time>
</a>

    <span class="article-date">V1.2</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/phaser/">phaser</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      The Sprite onKilled event in phaser
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>When making a <a href="https://photonstorm.github.io/phaser-ce/" target="_blank" rel="external">Phaser ce</a> powered javaScript game project there are of course sprites, and when working with sprites there are useful events. In this post the focus will be on the <a href="https://photonstorm.github.io/phaser-ce/Phaser.Events.html#onKilled" target="_blank" rel="external">sprite.events.onKilled</a> event in phaser ce. This is a signal that will fire when the sprite.kill method is called, which is very different from sprite.destroy. The kill method is what I would call if I want to set certain values to what would be appropriate if the sprite has been killed, but I do not want to actually destroy the sprite completely. So in this post I will be coving some use case examples for this method.</p>
<a id="more"></a>
<h2 id="1-Start-here"><a href="#1-Start-here" class="headerlink" title="1 - Start here"></a>1 - Start here</h2><p>In this post I am writing about the onKilled event that is fired when a sprite is killed with the sprite.killed method in phaser ce. There is also the onDestroy event that is fired when a sprite is completely removed from the game world, and cache completely. In most projects I like to have a pool of sprite objects that I reuse, rather than the alternative which would be a mechanic where there is no set maximum of enemies that can be in the world. In any case it is good to be ware of both of these events, as well as the many other events that are fired by game objects in phaser ce.</p>
<h3 id="1-1-This-is-a-phaser-ce-2-x-post"><a href="#1-1-This-is-a-phaser-ce-2-x-post" class="headerlink" title="1.1 - This is a phaser ce 2.x post"></a>1.1 - This is a phaser ce 2.x post</h3><p>In this post I am using <a href="https://photonstorm.github.io/phaser-ce/" target="_blank" rel="external">Phaser ce</a> 2.11.0, not the newer phaser 3.x major release of <a href="https://phaser.io/" target="_blank" rel="external">phaser</a>.</p>
<h2 id="2-A-full-example-using-sprite-events-onKilled"><a href="#2-A-full-example-using-sprite-events-onKilled" class="headerlink" title="2 - A full example using sprite.events.onKilled"></a>2 - A full example using sprite.events.onKilled</h2><p>For this posts full working example I made a simple little project that involves a pool of sprites that spawn from the upper left corner of the screen, and then move across the screen, <a href="/2018/07/22/phaser-math-wrap-and-clamp/">wrapping around within the screen</a> when going out of bounds. When a sprite is clicked it looses hp, and will be killed when hp reaches zero. At which point the sprite.events.onKilled event will fire, in this example I have some logic that determines how many points the player should get when killing the enemy.</p>
<h3 id="2-1-My-enemies-js-file"><a href="#2-1-My-enemies-js-file" class="headerlink" title="2.1 - My enemies.js file"></a>2.1 - My enemies.js file</h3><p>So in this example I have an enemies.js file that contains many methods that help with the creating of a group of enemies, that is then used in my main.js file where I create an instance of Phaser.Game, and add some states to it. In this file I make a javaScript object literal, and append a few methods to it including a method that makes use of sprite.events.onKilled.</p>
<h4 id="2-1-1-Staring-off-the-Enemy-module-and-Enemy-setup"><a href="#2-1-1-Staring-off-the-Enemy-module-and-Enemy-setup" class="headerlink" title="2.1.1 - Staring off the Enemy module, and Enemy.setup"></a>2.1.1 - Staring off the Enemy module, and Enemy.setup</h4><p>For this module I went with just the Object literal module pattern, which works fine for this example as it is okay that everything is public. I then start off with a setup method that I will call in a boot state when making the phaser game instance later.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Enemy = &#123;&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// setup a game.data object</span></div><div class="line">Enemy.setup = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">this</span>.game.data = &#123;</div><div class="line"> </div><div class="line">        <span class="attr">maxEnemies</span>: <span class="number">5</span>,</div><div class="line">        <span class="attr">enemies</span>: <span class="literal">null</span>,</div><div class="line">        <span class="attr">score</span>: <span class="number">0</span></div><div class="line"> </div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>When I do call the setup method it will create an append a data object to the game instance when I call it with <a href="/2017/09/21/js-call-apply-and-bind/">Function.call</a>. Just appending a data object to the Phaser.Game instance is a common way to set some game wide variables.</p>
<h4 id="2-1-2-The-Enemy-onKill-handler"><a href="#2-1-2-The-Enemy-onKill-handler" class="headerlink" title="2.1.2 - The Enemy.onKill handler"></a>2.1.2 - The Enemy.onKill handler</h4><p>Here is the handler that I will use with the sprite.events.onKill method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// The onKill method that will be called each time an enemy is killed</span></div><div class="line">Enemy.onKill = <span class="function"><span class="keyword">function</span> (<span class="params">sprite</span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> game = <span class="keyword">this</span>.game,</div><div class="line">    spriteSpeed = (sprite.data.dx + sprite.data.dy) / <span class="number">8</span>,</div><div class="line">    speedBonus = <span class="number">175</span>, <span class="comment">// points bonus for speed.</span></div><div class="line">    perKill = <span class="number">25</span>; <span class="comment">// points per kill</span></div><div class="line"> </div><div class="line">    <span class="comment">// score formula</span></div><div class="line">    game.data.score += perKill + <span class="built_in">Math</span>.floor(spriteSpeed * speedBonus);</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>So in this example each time an enemy is killed a points value will be figured out, and appended to the score property of my game.data object.</p>
<h4 id="2-1-3-The-Enemy-onInputDown-handler"><a href="#2-1-3-The-Enemy-onInputDown-handler" class="headerlink" title="2.1.3 - The Enemy.onInputDown handler"></a>2.1.3 - The Enemy.onInputDown handler</h4><p>So another useful event is the sprite.events.onInputDown event. I this example I will want one of these attached for each sprite as well, so that when one is clicked by the player something happens in this case it looses a single hp point.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// What happens when the player clicks an enemy</span></div><div class="line">Enemy.onInputDown = <span class="function"><span class="keyword">function</span> (<span class="params">enemy</span>) </span>&#123;</div><div class="line"> </div><div class="line">    enemy.data.hp -= <span class="number">1</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> (enemy.data.hp === <span class="number">1</span>) &#123;</div><div class="line">        enemy.frame = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> (enemy.data.hp &lt;= <span class="number">0</span>) &#123;</div><div class="line">        enemy.kill();</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="2-1-4-Generate-Sprite-Data-objects"><a href="#2-1-4-Generate-Sprite-Data-objects" class="headerlink" title="2.1.4 - Generate Sprite Data objects"></a>2.1.4 - Generate Sprite Data objects</h4><p>So this method will create a new data object for a sprite. The sprite.data object is an official phaser ce way of setting some values and methods for a sprite that are specific to the nature of the game itself that I am making. The sprite.data object is not used my phaser itself internally, so it is safe to do whatever seems right with it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// generate a data object for a sprite</span></div><div class="line">Enemy.genSpriteData = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">dx</span>: <span class="built_in">Math</span>.random() * <span class="number">3.5</span> + <span class="number">0.5</span>,</div><div class="line">        <span class="attr">dy</span>: <span class="built_in">Math</span>.random() * <span class="number">3.5</span> + <span class="number">0.5</span>,</div><div class="line">        <span class="attr">hp</span>: <span class="number">2</span></div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>In this example I will just be setting some delta values, and a hit point value.</p>
<h4 id="2-1-5-Make-a-sprite-sheet-with-canvas"><a href="#2-1-5-Make-a-sprite-sheet-with-canvas" class="headerlink" title="2.1.5 - Make a sprite sheet with canvas"></a>2.1.5 - Make a sprite sheet with canvas</h4><p>So this is just a simple demo rather than a real serious game that consists of many lines of code. Never the less I am using sprites, and I will want a way to skin these sprites, even if they are just solid colored boxes. So for many of my examples for these posts I like to use a <a href="/2018/08/04/phaser-spritesheet-from-canvas/">canvas solution for making a sprite sheet</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// make a sprite sheet</span></div><div class="line">Enemy.mkSheet = <span class="function"><span class="keyword">function</span> (<span class="params">game</span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// sprite sheet generated by canvas</span></div><div class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>),</div><div class="line">    ctx = canvas.getContext(<span class="string">'2d'</span>);</div><div class="line">    canvas.width = <span class="number">64</span>;</div><div class="line">    canvas.height = <span class="number">32</span>;</div><div class="line"> </div><div class="line">    <span class="comment">// blue frame</span></div><div class="line">    ctx.fillStyle = <span class="string">'#0000ff'</span>;</div><div class="line">    ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">32</span>, <span class="number">32</span>);</div><div class="line"> </div><div class="line">    <span class="comment">// red frame</span></div><div class="line">    ctx.fillStyle = <span class="string">'#ff0000'</span>;</div><div class="line">    ctx.fillRect(<span class="number">32</span>, <span class="number">0</span>, <span class="number">32</span>, <span class="number">32</span>);</div><div class="line"> </div><div class="line">    game.cache.addSpriteSheet(<span class="string">'sheet-block'</span>, <span class="literal">null</span>, canvas, <span class="number">32</span>, <span class="number">32</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="2-1-6-Create-a-pool-of-enemies"><a href="#2-1-6-Create-a-pool-of-enemies" class="headerlink" title="2.1.6 - Create a pool of enemies"></a>2.1.6 - Create a pool of enemies</h4><p>So because this is an example of sprite.events.onKilled, I will be working with a pool of sprites. This is because of the differences between the sprite.kill, and the sprite.destroy methods. The sprite.kill method will set a bunch of properties of a sprite to a status that is that considered dead. The sprite can then later be reused by using a method like group.getFirstDead, or sprite.revive. This is very different from the sprite.destroy method that will completely remove the sprite from phaser all together.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create a group of enemies</span></div><div class="line">Enemy.createEnemyPool = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">    data = <span class="keyword">this</span>.game.data;</div><div class="line"> </div><div class="line">    <span class="comment">// make data.enemies a new group</span></div><div class="line">    data.enemies = game.add.group();</div><div class="line"> </div><div class="line">    <span class="comment">// make a pool of enemies in the group</span></div><div class="line">    <span class="keyword">while</span> (i &lt; data.maxEnemies) &#123;</div><div class="line"> </div><div class="line">        <span class="keyword">var</span> enemy = data.enemies.create(<span class="number">0</span>, <span class="number">0</span>, <span class="string">'sheet-block'</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// enemy starts out killed</span></div><div class="line">        enemy.kill();</div><div class="line"> </div><div class="line">        <span class="comment">// attach onKilled event</span></div><div class="line">        enemy.events.onKilled.add(Enemy.onKill, <span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// attach on input down event</span></div><div class="line">        enemy.inputEnabled = <span class="literal">true</span>;</div><div class="line">        enemy.events.onInputDown.add(Enemy.onInputDown, <span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        i += <span class="number">1</span>;</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>So I am calling sprite.kill right after making the sprite to start it off in a dead state. I then have another method Enemy.spawn that will revive these at a set rate.</p>
<h4 id="2-1-7-The-spawn-method"><a href="#2-1-7-The-spawn-method" class="headerlink" title="2.1.7 - The spawn method"></a>2.1.7 - The spawn method</h4><p>So here is my spawn method that will be called every second or so in the main state that will run this example.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// re-spawn a dead enemy</span></div><div class="line">Enemy.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> enemies = <span class="keyword">this</span>.game.data.enemies;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> dead = enemies.getFirstDead(<span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">'sheet-block'</span>, <span class="number">0</span>);</div><div class="line"> </div><div class="line">    <span class="comment">// if there is</span></div><div class="line">    <span class="keyword">if</span> (dead) &#123;</div><div class="line"> </div><div class="line">        dead.data = Enemy.genSpriteData();</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Here I am using the group.getFirstDead method to get and revive the first dead sprite in the pool or group of sprites. In the event that they are all alive this method will return null, so i test if it is not before setting a new sprite.data object to it with the genSpriteData helper I made earlier.</p>
<h4 id="2-1-8-An-update-method-for-the-enemies"><a href="#2-1-8-An-update-method-for-the-enemies" class="headerlink" title="2.1.8 - An update method for the enemies"></a>2.1.8 - An update method for the enemies</h4><p>So when I make a module like this I often have an update method as well that will be called each time there is a frame tick in the main game state when making my state objects of the instance of Phaser.Game</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// What needs to happen for each frame tick</span></div><div class="line">Enemy.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> data = <span class="keyword">this</span>.game.data,</div><div class="line">    game = <span class="keyword">this</span>.game;</div><div class="line"> </div><div class="line">    <span class="comment">// loop all enemies</span></div><div class="line">    data.enemies.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">enemy</span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="comment">// step position based on current deltas</span></div><div class="line">        enemy.x = Phaser.Math.wrap(enemy.x += enemy.data.dx, <span class="number">-32</span>, game.world.width + <span class="number">32</span>);</div><div class="line">        enemy.y = Phaser.Math.wrap(enemy.y += enemy.data.dy, <span class="number">-32</span>, game.world.height + <span class="number">32</span>);</div><div class="line"> </div><div class="line">    &#125;);</div><div class="line"> </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>For this method I am using group.forEach to loop over all sprites an stepping there position with the current deltas in the sprite.data object.</p>
<h3 id="2-2-The-Phaser-Game-instance-and-states"><a href="#2-2-The-Phaser-Game-instance-and-states" class="headerlink" title="2.2 - The Phaser.Game instance, and states"></a>2.2 - The Phaser.Game instance, and states</h3><p>So now to tie everything to together with a Phaser.Game instance an a few state objects. For this example I just have a boot state, and a demo state, I guess I could just have everything in a single state, but I like to start off with this even for simple examples like this one. In a real game there will end up being a lot of state objects, this helps to break things down, making them more fine grain. Fine grain code is often easier to read, and debug.</p>
<h4 id="2-2-1-The-Phaser-Game-instance-and-boot-state"><a href="#2-2-1-The-Phaser-Game-instance-and-boot-state" class="headerlink" title="2.2.1 - The Phaser.Game instance, and boot state"></a>2.2.1 - The Phaser.Game instance, and boot state</h4><p>So like always I create a new instance of Phaser.game, setting a mobile friendly resolution of 32- by 240. I just about always set the renderer to Phaser.AUTO, and often have a div in my html with an id attribute of ‘gamearea’.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> game = <span class="keyword">new</span> Phaser.Game(<span class="number">320</span>, <span class="number">240</span>, Phaser.AUTO, <span class="string">'gamearea'</span>);</div><div class="line"> </div><div class="line">game.state.add(<span class="string">'boot'</span>, &#123;</div><div class="line"> </div><div class="line">    <span class="attr">create</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="comment">// setup game data object</span></div><div class="line">        Enemy.setup.call(<span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        Enemy.mkSheet(<span class="keyword">this</span>.game);</div><div class="line"> </div><div class="line">        Enemy.createEnemyPool.call(<span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// start demo, and do not clear the world</span></div><div class="line">        game.state.start(<span class="string">'demo'</span>, <span class="literal">false</span>, <span class="literal">false</span>);</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>In my boot state I set up the game.data object with the Enemy.setup method, create the sprite sheet with Enemy.mkSheet, and set up the sprite pool with Enemy.createEnemyPool. Once way or another I need to share the instance of Phaser.Game with these methods, by passing them as an argument, or using Function.call to set the value of the this keyword.</p>
<h4 id="2-2-2-The-demo-state"><a href="#2-2-2-The-demo-state" class="headerlink" title="2.2.2 - The demo state"></a>2.2.2 - The demo state</h4><p>I start the game by starting the boot state, that will set some things up, and then start the actual demo state. In the demo state I start a loop that will call Enemy.spawn every second to spawn a new enemy, and create a text display object to display the current player score.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">game.state.add(<span class="string">'demo'</span>, &#123;</div><div class="line"> </div><div class="line">    <span class="attr">create</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="comment">// call Enemy.spawn every second</span></div><div class="line">        game.time.events.loop(<span class="number">1000</span>, Enemy.spawn, <span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        <span class="comment">// text display object to show score</span></div><div class="line">        <span class="keyword">var</span> text = game.add.text(<span class="number">5</span>, <span class="number">5</span>, <span class="string">''</span>, &#123;</div><div class="line">                <span class="attr">fill</span>: <span class="string">'white'</span></div><div class="line">            &#125;);</div><div class="line">        text.name = <span class="string">'disp-score'</span>;</div><div class="line"> </div><div class="line">    &#125;,</div><div class="line"> </div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">        <span class="keyword">var</span> data = <span class="keyword">this</span>.game.data;</div><div class="line"> </div><div class="line">        Enemy.update.call(<span class="keyword">this</span>);</div><div class="line"> </div><div class="line">        game.world.getByName(<span class="string">'disp-score'</span>).text = <span class="string">'score: '</span> + data.score;</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;);</div><div class="line"> </div><div class="line">game.state.start(<span class="string">'boot'</span>);</div></pre></td></tr></table></figure>
<p>In the update method of the demo state I call my Enemy.update method, and update the score to the latest value in the game.data object created with Enemy.setup</p>
<h2 id="3-Conclusion"><a href="#3-Conclusion" class="headerlink" title="3 - Conclusion"></a>3 - Conclusion</h2><p>All of this results in an example where sprites in a pool a revived at a rate of one per second, the player can then click on one to damage it, and again to kill it. Once the sprite is killed the onKilled event that I attached to it fires, and in the body of this method I update the players score.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/" data-id="cjm8dszph00y7mov1ufiwvfz0" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/phaser/">phaser</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/14/phaser-sprite-data/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Phaser Sprite data objects
        
      </div>
    </a>
  
  
    <a href="/2018/09/08/phaser-gameobj-pause/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">The deal with Pausing a game in phaser</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/index.html';
    this.page.identifier = '278';
    this.page.title = 'The Sprite onKilled event in phaser';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.22px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.56px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.89px;">angular</a> <a href="/tags/animation/" style="font-size: 12.78px;">animation</a> <a href="/tags/automation/" style="font-size: 12.78px;">automation</a> <a href="/tags/backbone/" style="font-size: 13.33px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.56px;">blog</a> <a href="/tags/canvas/" style="font-size: 17.22px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.78px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11.11px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.67px;">ejs</a> <a href="/tags/express/" style="font-size: 16.11px;">express</a> <a href="/tags/games/" style="font-size: 17.78px;">games</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 14.44px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.67px;">heroku</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.56px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.67px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.33px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.44px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.89px;">phaser</a> <a href="/tags/statistics/" style="font-size: 12.22px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 16.67px;">three.js</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/10/js-javascript-iframe/">Javascript iframe basics</a>
          </li>
        
          <li>
            <a href="/2019/02/09/js-javascript-let/">Javascript let keyword for declaring block scoped variables</a>
          </li>
        
          <li>
            <a href="/2019/02/08/js-javascript-new/">Javascript new operator examples</a>
          </li>
        
          <li>
            <a href="/2019/02/06/js-javascript-equals/">Javascript == ,===, and more.</a>
          </li>
        
          <li>
            <a href="/2019/02/02/js-operator-precedence/">Operator precedence AKA order of operations in javaScript</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2018/09/13/phaser-sprite-events-onkilled/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>