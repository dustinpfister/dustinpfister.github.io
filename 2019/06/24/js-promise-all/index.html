<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Promise all method for a collection of promises | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2019/06/24/js-promise-all/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="When a whole bunch of tasks need to be accomplished before moving on with things, some or all of which might take a while, one way to do so is with the Promise.all method. This method will return a re">
<meta property="og:type" content="article">
<meta property="og:title" content="Promise all method for a collection of promises">
<meta property="og:url" content="https://dustinpfister.github.io/2019/06/24/js-promise-all/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="When a whole bunch of tasks need to be accomplished before moving on with things, some or all of which might take a while, one way to do so is with the Promise.all method. This method will return a re">
<meta property="og:updated_time" content="2021-11-30T15:25:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Promise all method for a collection of promises">
<meta name="twitter:description" content="When a whole bunch of tasks need to be accomplished before moving on with things, some or all of which might take a while, one way to do so is with the Promise.all method. This method will return a re">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS-Examples</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas-Examples</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-js-promise-all" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/js-promise-all/" class="article-date"> Published:
  <time datetime="2019-06-24T17:03:00.000Z" itemprop="datePublished">2019-06-24</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2019/06/24/js-promise-all/" class="article-date"> Modified:
  <time datetime="2021-11-30T15:25:30.000Z" itemprop="dateModified">2021-11-30</time>
</a>

    <span class="article-date">V1.49</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js/">js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Promise all method for a collection of promises
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>When a whole bunch of tasks need to be accomplished before moving on with things, some or all of which might take a while, one way to do so is with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank" rel="external">Promise.all</a> method. This method will return a resolved promise object when everything that is given to it via an array as the first argument is resolved if a promise, or is something that is not a promise. In Other words the promise all method will only resolve when every element in a given array is a value, or a promise object that has been resolve, rather than rejected. The Promise all method will then only result in a rejected promise if one or more promise in the array reject. So then the array that is given to the promise all method can be a mixed collection of values, some of which can be promises, and things will not continue until all promises in the array are resolved or rejected.</p>
<p>So it goes without saying that the promise all method is fairly useful whenever I am in a situation in which I need to do a whole bunch of async tasks, and then continue with more to do once all of that has completed. The promise all method should be there when it comes to native Promise support, but can also be added when working with older platforms via something like <a href="/2017/12/02/nodejs-bluebird/">bluebird</a>. </p>
<p>So then lets take a look at a few examples of the promise all method in action.</p>
<a id="more"></a>
<h2 id="1-The-basics-of-the-Promise-all-method"><a href="#1-The-basics-of-the-Promise-all-method" class="headerlink" title="1 - The basics of the Promise.all method"></a>1 - The basics of the Promise.all method</h2><p>In this section I will be starting out with the basics of the Promise.all method, starting out with some very simple examples that should help one to get the core idea of what the Promise.all method is all about. I will also be getting into some other examples that are a little involved but should serve well as some what basic example for a nodejs and client side javaScript environment as there are different things to work with in those two different environments.</p>
<p>I trust that you have at least some background when it comes to the very <a href="/2018/11/27/js-getting-started/">basics of javaScript</a> in the client side as well as in <a href="/2017/04/05/nodejs-helloworld/">nodejs</a>. If not you might want to take a step back and come back to promises later, many developers consider promises part of advanced javaScript along with things like <a href="/2019/02/22/js-javascript-closure/">closures</a> and the nature of the <a href="/2017/04/14/js-this-keyword/">this keyword</a>. I will be trying to keep these examples fairly basic and easy to follow at least in the first section, but I am not going to cover every little detail that you should know before hand here.</p>
<h3 id="The-source-code-examples-in-this-post-are-on-github"><a href="#The-source-code-examples-in-this-post-are-on-github" class="headerlink" title="The source code examples in this post are on github"></a>The source code examples in this post are on github</h3><p>The <a href="https://github.com/dustinpfister/test_vjs/tree/master/for_post/js-promise-all" target="_blank" rel="external">source code examples here can be found on github</a> in my test vjs repository. In this repository there is also all the source code examples for all my other <a href="https://dustinpfister.github.io/categories/js/">posts on vanilla javaScript</a>.</p>
<h3 id="1-1-Simple-Promise-all-hello-world-example"><a href="#1-1-Simple-Promise-all-hello-world-example" class="headerlink" title="1.1 - Simple Promise all hello world example"></a>1.1 - Simple Promise all hello world example</h3><p>To start out with this method in just about any javaScript environment that supports promises an array of any kind can be given as the first argument. Often when using this method the array will contain at least one ore more Promise Objects, but that does not have to be the case. In the event that it is an array of primitives that will result in a resolved promise for the call of Promise all so then the next then function call in the Promise chain will be what is called.</p>
<p>So then something like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Promise</span>.all([<span class="string">'Hello'</span>, <span class="string">'world'</span>])</div><div class="line">.then(<span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(array.join(<span class="string">' '</span>));</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.warn(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Will result in the text Hello World being logged to the console. However this is not in any way a typical use case example of the Promise all method, and I could just pass the array to a <a href="/2019/09/18/js-promise-resolve-reject/">Promise.resolve static method</a> call to get the same result. I am just bothering with this to make a point which is that the array that I give to Promise.all can be an array of primitives, or it can also be an array of Promise objects that will resolve or reject in certain situations, or a combination of the two. More on this later in this post, but for now on many at least a few more basic examples are call for.</p>
<h3 id="1-2-Simple-Promise-all-example-with-a-method-that-will-return-a-promise"><a href="#1-2-Simple-Promise-all-example-with-a-method-that-will-return-a-promise" class="headerlink" title="1.2 - Simple Promise all example with a method that will return a promise"></a>1.2 - Simple Promise all example with a method that will return a promise</h3><p>Although The array that is given to the Promise all method can be an array of anything, often it should contain at least one if not more promise objects. When all the Promise objects in the array resolve, then the next then method in the promise chain will be called.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a delayed function that returns a promise</span></div><div class="line"><span class="keyword">let</span> delayed = <span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> st = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            resolve(<span class="keyword">new</span> <span class="built_in">Date</span>() - st);</div><div class="line">        &#125;, ms || <span class="number">1000</span>)</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">// calling the function twice for two elements in an array, and</span></div><div class="line"><span class="comment">// passing that array to the promise all method</span></div><div class="line"><span class="built_in">Promise</span>.all([delayed(<span class="number">10</span>), delayed(<span class="number">1500</span>)])</div><div class="line">.then(<span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(array);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>When calling this source code example I get an array of numbers where each number is the amount of time it took for each of the called of the delay method to finish.</p>
<h3 id="1-3-Simple-resolve-and-reject-example-of-Promise-all"><a href="#1-3-Simple-resolve-and-reject-example-of-Promise-all" class="headerlink" title="1.3 - Simple resolve and reject example of Promise all"></a>1.3 - Simple resolve and reject example of Promise all</h3><p>If Just one of the promise objects in the array reject, then so will the promise all call as a whole and then next catch statement will file in the promise chain for the Promise all call.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> delayed = <span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> st = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            <span class="keyword">let</span> t = <span class="keyword">new</span> <span class="built_in">Date</span>() - st;</div><div class="line">            <span class="keyword">if</span> (t &gt;= <span class="number">1000</span>) &#123;</div><div class="line">                reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'process took to long'</span>))</div><div class="line">            &#125;</div><div class="line">            resolve(t);</div><div class="line">        &#125;, ms || <span class="number">1000</span>)</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="built_in">Promise</span>.all([delayed(<span class="number">10</span>), delayed(<span class="number">985</span>)])</div><div class="line">.then(<span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(array);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="1-4-Promise-all-nodejs-example"><a href="#1-4-Promise-all-nodejs-example" class="headerlink" title="1.4 - Promise all nodejs example"></a>1.4 - Promise all nodejs example</h3><p>Here I have a simple example of Promise all in nodejs 8.x, in this version of nodejs the <a href="/2019/06/22/nodejs-util-promisify/">util promisify method</a> was introduced that can be used to make methods that just make use of a callback, return a promise. I can then use this as a way to make file system methods return promises, which I can then use in an array. This array can then be passed as the first argument for promise all.</p>
<p>So in the example here I am using the util promisify method to make sure that the fs stat method will return a promise when used, and doing the same for the fs read file method. In addition I am doing so in an array, so I have an array of two promise objects and of course I am passing this to the Promise all method as the first argument. Wit that said the promise all method then returns a promise as it should, and just like with any other promise I can call then and catch methods off of it. In the event that and error happens, and I end up with a rejected promise I end up logging an error message, if all goes to plan then it will resolve and the code in the then function call with run. In the body of that then function call I will have access to both a stats object, and the content of the read file call as the array of resolved values will be passed as an argument there.<br>That is a bit of a mouth full, but maybe it is best to just play around with a code example to get a better idea of that the deal is when this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="built_in">Promise</span>.all([</div><div class="line">        util.promisify(fs.stat)(<span class="string">'./text.txt'</span>),</div><div class="line">        util.promisify(fs.readFile)(<span class="string">'./text.txt'</span>)</div><div class="line">    ])</div><div class="line">.then(<span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(a[<span class="number">0</span>].isFile()); <span class="comment">// true</span></div><div class="line">    <span class="built_in">console</span>.log(a[<span class="number">1</span>].constructor.name); <span class="comment">// Buffer</span></div><div class="line">&#125;)</div><div class="line">.catch (<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>If you are using a later version of node, and you do not need to work about pushing backward compatibility back to node 8.x then the code example could be a litter different as some of the later versions of node have files system methods that will return promises anyway. However in any case this simple example of promise all should help give you a basic idea of what the deal is with the promise all method and why it can come in handy now and then.</p>
<h3 id="1-5-Promise-all-client-side-example"><a href="#1-5-Promise-all-client-side-example" class="headerlink" title="1.5 - Promise all client side example"></a>1.5 - Promise all client side example</h3><p>So if a browser does support Promise all it can also be used in the front end as well. New browser technologies such as fetch return promises, and it is also possible to create custom promises as well with the Promise constructor. However there is just one little concern when it comes to browser support, if you care about supporting any version of IE at all you will need to use something that will bring promise all support to those older platforms.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>promise all<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">// get a url with fetch</span></div><div class="line"><span class="keyword">let</span> get = <span class="function">(<span class="params">url</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> fetch(url)</div><div class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> res.body.getReader().read();</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> [].map.call(data.value, (byt) =&gt; &#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode(byt)</div><div class="line">        &#125;).join(<span class="string">''</span>);</div><div class="line">    &#125;)</div><div class="line">&#125;;</div><div class="line"><span class="comment">// delay</span></div><div class="line"><span class="keyword">let</span> delay = <span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            resolve(<span class="string">'delay done'</span>);</div><div class="line">        &#125;, time);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// Promise all</span></div><div class="line"><span class="built_in">Promise</span>.all([get(<span class="string">'https://dustinpfister.github.io/'</span>), delay(<span class="number">3000</span>)])</div><div class="line">.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(result)</div><div class="line">&#125;)</div><div class="line">.catch (<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e);</div><div class="line">&#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-The-array-passed-to-Promise-all-can-be-a-mix-of-Promises-and-static-values"><a href="#2-The-array-passed-to-Promise-all-can-be-a-mix-of-Promises-and-static-values" class="headerlink" title="2 - The array passed to Promise all can be a mix of Promises and static values"></a>2 - The array passed to Promise all can be a mix of Promises and static values</h2><p>I have mentioned this before, but it is worth repeating and having a section on this. The array that you pass to the Promise all method does not have to be an array of promise instances only. It can be a mix of promises and plain old objects, strings, numbers, of any valid javaScript value for an array element. In the event that an element is not a promise that element with just be reorganized as might resolved all ready.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="comment">// returns a promise</span></div><div class="line"><span class="keyword">let</span> read = util.promisify(fs.readFile);</div><div class="line"> </div><div class="line"><span class="comment">// mixed array of promises and other values</span></div><div class="line"><span class="keyword">let</span> mixed = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> hard = [<span class="number">42</span>, <span class="string">'bar'</span>];</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all([read(<span class="string">'file1.txt'</span>), read(<span class="string">'file2.txt'</span>)].concat(hard))</div><div class="line">    .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> result.map(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">return</span> el <span class="keyword">instanceof</span> Buffer ? el.toString() : el;</div><div class="line">        &#125;);</div><div class="line">    &#125;)</div><div class="line">    .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> hard;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">mixed().then(<span class="function">(<span class="params">arr</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(arr);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>In this example I am passing an array that is a concatenation of a hard coded array of values, and an array of promise objects for files that contain additional string values. In the event that all the fires are there, and there is no problem reading them, then an array of the hard values along with the loaded values will be returned. If there is an array of any kind then the hard values will be returned only.</p>
<p>this example could be written differently where the hard coded values are added later, but you get the idea. The array can be of mixed values, and in some cases this might be helpful. Say you need to do something where you start off with some hard coded values, and what is loaded will effect those values. The hard coded values can be just packed up along with everything else and passed down along the promise chain.</p>
<h2 id="3-Array-methods-and-the-Promise-all-method"><a href="#3-Array-methods-and-the-Promise-all-method" class="headerlink" title="3 - Array methods and the Promise all method"></a>3 - Array methods and the Promise all method</h2><p>It is a good idea to know a thing or two about the <a href="/2018/12/10/js-array/">array prototype methods</a> when working with the Promise all method. Mainly the array map and array filter methods, as these are the methods that I find myself using the most often when working with arrays of data, or objects to which I want to create an array of promises for that I would then pass to the Promise all method. So then in this section I am going to be going over a few quick examples of using the promise all method with certain array prototype methods. The basics covered in this section here will then come up in the actually basic project examples that I will be getting to later in this post.</p>
<h3 id="3-1-Array-map"><a href="#3-1-Array-map" class="headerlink" title="3.1 - Array map"></a>3.1 - Array map</h3><p>The <a href="/2020/06/16/js-array-map/">array map method</a> is what I can use to create a new array from a source array where I want to do something for each element in the source array that will then result in the new element for each element in the new array. In this example I have an array of times and I want to create an array of promise objects for each time, for this I can just call the array map method and then just return a promise for each time by calling the delayed method that returns a promse and pass the time for each call of that method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> delayed = <span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> st = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            resolve(<span class="keyword">new</span> <span class="built_in">Date</span>() - st);</div><div class="line">        &#125;, ms || <span class="number">1000</span>)</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">// an array of times</span></div><div class="line"><span class="keyword">let</span> times = [<span class="number">10</span>, <span class="number">1500</span>, <span class="number">100</span>, <span class="number">75</span>, <span class="number">33</span>, <span class="number">150</span>];</div><div class="line"><span class="comment">// using array.map to create a new array of promises</span></div><div class="line"><span class="comment">// my calling delayed method for each element in times array</span></div><div class="line"><span class="built_in">Promise</span>.all(times.map(<span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> delayed(ms);</div><div class="line">&#125;))</div><div class="line">.then(<span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(array);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="3-2-Array-filter"><a href="#3-2-Array-filter" class="headerlink" title="3.2 - Array filter"></a>3.2 - Array filter</h3><p>The <a href="/2020/10/03/js-array-filter/">array filter method</a> is then what I want to use to create a new array, where each element in the new array is something that meets a given condition for elements in the source array. Once again lets take an example similar to that of the map example, but this time say I want to only create an array of promises for each time that is less than one thousand. For this I can use the array filter method to create an array of times that are below one thousand and then call the array map method off of that array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> delayed = <span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> st = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            resolve(<span class="keyword">new</span> <span class="built_in">Date</span>() - st);</div><div class="line">        &#125;, ms || <span class="number">1000</span>)</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">// an array of times</span></div><div class="line"><span class="keyword">let</span> times = [<span class="number">10</span>, <span class="number">1500</span>, <span class="number">33</span>, <span class="number">7500</span>, <span class="number">3000</span>, <span class="number">150</span>];</div><div class="line"><span class="comment">// filtering out times over 1000, and then using map</span></div><div class="line"><span class="built_in">Promise</span>.all(times.filter(<span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> ms &lt; <span class="number">1000</span>;</div><div class="line">&#125;).map(<span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> delayed(ms);</div><div class="line">&#125;))</div><div class="line">.then(<span class="function">(<span class="params">array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(array);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="4-File-walker-use-case-example-of-promise-all"><a href="#4-File-walker-use-case-example-of-promise-all" class="headerlink" title="4 - File walker use case example of promise all"></a>4 - File walker use case example of promise all</h2><p>So say I want to walk a file system path for all items in a path, and then filter out all the folders. After that I want to read all of the files in that path. In nodejs I can use the readdir method to read the contents of a dir, and then I can use promise all for each item in the path, getting the stats for each item. That can the be used to filter out all the folders, at which point I can the use promise all again to read all the files then as well.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="comment">// functions that return a promise</span></div><div class="line"><span class="keyword">let</span> readdir = util.promisify(fs.readdir);</div><div class="line"><span class="keyword">let</span> stat = util.promisify(fs.stat);</div><div class="line"><span class="keyword">let</span> fileData = <span class="function">(<span class="params">path_file</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> stat(path_file).then(<span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">stats</span>: stats,</div><div class="line">            <span class="attr">isFile</span>: stats.isFile(),</div><div class="line">            <span class="attr">fileName</span>: path.basename(path_file),</div><div class="line">            <span class="attr">path_file</span>: path_file</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> readFile = util.promisify(fs.readFile);</div><div class="line"><span class="comment">// lets do it</span></div><div class="line"><span class="keyword">let</span> dir = path.resolve(process.argv[<span class="number">2</span>] || process.cwd());</div><div class="line">readdir(dir)</div><div class="line">.then(<span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(files.map(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">//return stat(path.join(dir, file));</span></div><div class="line">            <span class="keyword">return</span> fileData(path.join(dir, file));</div><div class="line">        &#125;))</div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">fileData</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// filter out folders</span></div><div class="line">    fileData = fileData.filter(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">return</span> data.isFile</div><div class="line">        &#125;);</div><div class="line">    <span class="comment">// read all</span></div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(fileData.map(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">return</span> readFile(path.join(dir, data.fileName), <span class="string">'utf8'</span>);</div><div class="line">        &#125;));</div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</div><div class="line">    results.forEach(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(data);</div><div class="line">    &#125;);</div><div class="line">&#125;)</div><div class="line">.catch (<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(e.message)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>In this example I am also using the util.promisify method as a way to make all the file system module methods that I am using return a promise rather than having to deal with call back hell.</p>
<h2 id="5-Nodejs-promise-all-example-that-has-to-do-with-creating-a-JSON-report-for-a-collection-of-blog-post-files"><a href="#5-Nodejs-promise-all-example-that-has-to-do-with-creating-a-JSON-report-for-a-collection-of-blog-post-files" class="headerlink" title="5 - Nodejs promise all example that has to do with creating a JSON report for a collection of blog post files."></a>5 - Nodejs promise all example that has to do with creating a JSON report for a collection of blog post files.</h2><p>For yet another project example of the Promise all method here is yet another example that runs on top of nodejs, and does not use any npm packages. The goal here is to have some kind of system where I read all the mark down files in a given folder, and create objects for each file found in the given folder. I then write a json file that will contain all of the data that was extracted. For now with this example at least the goal is to just create a collection of objects where each object is just a file name, and also a date, and updated key that is extracted from the top from data of each mark down file.</p>
<h3 id="5-1-The-report-js-file"><a href="#5-1-The-report-js-file" class="headerlink" title="5.1 - The report.js file"></a>5.1 - The report.js file</h3><p>Here I have the javaScript code that I will be using for this example that creates a json report for a collection of mark down files in a given folder. So then this module will export just one public function that I can then use in some kind of main index script that when called is passed a folder that contains markdown files, and a path to a json file to update, or create in the event that it is not there.</p>
<p>When it comes to the Promise all method alone which is of course the theme of this post then the main method of interest to write about here would be the read all method. This method calls the get uri array method that will return a promise that should resolve to an array of file names for each post, that can then be used to create an array of promise objects each of which are a call of the read file method that will return a promise. When each of these promise resolve the end result will then be an object that contains the filename as well as the text that was read from the mark down file. This array of promise objects is then passed to, you guessed it the promise all method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</div><div class="line">readFile = util.promisify(fs.readFile),</div><div class="line">writeFile = util.promisify(fs.writeFile),</div><div class="line">readdir = util.promisify(fs.readdir);</div><div class="line"> </div><div class="line"><span class="keyword">let</span> NEW_REPORT = &#123;</div><div class="line">    <span class="attr">posts</span>: []</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// just get a filtered list of posts for the given dir</span></div><div class="line"><span class="keyword">let</span> get_uri_array = <span class="function">(<span class="params">dir_posts</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> readdir(dir_posts)</div><div class="line">    .then(<span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> files.filter(<span class="function">(<span class="params">fileName</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">return</span> fileName.match(<span class="regexp">/\.md$/</span>) != <span class="literal">null</span>;</div><div class="line">        &#125;);</div><div class="line">    &#125;)</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// read all files returning an array of objects with fileName, and md for each post</span></div><div class="line"><span class="comment">// like this: [&#123;fileName: foo.md, md: 'markdown text of foo.md'&#125;]</span></div><div class="line"><span class="keyword">let</span> readAll = <span class="function">(<span class="params">dir_posts</span>) =&gt;</span> &#123;</div><div class="line">    fileNames = [];</div><div class="line">    <span class="keyword">return</span> get_uri_array(dir_posts)</div><div class="line">    .then(<span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</div><div class="line">        fileNames = files;</div><div class="line">        <span class="keyword">let</span> array = files.map(<span class="function">(<span class="params">fileName</span>) =&gt;</span> &#123;</div><div class="line">                <span class="keyword">return</span> readFile(path.join(dir_posts, fileName), <span class="string">'utf8'</span>)</div><div class="line">                .then(<span class="function">(<span class="params">md</span>) =&gt;</span> &#123;</div><div class="line">                    <span class="keyword">return</span> &#123;</div><div class="line">                        <span class="attr">fileName</span>: fileName,</div><div class="line">                        <span class="attr">md</span>: md</div><div class="line">                    &#125;;</div><div class="line">                &#125;);</div><div class="line">            &#125;);</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.all(array);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// set dates for the array of post objects</span></div><div class="line"><span class="comment">// deleting any md key for each object in any case</span></div><div class="line"><span class="keyword">let</span> setDates = <span class="function">(<span class="params">postObjects</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> patt = <span class="regexp">/---[\s|\S]*?---/g</span>;</div><div class="line">    <span class="keyword">return</span> postObjects.map(<span class="function">(<span class="params">postObj</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> m = postObj.md.match(patt);</div><div class="line">        <span class="keyword">if</span> (m) &#123;</div><div class="line">            m[<span class="number">0</span>].split(<span class="string">'\r\n'</span>).forEach(<span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</div><div class="line">                <span class="keyword">if</span> (str.match(<span class="regexp">/^date/</span>)) &#123;</div><div class="line">                    postObj.date = str.replace(<span class="regexp">/^date:/</span>, <span class="string">''</span>).trim();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (str.match(<span class="regexp">/^updated/</span>)) &#123;</div><div class="line">                    postObj.updated = str.replace(<span class="regexp">/^updated:/</span>, <span class="string">''</span>).trim();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// delete md</span></div><div class="line">        <span class="keyword">delete</span> postObj.md;</div><div class="line">        <span class="keyword">return</span> postObj;</div><div class="line">    &#125;)</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// try to get the given json file and if not found</span></div><div class="line"><span class="comment">// write a new one, in any case return an object that</span></div><div class="line"><span class="comment">// is the parsed json, or a default object used for a new report</span></div><div class="line"><span class="keyword">let</span> getReport = <span class="function"><span class="keyword">function</span> (<span class="params">uri_json</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> readFile(uri_json, <span class="string">'utf8'</span>)</div><div class="line">    .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> json = <span class="built_in">JSON</span>.stringify(NEW_REPORT);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'report not found writing new one'</span>);</div><div class="line">        <span class="keyword">return</span> writeFile(uri_json, json, <span class="string">'utf8'</span>)</div><div class="line">        .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(json);</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(json);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// export</span></div><div class="line"><span class="keyword">let</span> api = <span class="function">(<span class="params">dir_posts, uri_json</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> report = &#123;&#125;;</div><div class="line">    <span class="keyword">return</span> getReport(uri_json)</div><div class="line">    .then(<span class="function">(<span class="params">loadedReport</span>) =&gt;</span> &#123;</div><div class="line">        report = loadedReport;</div><div class="line">        <span class="keyword">return</span> readAll(dir_posts);</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">objects</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">var</span> posts = setDates(objects);</div><div class="line">        report.posts = posts;</div><div class="line">        <span class="keyword">return</span> writeFile(uri_json, <span class="built_in">JSON</span>.stringify(report), <span class="string">'utf8'</span>);</div><div class="line">    &#125;)</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="built_in">module</span>.exports = api;</div></pre></td></tr></table></figure>
<h3 id="5-2-The-index-js-file"><a href="#5-2-The-index-js-file" class="headerlink" title="5.2 - The index.js file"></a>5.2 - The index.js file</h3><p>So I then have a index.js file that will make use of this report module that I have above. I just require in the module, and see about calling the main method that is exported by the module. The result of which is then a json file being crated for each of the demo posts that I have in my test project folder.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">report = <span class="built_in">require</span>(path.join(__dirname, <span class="string">'report.js'</span>));</div><div class="line"> </div><div class="line">report(path.join(__dirname, <span class="string">'posts'</span>), path.join(__dirname, <span class="string">'report.json'</span>))</div><div class="line">.then(<span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'report done'</span>);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.warn(e.message);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The end result of the report is then just a collection of objects for each markdown file that contain just the file name as well as updated and date keys extracted from the files header data. That is all that I wanted to do for this example at least, but there is taking this and making at least one or two more scripts that will do a bot more than just that such as tabulate things that I might want to know for a massive collection of text files.</p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6 - Conclusion"></a>6 - Conclusion</h2><p>So the <a href="https://www.freecodecamp.org/news/promise-all-in-javascript-with-example-6c8c5aea3e32/" target="_blank" rel="external">promise all method</a> can be used as a way to create a promise with an array of promises and other mixed values that will resolve when all of the promises in the array resolve, or contain values that are not a promise. In other words if I am every in a situation in whichI need to do create not just one promise but a whole bunch of them, then the promise all method is what I want to use to get things done.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2019/06/24/js-promise-all/" data-id="cl6gvnzlv00x7r8v11j8xj7kp" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2019/06/24/js-promise-all/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/25/hapi-plugins/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Plugins in hapi js
        
      </div>
    </a>
  
  
    <a href="/2019/06/24/hapi-views/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Setting up a view in hapi js</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2019/06/24/js-promise-all/index.html';
    this.page.identifier = '488';
    this.page.title = 'Promise all method for a collection of promises';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.5px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.5px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.5px;">angular</a> <a href="/tags/animation/" style="font-size: 12px;">animation</a> <a href="/tags/automation/" style="font-size: 12px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.5px;">backbone</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.5px;">canvas</a> <a href="/tags/corejs/" style="font-size: 13px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.5px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.5px;">express</a> <a href="/tags/games/" style="font-size: 17px;">games</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 12px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.5px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.5px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.5px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.5px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.5px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.5px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.5px;">python</a> <a href="/tags/statistics/" style="font-size: 14px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/05/threejs-examples-camera-kit/">Camera Kit module threejs example</a>
          </li>
        
          <li>
            <a href="/2022/07/29/threejs-examples-aplerp/">An advanced Lerping module threejs example</a>
          </li>
        
          <li>
            <a href="/2022/07/22/threejs-capsule-geometry/">Capsule geometry in threejs</a>
          </li>
        
          <li>
            <a href="/2022/07/15/threejs-examples-object-grid-wrap-land/">THREEJS Looping land animation using the Object grid wrap module</a>
          </li>
        
          <li>
            <a href="/2022/07/08/threejs-examples-weird-face-one/">Weird face one threejs example</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS-Examples</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas-Examples</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2019/06/24/js-promise-all/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>