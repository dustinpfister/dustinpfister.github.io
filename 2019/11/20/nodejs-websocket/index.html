<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Node websocket simple vanilla javaScript example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2019/11/20/nodejs-websocket/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="So you want to get break ground with a node websocket project, and so you want to write everything vanilla javaScript style? First things first, reconsider and just use a package such as websocket-nod">
<meta property="og:type" content="article">
<meta property="og:title" content="Node websocket simple vanilla javaScript example">
<meta property="og:url" content="https://dustinpfister.github.io/2019/11/20/nodejs-websocket/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="So you want to get break ground with a node websocket project, and so you want to write everything vanilla javaScript style? First things first, reconsider and just use a package such as websocket-nod">
<meta property="og:updated_time" content="2020-01-31T19:47:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node websocket simple vanilla javaScript example">
<meta name="twitter:description" content="So you want to get break ground with a node websocket project, and so you want to write everything vanilla javaScript style? First things first, reconsider and just use a package such as websocket-nod">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83195184-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image-->
        <div class="selfimage"></div>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

<!-- adding my canvas thing ( Dustin ) -->
<script src="/js/the_matrix.js"></script>
      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-nodejs-websocket" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/20/nodejs-websocket/" class="article-date"> Published:
  <time datetime="2019-11-20T22:16:00.000Z" itemprop="datePublished">2019-11-20</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2019/11/20/nodejs-websocket/" class="article-date"> Modified:
  <time datetime="2020-01-31T19:47:39.000Z" itemprop="dateModified">2020-01-31</time>
</a>

    <span class="article-date">V1.12</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Node websocket simple vanilla javaScript example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>So you want to get break ground with a <a href="https://medium.com/@martin.sikora/node-js-websocket-simple-chat-tutorial-2def3a841b61" target="_blank" rel="external">node websocket</a> project, and so you want to write everything vanilla javaScript style? First things first, reconsider and just use a package such as <a href="https://github.com/theturtle32/WebSocket-Node/" target="_blank" rel="external">websocket-node</a>, trust me this one is going to be time consuming. If you still want to just put together a very simple web socket server, and client then this post is my take on doing so.</p>
<p>Again when it comes to using websockets in an actual project you are going to want to use a well supported npm package, there is allot to this, and handing the handshake, and frames is a little complicated. STill if you just want to make a simple node websocket project working just with the core nodejs modules, maybe this post will help you get started at least.</p>
<p>This post will contain a very simple web <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers" target="_blank" rel="external">socket server</a>, and a very basic <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications" target="_blank" rel="external">web socket client</a> in addition to a simple http server that serves the client system.</p>
<a id="more"></a>
<h2 id="1-A-very-simple-node-websocket-project-that-just-streams-simple-text-frames-to-a-client"><a href="#1-A-very-simple-node-websocket-project-that-just-streams-simple-text-frames-to-a-client" class="headerlink" title="1 - A very simple node websocket project that just streams simple text frames to a client"></a>1 - A very simple node websocket project that just streams simple text frames to a client</h2><p>Making a vanilla javaScript node websocket project is little easier said then done. First there must be a handshake between the client and the server, before frames can be sent to the client. Luckily sending frames tot he client is easier then the other way around that I did not get to in this example (again use an npm package for a real project this one gets involved). In Addition once the handshake process is done, I cant just start streaming data to the client, it must be done so following a certain frame format. </p>
<p>The handshake process alone was a little tricky to work out, but I managed to find a way by reading other posts on this topic, and studying the source code of npm packages that do a better job abstracting what needs to happen.</p>
<p>The frame format is also a little tricky, not impossible to follow, but a little tricky. You need to be fairly comfortable on how to work with buffers, and the bitwise or operator. The reason why is because there a certain bits that act is flags, and values to inform a client or server about the size, and other aspects of each frame that is set or received.</p>
<h3 id="1-1-The-node-websocket-module"><a href="#1-1-The-node-websocket-module" class="headerlink" title="1.1 - The node websocket module"></a>1.1 - The node websocket module</h3><p>So first for the module that I worked out to make setting up a simple web socket project easy for me, by abstracting things away. The basic process here is to set up a basic http server, and then allow for it to be upgraded to a web socket server when a proper request is made from the client system with the web socket constructor. Then I just need to use a method that I work out to send simple text frames to the client one frame at a time.</p>
<p>I started out by making just a plain old http server with the node http module, and created an handler for the upgrade event of the http server. From there I call my accept upgrade method passing the request object, and the socket. Inside the body of the accept upgrade method I call my generate accept key method passing just the request object, which gives me the sec-websocket-accept key value to inform the client that the server has accepted the request.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</div><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="comment">// Very Simple Web Socket server</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">opt</span>) =&gt;</span> &#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.port = opt.port || <span class="number">8095</span>;</div><div class="line">    opt.host = opt.host || <span class="string">'localhost'</span>;</div><div class="line">    opt.onReady = opt.onReady || <span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</div><div class="line">        api.sendText(<span class="string">'Hello World'</span>)</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// generate the accept key for the upgrade request</span></div><div class="line">    <span class="keyword">let</span> genAcceptKey = <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> key = req.headers[<span class="string">'sec-websocket-key'</span>],</div><div class="line">        sha1 = crypto.createHash(<span class="string">'sha1'</span>);</div><div class="line">        sha1.update(key + <span class="string">'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'</span>);</div><div class="line">        <span class="keyword">let</span> acceptKey = sha1.digest(<span class="string">'base64'</span>);</div><div class="line">        <span class="keyword">return</span> acceptKey;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// accept upgrade handler for upgrade event</span></div><div class="line">    <span class="keyword">let</span> acceptUpgrade = <span class="function">(<span class="params">req, socket</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// gen accept key</span></div><div class="line">        <span class="keyword">let</span> acceptKey = genAcceptKey(req);</div><div class="line">        <span class="comment">// write response</span></div><div class="line">        socket.write(<span class="string">'HTTP/1.1 101 Web Socket Protocol Handshake\r\n'</span> +</div><div class="line">            <span class="string">'Upgrade: WebSocket\r\n'</span> +</div><div class="line">            <span class="string">'Connection: Upgrade\r\n'</span> +</div><div class="line">            <span class="string">'Sec-WebSocket-Accept: '</span> + acceptKey + <span class="string">'\r\n'</span> +</div><div class="line">            <span class="string">'\r\n'</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// simple send text frame helper</span></div><div class="line">    <span class="keyword">let</span> sendTextFrame = <span class="function"><span class="keyword">function</span> (<span class="params">socket, text</span>) </span>&#123;</div><div class="line">        <span class="keyword">let</span> firstByte = <span class="number">0x00</span>,</div><div class="line">        secondByte = <span class="number">0x00</span>,</div><div class="line">        payloadLength = Buffer.from([<span class="number">0</span>, <span class="number">0</span>]),</div><div class="line">        payload = Buffer.alloc(text.length);</div><div class="line">        payload.write(text);</div><div class="line">        firstByte |= <span class="number">0x80</span>; <span class="comment">// fin bit true</span></div><div class="line">        firstByte |= <span class="number">0x01</span>; <span class="comment">// opt code of 1 (text)</span></div><div class="line">        secondByte |= text.length; <span class="comment">// mask and payload len</span></div><div class="line">        <span class="keyword">let</span> frame = Buffer.concat([Buffer.from([firstByte]), Buffer.from([secondByte]), payload]);</div><div class="line">        socket.write(frame);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create the server</span></div><div class="line">    <span class="keyword">let</span> wsServer = http.createServer();</div><div class="line">    <span class="comment">// upgrade handler</span></div><div class="line">    wsServer.on(<span class="string">'upgrade'</span>, (req, socket, head) =&gt; &#123;</div><div class="line">        <span class="comment">// accept upgrade</span></div><div class="line">        acceptUpgrade(req, socket);</div><div class="line">        <span class="comment">// send simple text frame</span></div><div class="line">        <span class="comment">//sendTextFrame(socket, 'Hello');</span></div><div class="line">        opt.onReady(&#123;</div><div class="line">            <span class="attr">socket</span>: socket,</div><div class="line">            <span class="attr">sendText</span>: <span class="function"><span class="keyword">function</span> (<span class="params">text</span>) </span>&#123;</div><div class="line">                sendTextFrame(<span class="keyword">this</span>.socket, text);</div><div class="line">            &#125;</div><div class="line">        &#125;, socket);</div><div class="line">    &#125;);</div><div class="line">    wsServer.listen(opt.port, opt.host, () =&gt; &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'web socket server is up on port: '</span> + opt.port);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> wsServer;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Once the accept upgrade method is done I then call an on ready callback that will provide an api that contains the socket and a send text method that makes streaming text to the client very simple. For now it is just that one method that I can use to send text to the client one frame at a time, for the sake of this idea that I had for an example, and what I mainly want to do with websockets it works okay. </p>
<p>However web sockets are duplex streams, so It would be nice to work out a better version of this that can also receive frames from the client also, or better yet just use a framework.</p>
<h3 id="1-2-The-server-js-file"><a href="#1-2-The-server-js-file" class="headerlink" title="1.2 - The server.js file"></a>1.2 - The server.js file</h3><p>So now that I have my node websocket module, I can now use it in a project. This main server file I work out sets up a simple web server that will just host a basic client system that is independent of the websocket server. I just need for this server to serve up my simple static client system that I will be getting to later.</p>
<p>It also uses the websocket module to set up a web socket server on a different port at the end of the file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>),</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line"><span class="comment">// dirs</span></div><div class="line">dir_root = path.resolve(__dirname),</div><div class="line">dir_public = path.join(dir_root, <span class="string">'public'</span>),</div><div class="line"><span class="comment">// set ports (just hard coded for now)</span></div><div class="line">port = <span class="number">8090</span>,</div><div class="line">wsPort = <span class="number">8095</span>;</div><div class="line"><span class="comment">// The web server</span></div><div class="line"><span class="keyword">let</span> webServer = http.createServer();</div><div class="line"><span class="comment">// requests for client system</span></div><div class="line">webServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">    <span class="comment">// get the path</span></div><div class="line">    <span class="keyword">let</span> p = path.join(dir_public, req.url);</div><div class="line">    <span class="comment">// get stats of that path</span></div><div class="line">    fs.lstat(p, <span class="function"><span class="keyword">function</span> (<span class="params">e, stat</span>) </span>&#123;</div><div class="line">        <span class="comment">// if error end</span></div><div class="line">        <span class="keyword">if</span> (e) &#123;</div><div class="line">            res.writeHead(<span class="number">500</span>);</div><div class="line">            res.write(<span class="built_in">JSON</span>.stringify(e));</div><div class="line">            res.end();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if stats check it out</span></div><div class="line">        <span class="keyword">if</span> (stat) &#123;</div><div class="line">            <span class="comment">// if it is not a file append index.html to path, and try that</span></div><div class="line">            <span class="keyword">if</span> (!stat.isFile()) &#123;</div><div class="line">                p = path.join(p, <span class="string">'index.html'</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// default encoding to utf-8, and get file extension</span></div><div class="line">            <span class="keyword">let</span> encoding = <span class="string">'utf-8'</span>;</div><div class="line">            <span class="keyword">let</span> ext = path.extname(p).toLowerCase();</div><div class="line">            <span class="comment">// binary encoding if...</span></div><div class="line">            encoding = ext === <span class="string">'.png'</span> ? <span class="string">'binary'</span> : encoding;</div><div class="line">            <span class="comment">// try to read the path</span></div><div class="line">            fs.readFile(p, encoding, <span class="function"><span class="keyword">function</span> (<span class="params">e, file</span>) </span>&#123;</div><div class="line">                <span class="comment">// if error end</span></div><div class="line">                <span class="keyword">if</span> (e) &#123;</div><div class="line">                    res.writeHead(<span class="number">500</span>);</div><div class="line">                    res.write(<span class="built_in">JSON</span>.stringify(e));</div><div class="line">                    res.end();</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// if file, send it out</span></div><div class="line">                <span class="keyword">if</span> (file) &#123;</div><div class="line">                    <span class="comment">// default mime to text/plain</span></div><div class="line">                    <span class="keyword">let</span> mime = <span class="string">'text/plain'</span>;</div><div class="line">                    <span class="comment">// text</span></div><div class="line">                    mime = ext === <span class="string">'.html'</span> ? <span class="string">'text/html'</span> : mime;</div><div class="line">                    mime = ext === <span class="string">'.css'</span> ? <span class="string">'text/css'</span> : mime;</div><div class="line">                    mime = ext === <span class="string">'.js'</span> ? <span class="string">'text/javascript'</span> : mime;</div><div class="line">                    <span class="comment">// images</span></div><div class="line">                    mime = ext === <span class="string">'.png'</span> ? <span class="string">'image/png'</span> : mime;</div><div class="line">                    res.writeHead(<span class="number">200</span>, &#123;</div><div class="line">                        <span class="string">'Content-Type'</span>: mime</div><div class="line">                    &#125;);</div><div class="line">                    res.write(file, encoding);</div><div class="line">                    res.end();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// start server</span></div><div class="line">webServer.listen(port, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hosting client at: '</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'path: '</span> + dir_public);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'port: '</span> + port);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// using my simple web socket lib</span></div><div class="line"><span class="keyword">let</span> sws = <span class="built_in">require</span>(<span class="string">'./server_ws.js'</span>);</div><div class="line">sws(&#123;</div><div class="line">    <span class="attr">port</span>: wsPort,</div><div class="line">    <span class="attr">host</span>: <span class="string">'localhost'</span>,</div><div class="line">    <span class="attr">onReady</span>: <span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</div><div class="line">        setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            api.sendText(<span class="built_in">Math</span>.round(<span class="number">1024</span> + <span class="number">1024</span> * <span class="built_in">Math</span>.random()).toString(<span class="number">16</span>))</div><div class="line">        &#125;, <span class="number">100</span>)</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="1-3-The-public-folder-and-websocket-client"><a href="#1-3-The-public-folder-and-websocket-client" class="headerlink" title="1.3 - The public folder and websocket client"></a>1.3 - The public folder and websocket client</h3><p>Now for the public folder that contains the websocket client system. First the html file that is the index of the client system. Here I just have a single text area element that will be used to log data that is being streamed from the web socket server, and a single script tag that links to my client side javaScript for this.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Basic WebSocket example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>WebSocket example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"log"</span> <span class="attr">cols</span>=<span class="string">"60"</span> <span class="attr">rows</span>=<span class="string">"30"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Here I have the client that just uses the WebSocket constructor to create a new web socket for the server that I have set up, at which point it starts the handshake process. Once that is done, the server starts sending data, and then I just start logging that in the text area element.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:8095/"</span>),</div><div class="line">log = <span class="built_in">document</span>.getElementById(<span class="string">'log'</span>);</div><div class="line">socket.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'okay we opened a connection'</span>);</div><div class="line">&#125;;</div><div class="line">socket.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'we have a message'</span>);</div><div class="line">    <span class="built_in">console</span>.log(e.data.toString());</div><div class="line">    log.value += e.data.toString();</div><div class="line">&#125;;</div><div class="line">socket.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'socket closed'</span>)</div><div class="line">    <span class="keyword">if</span> (e.wasClean) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'clean close'</span>);</div><div class="line">        <span class="built_in">console</span>.log(e.code);</div><div class="line">        <span class="built_in">console</span>.log(e.reason);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'conection died'</span>);</div><div class="line">        <span class="built_in">console</span>.log(e.code);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>So when this project Is up and running the client makes a request to the node websocket server which just goes right ahead and accepts the request, and then just starts sending hex strings every second. This example is not all that practical or interesting, but a real example might be some kind of project that steams progress to the client as it does some server side work such as looping over files.</p>
<h2 id="2-Conclusion"><a href="#2-Conclusion" class="headerlink" title="2 - Conclusion"></a>2 - Conclusion</h2><p>That is it for now, just the one simple node websocket example. If I get around to it I might expand this post to get into more details about websockets. In any case when it comes to using node websockets in a real project I am going to be going with a well supported npm package with this one. Still it was fun to do this in order to gain a deeper understanding of these projects and why they help to make the process of working with web sockets a whole world easier.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2019/11/20/nodejs-websocket/" data-id="ck3hx7hav000ku4v14p52k8ds" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2019/11/20/nodejs-websocket/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/21/nodejs-event/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Node event emitter class
        
      </div>
    </a>
  
  
    <a href="/2019/11/19/nodejs-os/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Node os module examples</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2019/11/20/nodejs-websocket/index.html';
    this.page.identifier = '567';
    this.page.title = 'Node websocket simple vanilla javaScript example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.78px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.56px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.89px;">angular</a> <a href="/tags/animation/" style="font-size: 12.78px;">animation</a> <a href="/tags/automation/" style="font-size: 12.78px;">automation</a> <a href="/tags/backbone/" style="font-size: 13.33px;">backbone</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/canvas/" style="font-size: 17.78px;">canvas</a> <a href="/tags/corejs/" style="font-size: 13.33px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 11.11px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.67px;">ejs</a> <a href="/tags/express/" style="font-size: 16.67px;">express</a> <a href="/tags/games/" style="font-size: 17.22px;">games</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 13.89px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.44px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.56px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.67px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 12.78px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.33px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.44px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.44px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.89px;">phaser</a> <a href="/tags/statistics/" style="font-size: 12.22px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 16.11px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 15.56px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/06/js-value-of/">js value of object method</a>
          </li>
        
          <li>
            <a href="/2020/03/04/canvas-get-point-relative-to-canvas/">Get a point relative to a canvas element rather than window in client side javaScript</a>
          </li>
        
          <li>
            <a href="/2020/03/03/lodash_pull/">The lodash pull method and other ways to remove elements</a>
          </li>
        
          <li>
            <a href="/2020/02/28/js-json-parse/">JSON parse method in javaScript</a>
          </li>
        
          <li>
            <a href="/2020/02/27/js-javascript-example-tax-brackets/">javaScript example tax brackets</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2019/11/20/nodejs-websocket/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>