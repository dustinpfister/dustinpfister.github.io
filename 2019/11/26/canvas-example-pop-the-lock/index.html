<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Pop The Lock Canvas Example Game Clone | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="A long time ago I played a game called pop the lock on android, and managed to end up getting hooked for a while. It was a very simple game that just involved a circle moving along the path of another">
<meta property="og:type" content="article">
<meta property="og:title" content="Pop The Lock Canvas Example Game Clone">
<meta property="og:url" content="https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="A long time ago I played a game called pop the lock on android, and managed to end up getting hooked for a while. It was a very simple game that just involved a circle moving along the path of another">
<meta property="og:updated_time" content="2021-03-20T20:13:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pop The Lock Canvas Example Game Clone">
<meta name="twitter:description" content="A long time ago I played a game called pop the lock on android, and managed to end up getting hooked for a while. It was a very simple game that just involved a circle moving along the path of another">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-canvas-example-pop-the-lock" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/26/canvas-example-pop-the-lock/" class="article-date"> Published:
  <time datetime="2019-11-27T02:22:00.000Z" itemprop="datePublished">2019-11-26</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2019/11/26/canvas-example-pop-the-lock/" class="article-date"> Modified:
  <time datetime="2021-03-20T20:13:01.000Z" itemprop="dateModified">2021-03-20</time>
</a>

    <span class="article-date">V1.57</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/canvas/">canvas</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Pop The Lock Canvas Example Game Clone
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>A long time ago I played a game called <a href="https://play.google.com/store/apps/details?id=com.sm.popTheLock&amp;hl=en_US" target="_blank" rel="external">pop the lock on android</a>, and managed to end up getting hooked for a while. It was a very simple game that just involved a circle moving along the path of another circle, and once it gets close to a target area you need to tap the screen or else you loose, you also loose if you tap to soon. I can then try again and the object is to repeat this process up to a certain count of times to unlock a lock.</p>
<p>I find myself making clones of this game now and then, in part because it is so easy to make a game like this. It is the kind of game where I can make a working clone within just about an hour or so when I am working at my best, sometimes even less than that when it comes to just the basic idea of what it is. However there is so much room of programing things a little differently so that I am making something new rather than something that is just a clone of the same game.</p>
<p>Many of the game prototypes that I have made so far are the kind of projects where it takes a long time to get something together that is just starting to look like a game, but things do not always have to be that way when it comes to this sort of thing, a game can be simple. It is also a great example of what really matters when making a game which is just to make something that is fun, or addictive in a distinct unique way. Often I think that I put way to much time and thought into a game, so it is nice to take a break from that are work on a game like this.</p>
<p>So todays <a href="/2020/03/23/canvas-example/">canvas example</a> will be a game that is a clone of this pop the lock game to some extent, but a little different. I want to play around with the various values that come to mind when making a game like this, and maybe make it work a little differently altogether so it is not just a full rip off of the original. Sense the time that I have started this post I have updated the source code a few times, when I come back to this one I like to experiment with new game modes, and features.</p>
<a id="more"></a>
<p><div id="canvas-app"></div></p>
<script src="/js/canvas-examples/pop-the-lock/1.0.1/pkg.js"></script>

<h2 id="1-The-game-js-module-for-pop-the-lock"><a href="#1-The-game-js-module-for-pop-the-lock" class="headerlink" title="1 - The game.js module for pop the lock"></a>1 - The game.js module for pop the lock</h2><p>For this canvas example I made a game module that will be used to create and return a game state object, as well as provide methods to update that state object.</p>
<p>The game object contains values such as the current degree of the point in motion, and a value that reflects the total number of degrees in the main circle of the game. In addition there is also a target degree, and margin value that can be used to result in a range area in the circle. This range is the area where the payer will score if they make an action such as clicking or touching the canvas when the current degree is in that range. There are also a number of other values that have to do with the rate at which the current degree will move as well as the current direction, and a boolean that indicates that the current degree is in the range.</p>
<p>In recent version of this game I worked out a few methods for creating new target locations. One of which I like to use when it comes to creating trip up locations, and the other is for creating locations that end up farther away from the current degree location. Speaking of trip up locations this is another feature that I added that can help to make a game mode more challenging, when the trip up location feature is active new targets will spawn close to the current degree location give the player little time to react. I also mentioned modes when is another new feature where I am working out more than one way to go about creating this kind of game. I would like to write more about modes, but I think I am going to keep working on this example a great deal more in the coming days, and I would not like to get into it that much at this time.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// MODES</span></div><div class="line">    <span class="keyword">var</span> modeAPI = &#123;&#125;;</div><div class="line">    <span class="keyword">var</span> modes = &#123;&#125;;</div><div class="line">    <span class="comment">// return the shortest distance to the target from the current position</span></div><div class="line">    <span class="keyword">var</span> getDistanceFromTarget = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> utils.shortestDistance(game.deg.current, game.deg.target, game.deg.total);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// helpers</span></div><div class="line">    <span class="keyword">var</span> getInRange = <span class="function"><span class="keyword">function</span> (<span class="params">game</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> game.deg.distance &lt;= game.deg.margin;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a target degree, with degOrgin, percent, and range arguments</span></div><div class="line">    <span class="keyword">var</span> getTarget = <span class="function"><span class="keyword">function</span>(<span class="params">game, degOrgin, per, rangePer</span>)</span>&#123;</div><div class="line">        degOrgin = degOrgin === <span class="literal">undefined</span> ? game.deg.current: degOrgin;</div><div class="line">        per = utils.mod(per === <span class="literal">undefined</span> ? <span class="number">0</span> : per, <span class="number">1</span>);</div><div class="line">        rangePer = utils.clampPer(rangePer === <span class="literal">undefined</span> ? <span class="number">1</span> : rangePer);</div><div class="line">        <span class="keyword">var</span> halfDeg = game.deg.total / <span class="number">2</span>,</div><div class="line">        halfRange = halfDeg * rangePer,</div><div class="line">        homeDeg = utils.mod(degOrgin + halfDeg, game.deg.total),</div><div class="line">        deg = homeDeg - halfRange + (halfRange * <span class="number">2</span> * per);</div><div class="line">        <span class="keyword">return</span> utils.mod(<span class="built_in">Math</span>.round(deg), game.deg.total);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a target degree from a given degOrigin (0 to deg.total) </span></div><div class="line">    <span class="comment">// by a margin (0 to deg.total) in a direction (1, -1)</span></div><div class="line">    <span class="keyword">var</span> getTargetFrom = <span class="function"><span class="keyword">function</span>(<span class="params">game, degOrgin, margin, dir</span>)</span>&#123;</div><div class="line">        margin = margin === <span class="literal">undefined</span> ? <span class="number">0</span> : margin;</div><div class="line">        dir = dir === <span class="literal">undefined</span> ? <span class="number">1</span> : dir;</div><div class="line">        <span class="keyword">return</span> utils.mod(<span class="built_in">Math</span>.round(degOrgin + margin * dir), game.deg.total);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a random target</span></div><div class="line">    <span class="keyword">var</span> getTargetRandom = modeAPI.getTargetRandom = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> getTarget(game, game.deg.current, <span class="built_in">Math</span>.random(), game.range);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a random target that is a 'trip up' target</span></div><div class="line">    <span class="keyword">var</span> getTargetRandomTripUp = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="comment">//var deltaDeg = utils.randomRange(game.tripUp.degMin, game.tripUp.degMax);</span></div><div class="line">        <span class="keyword">var</span> deltaDeg = utils.randomRange(game.tripUp.degRange);</div><div class="line">        <span class="keyword">return</span> getTargetFrom(game, game.deg.current + deltaDeg * game.dir);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create and return a new target</span></div><div class="line">    <span class="keyword">var</span> newTarget = modeAPI.newTarget = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(game.tripUp.count &gt; <span class="number">0</span>)&#123;</div><div class="line">            game.tripUp.count -= <span class="number">1</span>;</div><div class="line">            <span class="keyword">return</span> getTargetRandomTripUp(game);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> roll = <span class="built_in">Math</span>.random();</div><div class="line">        <span class="keyword">if</span>(roll &lt; game.tripUp.chance)&#123;</div><div class="line">            game.tripUp.count = <span class="built_in">Math</span>.floor(utils.randomRange(game.tripUp.countRange));</div><div class="line">            <span class="keyword">return</span> getTargetRandomTripUp(game);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> getTargetRandom(game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// make modes public</span></div><div class="line">    api.modes = modes;</div><div class="line">    <span class="comment">// CREATE and return a main game object</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> game = &#123;                         <span class="comment">// THE MAIN GAME OBJECT</span></div><div class="line">            mode: opt.mode || <span class="string">'freePlay'</span>,    <span class="comment">// current game mode such as 'endurance', or 'freePlay' (see modes object)</span></div><div class="line">            level: <span class="number">1</span>,</div><div class="line">            <span class="attr">targets</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">deg</span>: &#123;                           <span class="comment">// 'degree' object</span></div><div class="line">               perSec: <span class="number">30</span>,                   <span class="comment">// degrees per second</span></div><div class="line">               current: <span class="number">25</span>,                  <span class="comment">// the current 'degree'</span></div><div class="line">               target: <span class="number">0</span>,                    <span class="comment">// the target 'degree'</span></div><div class="line">               total: <span class="number">100</span>,                   <span class="comment">// total number of 'degrees'</span></div><div class="line">               margin: <span class="number">4</span>,                    <span class="comment">// the margin of 'degrees' +- from target that will still count as in range</span></div><div class="line">               distance: <span class="number">0</span>                   <span class="comment">// should be the shortest distance in 'degrees' from target</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">missTrack</span>: &#123;                     <span class="comment">// Miss Tacking (missed target, not clicking to soon)</span></div><div class="line">                canMiss: <span class="literal">false</span>,</div><div class="line">                <span class="attr">count</span>: <span class="number">0</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">clickTrack</span>: &#123;</div><div class="line">                <span class="attr">total</span>: <span class="number">0</span>,                    <span class="comment">// total number of clicks</span></div><div class="line">                hits: <span class="number">0</span>                      <span class="comment">// total number of clicks that are hits</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">tripUp</span>: &#123;                        <span class="comment">// settings for 'tripUp' mode</span></div><div class="line">                count: <span class="number">5</span>,</div><div class="line">                <span class="attr">chance</span>: <span class="number">0.12</span>,</div><div class="line">                <span class="attr">countRange</span>: [<span class="number">3</span>, <span class="number">10</span>],</div><div class="line">                <span class="attr">degRange</span>: [<span class="number">10</span>, <span class="number">20</span>]</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">hp</span>: &#123;                            <span class="comment">// hit points</span></div><div class="line">                active: <span class="literal">false</span>,</div><div class="line">                <span class="attr">current</span>: <span class="number">5</span>,</div><div class="line">                <span class="attr">max</span>: <span class="number">10</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">gameOver</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">win</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">pause</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">range</span>: <span class="number">0.5</span>,                      <span class="comment">// a number (0-1) that will set the range in which a new target can be</span></div><div class="line">            dir: <span class="number">-1</span>,                         <span class="comment">// the direction in which the current degree will change</span></div><div class="line">            inRange: <span class="literal">false</span>,                  <span class="comment">// true if the current degree is in range of the target degree</span></div><div class="line">            score: <span class="number">0</span>                         <span class="comment">// player score</span></div><div class="line">        &#125;;</div><div class="line">        game.deg.target = newTarget(game);</div><div class="line">        modes[game.mode].init(modeAPI, game, opt.modeSettings || &#123;&#125;);</div><div class="line">        game.deg.distance = getDistanceFromTarget(game);</div><div class="line">        game.inRange = getInRange(game);</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(!game.pause &amp;&amp; !game.gameOver)&#123;</div><div class="line">            game.deg.current +=  game.deg.perSec * secs * game.dir;</div><div class="line">        &#125; </div><div class="line">        game.deg.current = utils.mod(game.deg.current, game.deg.total);</div><div class="line">        game.deg.distance = getDistanceFromTarget(game);</div><div class="line">        game.inRange = getInRange(game);</div><div class="line">        <span class="keyword">if</span>(game.inRange)&#123;</div><div class="line">            game.missTrack.canMiss = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(game.missTrack.canMiss &amp;&amp; !game.inRange)&#123;</div><div class="line">            <span class="comment">// call onMiss for the current mode</span></div><div class="line">            modes[game.mode].onMiss(modeAPI,game);</div><div class="line">            game.missTrack.canMiss = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// call update method for the current mode</span></div><div class="line">        modes[game.mode].update(modeAPI, game, secs);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create click handler</span></div><div class="line">    api.click = <span class="function"><span class="keyword">function</span> (<span class="params">game, modeOptions</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!game.pause &amp;&amp; !game.gameOver)&#123;</div><div class="line">            game.clickTrack.total += <span class="number">1</span>;</div><div class="line">            game.clickTrack.hits += game.inRange ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (game.inRange) &#123;</div><div class="line">                game.missTrack.canMiss = <span class="literal">false</span>;</div><div class="line">                game.dir = game.dir === <span class="number">1</span> ? <span class="number">-1</span> : <span class="number">1</span>;</div><div class="line">                </div><div class="line">            &#125;</div><div class="line">            <span class="comment">// call on click for the current mode</span></div><div class="line">            modes[game.mode].onClick(modeAPI, game, modeOptions);</div><div class="line">        &#125;</div><div class="line">        game.pause = <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// load a game mode file</span></div><div class="line">    api.loadMode = <span class="function"><span class="keyword">function</span>(<span class="params">gameMode</span>)</span>&#123;</div><div class="line">        <span class="comment">// props that should default to utils.noop</span></div><div class="line">        [<span class="string">'init'</span>,<span class="string">'update'</span>,<span class="string">'onMiss'</span>,<span class="string">'onClick'</span>, <span class="string">'draw'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>&#123;</div><div class="line">            gameMode[key] = gameMode[key] || utils.noop;</div><div class="line">        &#125;);</div><div class="line">        gameMode.key = gameMode.key || <span class="string">'nameMe-'</span> + <span class="built_in">Object</span>.keys(modes).length;</div><div class="line">        gameMode.settings = gameMode.settings || [];</div><div class="line">        gameMode.background = gameMode.background || <span class="string">'#4a4a4a'</span>;</div><div class="line">        gameMode.createBackground = gameMode.createBackground || <span class="literal">false</span>;</div><div class="line">        modes[gameMode.key] = gameMode;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return public api</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>In this module I am making use of a utils library that contains many useful methods such as mathematical modulo. I will be getter to that in a later section in this post.</p>
<p>So now that I have a game module worked out I am going to want to have some additional code that is used to draw the state of one of these game state objects to the canvas. In additional I am also going to want to have some javaScript code that will provide a main app loop, and a state machine that will be needed when it comes to continuing to expand this.</p>
<h2 id="2-The-game-modes-thus-far"><a href="#2-The-game-modes-thus-far" class="headerlink" title="2 - The game modes thus far"></a>2 - The game modes thus far</h2><p>So now that I have a plug in system for game modes I can experiment with different kinds of game modes where I am switching up the rules and settings a little from one game mode to another. The basic idea of the game is simple enough, but I cant help but think that there is so much more that can be done to make the game more interesting. There is having game modes where the player does not have to worry about missing a target, and the smaller circle moves at a fixed speed. There is then ideas for other modes that they player will loose if they miss just a single target, and each target gained will make the smaller circle go faster, and maybe tweak other features to make the game even more intense. So I thought it would be a good idea to start at least a few game mode files to work out these different ideas when it comes to the core logic of the game.</p>
<h3 id="2-1-Free-Play-mode"><a href="#2-1-Free-Play-mode" class="headerlink" title="2.1 - Free Play mode"></a>2.1 - Free Play mode</h3><p>The first mode that I put together is a way to just freely play the game without having to worry about missing a target, or clicking to soon. In this mode missing a taker by being to late, or clicking when the smaller circle is not over a target might still negatively impact the score, however it will not result in an automatic game over also. In fact in this mode the only way to loose is to quit once the player gets board.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">gameMod.loadMode(&#123;</div><div class="line">    <span class="comment">// each game mode should have a key</span></div><div class="line">    key: <span class="string">'freePlay'</span>,</div><div class="line">    <span class="comment">// gameMode state settings for modeSettings object</span></div><div class="line">    settings:[</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSec'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">35</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">10</span>, <span class="number">100</span>]</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="comment">// what to do each time a new game object is created in gameMod.create</span></div><div class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        game.hp.active = <span class="literal">false</span>;</div><div class="line">        game.deg.perSec = modeSettings.perSec || <span class="number">10</span>;</div><div class="line">        game.win = <span class="literal">true</span>;</div><div class="line">        game.score = <span class="number">0</span>;</div><div class="line">        game.perHitScore = <span class="number">0</span>;</div><div class="line">        <span class="comment">// base bonus effect by speed setting</span></div><div class="line">        game.baseBonus = <span class="number">100</span> + <span class="built_in">Math</span>.round(<span class="number">300</span>  * ((modeSettings.perSec - <span class="number">10</span>) / (<span class="number">100</span> - <span class="number">10</span>)));</div><div class="line">        <span class="built_in">console</span>.log( game.baseBonus );</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> hits = game.clickTrack.hits,</div><div class="line">        total = game.clickTrack.total,</div><div class="line">        hitPer = game.clickTrack.hits / total,</div><div class="line">        missLoss = <span class="number">1</span> - (<span class="number">1</span> / (game.missTrack.count + <span class="number">1</span>));</div><div class="line">        hitPer = utils.isNaN(hitPer) ? <span class="number">1</span> : hitPer;</div><div class="line">        <span class="keyword">var</span> bonus = <span class="built_in">Math</span>.floor( game.baseBonus * hitPer * (<span class="number">1</span> - missLoss)) * (total &lt; <span class="number">100</span> ? total / <span class="number">100</span>: <span class="number">1</span>);</div><div class="line">        game.score =  <span class="built_in">Math</span>.floor(game.perHitScore + bonus);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onMiss</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI,game</span>)</span>&#123;</div><div class="line">        game.missTrack.count += <span class="number">1</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (game.inRange) &#123;</div><div class="line">           game.deg.target = modeAPI.newTarget(game);</div><div class="line">           <span class="keyword">var</span> hits = game.clickTrack.hits;</div><div class="line">           <span class="keyword">var</span> perHitScoreDelta = (<span class="number">1</span> - utils.getDimPer(hits, <span class="number">0.125</span>)) * <span class="number">10</span>;</div><div class="line">           game.perHitScore += perHitScoreDelta;</div><div class="line">           game.perHitScore = <span class="built_in">Number</span>( game.perHitScore.toFixed(<span class="number">2</span>) );</div><div class="line">           game.perHitScore = game.perHitScore &gt;= <span class="number">100</span> ? <span class="number">100</span>: game.perHitScore;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// not used by game.js, but used in draw.js</span></div><div class="line">    background: <span class="string">'gray'</span>,</div><div class="line">    <span class="attr">createBackground</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, mode</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gradient = draw.createGradient(sm.ctx, sm.canvas, <span class="built_in">Math</span>.random());</div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        draw.PTL(ctx, canvas, sm.game, <span class="string">'black'</span>);</div><div class="line">        draw.score(ctx, canvas, sm);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="2-2-Sudden-Death-Mode"><a href="#2-2-Sudden-Death-Mode" class="headerlink" title="2.2 - Sudden Death Mode"></a>2.2 - Sudden Death Mode</h3><p>In sudden death mode the game will process to the game over state when the player misses a single target, or clicks to soon. The speed of the smaller circle will increase with each target clicked also, and the speed will continue until the player looses. The object then is to just keep playing until a single miss or early click event happens, and get as many targets in the process of doing so to get a high score.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">gameMod.loadMode(&#123;</div><div class="line">    <span class="attr">key</span>: <span class="string">'sudendeath'</span>,</div><div class="line">    <span class="attr">settings</span>:[</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecLower'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'Start Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">30</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">10</span>, <span class="number">40</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecHigher'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'End Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">80</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">80</span>, <span class="number">100</span>]</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        game.hp.active = <span class="literal">false</span>;</div><div class="line">        game.deg.current = <span class="number">25</span>;</div><div class="line">        game.perSecLower = modeSettings.perSecLower || <span class="number">20</span>;</div><div class="line">        game.perSecHigher = modeSettings.perSecHigher ||<span class="number">85</span>;</div><div class="line">        game.deg.perSec = game.perSecLower;</div><div class="line">        game.deg.target = modeAPI.getTargetRandom(game);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> hits = game.clickTrack.hits;</div><div class="line">        game.score = <span class="built_in">Math</span>.floor(hits + <span class="built_in">Math</span>.pow(<span class="number">1.075</span>, hits)) - <span class="number">1</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onMiss</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        game.missTrack.count = <span class="number">1</span>;</div><div class="line">        game.gameOver = <span class="literal">true</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (game.inRange) &#123;</div><div class="line">            game.deg.target = modeAPI.getTargetRandom(game);</div><div class="line">            game.level += <span class="number">1</span>;</div><div class="line">            game.level = game.level &gt; <span class="number">100</span> ? <span class="number">100</span> : game.level;</div><div class="line">            game.deg.perSec = game.perSecLower + <span class="built_in">Math</span>.round( (game.perSecHigher - game.perSecLower) * (game.level / <span class="number">100</span>));</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            game.gameOver = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// Draw</span></div><div class="line">    createBackground: <span class="function"><span class="keyword">function</span>(<span class="params">sm, mode</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gradient = draw.createGradient(sm.ctx, sm.canvas, <span class="number">0.75</span>, [[<span class="number">0</span>,<span class="string">'black'</span>],[<span class="number">1</span>,<span class="string">'red'</span>]]);</div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        draw.PTL(ctx, canvas, sm.game);</div><div class="line">        draw.score(ctx, canvas, sm);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="2-3-Classic-Mode"><a href="#2-3-Classic-Mode" class="headerlink" title="2.3 - Classic Mode"></a>2.3 - Classic Mode</h3><p>The classic mode is called such because the aim in this mode is to reproduce the same game mechanics as the original pop the lock game. One of the main settings of interest is the level setting which can be set to a value between 1 and 100 which is the number of targets that need to be clicked to win the game. Just like sudden death mode the game will come to an end the vary moment that the player misses a single target, but the game will not continue until the game gets to hard to continue also. So in this mode it is possible to win the game, rather than being about how long the player can hold out for until they loose no matter what, or playing until they get board.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">gameMod.loadMode(&#123;</div><div class="line">    <span class="attr">key</span>: <span class="string">'classic'</span>,</div><div class="line">    <span class="attr">settings</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'level'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'Level'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">8</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">1</span>, <span class="number">100</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecLower'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'Start Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">15</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">10</span>, <span class="number">25</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecHigher'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'End Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">35</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">30</span>, <span class="number">80</span>]</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        game.hp.active = <span class="literal">false</span>;</div><div class="line">        game.deg.current = <span class="number">25</span>;</div><div class="line">        game.tripUp.chance = <span class="number">0.1</span>;</div><div class="line">        game.tripUp.degRange = [<span class="number">20</span>, <span class="number">30</span>];</div><div class="line">        game.perSecLower = modeSettings.perSecLower || <span class="number">20</span>;</div><div class="line">        game.perSecHigher = modeSettings.perSecHigher ||<span class="number">70</span>;</div><div class="line">        game.deg.perSec = game.perSecLower;</div><div class="line">        modeSettings.level = game.level = modeSettings.level || <span class="number">1</span>;</div><div class="line">        game.targets = game.level;</div><div class="line">        game.deg.target = modeAPI.getTargetRandom(game);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> hits = game.clickTrack.hits;</div><div class="line">        game.score = hits;</div><div class="line">        game.deg.perSec = game.perSecLower + <span class="built_in">Math</span>.round( (game.perSecHigher - game.perSecLower) * (hits / game.level));</div><div class="line">        game.deg.perSec = game.deg.perSec &gt; game.perSecHigher ? game.perSecHigher : game.deg.perSec;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onMiss</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        game.missTrack.count = <span class="number">1</span>;</div><div class="line">        game.gameOver = <span class="literal">true</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (game.inRange) &#123;</div><div class="line">            game.deg.target = modeAPI.newTarget(game);</div><div class="line">            game.targets -= <span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(game.targets === <span class="number">0</span>)&#123;</div><div class="line">                modeSettings.level += <span class="number">1</span>;</div><div class="line">                modeSettings.level = modeSettings.level &gt; <span class="number">100</span> ? <span class="number">100</span>: modeSettings.level;</div><div class="line">                game.gameOver = <span class="literal">true</span>;</div><div class="line">                game.win = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            game.gameOver = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// Draw</span></div><div class="line">    createBackground: <span class="function"><span class="keyword">function</span>(<span class="params">sm, mode</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gradient = draw.createGradient(sm.ctx, sm.canvas, <span class="number">0.75</span>, [[<span class="number">0</span>,<span class="string">'purple'</span>],[<span class="number">1</span>,<span class="string">'cyan'</span>]]);</div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        draw.PTL(ctx, canvas, sm.game);</div><div class="line">        draw.score(ctx, canvas, sm);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="2-4-Endurance-Mode"><a href="#2-4-Endurance-Mode" class="headerlink" title="2.4 - Endurance Mode"></a>2.4 - Endurance Mode</h3><p>The endurance mode is like sudden death in that the game will keep getting harder with each target. However it is okay if the player misses a target or clicks to soon a few times. Such actions will not result in an automatic game over, however it will deduct health from a hit points bar of sorts.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">gameMod.loadMode(&#123;</div><div class="line">    <span class="attr">key</span>: <span class="string">'endurance'</span>,</div><div class="line">    <span class="attr">settings</span>:[</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecLower'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'Start Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">15</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">10</span>, <span class="number">40</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">key</span>: <span class="string">'perSecHigher'</span>,</div><div class="line">            <span class="attr">disp</span>: <span class="string">'End Speed'</span>,</div><div class="line">            <span class="attr">start</span>: <span class="number">85</span>,</div><div class="line">            <span class="attr">range</span>: [<span class="number">80</span>, <span class="number">100</span>]</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        game.hp.active = <span class="literal">true</span>;</div><div class="line">        game.hp.current = game.hp.max * <span class="number">0.5</span>;</div><div class="line">        game.hp.perSec = <span class="number">0.8</span>;</div><div class="line">        game.deg.current = <span class="number">25</span>;</div><div class="line">        game.perSecLower = modeSettings.perSecLower || <span class="number">20</span>;</div><div class="line">        game.perSecHigher = modeSettings.perSecHigher ||<span class="number">85</span>;</div><div class="line">        game.deg.perSec = game.perSecLower;</div><div class="line">        game.deg.target = modeAPI.getTargetRandom(game);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> hits = game.clickTrack.hits;</div><div class="line">        game.score = <span class="built_in">Math</span>.floor(hits + <span class="built_in">Math</span>.pow(<span class="number">1.075</span>, hits)) - <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(game.hp.current &lt;= <span class="number">0</span>)&#123;</div><div class="line">            game.gameOver = <span class="literal">true</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            game.hp.current += game.hp.perSec * secs;</div><div class="line">            game.hp.current = game.hp.current &gt;= game.hp.max ? game.hp.max : game.hp.current;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onMiss</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game</span>)</span>&#123;</div><div class="line">        game.missTrack.count += <span class="number">1</span>;</div><div class="line">        game.hp.current -= <span class="number">1</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">modeAPI, game, modeSettings</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (game.inRange) &#123;</div><div class="line">            game.deg.target = modeAPI.getTargetRandom(game);</div><div class="line">            game.level += <span class="number">1</span>;</div><div class="line">            game.level = game.level &gt; <span class="number">100</span> ? <span class="number">100</span> : game.level;</div><div class="line">            game.deg.perSec = game.perSecLower + <span class="built_in">Math</span>.round( (game.perSecHigher - game.perSecLower) * (game.level / <span class="number">100</span>));</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            game.hp.current -= <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// Draw</span></div><div class="line">    createBackground: <span class="function"><span class="keyword">function</span>(<span class="params">sm, mode</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gradient = draw.createGradient(sm.ctx, sm.canvas, <span class="number">0.625</span>, [[<span class="number">0</span>,<span class="string">'black'</span>],[<span class="number">1</span>,<span class="string">'lime'</span>]]);</div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        draw.PTL(ctx, canvas, sm.game);</div><div class="line">        draw.score(ctx, canvas, sm);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="3-The-draw-method"><a href="#3-The-draw-method" class="headerlink" title="3 - The draw method"></a>3 - The draw method</h2><p>So now that I have the game state object worked out it is time to work out a draw method for it, as well as some additional draw methods for the project as a whole. In this example I am not doing anything fancy with layering, sprites, and so forth. So I just have a collection of draw methods for drawing things like a solid color background, the current version number, and the current state of things when it comes to the game state object of course. I took the time to break things down into a whole bunch of helper methods, and then have just a few public drawing methods that I will be using in my main.js file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> CIRCLE_RADIUS = <span class="number">200</span>;</div><div class="line">    <span class="keyword">var</span> text_base_center = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_title_center = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        text_base_center(ctx);</div><div class="line">        ctx.font=<span class="string">'50px arial'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_big_center = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        text_base_center(ctx);</div><div class="line">        ctx.font=<span class="string">'40px arial'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_big_left = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        text_base_center(ctx);</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.font=<span class="string">'40px arial'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_med_center = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        text_base_center(ctx);</div><div class="line">        ctx.font=<span class="string">'20px arial'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_small_center = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        text_base_center(ctx);</div><div class="line">        ctx.font=<span class="string">'15px arial'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> text_game_stats = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'lime'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font=<span class="string">'10px arial'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw base circle</span></div><div class="line">    <span class="keyword">var</span> baseCircle = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, style</span>)</span>&#123;</div><div class="line">        ctx.strokeStyle = style || <span class="string">'white'</span>;</div><div class="line">        ctx.lineWidth = <span class="number">6</span>;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.arc(canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>, CIRCLE_RADIUS, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">        ctx.stroke();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw target range</span></div><div class="line">    <span class="keyword">var</span> targetRange = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, game</span>)</span>&#123;</div><div class="line">        ctx.strokeStyle = <span class="string">'red'</span>;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.lineWidth = <span class="number">8</span>;</div><div class="line">        ctx.arc(canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>, CIRCLE_RADIUS,</div><div class="line">            utils.mod(game.deg.target - game.deg.margin, game.deg.total) / game.deg.total * <span class="built_in">Math</span>.PI * <span class="number">2</span>,</div><div class="line">            utils.mod(game.deg.target + game.deg.margin, game.deg.total) / game.deg.total * <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">        ctx.stroke();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw current position</span></div><div class="line">    <span class="keyword">var</span> current_pos = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, game</span>)</span>&#123;</div><div class="line">        ctx.strokeStyle = <span class="string">'blue'</span>;</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.lineWidth = <span class="number">6</span>;</div><div class="line">        <span class="keyword">var</span> r = game.deg.current / game.deg.total * <span class="built_in">Math</span>.PI * <span class="number">2</span>,</div><div class="line">        x = <span class="built_in">Math</span>.cos(r) * CIRCLE_RADIUS + canvas.width / <span class="number">2</span>,</div><div class="line">        y = <span class="built_in">Math</span>.sin(r) * CIRCLE_RADIUS + canvas.height / <span class="number">2</span>;</div><div class="line">        ctx.arc(x, y, <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">        ctx.stroke();</div><div class="line">        ctx.fill();</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> hpBar = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(game.hp.active)&#123;</div><div class="line">            ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">            ctx.fillRect(canvas.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">10</span>);</div><div class="line">            ctx.fillStyle = <span class="string">'lime'</span>;</div><div class="line">            <span class="keyword">var</span> per = game.hp.current / game.hp.max;</div><div class="line">            ctx.fillRect(canvas.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">10</span>, <span class="number">100</span> * per, <span class="number">10</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public api</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// create and return a gradient</span></div><div class="line">    <span class="keyword">var</span> default_stops = [</div><div class="line">        [<span class="number">0</span>, <span class="string">'red'</span>],</div><div class="line">        [<span class="number">0.2</span>, <span class="string">'orange'</span>],</div><div class="line">        [<span class="number">0.4</span>, <span class="string">'yellow'</span>],</div><div class="line">        [<span class="number">0.6</span>, <span class="string">'blue'</span>],</div><div class="line">        [<span class="number">0.8</span>, <span class="string">'cyan'</span>],</div><div class="line">        [<span class="number">1</span>, <span class="string">'lime'</span>]</div><div class="line">    ];</div><div class="line">    api.createGradient = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, angelePer, stops</span>)</span>&#123;</div><div class="line">        angelePer = angelePer === <span class="literal">undefined</span> ? <span class="number">0.125</span> : angelePer;</div><div class="line">        stops = stops || default_stops;</div><div class="line">        <span class="keyword">var</span> size = <span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, [canvas.width, canvas.height]),</div><div class="line">        radius = size / <span class="number">2</span>,</div><div class="line">        radian = <span class="built_in">Math</span>.PI * <span class="number">2</span> * angelePer,</div><div class="line">        sx = canvas.width / <span class="number">2</span> + <span class="built_in">Math</span>.cos(radian) * radius,</div><div class="line">        sy = canvas.height / <span class="number">2</span> + <span class="built_in">Math</span>.sin(radian) * radius,</div><div class="line">        ex = canvas.width / <span class="number">2</span> + <span class="built_in">Math</span>.cos(radian + <span class="built_in">Math</span>.PI) * radius,</div><div class="line">        ey = canvas.height / <span class="number">2</span> + <span class="built_in">Math</span>.sin(radian + <span class="built_in">Math</span>.PI) * radius,</div><div class="line">        gradient = ctx.createLinearGradient(sx, sy, ex, ey);</div><div class="line">        <span class="comment">// Add color stops</span></div><div class="line">        stops.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">st</span>)</span>&#123;</div><div class="line">            gradient.addColorStop.apply(gradient, st);</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// plain background method</span></div><div class="line">    api.background = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, style</span>)</span>&#123;</div><div class="line">        ctx.globalAlpha = <span class="number">1</span>;</div><div class="line">        ctx.fillStyle = style || <span class="string">'black'</span>;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// background</span></div><div class="line">    api.backgroundMode = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        ctx.globalAlpha = <span class="number">1</span>;</div><div class="line">        ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">        <span class="keyword">var</span> mode = gameMod.modes[sm.gameMode];</div><div class="line">        <span class="keyword">if</span>(mode)&#123;</div><div class="line">            ctx.fillStyle = mode.background;</div><div class="line">        &#125;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// Pop The Lock</span></div><div class="line">    api.PTL = <span class="function"><span class="keyword">function</span> (<span class="params">ctx, canvas, game, circleStyle</span>) </span>&#123;</div><div class="line">        baseCircle(ctx, canvas, circleStyle);</div><div class="line">        targetRange(ctx, canvas, game);</div><div class="line">        current_pos(ctx, canvas, game);</div><div class="line">        hpBar(ctx, canvas, game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// score</span></div><div class="line">    <span class="keyword">var</span> scoreModes = &#123;</div><div class="line">        <span class="attr">classic</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm, game</span>)</span>&#123;</div><div class="line">            text_big_center(ctx);</div><div class="line">            <span class="comment">// score</span></div><div class="line">            ctx.fillText(game.targets, canvas.width / <span class="number">2</span>, canvas.height * <span class="number">0.5</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    api.score = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game;</div><div class="line">        <span class="keyword">if</span>(sm.gameMode <span class="keyword">in</span> scoreModes)&#123;</div><div class="line">            scoreModes[sm.gameMode](ctx, canvas, sm, game);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            text_big_center(ctx);</div><div class="line">            <span class="comment">// score</span></div><div class="line">            ctx.fillText(game.score, canvas.width / <span class="number">2</span>, canvas.height * <span class="number">0.25</span>);</div><div class="line">            <span class="comment">// late and miss counts</span></div><div class="line">            text_med_center(ctx);</div><div class="line">            <span class="keyword">var</span> miss = game.clickTrack.total - game.clickTrack.hits;</div><div class="line">            ctx.fillText(<span class="string">'late: '</span> + game.missTrack.count + <span class="string">', miss: '</span> + miss, canvas.width / <span class="number">2</span>, canvas.height * <span class="number">0.35</span>);</div><div class="line">            <span class="comment">// high score for current mode</span></div><div class="line">            text_small_center(ctx);</div><div class="line">            <span class="keyword">var</span> hs = sm.highScores[sm.game.mode];</div><div class="line">            <span class="keyword">if</span>(hs)&#123;</div><div class="line">                ctx.fillText(<span class="string">'High Score: '</span> + hs, canvas.width / <span class="number">2</span>, canvas.height * <span class="number">0.65</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw title text</span></div><div class="line">    api.text_title = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, obj</span>)</span>&#123;</div><div class="line">        text_title_center(ctx);</div><div class="line">        ctx.fillText(<span class="string">'Pop The Lock'</span>, obj.x + obj.w / <span class="number">2</span>, obj.y + obj.h / <span class="number">2</span> );</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw game over text</span></div><div class="line">    api.text_gameover = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game,</div><div class="line">        sx = canvas.width * <span class="number">0.25</span> - <span class="number">120</span>,</div><div class="line">        sy = canvas.height / <span class="number">2</span> - <span class="number">25</span>;</div><div class="line">        text_big_left(ctx);</div><div class="line">        ctx.fillText(game.win ? <span class="string">'You Won!'</span> : <span class="string">'Game Over'</span>, sx, canvas.height * <span class="number">0.25</span>);</div><div class="line">        text_game_stats(ctx);</div><div class="line">        ctx.fillText(<span class="string">'clicks (hits/total): '</span> + game.clickTrack.hits + <span class="string">'/'</span> + game.clickTrack.total, sx, sy + <span class="number">10</span>);</div><div class="line">        ctx.fillText(<span class="string">'miss count: '</span> + game.missTrack.count, sx, sy + <span class="number">20</span>);</div><div class="line">        ctx.fillText(<span class="string">'score: '</span> + game.score, sx, sy + <span class="number">40</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// version</span></div><div class="line">    api.ver = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, sm</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.font=<span class="string">'15px arial'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.fillText(<span class="string">'v'</span> + sm.ver, <span class="number">5</span>, canvas.height - <span class="number">15</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw object pool</span></div><div class="line">    <span class="keyword">var</span> drawPool = <span class="function"><span class="keyword">function</span> (<span class="params">ctx, pool, globalDraw</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.strokeStyle = <span class="string">'black'</span>;</div><div class="line">        ctx.lineWidth = <span class="number">3</span>;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                ctx.save();</div><div class="line">                <span class="keyword">if</span>(obj.data.draw)&#123;</div><div class="line">                    obj.data.draw(ctx, obj, i);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    globalDraw(ctx, obj, i);</div><div class="line">                &#125;</div><div class="line">                ctx.restore();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    api.pool = <span class="function"><span class="keyword">function</span> (<span class="params">ctx, pool</span>) </span>&#123;</div><div class="line">        drawPool(ctx, pool, <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj, i</span>)</span>&#123;</div><div class="line">                ctx.fillStyle = obj.data.fill || <span class="string">'white'</span>;</div><div class="line">                ctx.globalAlpha = obj.data.alpha || <span class="number">1</span>;</div><div class="line">                ctx.translate(obj.x, obj.y);</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.rect(<span class="number">0</span>, <span class="number">0</span>, obj.w, obj.h);</div><div class="line">                ctx.fill();</div><div class="line">                ctx.stroke();</div><div class="line">                <span class="keyword">if</span>(obj.data.disp)&#123;</div><div class="line">                   ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">                   ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">                   ctx.font = <span class="string">'20px arial'</span>;</div><div class="line">                   ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">                   ctx.fillText(obj.data.disp, obj.w / <span class="number">2</span>, obj.h / <span class="number">2</span>);</div><div class="line">                &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// info</span></div><div class="line">    api.debugInfo = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, game</span>)</span>&#123;</div><div class="line">        ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.globalAlpha = <span class="number">0.35</span>;</div><div class="line">        ctx.font = <span class="string">'20px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'deg.current '</span> + game.deg.current.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">20</span>);</div><div class="line">        ctx.fillText(<span class="string">'deg.target '</span> + game.deg.target, <span class="number">10</span>, <span class="number">40</span>);</div><div class="line">        ctx.fillText(<span class="string">'deg.distance '</span> + game.deg.distance.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">60</span>);</div><div class="line">        ctx.fillText(<span class="string">'deg.perSec '</span> + game.deg.perSec.toFixed(<span class="number">2</span>), <span class="number">10</span>, <span class="number">80</span>);</div><div class="line">        ctx.fillText(<span class="string">'trip up count: '</span> + game.tripUp.count, <span class="number">10</span>, <span class="number">100</span>);</div><div class="line">        ctx.fillText(<span class="string">'inrange '</span> + game.inRange, <span class="number">10</span>, <span class="number">120</span>);</div><div class="line">        ctx.fillText(<span class="string">'miss count: '</span> + game.missTrack.count, <span class="number">10</span>, <span class="number">140</span>);</div><div class="line">        ctx.fillText(<span class="string">'clicks (hits/total): '</span> + game.clickTrack.hits + <span class="string">'/'</span> + game.clickTrack.total, <span class="number">10</span>, <span class="number">160</span>);</div><div class="line">        ctx.fillText(<span class="string">'paused: '</span> + game.pause, <span class="number">10</span>, <span class="number">180</span>);</div><div class="line">        ctx.fillText(<span class="string">'mode: '</span> + game.mode, <span class="number">10</span>, <span class="number">200</span>);</div><div class="line">        ctx.fillText(<span class="string">'level: '</span> + game.level, <span class="number">10</span>, <span class="number">220</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>If I put more time into this project this will end up getting broken down into many methods and will be pulled into a file of its one which is often the case with many of these canvas examples.</p>
<h2 id="4-The-utils-lib"><a href="#4-The-utils-lib" class="headerlink" title="4 - The utils lib"></a>4 - The utils lib</h2><p>Like all my other canvas examples these days I have a utils library where I park functions that I will likely use in more than one file in a project, and also might copy and paste over to other utils libraries in other canvas examples. For pop the lock thus far as of version 0.0.0 I am just using my create canvas method that is more or less standard for canvas examples now.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"><span class="comment">// no operation ref</span></div><div class="line">utils.noop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"><span class="comment">// is NaN method</span></div><div class="line">utils.isNaN = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(a) === <span class="string">'NaN'</span> &amp;&amp; <span class="keyword">typeof</span> a != <span class="string">'string'</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get diminishing returns percent value for the given number and base</span></div><div class="line">utils.getDimPer = <span class="function"><span class="keyword">function</span>(<span class="params">n, base</span>)</span>&#123;</div><div class="line">    base = base === <span class="literal">undefined</span> ? <span class="number">2</span> : base;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.log(base - (base - <span class="number">1</span>) * <span class="number">1</span> / (n + <span class="number">1</span>), base) / <span class="built_in">Math</span>.log(base, base);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// distance</span></div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// bounding box</span></div><div class="line">utils.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, w1, h1, x2, y2, w2, h2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !(</div><div class="line">        (y1 + h1) &lt; y2 ||</div><div class="line">        y1 &gt; (y2 + h2) ||</div><div class="line">        (x1 + w1) &lt; x2 ||</div><div class="line">        x1 &gt; (x2 + w2));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// mathematical modulo</span></div><div class="line">utils.mod = <span class="function"><span class="keyword">function</span> (<span class="params">x, m</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (x % m + m) % m;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// clamp a 0 - 1 value</span></div><div class="line">utils.clampPer = <span class="function"><span class="keyword">function</span> (<span class="params">per</span>) </span>&#123;</div><div class="line">    per = per &gt; <span class="number">1</span> ? <span class="number">1</span> : per;</div><div class="line">    per = per &lt; <span class="number">0</span> ? <span class="number">0</span> : per;</div><div class="line">    <span class="keyword">return</span> per;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get a random number between the given range</span></div><div class="line">utils.randomRange = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> x = a, y = b;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> a === <span class="string">'object'</span>)&#123;</div><div class="line">        x = a[<span class="number">0</span>];</div><div class="line">        y = a[<span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> x + (y - x) * <span class="built_in">Math</span>.random();</div><div class="line">&#125;;</div><div class="line"><span class="comment">// normalizeHalf</span></div><div class="line">utils.normalizeHalf = <span class="function"><span class="keyword">function</span>(<span class="params">degree, scale</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> halfScale = scale / <span class="number">2</span>;</div><div class="line">  <span class="keyword">return</span> utils.mod(degree + halfScale, scale) - halfScale;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// shortest distance</span></div><div class="line">utils.shortestDistance = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, scale</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> halfScale = scale / <span class="number">2</span>,</div><div class="line">  diff = utils.normalizeHalf(a - b, scale);</div><div class="line">  <span class="keyword">if</span> (diff &gt; halfScale)&#123;</div><div class="line">    diff = diff - scale;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.abs(diff);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// create a canvas</span></div><div class="line">utils.createCanvas = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.container = opt.container || <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">    opt.canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</div><div class="line">    opt.ctx = opt.canvas.getContext(<span class="string">'2d'</span>);</div><div class="line">    <span class="comment">// assign the 'canvas_example' className</span></div><div class="line">    opt.canvas.className = <span class="string">'canvas_example'</span>;</div><div class="line">    <span class="comment">// set native width</span></div><div class="line">    opt.canvas.width = opt.width === <span class="literal">undefined</span> ? <span class="number">320</span> : opt.width;</div><div class="line">    opt.canvas.height = opt.height === <span class="literal">undefined</span> ? <span class="number">240</span> : opt.height;</div><div class="line">    <span class="comment">// translate by 0.5, 0.5</span></div><div class="line">    opt.ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line">    <span class="comment">// disable default action for onselectstart</span></div><div class="line">    opt.canvas.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line">    opt.canvas.style.imageRendering = <span class="string">'pixelated'</span>;</div><div class="line">    opt.ctx.imageSmoothingEnabled = <span class="literal">false</span>;</div><div class="line">    <span class="comment">// append canvas to container</span></div><div class="line">    opt.container.appendChild(opt.canvas);</div><div class="line">    <span class="keyword">return</span> opt;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get canvas relative point</span></div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect(),</div><div class="line">    pos = &#123;</div><div class="line">        <span class="attr">x</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientX : e.clientX) - bx.left,</div><div class="line">        <span class="attr">y</span>: (e.changedTouches ? e.changedTouches[<span class="number">0</span>].clientY : e.clientY) - bx.top,</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// ajust for native canvas matrix size</span></div><div class="line">    pos.x = <span class="built_in">Math</span>.floor((pos.x / canvas.scrollWidth) * canvas.width);</div><div class="line">    pos.y = <span class="built_in">Math</span>.floor((pos.y / canvas.scrollHeight) * canvas.height);</div><div class="line">    <span class="comment">// prevent default</span></div><div class="line">    e.preventDefault();</div><div class="line">    <span class="keyword">return</span> pos;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// save a state</span></div><div class="line">utils.save = <span class="function"><span class="keyword">function</span>(<span class="params">appName, slotID, state</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> key = appName + <span class="string">'-'</span> + slotID;</div><div class="line">    <span class="keyword">var</span> str = <span class="built_in">JSON</span>.stringify(state);</div><div class="line">    localStorage.setItem(key, str);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// load a state</span></div><div class="line">utils.load = <span class="function"><span class="keyword">function</span>(<span class="params">appName, slotID</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> key = appName + <span class="string">'-'</span> + slotID;</div><div class="line">    <span class="keyword">var</span> str = localStorage.getItem(key);</div><div class="line">    <span class="keyword">if</span>(str)&#123;</div><div class="line">        <span class="keyword">try</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(str);</div><div class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="5-An-Object-pool-module-that-I-am-using-for-buttons-in-the-state-machine"><a href="#5-An-Object-pool-module-that-I-am-using-for-buttons-in-the-state-machine" class="headerlink" title="5 - An Object pool module that I am using for buttons in the state machine"></a>5 - An Object pool module that I am using for buttons in the state machine</h2><p>I wanted to add an object pool module, however for this canvas example the only reason why is more so for the sake of having animated buttons, and maybe a few additional effects. This module is based off of what i worked out in my other canvas example on objects pools, in fact I copied that source code and just made a few changes here and there that I might add in future versions of that canvas example.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> poolMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// get next inactive object in the given pool</span></div><div class="line">    <span class="keyword">var</span> getInactive = <span class="function"><span class="keyword">function</span> (<span class="params">pool</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a new pool</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.count = opt.count || <span class="number">10</span>;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        pool = &#123;</div><div class="line">            <span class="attr">maxSecs</span>: opt.maxSecs || <span class="number">0.125</span>,</div><div class="line">            <span class="attr">objects</span>: [],</div><div class="line">            <span class="attr">data</span>: opt.data || &#123;&#125;,</div><div class="line">            <span class="attr">spawn</span>: opt.spawn || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, opt</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">purge</span>: opt.purge || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">update</span>: opt.update || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, secs</span>) </span>&#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">while</span> (i &lt; opt.count) &#123;</div><div class="line">            pool.objects.push(&#123;</div><div class="line">                <span class="attr">active</span>: <span class="literal">false</span>,</div><div class="line">                <span class="attr">i</span>: i,</div><div class="line">                <span class="attr">x</span>: opt.x === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.x,</div><div class="line">                <span class="attr">y</span>: opt.y === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.y,</div><div class="line">                <span class="attr">w</span>: opt.w === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.w,</div><div class="line">                <span class="attr">h</span>: opt.h === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.h,</div><div class="line">                <span class="attr">heading</span>: opt.heading === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.heading,</div><div class="line">                <span class="attr">pps</span>: opt.pps === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.pps,</div><div class="line">                <span class="attr">lifespan</span>: opt.lifespan || <span class="number">3</span>,</div><div class="line">                <span class="attr">data</span>: &#123;&#125;</div><div class="line">            &#125;);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> pool;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// spawn the next inactive object in the given pool</span></div><div class="line">    api.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">pool, state, opt</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = getInactive(pool);</div><div class="line">        state = state || &#123;&#125;;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (obj) &#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active = <span class="literal">true</span>;</div><div class="line">                pool.spawn.call(pool, obj, pool, state, opt);</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a pool object by a secs value</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">pool, secs, state</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        state = state || &#123;&#125;; <span class="comment">// your projects state object</span></div><div class="line">        secs = secs &gt;= pool.maxSecs ? pool.maxSecs : secs;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                pool.update.call(pool, obj, pool, state, secs);</div><div class="line">                obj.lifespan -= secs;</div><div class="line">                obj.lifespan = obj.lifespan &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.lifespan;</div><div class="line">                <span class="keyword">if</span> (obj.lifespan === <span class="number">0</span>) &#123;</div><div class="line">                    obj.active = <span class="literal">false</span>;</div><div class="line">                    pool.purge.call(pool, obj, pool, state);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// set all to inActive or active state</span></div><div class="line">    api.setActiveStateForAll = <span class="function"><span class="keyword">function</span> (<span class="params">pool, bool</span>) </span>&#123;</div><div class="line">        bool = bool === <span class="literal">undefined</span> ? <span class="literal">false</span> : bool;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            obj.active = bool;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get an active object at the given position, or return false if nothing is there</span></div><div class="line">    api.getObjectAt = <span class="function"><span class="keyword">function</span> (<span class="params">pool, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                <span class="keyword">if</span> (api.boundingBox(obj, &#123;</div><div class="line">                        <span class="attr">x</span>: x,</div><div class="line">                        <span class="attr">y</span>: y,</div><div class="line">                        <span class="attr">w</span>: <span class="number">1</span>,</div><div class="line">                        <span class="attr">h</span>: <span class="number">1</span></div><div class="line">                    &#125;)) &#123;</div><div class="line">                    <span class="keyword">return</span> obj;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move the given object by its current heading and pps</span></div><div class="line">    api.moveByPPS = <span class="function"><span class="keyword">function</span> (<span class="params">obj, secs</span>) </span>&#123;</div><div class="line">        obj.x += <span class="built_in">Math</span>.cos(obj.heading) * obj.pps * secs;</div><div class="line">        obj.y += <span class="built_in">Math</span>.sin(obj.heading) * obj.pps * secs;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move my frame percent object</span></div><div class="line">    <span class="comment">/*</span></div><div class="line">&#123;</div><div class="line">    sx: -100,</div><div class="line">    sy: 0,</div><div class="line">    dist: 100,</div><div class="line">    heading: 0,</div><div class="line">    frame: 0,</div><div class="line">    frameMax: 50,</div><div class="line">    rev: false</div><div class="line">    &#125;</div><div class="line">     */</div><div class="line">    api.moveByFramePerObj = <span class="function"><span class="keyword">function</span> (<span class="params">obj, fp</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> per = fp.frame / fp.frameMax;</div><div class="line">        per = per &gt; <span class="number">1</span> ? <span class="number">1</span> : per;</div><div class="line">        per = per &lt; <span class="number">0</span> ? <span class="number">0</span> : per;</div><div class="line">        per = fp.rev ? <span class="number">1</span> - per : per;</div><div class="line">        obj.x = fp.sx + <span class="built_in">Math</span>.cos(fp.heading) * fp.dist * per;</div><div class="line">        obj.y = fp.sy + <span class="built_in">Math</span>.sin(fp.heading) * fp.dist * per;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// check bounds for the given display object and canvas and return true if the object</span></div><div class="line">    <span class="comment">// is out of bounds and false if it is not.</span></div><div class="line">    api.checkBounds = <span class="function"><span class="keyword">function</span> (<span class="params">obj, canvas</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj.x &gt;= canvas.width || obj.x &lt; obj.w * <span class="number">-1</span> || obj.y &gt; canvas.height || obj.y &lt; obj.h * <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// bounding box</span></div><div class="line">    api.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> utils.boundingBox(a.x, a.y, a.w, a.h, b.x, b.y, b.w, b.h);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return public method</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="6-The-canvas-main-app-loop-and-the-html"><a href="#6-The-canvas-main-app-loop-and-the-html" class="headerlink" title="6 - The canvas, main app loop, and the html"></a>6 - The canvas, main app loop, and the html</h2><p>So now to make use of everything I worked out in a main javaScript file that will proved the main app loop and the state machine. In this main.js file I create a canvas with the create canvas utils method, and get the drawing context to it.</p>
<p>In the main.js file I have started a basic state machine of sorts, as of version 1.0.1 I have a title state, as well as states for game mode settings, the game itself, and a game over state. As I continue working on this project I might get around to starting to break the main.js file down into the main.js file and a much of states define in stand alone javaScript files in a state folder.</p>
<p>In the main app loop I am calling the game module update method of my pop the lock game module, and passing the game object that I created with the game module create method. I am also using the draw method I have worked out to draw the current state of the game state object in the canvas element. I am also of course using request animation frame as always to create the app loop for the canvas example as with just about any other.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// SETUP CANVAS</span></div><div class="line">    <span class="comment">// create and append canvas element, and get 2d context</span></div><div class="line">    <span class="keyword">var</span> canvasObj = utils.createCanvas(&#123;</div><div class="line">            <span class="attr">width</span>: <span class="number">640</span>,</div><div class="line">            <span class="attr">height</span>: <span class="number">480</span></div><div class="line">        &#125;),</div><div class="line">    canvas = canvasObj.canvas,</div><div class="line">    ctx = canvasObj.ctx;</div><div class="line"> </div><div class="line">    <span class="comment">// BUTTON OBJECT POOL</span></div><div class="line">    <span class="keyword">var</span> createButtonPool = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> poolMod.create(&#123;</div><div class="line">            <span class="attr">count</span>: count || <span class="number">20</span>,</div><div class="line">            <span class="attr">maxSecs</span>: <span class="number">0.25</span>,</div><div class="line">            <span class="attr">spawn</span>: <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, sm, opt</span>) </span>&#123;</div><div class="line">                <span class="comment">// just ref opt for the data object</span></div><div class="line">                obj.data = opt;</div><div class="line">                obj.x = opt.hx;</div><div class="line">                obj.y = opt.hy;</div><div class="line">                obj.w = opt.w || <span class="number">128</span>;</div><div class="line">                obj.h = opt.h || <span class="number">32</span>;</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">// update the button</span></div><div class="line">            update: <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, sm, secs</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> fp = &#123;</div><div class="line">                    <span class="attr">sx</span>: obj.data.sx || <span class="number">0</span>,</div><div class="line">                    <span class="attr">sy</span>: obj.data.sy || <span class="number">0</span>,</div><div class="line">                    <span class="attr">dist</span>: obj.data.dist || <span class="number">0</span>,</div><div class="line">                    <span class="attr">heading</span>: obj.data.heading || <span class="number">0</span>,</div><div class="line">                    <span class="attr">frame</span>: <span class="built_in">Math</span>.round(sm.trans.secs / sm.trans.secsTotal * <span class="number">50</span>),</div><div class="line">                    <span class="attr">frameMax</span>: <span class="number">50</span>,</div><div class="line">                    <span class="attr">rev</span>: !sm.trans.inState <span class="comment">// use trans instate bool to ser rev</span></div><div class="line">                &#125;;</div><div class="line">                poolMod.moveByFramePerObj(obj, fp);</div><div class="line">                obj.lifespan = <span class="literal">Infinity</span>; <span class="comment">// keep setting lifespan to 1</span></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// a spawn button helper</span></div><div class="line">    <span class="keyword">var</span> spawnButton = <span class="function"><span class="keyword">function</span>(<span class="params">sm, bx, actionString, dispText, angle, poolKey</span>)</span>&#123;</div><div class="line">        poolKey = poolKey === <span class="literal">undefined</span> ? <span class="string">'buttons'</span> : poolKey;</div><div class="line">        angle = angle === <span class="literal">undefined</span> ? <span class="built_in">Math</span>.PI * <span class="number">0.5</span> : angle;</div><div class="line">        <span class="keyword">var</span> sx = bx.x + <span class="built_in">Math</span>.cos(angle) * sm.canvas.width,</div><div class="line">        sy = bx.y + <span class="built_in">Math</span>.sin(angle) * sm.canvas.width;</div><div class="line">        <span class="keyword">return</span> poolMod.spawn(sm[poolKey], sm, &#123;</div><div class="line">            <span class="attr">action</span>: actionString,</div><div class="line">            <span class="attr">disp</span>: dispText,</div><div class="line">            <span class="attr">sx</span>: sx, <span class="comment">//sm.canvas.width * 0.5 * -1,</span></div><div class="line">            sy: sy, <span class="comment">//sm.canvas.height * 0.4,</span></div><div class="line">            w: bx.w || <span class="number">256</span>,</div><div class="line">            <span class="attr">h</span>: bx.h || <span class="number">64</span>,</div><div class="line">            <span class="attr">dist</span>: utils.distance(bx.x, bx.y, sx, sy), <span class="comment">//sm.canvas.width - 128,</span></div><div class="line">            heading: utils.mod(angle + <span class="built_in">Math</span>.PI, <span class="built_in">Math</span>.PI * <span class="number">2</span>)</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a button by id</span></div><div class="line">    <span class="keyword">var</span> getButtonByAction = <span class="function"><span class="keyword">function</span>(<span class="params">buttonPool, action</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> result = buttonPool.objects.filter(<span class="function"><span class="keyword">function</span>(<span class="params">button</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> button.active &amp;&amp; button.data.action === action;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">if</span>(result.length &gt;= <span class="number">1</span>)&#123;</div><div class="line">            <span class="keyword">return</span> result[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// STATE MACHINE</span></div><div class="line">    <span class="keyword">var</span> sm = &#123;</div><div class="line">        <span class="attr">ver</span>: <span class="string">'1.0.1'</span>,</div><div class="line">        <span class="attr">appName</span>: <span class="string">'canvas-example-pop-the-lock'</span>,</div><div class="line">        <span class="attr">debugMode</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">canvas</span>: canvas,</div><div class="line">        <span class="attr">ctx</span>: ctx,</div><div class="line">        <span class="attr">game</span>: &#123;&#125;,</div><div class="line">        <span class="attr">highScores</span>: &#123;&#125;,</div><div class="line">        <span class="attr">lt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        <span class="attr">currentState</span>: <span class="string">'title'</span>,</div><div class="line">        <span class="attr">gameModeIndex</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">gameMode</span>: <span class="string">''</span>,</div><div class="line">        <span class="attr">modeSettingsCollection</span>: &#123;&#125;,</div><div class="line">        <span class="attr">modeSettings</span>: &#123;&#125;, <span class="comment">// current modeSettingsObject in modeSettingsCollection</span></div><div class="line">        trans: &#123;</div><div class="line">            <span class="attr">active</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">inState</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">secs</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">secsTotal</span>: <span class="number">0.75</span>,</div><div class="line">            <span class="attr">onDone</span>: utils.noop</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">states</span>: &#123;&#125;,</div><div class="line">        <span class="attr">buttons</span>: createButtonPool(<span class="number">20</span>),</div><div class="line">        <span class="attr">dispObjects</span>: createButtonPool(<span class="number">2</span>),</div><div class="line">        <span class="attr">background</span>: <span class="string">'blue'</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// change the current state and set up a 'in' transition for the new state</span></div><div class="line">    <span class="keyword">var</span> changeState = <span class="function"><span class="keyword">function</span> (<span class="params">sm, stateKey</span>) </span>&#123;</div><div class="line">        sm.currentState = stateKey;</div><div class="line">        sm.trans.active = <span class="literal">true</span>;</div><div class="line">        sm.trans.inState = <span class="literal">true</span>;</div><div class="line">        sm.trans.secs = <span class="number">0</span>;</div><div class="line">        <span class="comment">// reset pools</span></div><div class="line">        poolMod.setActiveStateForAll(sm.buttons, <span class="literal">false</span>);</div><div class="line">        poolMod.setActiveStateForAll(sm.dispObjects, <span class="literal">false</span>);</div><div class="line">        <span class="comment">// call init method for the new state</span></div><div class="line">        sm.states[sm.currentState].init(sm);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// start a 'out' transition to a state change</span></div><div class="line">    <span class="keyword">var</span> startStateChangeTrans = <span class="function"><span class="keyword">function</span>(<span class="params">sm, stateKey</span>)</span>&#123;</div><div class="line">        sm.trans.active = <span class="literal">true</span>;</div><div class="line">        sm.trans.inState = <span class="literal">false</span>;</div><div class="line">        sm.trans.secs = <span class="number">0</span>;</div><div class="line">        sm.trans.onDone = <span class="function"><span class="keyword">function</span>(<span class="params">sm</span>)</span>&#123;</div><div class="line">            changeState(sm, stateKey);</div><div class="line">            sm.trans.onDone = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">            sm.trans.onDone = utils.noop;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update state by calling trans or update method</span></div><div class="line">    <span class="keyword">var</span> updateState = <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (sm.trans.active) &#123;</div><div class="line">            <span class="keyword">if</span> (sm.trans.secs &lt; sm.trans.secsTotal) &#123;</div><div class="line">                sm.trans.secs += secs;</div><div class="line">                sm.trans.secs = sm.trans.secs &gt; sm.trans.secsTotal ? sm.trans.secsTotal : sm.trans.secs;</div><div class="line">                <span class="keyword">if</span> (sm.trans.secs === sm.trans.secsTotal) &#123;</div><div class="line">                    sm.trans.active = <span class="literal">false</span>;</div><div class="line">                    sm.trans.onDone(sm);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            sm.states[sm.currentState].trans(sm, secs);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            sm.states[sm.currentState].update(sm, secs);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// TITLE STATE</span></div><div class="line">    sm.states.title = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">            <span class="comment">// Buttons</span></div><div class="line">            <span class="keyword">var</span> x = sm.canvas.width / <span class="number">2</span> - <span class="number">128</span>,</div><div class="line">            y = sm.canvas.height / <span class="number">2</span>;</div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: x, <span class="attr">y</span>: y - <span class="number">64</span>&#125;, <span class="string">'start_state_gameMode'</span>, <span class="string">'Play'</span>);</div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: x, <span class="attr">y</span>: y + <span class="number">32</span>&#125;, <span class="string">'goto_devsite_canvas_examples'</span>, <span class="string">'More Games'</span>, <span class="built_in">Math</span>.PI);</div><div class="line"> </div><div class="line">            <span class="comment">// title display Object</span></div><div class="line">            poolMod.spawn(sm.dispObjects, sm, &#123;</div><div class="line">                <span class="attr">action</span>: <span class="string">'dispobj_title'</span>,</div><div class="line">                <span class="attr">disp</span>: <span class="string">'Pop The Lock'</span>,</div><div class="line">                <span class="attr">sx</span>: sm.canvas.width * <span class="number">1.7</span> * <span class="number">1</span>,</div><div class="line">                <span class="attr">sy</span>: <span class="number">8</span>,</div><div class="line">                <span class="attr">w</span>: <span class="number">512</span>,</div><div class="line">                <span class="attr">h</span>: <span class="number">128</span>,</div><div class="line">                <span class="attr">dist</span>: sm.canvas.width * <span class="number">1.6</span>,</div><div class="line">                <span class="attr">heading</span>: <span class="built_in">Math</span>.PI,</div><div class="line">                <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">                    draw.text_title(ctx, sm.canvas, obj);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="comment">// setup a background</span></div><div class="line">            sm.background = draw.createGradient(sm.ctx, sm.canvas, <span class="number">0.75</span>, [[<span class="number">0</span>,<span class="string">'#cc0000'</span>],[<span class="number">0.25</span>,<span class="string">'purple'</span>],[<span class="number">1</span>,<span class="string">'cyan'</span>]]);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trans</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            poolMod.update(sm.buttons, secs, sm);</div><div class="line">            poolMod.update(sm.dispObjects, secs, sm);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;&#125;,</div><div class="line">        <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">            draw.background(ctx, canvas, sm.background);</div><div class="line">            draw.pool(ctx, sm.buttons);</div><div class="line">            draw.pool(ctx, sm.dispObjects);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">click</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> button = poolMod.getObjectAt(sm.buttons, pos.x, pos.y);</div><div class="line">            <span class="keyword">if</span> (button) &#123;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'start_state_gameMode'</span>)&#123;</div><div class="line">                    startStateChangeTrans(sm, <span class="string">'gameMode'</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'goto_devsite_canvas_examples'</span>)&#123;</div><div class="line">                    <span class="built_in">console</span>.log(<span class="string">'to dev site'</span>);</div><div class="line">                    <span class="built_in">document</span>.location.href = <span class="string">'https://dustinpfister.github.io/2020/03/23/canvas-example/'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// GAME MODE STATE</span></div><div class="line">    <span class="keyword">var</span> spawnSettingsButton = <span class="function"><span class="keyword">function</span>(<span class="params">sm, setting, bx, actionStringPart, dispText, angle, poolKey</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> actionString = <span class="string">'set_modesetting_'</span> + actionStringPart + <span class="string">'_'</span> + setting.key;</div><div class="line">        <span class="keyword">var</span> button = spawnButton(sm, bx, actionString, dispText, angle, poolKey);</div><div class="line">        button.data.setting = setting;</div><div class="line">        <span class="keyword">return</span> button;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// set mode prop helper</span></div><div class="line">    <span class="keyword">var</span> setModeProp = <span class="function"><span class="keyword">function</span>(<span class="params">sm, parts, button, dir</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> modeProp = sm.modeSettings[parts[<span class="number">3</span>]],</div><div class="line">        settingObj = button.data.setting,</div><div class="line">        range = settingObj.range;</div><div class="line">        modeProp += <span class="number">1</span> * dir;</div><div class="line">        sm.modeSettings[parts[<span class="number">3</span>]] = modeProp &gt; range[<span class="number">1</span>] ? range[<span class="number">0</span>]: modeProp;</div><div class="line">        sm.modeSettings[parts[<span class="number">3</span>]] = modeProp &lt; range[<span class="number">0</span>] ? range[<span class="number">1</span>]: modeProp;</div><div class="line">        <span class="keyword">var</span> dispButton = getButtonByAction(sm.buttons, <span class="string">'set_modesetting_current_'</span> + settingObj.key);</div><div class="line">        dispButton.data.disp = settingObj.disp + <span class="string">' '</span> + sm.modeSettings[parts[<span class="number">3</span>]];</div><div class="line">    &#125;;</div><div class="line">    sm.states.gameMode = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">            <span class="comment">// default to whatever key sm.gameModeIndex is for gameMode</span></div><div class="line">            sm.gameMode = <span class="built_in">Object</span>.keys(gameMod.modes)[sm.gameModeIndex];</div><div class="line">            <span class="keyword">var</span> mode = gameMod.modes[sm.gameMode];</div><div class="line">            <span class="keyword">if</span>(mode.createBackground)&#123;</div><div class="line">                mode.background = mode.createBackground(sm, mode);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// ref mode settings object in sm.modeSettingsCollection</span></div><div class="line">            sm.modeSettings = sm.modeSettingsCollection[sm.gameMode];</div><div class="line">            <span class="comment">// create settings buttons</span></div><div class="line">            mode.settings.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">setting, i</span>)</span>&#123;</div><div class="line">                <span class="comment">// down button</span></div><div class="line">                <span class="keyword">var</span> w = <span class="number">64</span>,</div><div class="line">                h = <span class="number">64</span>,</div><div class="line">                x = <span class="number">8</span>,</div><div class="line">                y = <span class="number">64</span> + <span class="number">64</span> * i;</div><div class="line">                <span class="comment">// + / -</span></div><div class="line">                spawnSettingsButton(sm, setting, &#123;<span class="attr">x</span>: x, <span class="attr">y</span>: y, <span class="attr">w</span>: w, <span class="attr">h</span> : h&#125;, <span class="string">'down'</span>, <span class="string">'-'</span>);</div><div class="line">                spawnSettingsButton(sm, setting, &#123;<span class="attr">x</span>: x + w * <span class="number">5</span>, <span class="attr">y</span>: y, <span class="attr">w</span>: w, <span class="attr">h</span> : h&#125;, <span class="string">'up'</span>, <span class="string">'+'</span>);</div><div class="line">                <span class="comment">// setting disp</span></div><div class="line">                w = <span class="number">64</span> * <span class="number">4</span>;</div><div class="line">                spawnSettingsButton(sm, setting, </div><div class="line">                  &#123;<span class="attr">x</span>: x + <span class="number">64</span> * <span class="number">1</span>, <span class="attr">y</span>: y, <span class="attr">w</span>: w, <span class="attr">h</span> : h&#125;, </div><div class="line">                  <span class="string">'current'</span>, </div><div class="line">                   setting.disp + <span class="string">' '</span> + sm.modeSettings[setting.key]);</div><div class="line">            &#125;);</div><div class="line">            <span class="comment">// next mode button</span></div><div class="line">            <span class="keyword">var</span> w = <span class="number">64</span>,</div><div class="line">            h = <span class="number">64</span>;</div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: canvas.width - <span class="number">80</span>, <span class="attr">y</span>: <span class="number">200</span>, <span class="attr">w</span>: w, <span class="attr">h</span>: h&#125;, <span class="string">'set_mode_next'</span>, <span class="string">'Next'</span>);</div><div class="line">            <span class="comment">// start game button</span></div><div class="line">            <span class="keyword">var</span> w = <span class="number">250</span>,</div><div class="line">            h = <span class="number">64</span>;</div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: canvas.width - <span class="number">275</span>, <span class="attr">y</span>: canvas.height - <span class="number">80</span>, <span class="attr">w</span>: w, <span class="attr">h</span>: h&#125;, <span class="string">'start_game'</span>, <span class="string">'Start'</span>);</div><div class="line">            <span class="comment">// back to title</span></div><div class="line">            w = <span class="number">125</span>;</div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: canvas.width - <span class="number">150</span>, <span class="attr">y</span>: <span class="number">32</span>, <span class="attr">w</span>: w, <span class="attr">h</span>: h&#125;, <span class="string">'start_title'</span>, <span class="string">'Title'</span>);</div><div class="line">            <span class="comment">// current mode display Object</span></div><div class="line">            <span class="keyword">var</span> disp = spawnButton(sm, &#123;<span class="attr">x</span>: <span class="number">8</span>, <span class="attr">y</span>: <span class="number">8</span>, <span class="attr">w</span>: <span class="number">200</span>, <span class="attr">h</span>: <span class="number">32</span>&#125;, <span class="string">'dispobj_currentMode'</span>, sm.gameMode, <span class="number">0</span>, <span class="string">'dispObjects'</span>);</div><div class="line">            disp.data.draw = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">                ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">                ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">                ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">                ctx.font=<span class="string">'50px arial'</span>;</div><div class="line">                ctx.fillText(obj.data.disp, obj.x, obj.y);</div><div class="line">            &#125;;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trans</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            poolMod.update(sm.buttons, secs, sm);</div><div class="line">            poolMod.update(sm.dispObjects, secs, sm);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;&#125;,</div><div class="line">        <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">            draw.backgroundMode(ctx, canvas, sm);</div><div class="line">            draw.pool(ctx, sm.buttons);</div><div class="line">            draw.pool(ctx, sm.dispObjects);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">click</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> button = poolMod.getObjectAt(sm.buttons, pos.x, pos.y);</div><div class="line">            <span class="keyword">if</span> (button) &#123;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'start_game'</span>)&#123;</div><div class="line">                    startStateChangeTrans(sm, <span class="string">'game'</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'start_title'</span>)&#123;</div><div class="line">                    startStateChangeTrans(sm, <span class="string">'title'</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'set_mode_next'</span>)&#123;</div><div class="line">                    sm.gameModeIndex += <span class="number">1</span>;</div><div class="line">                    sm.gameModeIndex = utils.mod(sm.gameModeIndex, <span class="built_in">Object</span>.keys(gameMod.modes).length);</div><div class="line">                    startStateChangeTrans(sm, <span class="string">'gameMode'</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> parts = button.data.action.split(<span class="string">'_'</span>);</div><div class="line">                <span class="keyword">if</span>(parts[<span class="number">0</span>] === <span class="string">'set'</span>)&#123;</div><div class="line">                    <span class="keyword">if</span>(parts[<span class="number">2</span>] === <span class="string">'up'</span>)&#123;</div><div class="line">                        setModeProp(sm, parts, button, <span class="number">1</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span>(parts[<span class="number">2</span>] === <span class="string">'down'</span>)&#123;</div><div class="line">                        setModeProp(sm, parts, button, <span class="number">-1</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// GAME STATE</span></div><div class="line">    sm.states.game = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">            <span class="comment">// Quit Button</span></div><div class="line">            spawnButton(sm, &#123;<span class="attr">x</span>: canvas.width - <span class="number">72</span>, <span class="attr">y</span>: <span class="number">8</span>, <span class="attr">w</span>: <span class="number">64</span>, <span class="attr">h</span>: <span class="number">64</span>&#125;, <span class="string">'set_state_gameover'</span>, <span class="string">'Quit'</span>, <span class="built_in">Math</span>.PI);</div><div class="line">            <span class="comment">// PTL area display Object</span></div><div class="line">            <span class="keyword">var</span> disp = spawnButton(sm, &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>, <span class="attr">w</span>: canvas.width, <span class="attr">h</span>: canvas.height&#125;, </div><div class="line">                <span class="string">'dispobj_ptl'</span>, sm.gameMode, <span class="built_in">Math</span>.PI * <span class="number">1.5</span>, <span class="string">'dispObjects'</span>);</div><div class="line">            disp.data.draw = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">                ctx.save();</div><div class="line">                ctx.translate(obj.x, obj.y);</div><div class="line">                gameMod.modes[sm.gameMode].draw(ctx, canvas, sm);</div><div class="line">                ctx.restore();</div><div class="line">            &#125;;</div><div class="line">            <span class="comment">// create a new game object</span></div><div class="line">            sm.game = gameMod.create(&#123;</div><div class="line">               <span class="attr">mode</span>: sm.gameMode,</div><div class="line">               <span class="attr">modeSettings</span>: sm.modeSettings</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trans</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            poolMod.update(sm.buttons, secs, sm);</div><div class="line">            poolMod.update(sm.dispObjects, secs, sm);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            gameMod.update(sm.game, secs);</div><div class="line">            <span class="keyword">if</span>(sm.game.gameOver)&#123;</div><div class="line">                startStateChangeTrans(sm, <span class="string">'gameOver'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">            draw.backgroundMode(ctx, canvas, sm);</div><div class="line">            draw.pool(ctx, sm.buttons);</div><div class="line">            draw.pool(ctx, sm.dispObjects);</div><div class="line">            <span class="keyword">if</span>(sm.debugMode)&#123;</div><div class="line">                draw.debugInfo(ctx, canvas, sm.game);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">click</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> button = poolMod.getObjectAt(sm.buttons, pos.x, pos.y);</div><div class="line">            <span class="keyword">if</span> (button) &#123;</div><div class="line">                <span class="keyword">if</span>(button.data.action === <span class="string">'set_state_gameover'</span>)&#123;</div><div class="line">                    startStateChangeTrans(sm, <span class="string">'gameOver'</span>);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                gameMod.click(sm.game, sm.modeSettings);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// GAME OVER STATE</span></div><div class="line">    sm.states.gameOver = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">            <span class="comment">// option buttons</span></div><div class="line">            <span class="keyword">var</span> dispText = [<span class="string">'Try Again'</span>, <span class="string">'Settings'</span>, <span class="string">'Title'</span>];</div><div class="line">            [<span class="string">'game'</span>, <span class="string">'gameMode'</span>, <span class="string">'title'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">stateKey, i</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> bx = &#123;<span class="attr">x</span>: canvas.width - <span class="number">176</span>, <span class="attr">y</span>: canvas.height * <span class="number">0.25</span> + <span class="number">70</span> * i, <span class="attr">w</span>: <span class="number">168</span>, <span class="attr">h</span>: <span class="number">64</span>&#125;;</div><div class="line">                spawnButton(sm, bx, <span class="string">'set_state_'</span> + stateKey, dispText[i], <span class="number">0</span>);</div><div class="line">            &#125;);</div><div class="line">            <span class="comment">// Game Over text area display Object</span></div><div class="line">            <span class="keyword">var</span> disp = spawnButton(sm, &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>, <span class="attr">w</span>: canvas.width, <span class="attr">h</span>: canvas.height&#125;, </div><div class="line">                <span class="string">'dispobj_gameOver'</span>, sm.gameMode, <span class="built_in">Math</span>.PI * <span class="number">0.5</span>, <span class="string">'dispObjects'</span>);</div><div class="line">            disp.data.draw = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, obj</span>)</span>&#123;</div><div class="line">                ctx.save();</div><div class="line">                ctx.translate(obj.x, obj.y);</div><div class="line">                draw.text_gameover(ctx, canvas, sm);</div><div class="line">                ctx.restore();</div><div class="line">            &#125;;</div><div class="line">            <span class="comment">// update any save that might be there</span></div><div class="line">            <span class="keyword">var</span> highScore = sm.highScores[sm.game.mode];</div><div class="line">            <span class="keyword">if</span>(!highScore || highScore &lt; sm.game.score)&#123;</div><div class="line">                sm.highScores[sm.game.mode] = sm.game.score;</div><div class="line">                utils.save(sm.appName, <span class="number">0</span>, sm.highScores);</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">trans</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">            poolMod.update(sm.buttons, secs, sm);</div><div class="line">            poolMod.update(sm.dispObjects, secs, sm);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">            draw.backgroundMode(ctx, canvas, sm);</div><div class="line">            draw.background(ctx, canvas, <span class="string">'rgba(0,0,0,0.8)'</span>);</div><div class="line">            <span class="comment">//draw.text_gameover(ctx, canvas, sm);</span></div><div class="line">            draw.pool(ctx, sm.buttons);</div><div class="line">            draw.pool(ctx, sm.dispObjects);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">click</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, pos, e</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> button = poolMod.getObjectAt(sm.buttons, pos.x, pos.y);</div><div class="line">            <span class="keyword">if</span> (button) &#123;</div><div class="line">                [<span class="string">'title'</span>, <span class="string">'gameMode'</span>,<span class="string">'game'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">stateKey, i</span>)</span>&#123;</div><div class="line">                    <span class="keyword">if</span>(button.data.action === <span class="string">'set_state_'</span> + stateKey)&#123;</div><div class="line">                        startStateChangeTrans(sm, stateKey);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// LOOP</span></div><div class="line">    <span class="comment">// high scores</span></div><div class="line">    <span class="keyword">var</span> highScores = utils.load(sm.appName, <span class="string">'0'</span>);</div><div class="line">    <span class="keyword">if</span>(highScores)&#123;</div><div class="line">        sm.highScores = highScores;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// mode settings collection object</span></div><div class="line">    sm.modeSettingsCollection = &#123;&#125;;</div><div class="line">    <span class="built_in">Object</span>.keys(gameMod.modes).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">modeKey</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> mode = gameMod.modes[modeKey],</div><div class="line">        settings = &#123;&#125;;</div><div class="line">        mode.settings.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">settingObj</span>)</span>&#123;</div><div class="line">            settings[settingObj.key] = settingObj.start;</div><div class="line">        &#125;);</div><div class="line">        sm.modeSettingsCollection[modeKey] = settings;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// start state</span></div><div class="line">    changeState(sm, <span class="string">'title'</span>);</div><div class="line">    <span class="comment">// the loop</span></div><div class="line">    <span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        secs = (now - sm.lt) / <span class="number">1000</span>;</div><div class="line">        requestAnimationFrame(loop);</div><div class="line">        updateState(sm, secs);</div><div class="line"> </div><div class="line">        sm.states[sm.currentState].draw(sm, ctx, canvas);</div><div class="line">        draw.ver(ctx, canvas, sm);</div><div class="line"> </div><div class="line">        sm.lt = now;</div><div class="line">    &#125;;</div><div class="line">    loop();</div><div class="line"> </div><div class="line">    <span class="comment">// EVENTS</span></div><div class="line">    canvas.addEventListener(<span class="string">'mousedown'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = utils.getCanvasRelative(e);</div><div class="line">        sm.states[sm.currentState].click(sm, pos, e);</div><div class="line">    &#125;);</div><div class="line">    canvas.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = utils.getCanvasRelative(e);</div><div class="line">        sm.states[sm.currentState].click(sm, pos, e);</div><div class="line">    &#125;);</div><div class="line"> </div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<p>Now that I have covered everything that composes the main.js file I just need a little HTML to get this up and running. In my html I just have a div element that I am using for a container element to which the canvas element gets injected in when my main.js file runs, and then of course I have a script tag that links to my main.js file.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pop The Lock canvas example <span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">body&#123;</div><div class="line">  margin:0px;</div><div class="line">  padding:0px;</div><div class="line">  background:gray;</div><div class="line">&#125;</div><div class="line">.canvas_example&#123;</div><div class="line">    display: block;</div><div class="line">    width: auto;</div><div class="line">    height: 100%;</div><div class="line">    margin: 0 auto;</div><div class="line">&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"canvas-app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./lib/utils.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./lib/pool.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./lib/game.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./modes/freeplay.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./modes/sudendeath.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./modes/endurance.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./modes/classic.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./lib/draw.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>When the game is up and running I now have a title screen with animated buttons one of which will take me to the game mode settings state. When in the game mode settings state I can choose which game mode I want to play, the total number of games modes and settings for each will depend on the number of game modes I have loaded and the settings for each. Once I have a game mode that I want to play selected, and the settings for it just the way I want them, I can the play that game mode. </p>
<p>Once I am playing the current game mode I can press the quit button of the game mode, or get a game over for one reason or another at which point i then progress to the game over state. In he game over state I have three options, one to play again with the current game mode and settings, one to go back to settings, and another to go back to the title screen.</p>
<h2 id="7-Conclusion"><a href="#7-Conclusion" class="headerlink" title="7 - Conclusion"></a>7 - Conclusion</h2><p>This canvas example started out as a a quick, and fun little project that I put together in a flash, but is all ready starting to feel like a finished game. However there is still a great deal of room for improvement with it also, and I have yet to find a way to turn this kind of project into something more distinct from what I am cloning so that it is not just a knock off. To some extent I think I have done that all ready with the introduction of additional game modes, while still preserving the original game with the classic mode.</p>
<p>I often like to try to keep the projects in these canvas examples posts fairly simple and basic though so that I do not have to write an extremely lengthly amount of written content outlining the example. However this one is starting to get a little involved and I also have a lot more ideas that I keep writing down on my todo list for this one. The original game that I cloned off of was all ready a little addictive, but I found myself loosing interest fairly quick still. I thought to myself, hey this game is pretty cool actually, and it is so simple too, but it would be even better if it had some additional features.</p>
<p>I will be continuing to work on this one at least a little while longer, because I think that it could use a few more game modes. In addition I think some of the game modes still have some ruff edges when it comes to the logic, and some of them could use some more features actually which is what I have in mind for the endurance mode. However what I really want to do is see if I can come up with new modes, and additional features to tweak these modes in order to come up with something that I think will be pretty cool. </p>
<p>I think I should have some additional states, and even some basic features are still missing. I also have ideas of adding things like an experience point system and making game modes and settings features that must be unlocked. As I continue to work on this I hope to also work out a half way decent system when it comes to having a state machine, and user interface features to move from one state to another.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/" data-id="clhgcnt2s007bpwv19hmb3mos" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/27/canvas-example-grid-defense/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          A grid defense game canvas example
        
      </div>
    </a>
  
  
    <a href="/2019/11/25/nodejs-filesystem-open/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">node open file examples</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/index.html';
    this.page.identifier = '571';
    this.page.title = 'Pop The Lock Canvas Example Game Clone';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.27px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.45px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.18px;">angular</a> <a href="/tags/animation/" style="font-size: 11.82px;">animation</a> <a href="/tags/automation/" style="font-size: 11.82px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.27px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.45px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.64px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.73px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.91px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.36px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.64px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.82px;">express</a> <a href="/tags/games/" style="font-size: 17.27px;">games</a> <a href="/tags/git/" style="font-size: 12.73px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.82px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.55px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.45px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.36px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.73px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.64px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.55px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.55px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.91px;">python</a> <a href="/tags/statistics/" style="font-size: 14.09px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.09px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.36px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/05/threejs-examples-timeline/">Timeline module threejs example</a>
          </li>
        
          <li>
            <a href="/2023/04/28/electronjs-example-game-mrsun/">Idle Game Electronjs project example - MrSun Idle prototype</a>
          </li>
        
          <li>
            <a href="/2023/04/14/threejs-quaternion-slerp/">Quaternion slerp method</a>
          </li>
        
          <li>
            <a href="/2023/04/07/threejs-quaternion-setfromunitvectors/">Quaternion set from unit vectors method in threejs</a>
          </li>
        
          <li>
            <a href="/2023/03/31/threejs-quaternion-premultiply/">Quaternion premultiply method in threejs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2019/11/26/canvas-example-pop-the-lock/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>