<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner_2023.png">
  
  <title>Making a turn based RPG game javaScript project example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This week the plain is to expand my collection of simple JavaScript project examples, this time a simple turned based rpg based on the source code of another javaScript project example that has to do">
<meta property="og:type" content="article">
<meta property="og:title" content="Making a turn based RPG game javaScript project example">
<meta property="og:url" content="https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="This week the plain is to expand my collection of simple JavaScript project examples, this time a simple turned based rpg based on the source code of another javaScript project example that has to do">
<meta property="og:updated_time" content="2021-12-10T17:12:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Making a turn based RPG game javaScript project example">
<meta name="twitter:description" content="This week the plain is to expand my collection of simple JavaScript project examples, this time a simple turned based rpg based on the source code of another javaScript project example that has to do">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-js-javascript-example-turn-based-rpg" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/12/10/js-javascript-example-turn-based-rpg/" class="article-date"> Published:
  <time datetime="2021-12-10T15:02:00.000Z" itemprop="datePublished">2021-12-10</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2021/12/10/js-javascript-example-turn-based-rpg/" class="article-date"> Modified:
  <time datetime="2021-12-10T17:12:12.000Z" itemprop="dateModified">2021-12-10</time>
</a>

    <span class="article-date">V1.2</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js/">js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Making a turn based RPG game javaScript project example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>This week the plain is to expand my collection of simple <a href="/2021/04/02/js-javascript-example/">JavaScript project examples</a>, this time a simple turned based rpg based on the source code of another <a href="/2020/08/11/js-javascript-example-grid-game-unit-movement/">javaScript project example that has to do with grid unit movement</a>. When it comes to the source code of the grid unit movement example I mad a whole lot of improvements to the source code of that example, and I thought that I should take the time to continue to expand on that source code but as a whole other project folder. This example is then that project as it currently stands, and as of this writing I still have a lot of work to do with this when it comes to turning this source code into yet another project that might end up being some kind of final product.</p>
<p>I have a lot of ideas of what I would like the final product to be when I get to that point. This time around I may in fact make a final product with this one because I still seem to still be stuck in that awful start something but never finish something loop, and I want to break out of it. So I will be getting into making art assets, and external json files that hold things like scene data and so forth, but at the time of this writing that just happens to be what I am working on now.</p>
<p>So when it comes to writing a blog post about what I have together at this point the focus will be on the various features that I have added at the time that I stopped working on my improved form of the previous example, and started working on this example. With that said one improvement thus far has to do with breaking things down a little when it comes to units, pulling logic out of the main game state module and into a units module. Another talking point has to do with starting a custom state machine, and a few files that are state objects for said state machine. The main feature thus far though is my game state menu system that is inspired by the circle menu system in from the super Nintendo game called Secret of Mana. As of this writing it is not a clone of that just yet, and I will want to make chances that will work well when it comes to having a web based game version of it, but thus far I would say that is the best feature thus far with this one.</p>
<a id="more"></a>
<h2 id="What-to-know-first-before-reading-more"><a href="#What-to-know-first-before-reading-more" class="headerlink" title="- What to know first before reading more"></a>- What to know first before reading more</h2><p>This is a javaScript example that aims to be a kind of turn based RPG game, the source code of which is still not in a finished state. However there is a whole lot to write about it when it comes to what I have worked out thus far, and there is only so much more to do when it comes to further refining what I have in place. The example is as of revision 5 starting to feel like a finished game, but I still have at lase a little more work to do with it to ay the least when it comes to new features.</p>
<p>So there are two main points to take into account with this, one of which is that this is not at all any kind of <a href="/2018/11/27/js-getting-started/">getting started with javaScript type post</a>. So if you are new to javaScript this post may prove to be a little to advanced. The other main point that I think I should cover in this section is that I am still very much working on this example and intend to continue doing so for at least a little while longer so the source code examples in this post do not reflect the current state of the example.</p>
<h3 id="The-up-to-date-source-code-and-any-additional-assets-ca-be-found-at-my-test-vjs-repository"><a href="#The-up-to-date-source-code-and-any-additional-assets-ca-be-found-at-my-test-vjs-repository" class="headerlink" title="The up to date source code, and any additional assets ca be found at my test vjs repository"></a>The up to date source code, and any additional assets ca be found at my test vjs repository</h3><p>The up to date source code, along with any additional assets that I am not writing about here can be found in the <a href="https://github.com/dustinpfister/test_vjs/tree/master/for_post/js-javascript-example-turn-based-rpg" target="_blank" rel="external">folder that corresponds to this post in my test vjs repository on Github</a>. As of this writing I am writing about revision 5 of the source code there, I am currently working on r6, and have things planed out to at least r15 for now and I do not have everything written down just yet when it comes to the todo list. This test vjs repository is also where I park many other javaScript project examples, as well as the <a href="/categories/js/">examples for my various posts on javaScript in general</a>.</p>
<h2 id="1-The-game-javaScript-file-and-renderer"><a href="#1-The-game-javaScript-file-and-renderer" class="headerlink" title="1 - The game javaScript file and renderer"></a>1 - The game javaScript file and renderer</h2><p>In this section I will be writing about that main game module that is used to create and mutate a main game state object, as well as the library that I use to draw various parts of this state to a canvas element.</p>
<h3 id="1-1-The-game-js-module-to-creating-and-mutating-the-main-game-state-object"><a href="#1-1-The-game-js-module-to-creating-and-mutating-the-main-game-state-object" class="headerlink" title="1.1 -  The game.js module to creating and mutating the main game state object"></a>1.1 -  The game.js module to creating and mutating the main game state object</h3><p>This is the source code for a main game state module for the turn based game as currently stands. As with my many other javaScript and canvas example projects there is a public method that is used to create a main game object, and a method that is called in a loop to update that game object. On top of that I also have public methods for just setting things up for a game object rather than creating a whole new one, and also some methods that have to do with pointer events.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     TO MAP OBJECT</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// Is a given cell at a corner? Used to get adjust goto point for game.toMap object</span></div><div class="line">    <span class="keyword">var</span> isAtCorner = <span class="function"><span class="keyword">function</span>(<span class="params">game, cell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        w = map.w - <span class="number">1</span>,</div><div class="line">        h = map.h - <span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> (cell.x === <span class="number">0</span> &amp;&amp; cell.y === <span class="number">0</span>) || </div><div class="line">            (cell.x === w &amp;&amp; cell.y === h) || </div><div class="line">            (cell.x === <span class="number">0</span> &amp;&amp; cell.y === h) || </div><div class="line">            (cell.x === w &amp;&amp; cell.y === <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return a toIndexOptions array for the given map position in the current game map</span></div><div class="line">    <span class="keyword">var</span> getToIndexOptions = <span class="function"><span class="keyword">function</span>(<span class="params">game, x, y, ox, oy</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> toIndex = <span class="literal">null</span>,</div><div class="line">        dir = <span class="string">''</span>,</div><div class="line">        p = game.player,</div><div class="line">        map = game.maps[game.mapIndex],</div><div class="line">        cell = mapMod.get(map, x, y),</div><div class="line">        mwx = game.mapIndex % game.mapWorldWidth,                 <span class="comment">// map world x and y</span></div><div class="line">        mwy = <span class="built_in">Math</span>.floor(game.mapIndex / game.mapWorldWidth ),</div><div class="line">        options = [];</div><div class="line">        <span class="keyword">if</span>(isAtCorner(game, cell))&#123;</div><div class="line">            <span class="keyword">if</span>(x === <span class="number">0</span> &amp;&amp; y === <span class="number">0</span>)&#123;</div><div class="line">                <span class="keyword">return</span> getToIndexOptions(game, <span class="number">0</span>, <span class="number">1</span>, x, y).concat(getToIndexOptions(game, <span class="number">1</span>, <span class="number">0</span>, x, y));</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(x === map.w - <span class="number">1</span> &amp;&amp; y === <span class="number">0</span>)&#123;</div><div class="line">                <span class="keyword">return</span> getToIndexOptions(game, map.w - <span class="number">1</span>, <span class="number">1</span>, x, y).concat(getToIndexOptions(game, map.w - <span class="number">2</span>, <span class="number">0</span>, x, y));</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(x === map.w - <span class="number">1</span> &amp;&amp; y === map.h - <span class="number">1</span>)&#123;</div><div class="line">                <span class="keyword">return</span> getToIndexOptions(game, map.w - <span class="number">1</span>, map.h - <span class="number">2</span>, x, y).concat(getToIndexOptions(game, map.w - <span class="number">2</span>, map.h - <span class="number">1</span>, x, y));</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(x === <span class="number">0</span> &amp;&amp; y === map.h - <span class="number">1</span>)&#123;</div><div class="line">                <span class="keyword">return</span> getToIndexOptions(game, <span class="number">0</span>, map.h - <span class="number">2</span>, x, y).concat(getToIndexOptions(game, map.w - <span class="number">2</span>, map.h - <span class="number">1</span>, x, y));</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">// if player cell x equals 0 ( left side )</span></div><div class="line">            <span class="keyword">if</span>(x === <span class="number">0</span>)&#123;</div><div class="line">                <span class="keyword">var</span> x = mwx - <span class="number">1</span>;</div><div class="line">                x = x &lt; <span class="number">0</span> ? game.mapWorldWidth - <span class="number">1</span> : x;</div><div class="line">                toIndex = mwy * game.mapWorldWidth + x;</div><div class="line">                dir = <span class="string">'west'</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// if player cell x equals map.w - 1 ( right side )</span></div><div class="line">            <span class="keyword">if</span>(x === map.w - <span class="number">1</span>)&#123;</div><div class="line">                <span class="keyword">var</span> x = mwx + <span class="number">1</span>;</div><div class="line">                x = x &gt;= game.mapWorldWidth ? <span class="number">0</span> : x;</div><div class="line">                toIndex = mwy * game.mapWorldWidth + x;</div><div class="line">                dir = <span class="string">'east'</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// if player cell y equals 0 ( top side )</span></div><div class="line">            <span class="keyword">if</span>(y === <span class="number">0</span>)&#123;</div><div class="line">                <span class="keyword">var</span> y = mwy - <span class="number">1</span>;</div><div class="line">                y = y &lt; <span class="number">0</span> ? game.maps.length / game.mapWorldWidth - <span class="number">1</span> : y;</div><div class="line">                toIndex = y * game.mapWorldWidth + mwx;</div><div class="line">                dir = <span class="string">'north'</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// if player cell y map.h - 1 ( bottom side )</span></div><div class="line">            <span class="keyword">if</span>(y === map.h - <span class="number">1</span>)&#123;</div><div class="line">                <span class="keyword">var</span> y = mwy + <span class="number">1</span>;</div><div class="line">                y = y &gt;= game.maps.length / game.mapWorldWidth ? <span class="number">0</span> : y;</div><div class="line">                toIndex = y * game.mapWorldWidth + mwx;</div><div class="line">                dir = <span class="string">'south'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return array with index and dir text</span></div><div class="line">        <span class="keyword">return</span> dir === <span class="string">''</span> ? [] : [&#123;</div><div class="line">           <span class="attr">mi</span>: toIndex,</div><div class="line">           <span class="attr">dir</span>: dir,</div><div class="line">           <span class="attr">x</span>: ox === <span class="literal">undefined</span> ? x : ox,</div><div class="line">           <span class="attr">y</span>: oy === <span class="literal">undefined</span> ? y : oy</div><div class="line">        &#125;];</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a toMap object that can be set to the game.toMap propery</span></div><div class="line">    <span class="keyword">var</span> getToMap = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> toMap = &#123;<span class="attr">index</span>: <span class="literal">null</span>, <span class="attr">x</span>: <span class="literal">null</span>, <span class="attr">y</span>: <span class="literal">null</span>&#125;;</div><div class="line">        <span class="keyword">var</span> pCell = api.getPlayerCell(game);</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">var</span> options = toMap.options = getToIndexOptions(game, pCell.x, pCell.y);</div><div class="line">        options = options.map(<span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(opt.dir === <span class="string">'north'</span>)&#123;</div><div class="line">                opt.y = map.h - <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(opt.dir === <span class="string">'south'</span>)&#123;</div><div class="line">                opt.y = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(opt.dir === <span class="string">'east'</span>)&#123;</div><div class="line">                opt.x = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(opt.dir === <span class="string">'west'</span>)&#123;</div><div class="line">                opt.x = map.w - <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> opt;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// assume first index</span></div><div class="line">        <span class="keyword">if</span>(options.length &gt;= <span class="number">1</span>)&#123;</div><div class="line">            toMap.index = options[<span class="number">0</span>].mi;</div><div class="line">            toMap.x = options[<span class="number">0</span>].x;</div><div class="line">            toMap.y = options[<span class="number">0</span>].y;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> toMap;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MOVEMENT PATHS</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// get a move path in the from of a path created using mapMod.getPath that is cut</span></div><div class="line">    <span class="comment">// based on the maxCellsPerTurn value of the unit in the given start cell if any</span></div><div class="line">    <span class="keyword">var</span> getMovePath = <span class="function"><span class="keyword">function</span>(<span class="params">game, startCell, targetCell</span>)</span>&#123;</div><div class="line">        <span class="comment">// get current map</span></div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        unit = startCell.unit || <span class="literal">null</span>;</div><div class="line">        <span class="comment">// get the raw path to that target cell</span></div><div class="line">        <span class="keyword">var</span> path = mapMod.getPath(map, startCell.x, startCell.y, targetCell.x, targetCell.y);</div><div class="line">        <span class="comment">// get a slice of the raw path up to unit.maxCellsPerTurn</span></div><div class="line">        <span class="keyword">if</span>(unit)&#123;</div><div class="line">            path = path.reverse().slice(<span class="number">0</span>, unit.maxCellsPerTurn);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return the path</span></div><div class="line">        <span class="keyword">return</span> path;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get an arary of cell index values</span></div><div class="line">    <span class="keyword">var</span> getMoveCells = <span class="function"><span class="keyword">function</span>(<span class="params">game, startCell, targetCell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">return</span> getMovePath(game, startCell, targetCell).map(<span class="function"><span class="keyword">function</span>(<span class="params">pos</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> cell = mapMod.get(map, pos[<span class="number">0</span>], pos[<span class="number">1</span>]);</div><div class="line">            <span class="keyword">return</span> cell.i;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get enemy move cells options</span></div><div class="line">    <span class="keyword">var</span> getEnemeyMoveCells = <span class="function"><span class="keyword">function</span>(<span class="params">game, eCell</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> pCell = api.getPlayerCell(game),</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="comment">// get neighbor cells of the player unit</span></div><div class="line">        <span class="keyword">var</span> pCellNeighbors = mapMod.getNeighbors(map, pCell).filter(<span class="function"><span class="keyword">function</span>(<span class="params">cell</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> cell.walkable;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// get an array of path options </span></div><div class="line">        <span class="keyword">var</span> mtcOptions = pCellNeighbors.map(<span class="function"><span class="keyword">function</span>(<span class="params">cell</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> getMoveCells(game, eCell, cell)</div><div class="line">        &#125;).filter(<span class="function"><span class="keyword">function</span>(<span class="params">mtcOptions</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> mtcOptions.length &gt; <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// rteurn first path or empty array</span></div><div class="line">        <span class="keyword">return</span> mtcOptions[<span class="number">0</span>] || [];</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     UNITS</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// place a unit at the given location in the current map</span></div><div class="line">    <span class="keyword">var</span> placeUnit = <span class="function"><span class="keyword">function</span> (<span class="params">game, unit, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">var</span> newCell = mapMod.get(map, x, y);</div><div class="line">        <span class="keyword">if</span> (newCell) &#123;</div><div class="line">            <span class="comment">// any old cellIndex that may need to have walkable</span></div><div class="line">            <span class="comment">// set back to true?</span></div><div class="line">            <span class="keyword">if</span> (unit.currentCellIndex != <span class="literal">null</span>) &#123;</div><div class="line">                <span class="keyword">var</span> oldCell = map.cells[unit.currentCellIndex];</div><div class="line">                oldCell.walkable = <span class="literal">true</span>;</div><div class="line">                <span class="comment">// set unit ref back to null</span></div><div class="line">                map.cells[unit.currentCellIndex].unit = <span class="literal">null</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// set new cell to not walkable as a unit is now located here</span></div><div class="line">            newCell.walkable = <span class="literal">false</span>;</div><div class="line">            <span class="comment">// set current cell index for the unit</span></div><div class="line">            unit.currentCellIndex = newCell.i;</div><div class="line">            <span class="comment">// place a ref to the unit in the map cell</span></div><div class="line">            map.cells[unit.currentCellIndex].unit = unit; <span class="comment">// map ref to unit</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// place player helper that is called when setting up a new game, and when the player</span></div><div class="line">    <span class="comment">// moves to a new map</span></div><div class="line">    <span class="keyword">var</span> placePlayer = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        toMap = game.toMap,</div><div class="line">        toCell = <span class="literal">null</span>,</div><div class="line">        i = map.cells.length;</div><div class="line">        <span class="comment">// get a toCell ref if we have a pos in game.toMap</span></div><div class="line">        <span class="keyword">if</span>(toMap.x != <span class="literal">null</span> &amp;&amp; toMap.y != <span class="literal">null</span>)&#123;</div><div class="line">            toCell = mapMod.get(map, toMap.x, toMap.y);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we have a toCell</span></div><div class="line">        <span class="keyword">if</span>(toCell)&#123;</div><div class="line">            <span class="keyword">if</span>(!toCell.unit)&#123;</div><div class="line">                placeUnit(game, game.player, toCell.x, toCell.y);</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we get this far just find a spot</span></div><div class="line">        <span class="keyword">while</span>(i--)&#123;</div><div class="line">            <span class="keyword">var</span> cell = map.cells[i];</div><div class="line">            <span class="keyword">if</span>(cell.unit === <span class="literal">null</span>)&#123;</div><div class="line">                placeUnit(game, game.player, cell.x, cell.y);</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move a unit by way of any cell index values in unit.moveCells</span></div><div class="line">    <span class="keyword">var</span> moveUnit = <span class="function"><span class="keyword">function</span>(<span class="params">game, unit</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(unit.moveCells.length &gt; <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> ci = unit.moveCells.shift();</div><div class="line">            <span class="keyword">var</span> moveToCell = mapMod.get(game.maps[game.mapIndex], ci);</div><div class="line">            <span class="comment">// if no unit at the move to cell</span></div><div class="line">            <span class="keyword">if</span>(!moveToCell.unit)&#123;</div><div class="line">                placeUnit(game, unit, moveToCell.x, moveToCell.y);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// !!! might not hurt to do this for all units</span></div><div class="line">            <span class="comment">// also this might not belong here but where this method</span></div><div class="line">            <span class="comment">// is called for the player unit maybe</span></div><div class="line">            <span class="keyword">if</span>(unit.type === <span class="string">'player'</span>)&#123;</div><div class="line">                game.toMap = getToMap(game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MAP HELPERS</div><div class="line">*********** *********/</div><div class="line"><span class="comment">// get an array of cell objects by a given unit type string in the given map</span></div><div class="line"><span class="keyword">var</span> getCellsByUnitType = <span class="function"><span class="keyword">function</span>(<span class="params">map, type</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> map.cells.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, cell</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(cell.unit)&#123;</div><div class="line">            <span class="keyword">if</span>(cell.unit.type === type)&#123;</div><div class="line">                acc.push(cell);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> acc;</div><div class="line">    &#125;,[]);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> changeMap = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> pCell = api.getPlayerCell(game);</div><div class="line">        game.mapIndex = game.toMap.index;</div><div class="line">        pCell.unit = <span class="literal">null</span>;</div><div class="line">        pCell.walkable = <span class="literal">true</span>;</div><div class="line">        game.player.currentCellIndex = <span class="literal">null</span>;</div><div class="line">        placePlayer(game);</div><div class="line">        game.toMap = getToMap(game);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     SETUP GAME</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// setUp game helper with game object, and given maps</span></div><div class="line">    <span class="keyword">var</span> setupGame = api.setupGame = <span class="function"><span class="keyword">function</span> (<span class="params">game, newGame</span>) </span>&#123;</div><div class="line">        newGame = newGame === <span class="literal">undefined</span> ? <span class="literal">true</span> : newGame;</div><div class="line">        <span class="keyword">var</span> playerPlaced = <span class="literal">false</span>,</div><div class="line">        startMapIndex = <span class="number">0</span>;</div><div class="line">        game.mapIndex = <span class="number">0</span>;</div><div class="line">        <span class="comment">// set player HP to max</span></div><div class="line">        game.player.HP = game.player.maxHP;</div><div class="line">        <span class="keyword">if</span>(newGame)&#123;</div><div class="line">            game.remainingEnemies = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// make sure mode starts out on map mode</span></div><div class="line">        game.mode = <span class="string">'map'</span>;</div><div class="line">        <span class="comment">// set up maps</span></div><div class="line">        game.maps = game.maps.map(<span class="function"><span class="keyword">function</span>(<span class="params">map, mi</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> mapStr = game.mapStrings[mi] || <span class="string">''</span>;</div><div class="line">            game.mapIndex = mi;</div><div class="line">            map.cells = map.cells.map(<span class="function"><span class="keyword">function</span>(<span class="params">cell, ci</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> cellIndex = <span class="built_in">parseInt</span>(mapStr[ci] || <span class="string">'0'</span>),</div><div class="line">                x = ci % map.w,</div><div class="line">                y = <span class="built_in">Math</span>.floor(ci / map.w);</div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">0</span> &amp;&amp; newGame)&#123;</div><div class="line">                    <span class="keyword">var</span> cell = mapMod.get(map, ci);</div><div class="line">                    cell.unit = <span class="literal">null</span>;</div><div class="line">                    cell.walkable = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// wall blocks set for new games and not</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">1</span>)&#123;</div><div class="line">                    <span class="keyword">var</span> wall = unitMod.createUnit(<span class="string">'wall'</span>);</div><div class="line">                    placeUnit(game, wall, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// player always set</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">2</span>)&#123;</div><div class="line">                    playerPlaced = <span class="literal">true</span>;</div><div class="line">                    startMapIndex = mi;</div><div class="line">                    placeUnit(game, game.player, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// enemy</span></div><div class="line">                <span class="keyword">if</span>(cellIndex === <span class="number">3</span> &amp;&amp; newGame)&#123;</div><div class="line">                    game.remainingEnemies += <span class="number">1</span>;</div><div class="line">                    <span class="keyword">var</span> enemy = unitMod.createUnit(<span class="string">'enemy'</span>);</div><div class="line">                    enemy.HP = enemy.maxHP;</div><div class="line">                    placeUnit(game, enemy, x, y);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> cell;</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">return</span> map;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// if player is not palced then place the player unit</span></div><div class="line">        <span class="comment">// at a null cell</span></div><div class="line">        <span class="keyword">if</span>(!playerPlaced)&#123;</div><div class="line">            placePlayer(game);</div><div class="line">        &#125;</div><div class="line">        game.mapIndex = startMapIndex;</div><div class="line">        game.toMap = getToMap(game);</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MENU POOL</div><div class="line">*********** *********/</div><div class="line"><span class="keyword">var</span> menuPool = &#123;</div><div class="line">    <span class="attr">count</span>: <span class="number">8</span>,</div><div class="line">    <span class="attr">disableLifespan</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">data</span>: &#123;</div><div class="line">        <span class="attr">outerRadius</span>: <span class="number">75</span>,</div><div class="line">        <span class="attr">innerRadius</span>: <span class="number">25</span>,</div><div class="line">        <span class="attr">outerTotal</span>: <span class="number">1</span>,</div><div class="line">        <span class="attr">frame</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">maxFrame</span>: <span class="number">15</span>,</div><div class="line">        <span class="attr">activeButton</span>: <span class="literal">null</span>, <span class="comment">// a ref to the active button to use on 'exit' mode end</span></div><div class="line">        mode: <span class="string">'enter'</span>       <span class="comment">// current mode of the menuPool 'enter', 'exit'</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">menuPool.spawn = <span class="function"><span class="keyword">function</span>(<span class="params">button, options, sm, spawnOpt</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> bd = button.data,</div><div class="line">    pd = options.data;</div><div class="line">    <span class="comment">// button data</span></div><div class="line">    bd.desc = spawnOpt.desc || <span class="literal">false</span>;</div><div class="line">    bd.cx = button.x = sm.canvas.width / <span class="number">2</span> - button.w / <span class="number">2</span>;</div><div class="line">    bd.cy = button.y = sm.canvas.height / <span class="number">2</span> - button.h / <span class="number">2</span>;</div><div class="line">    bd.radius = <span class="number">0</span>;</div><div class="line">    bd.a = <span class="number">0</span>;</div><div class="line">    bd.ta = spawnOpt.ta === <span class="literal">undefined</span> ? <span class="built_in">Math</span>.PI * <span class="number">2</span>: spawnOpt.ta;</div><div class="line">    bd.outer = spawnOpt.outer === <span class="literal">undefined</span> ? <span class="literal">true</span> : spawnOpt.outer;</div><div class="line">    bd.onClick = spawnOpt.onClick || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">    <span class="comment">// pool data</span></div><div class="line">    pd.frame = <span class="number">0</span>;</div><div class="line">    pd.outerTotal = spawnOpt.outerTotal === <span class="literal">undefined</span> ? <span class="number">1</span> : spawnOpt.outerTotal</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">menuPool.update = <span class="function"><span class="keyword">function</span>(<span class="params">button, options, sm, secs</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> pd = options.data,</div><div class="line">    bd = button.data;</div><div class="line">    <span class="comment">// !!! updating pool data here is not so great</span></div><div class="line">    <span class="keyword">if</span>(button.i === options.objects.length - <span class="number">1</span>)&#123;</div><div class="line">        <span class="comment">// if we are in enter mode</span></div><div class="line">        <span class="keyword">if</span>(pd.mode === <span class="string">'enter'</span>)&#123;</div><div class="line">            pd.frame += <span class="number">30</span> * secs;</div><div class="line">            pd.frame = pd.frame &gt;= pd.maxFrame ? pd.maxFrame : pd.frame;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we are in exit mode</span></div><div class="line">        <span class="keyword">if</span>(pd.mode === <span class="string">'exit'</span>)&#123;</div><div class="line">            pd.frame -= <span class="number">30</span> * secs;</div><div class="line">            pd.frame = pd.frame &lt; <span class="number">0</span> ? <span class="number">0</span> : pd.frame;</div><div class="line">            <span class="keyword">if</span>(pd.frame === <span class="number">0</span> &amp;&amp; pd.activeButton)&#123;</div><div class="line">                pd.activeButton.data.onClick.call(sm, sm, pd.activeButton);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> per = pd.frame / pd.maxFrame;</div><div class="line">    <span class="keyword">var</span> radius = bd.outer ? pd.outerRadius : pd.innerRadius;</div><div class="line">    bd.a = bd.ta * per;</div><div class="line">    button.x = bd.cx + <span class="built_in">Math</span>.cos(bd.a) * radius * per;</div><div class="line">    button.y = bd.cy + <span class="built_in">Math</span>.sin(bd.a) * radius * per;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     gameMod.create PUBLIC METHOD</div><div class="line">*********** *********/</div><div class="line">    <span class="comment">// create a new game state</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="comment">//var mapStrings = opt.maps || ['2'];</span></div><div class="line">        <span class="keyword">var</span> game = &#123;</div><div class="line">            <span class="attr">mode</span>: <span class="string">'map'</span>, <span class="comment">// 'map' for the game in action, and 'menu' for the circle options menu</span></div><div class="line">            turn: <span class="number">0</span>,</div><div class="line">            <span class="attr">turnState</span>: <span class="string">'wait'</span>,</div><div class="line">            <span class="attr">maps</span>: [],</div><div class="line">            <span class="attr">mapIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">mapWorldWidth</span>: <span class="number">3</span>, <span class="comment">// used to find toIndex</span></div><div class="line">            toMap: &#123;</div><div class="line">                <span class="attr">index</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">x</span>: <span class="literal">null</span>,</div><div class="line">                <span class="attr">y</span>: <span class="literal">null</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">mapStrings</span>: opt.maps || [<span class="string">'2'</span>],</div><div class="line">            <span class="attr">player</span>: unitMod.createUnit(<span class="string">'player'</span>),</div><div class="line">            <span class="attr">remainingEnemies</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">options</span>: <span class="keyword">new</span> poolMod.create(menuPool), <span class="comment">// pool of objects used for the circle menu</span></div><div class="line">            pointerDownTime: <span class="keyword">new</span> <span class="built_in">Date</span>()            <span class="comment">// used to find out if we are dealing with a long press or not</span></div><div class="line">        &#125;;</div><div class="line">        game.mapStrings.forEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            game.maps.push(mapMod.create(&#123;</div><div class="line">                <span class="attr">marginX</span>: opt.marginX === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.marginX,</div><div class="line">                <span class="attr">marginY</span>: opt.marginY === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.marginY,</div><div class="line">                <span class="attr">w</span>:  opt.w === <span class="literal">undefined</span> ? <span class="number">4</span> : opt.w,</div><div class="line">                <span class="attr">h</span>:  opt.h === <span class="literal">undefined</span> ? <span class="number">4</span> : opt.h</div><div class="line">            &#125;));</div><div class="line">        &#125;);</div><div class="line">        setupGame(game, <span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     gameMod.update PUBLIC METHOD</div><div class="line">*********** *********/</div><div class="line">    <span class="keyword">var</span> processMeele = <span class="function"><span class="keyword">function</span>(<span class="params">game, unit</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> targetCellIndex = unit.meleeTarget,</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">if</span>(targetCellIndex != <span class="literal">null</span>)&#123;</div><div class="line">            <span class="keyword">var</span> targetCell = mapMod.get(map, targetCellIndex),</div><div class="line">            tUnit = targetCell.unit;</div><div class="line">            <span class="keyword">if</span>(tUnit)&#123;</div><div class="line">                <span class="comment">// unitMod meleeAttack method</span></div><div class="line">                unitMod.meleeAttack(unit, tUnit);</div><div class="line">                <span class="comment">// enemy unit death check</span></div><div class="line">                <span class="keyword">if</span>(tUnit.HP &lt;= <span class="number">0</span> &amp;&amp; tUnit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">                    targetCell.walkable = <span class="literal">true</span>;</div><div class="line">                    targetCell.unit = <span class="literal">null</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            unit.meleeTarget = <span class="literal">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get remaining Enemies helper used to update game.remainingEnemies in 'end' process turn state</span></div><div class="line">    <span class="keyword">var</span> getRemainingEnemies = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> game.maps.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, map</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            <span class="keyword">return</span> acc + eCells.length;</div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// process turn method used in gameMod.update</span></div><div class="line">    <span class="keyword">var</span> processTurn = <span class="function"><span class="keyword">function</span>(<span class="params">game, secs</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> map = game.maps[game.mapIndex],</div><div class="line">        pCell = api.getPlayerCell(game),</div><div class="line">        eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">        <span class="comment">// do nothing for 'wait' state</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'wait'</span>)&#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// starting a new turn</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'start'</span>)&#123;</div><div class="line">            <span class="comment">// let enemy units figure paths</span></div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> d = utils.distance(eCell.x + <span class="number">16</span>, eCell.y + <span class="number">16</span>, pCell.x + <span class="number">16</span>, pCell.y + <span class="number">16</span>);</div><div class="line">                <span class="keyword">if</span>( d &lt;= <span class="number">1.5</span>)&#123;</div><div class="line">                    <span class="comment">// in melee range player</span></div><div class="line">                    eCell.unit.meleeTarget = pCell.i;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">// not in melee range of player</span></div><div class="line">                    eCell.unit.moveCells = getEnemeyMoveCells(game, eCell);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//console.log(eCell.unit.moveCells);</span></div><div class="line">            &#125;);</div><div class="line">            game.turnState = <span class="string">'move'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// move state</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'move'</span>)&#123;</div><div class="line">            <span class="comment">// move player unit</span></div><div class="line">            moveUnit(game, game.player);</div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                moveUnit(game, eCell.unit);</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            <span class="comment">// if moveCells array length of all units === 0 the move state is over</span></div><div class="line">            <span class="keyword">if</span>(game.player.moveCells.length === <span class="number">0</span> &amp;&amp; eCells.every(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> eCell.unit.moveCells.length === <span class="number">0</span>;</div><div class="line">            &#125;))&#123;</div><div class="line">                game.turnState = <span class="string">'melee'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// melee attack</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'melee'</span>)&#123;</div><div class="line">            <span class="comment">// process any player melee attack</span></div><div class="line">            processMeele(game, game.player);</div><div class="line">            <span class="comment">// process melee attacks for enemy units</span></div><div class="line">            <span class="keyword">var</span> eCells = getCellsByUnitType(map, <span class="string">'enemy'</span>);</div><div class="line">            eCells.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">eCell</span>)</span>&#123;</div><div class="line">                processMeele(game, eCell.unit);</div><div class="line">            &#125;);</div><div class="line">            game.turnState = <span class="string">'end'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// for end state step game.turn and set game.turnState back to wait</span></div><div class="line">        <span class="keyword">if</span>(game.turnState === <span class="string">'end'</span>)&#123;</div><div class="line">            game.turn += <span class="number">1</span>;</div><div class="line">            game.turnState = <span class="string">'wait'</span>;</div><div class="line">            <span class="comment">// check for player death</span></div><div class="line">            <span class="keyword">if</span>(game.player.HP &lt;= <span class="number">0</span>)&#123;</div><div class="line">                <span class="comment">// !!! for now just call setupGame</span></div><div class="line">                pCell.unit = <span class="literal">null</span>;</div><div class="line">                pCell.walkable = <span class="literal">true</span>;</div><div class="line">                setupGame(game, <span class="literal">false</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// check for all enemies dead</span></div><div class="line">            game.remainingEnemies = getRemainingEnemies(game);</div><div class="line">            <span class="keyword">if</span>(game.remainingEnemies === <span class="number">0</span>)&#123;</div><div class="line">                setupGame(game, <span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a game object</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">sm, secs</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game;</div><div class="line">        <span class="comment">// in map mode just call process turn</span></div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'map'</span>)&#123;</div><div class="line">            processTurn(game, secs);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(game.mode === <span class="string">'menu'</span>)&#123;</div><div class="line">            poolMod.update(game.options, secs, sm);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get player cell</span></div><div class="line">    api.getPlayerCell = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> p = game.player,</div><div class="line">        map = game.maps[game.mapIndex];</div><div class="line">        <span class="keyword">return</span> map.cells[p.currentCellIndex];</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// preform what needs to happen for a player pointer event for the given pixel positon</span></div><div class="line">    api.pointerStart = <span class="function"><span class="keyword">function</span>(<span class="params">sm, x, y</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game;</div><div class="line">        <span class="comment">// pointerDownTime should start at now</span></div><div class="line">        game.pointerDownTime = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> BUTTON = &#123;&#125;;</div><div class="line"> </div><div class="line">    BUTTON.quit = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'quit'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">           sm.setState(<span class="string">'title'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.resume = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'resume'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">           sm.game.mode = <span class="string">'map'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> createMapButtonOnClick = <span class="function"><span class="keyword">function</span>(<span class="params">dir</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> tm = sm.game.toMap;</div><div class="line">            sm.game.mode = <span class="string">'map'</span>;</div><div class="line">            tm.options.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(opt.dir === dir)&#123;</div><div class="line">                   tm.index = opt.mi;</div><div class="line">                   tm.x = opt.x;</div><div class="line">                   tm.y = opt.y;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            changeMap(sm.game);</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.map_south = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'South'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">ta</span>: <span class="built_in">Math</span>.PI * <span class="number">0.5</span>,</div><div class="line">        <span class="attr">onClick</span>: createMapButtonOnClick(<span class="string">'south'</span>)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.map_north = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'North'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">ta</span>: <span class="built_in">Math</span>.PI * <span class="number">1.5</span>,</div><div class="line">        <span class="attr">onClick</span>: createMapButtonOnClick(<span class="string">'north'</span>)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.map_east = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'East'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">ta</span>: <span class="built_in">Math</span>.PI * <span class="number">2</span>,</div><div class="line">        <span class="attr">onClick</span>: createMapButtonOnClick(<span class="string">'east'</span>)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.map_west = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'West'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">ta</span>: <span class="built_in">Math</span>.PI * <span class="number">1</span>,</div><div class="line">        <span class="attr">onClick</span>: createMapButtonOnClick(<span class="string">'west'</span>)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.dum1 = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'dummy1'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">           sm.game.mode = <span class="string">'map'</span>;           </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.dum2 = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'dummy2'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">           sm.game.mode = <span class="string">'map'</span>;           </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    BUTTON.dum3 = &#123;</div><div class="line">        <span class="attr">desc</span>: <span class="string">'dummy2'</span>,</div><div class="line">        <span class="attr">outer</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, button</span>)</span>&#123;</div><div class="line">           sm.game.mode = <span class="string">'map'</span>;           </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> getButtonKeyValueCount = <span class="function"><span class="keyword">function</span>(<span class="params">buttonKeys, prop, value</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> buttonKeys.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, buttonKey</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> buttonDATA = BUTTON[buttonKey];</div><div class="line">            <span class="keyword">if</span>(buttonDATA[prop] === value)&#123;</div><div class="line">                acc += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> acc;</div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a menu for the current game state</span></div><div class="line">    <span class="keyword">var</span> createMenu = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="comment">// purge all buttons first</span></div><div class="line">        game.options.objects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">button</span>)</span>&#123;</div><div class="line">            button.active = <span class="literal">false</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// default buttonKeys array</span></div><div class="line">        <span class="comment">//var buttonKeys = ['quit', 'resume', 'map_south', 'map_north', 'map_east', 'map_west'];</span></div><div class="line">        <span class="keyword">var</span> buttonKeys = [<span class="string">'quit'</span>, <span class="string">'resume'</span>];</div><div class="line">        <span class="comment">// appending options</span></div><div class="line">        buttonKeys = buttonKeys.concat(game.toMap.options.map(<span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">             <span class="keyword">return</span> <span class="string">'map_'</span> + opt.dir;</div><div class="line">        &#125;));</div><div class="line">        <span class="keyword">var</span> oi = <span class="number">0</span>, </div><div class="line">        ii = <span class="number">0</span>,</div><div class="line">        oc = getButtonKeyValueCount(buttonKeys, <span class="string">'outer'</span>, <span class="literal">true</span>), <span class="comment">//3,</span></div><div class="line">        ic = getButtonKeyValueCount(buttonKeys, <span class="string">'outer'</span>, <span class="literal">false</span>); <span class="comment">//2;</span></div><div class="line">        <span class="comment">// spawn buttons </span></div><div class="line">        buttonKeys.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">buttonKey</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> buttonDATA = BUTTON[buttonKey],</div><div class="line">            len = (buttonDATA.outer ? oc : ic),</div><div class="line">            i = (buttonDATA.outer ? oi : ii),</div><div class="line">            ta = <span class="built_in">Math</span>.PI * <span class="number">2</span> / len * (i + <span class="number">1</span>);</div><div class="line">            <span class="comment">// use buttonDATA.ta if there is one</span></div><div class="line">            ta = buttonDATA.ta != <span class="literal">undefined</span> ? buttonDATA.ta : ta;</div><div class="line">            <span class="comment">// spawn buttons</span></div><div class="line">            poolMod.spawn(game.options, sm, &#123;</div><div class="line">                <span class="attr">desc</span>: buttonDATA.desc,</div><div class="line">                <span class="attr">onClick</span>: buttonDATA.onClick,</div><div class="line">                <span class="attr">outer</span>: buttonDATA.outer,</div><div class="line">                <span class="attr">ta</span>: ta</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">if</span>(buttonDATA.outer)&#123;</div><div class="line">               oi += <span class="number">1</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">               ii += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// call when a pointer has ended</span></div><div class="line">    api.pointerEnd = <span class="function"><span class="keyword">function</span>(<span class="params">sm, x, y</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game,</div><div class="line">        now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">        clickedCell = mapMod.getCellByPointer(game.maps[game.mapIndex], x, y),</div><div class="line">        map = game.maps[game.mapIndex],</div><div class="line">        pCell = api.getPlayerCell(game);</div><div class="line">        secs = (now - game.pointerDownTime) / <span class="number">1000</span>;</div><div class="line">        <span class="comment">// long press</span></div><div class="line">        <span class="keyword">if</span>( secs &gt;= <span class="number">0.5</span> )&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'long press!'</span>);</div><div class="line">            <span class="comment">// if we are in map mode switch to menu mode</span></div><div class="line">            <span class="keyword">if</span>(game.mode === <span class="string">'map'</span>)&#123;</div><div class="line">                game.mode = <span class="string">'menu'</span>;</div><div class="line">                game.options.data.mode = <span class="string">'enter'</span>;</div><div class="line">                createMenu(game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// short press</span></div><div class="line">        <span class="keyword">if</span>(secs &lt; <span class="number">0.5</span> )&#123;</div><div class="line">            <span class="keyword">if</span> (game.mode === <span class="string">'map'</span> &amp;&amp; clickedCell) &#123;</div><div class="line">                <span class="comment">// if player cell is clicked and there is a toIndex value</span></div><div class="line">                <span class="keyword">if</span>(clickedCell === pCell &amp;&amp; game.toMap.index != <span class="literal">null</span>)&#123;</div><div class="line">                    <span class="keyword">if</span>(game.toMap.options.length &gt; <span class="number">1</span>)&#123;</div><div class="line">                        game.mode = <span class="string">'menu'</span>;</div><div class="line">                        game.options.data.mode = <span class="string">'enter'</span>;</div><div class="line">                        createMenu(game);</div><div class="line">                    &#125;<span class="keyword">else</span>&#123;</div><div class="line">                        changeMap(game);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// if cell has a unit on it</span></div><div class="line">                <span class="keyword">if</span>(clickedCell.unit)&#123;</div><div class="line">                    <span class="keyword">var</span> unit = clickedCell.unit; </div><div class="line">                    <span class="keyword">if</span>(unit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">                        <span class="comment">// set meleeTarget index</span></div><div class="line">                        game.player.meleeTarget = clickedCell.i;</div><div class="line">                        game.turnState = <span class="string">'start'</span>;</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// default action is to try to move to the cell</span></div><div class="line">                game.player.moveCells = getMoveCells(game, pCell, clickedCell);</div><div class="line">                game.turnState = <span class="string">'start'</span>;</div><div class="line">            &#125;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span>(game.mode === <span class="string">'menu'</span>)&#123;</div><div class="line">                <span class="keyword">var</span> clicked = poolMod.getOverlaping(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">w</span>:<span class="number">1</span>, <span class="attr">h</span>:<span class="number">1</span>, <span class="attr">x</span>: x, <span class="attr">y</span>: y&#125;, game.options);</div><div class="line">                <span class="keyword">if</span>(clicked.length &gt;= <span class="number">1</span>)&#123;</div><div class="line">                    game.options.data.mode = <span class="string">'exit'</span>;</div><div class="line">                    game.options.data.activeButton = clicked[<span class="number">0</span>];</div><div class="line">                    <span class="comment">//clicked[0].data.onClick(sm, clicked[0]);</span></div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                   <span class="comment">// no button was clicked</span></div><div class="line">                   game.mode = <span class="string">'map'</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h3 id="1-2-The-draw-js-fire-for-drawing-to-the-canvas"><a href="#1-2-The-draw-js-fire-for-drawing-to-the-canvas" class="headerlink" title="1.2 - The draw.js fire for drawing to the canvas"></a>1.2 - The draw.js fire for drawing to the canvas</h3><p>Later in this source code I have a canvas element reference that is what will be used to draw the current state of a game object. I have got into the habit a long time ago to septate logic that has to do with a game object from logic that has to do with drawing that game state object. SO then this is that Logic that has to do with drawing the current map of a game world map, as well as various other things that I wanted rendered to the canvas.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// public api</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// unit colors</span></div><div class="line">    <span class="keyword">var</span> unitColors = [<span class="string">'green'</span>, <span class="string">'gray'</span>, <span class="string">'blue'</span>, <span class="string">'red'</span>];</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     HELPERS</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line"><span class="comment">// draw an hp bar for the given cell, if it has a vaild unit</span></div><div class="line"><span class="keyword">var</span> drawHPBar = <span class="function"><span class="keyword">function</span>(<span class="params">sm, cell</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> unit = cell.unit;</div><div class="line">    <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">    <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex];</div><div class="line">    <span class="keyword">var</span> cs = map.cellSize;</div><div class="line">    <span class="keyword">var</span> x = map.margin.x + cell.x * cs;</div><div class="line">    <span class="keyword">var</span> y = map.margin.y + cell.y * cs;</div><div class="line">    <span class="keyword">if</span> (unit) &#123;</div><div class="line">        <span class="keyword">if</span>(unit.type == <span class="string">'player'</span> || unit.type === <span class="string">'enemy'</span>)&#123;</div><div class="line">             <span class="comment">// hp bar back</span></div><div class="line">             ctx.fillStyle = <span class="string">'gray'</span>;</div><div class="line">             ctx.beginPath();</div><div class="line">             ctx.rect(x, y, cs, <span class="number">5</span>);</div><div class="line">             ctx.fill();</div><div class="line">             ctx.stroke();</div><div class="line">             <span class="comment">// current hp</span></div><div class="line">             <span class="keyword">var</span> per = unit.HP / unit.maxHP;</div><div class="line">             ctx.fillStyle = <span class="string">'lime'</span>;</div><div class="line">             ctx.beginPath();</div><div class="line">             ctx.rect(x, y, cs * per, <span class="number">5</span>);</div><div class="line">             ctx.fill();</div><div class="line">             ctx.stroke();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// draw a cell helper</span></div><div class="line"><span class="keyword">var</span> drawCell = <span class="function"><span class="keyword">function</span>(<span class="params">sm, cell</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex];</div><div class="line">    <span class="keyword">var</span> ctx = sm.ctx;</div><div class="line">    <span class="keyword">var</span> cs = map.cellSize;</div><div class="line">    <span class="keyword">var</span> x = map.margin.x + cell.x * cs;</div><div class="line">    <span class="keyword">var</span> y = map.margin.y + cell.y * cs;</div><div class="line">    <span class="comment">// draw base cell</span></div><div class="line">    ctx.fillStyle = unitColors[<span class="number">0</span>];</div><div class="line">    <span class="comment">// if we have a unit</span></div><div class="line">    <span class="keyword">if</span> (cell.unit) &#123;</div><div class="line">        ctx.fillStyle = unitColors[cell.unit.sheetIndex];</div><div class="line">    &#125;</div><div class="line">    ctx.beginPath();</div><div class="line">    ctx.rect(x, y, cs, cs);</div><div class="line">    ctx.fill();</div><div class="line">    ctx.stroke();</div><div class="line">    drawHPBar(sm, cell);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     PUBLIC API</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line">    <span class="comment">// draw background</span></div><div class="line">    api.back = <span class="function"><span class="keyword">function</span> (<span class="params">sm, style</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = sm.canvas,</div><div class="line">        ctx = sm.ctx;</div><div class="line">        ctx.fillStyle = style || <span class="string">'black'</span>;</div><div class="line">        ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    &#125;;</div><div class="line">    api.options = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = sm.canvas,</div><div class="line">        pool = sm.game.options,</div><div class="line">        ctx = sm.ctx,</div><div class="line">        opt = &#123;&#125;;</div><div class="line">        <span class="comment">// based off of pool-solid draw method in mod-pool.js in Clucker</span></div><div class="line">        pool.objects.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">            ctx.fillStyle = opt.fillStyle || obj.data.fillStyle || <span class="string">'white'</span>;</div><div class="line">            ctx.strokeStyle = opt.strokeStyle || obj.data.strokeStyle || <span class="string">'black'</span>;</div><div class="line">            <span class="keyword">if</span> (obj.active || opt.drawAll) &#123;</div><div class="line">                <span class="keyword">var</span> cx = obj.x + obj.w / <span class="number">2</span>,</div><div class="line">                cy = obj.y + obj.h / <span class="number">2</span>;</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.arc(cx, cy,  (obj.w + obj.h) / <span class="number">2</span> / <span class="number">2</span> , <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</div><div class="line">                ctx.fill();</div><div class="line">                ctx.stroke();</div><div class="line">                <span class="keyword">if</span>(obj.data.desc)&#123;</div><div class="line">                    ctx.fillStyle = <span class="string">'black'</span>;</div><div class="line">                    ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">                    ctx.textBaseline = <span class="string">'middle'</span>;</div><div class="line">                    ctx.fillText(obj.data.desc, cx, cy);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// bland place holder title text</span></div><div class="line">    api.titleText = <span class="function"><span class="keyword">function</span>(<span class="params">sm</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = sm.canvas,</div><div class="line">        ctx = sm.ctx;</div><div class="line">        <span class="comment">// text style</span></div><div class="line">        ctx.fillStyle = <span class="string">'white'</span>;</div><div class="line">        ctx.font = <span class="string">'20px courier'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'center'</span>;</div><div class="line">        <span class="keyword">var</span> x = canvas.width / <span class="number">2</span>,</div><div class="line">        y = canvas.height * <span class="number">0.25</span>;</div><div class="line">        ctx.fillText(<span class="string">'Turn Based RPG Prototype'</span>, x, y);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw the map</span></div><div class="line">    api.map = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> map = sm.game.maps[sm.game.mapIndex],</div><div class="line">        i = <span class="number">0</span>,</div><div class="line">        len = map.cells.length;</div><div class="line">        <span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">            drawCell(sm, map.cells[i]);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw version number</span></div><div class="line">    api.ver = <span class="function"><span class="keyword">function</span>(<span class="params">sm, style</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx,</div><div class="line">        canvas = sm.canvas;</div><div class="line">        <span class="comment">// text style</span></div><div class="line">        ctx.fillStyle = style || <span class="string">'white'</span>;</div><div class="line">        ctx.font = <span class="string">'8px courier'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        <span class="comment">// version number</span></div><div class="line">        ctx.fillText(<span class="string">'v'</span> + sm.ver, <span class="number">1</span>, canvas.height - <span class="number">10</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw info</span></div><div class="line">    api.info = <span class="function"><span class="keyword">function</span> (<span class="params">sm</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ctx = sm.ctx,</div><div class="line">        pos = sm.input.pos,</div><div class="line">        pCell = gameMod.getPlayerCell(sm.game),</div><div class="line">        canvas = sm.canvas,</div><div class="line">        dy = <span class="number">12</span>;</div><div class="line">        <span class="comment">// text style</span></div><div class="line">        ctx.fillStyle = <span class="string">'yellow'</span>;</div><div class="line">        ctx.font = <span class="string">'10px courier'</span>;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        <span class="comment">// draw current pointer position</span></div><div class="line">        ctx.fillText(<span class="string">'pos: '</span> + pos.x + <span class="string">','</span> + pos.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">0</span>);</div><div class="line">        <span class="comment">// player cell pos</span></div><div class="line">        ctx.fillText(<span class="string">'player pos: '</span> + pCell.x + <span class="string">','</span> + pCell.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">1</span>);</div><div class="line">        <span class="comment">// to map values</span></div><div class="line">        <span class="keyword">var</span> tm = sm.game.toMap;</div><div class="line">        ctx.fillText(<span class="string">'toMap: mi:'</span> + tm.index + <span class="string">', x: '</span> + tm.x + <span class="string">', y: '</span> + tm.y, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">2</span>);</div><div class="line">        ctx.fillText(<span class="string">'toMap.options:'</span> + <span class="built_in">JSON</span>.stringify(tm.options.map(<span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123; </div><div class="line">            <span class="keyword">return</span> opt.dir + <span class="string">'('</span> + opt.x + <span class="string">','</span> + opt.y + <span class="string">');'</span> + opt.mi;</div><div class="line">        &#125;)) , <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">3</span>);</div><div class="line">        <span class="comment">// turn number and turnChange bool</span></div><div class="line">        ctx.fillText(<span class="string">'turn:'</span> + sm.game.turn + <span class="string">', turnState: '</span> + sm.game.turnState, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">4</span>);</div><div class="line">        <span class="comment">// enemies</span></div><div class="line">        ctx.fillText(<span class="string">'enemies:'</span> + sm.game.remainingEnemies, <span class="number">5</span>, <span class="number">5</span> + dy * <span class="number">5</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public api to draw variable</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="2-Core-libraries-of-this-example"><a href="#2-Core-libraries-of-this-example" class="headerlink" title="2 - Core libraries of this example"></a>2 - Core libraries of this example</h2><p>I have took a moment to think in terms of what it is that I can pull out of my main game module and into a library that is its own independent thing. With that said thus far I have a general utilities library, as well as libraries that have to do with units, the game world map, and an object pool system that I am currently using with my menu system thus far. As I continue working on this example I am sure that this is a collection that will just continue to grow for the sake of keeping things fine grain and modular.</p>
<h3 id="2-1-The-utils-js-lib-that-contains-various-utilty-methods"><a href="#2-1-The-utils-js-lib-that-contains-various-utilty-methods" class="headerlink" title="2.1 - The utils.js lib that contains various utilty methods"></a>2.1 - The utils.js lib that contains various utilty methods</h3><p>This is what I have together for a general untiles library thus far when it comes to this turn based game example. The general idea here is to have <a href="/2019/02/15/lodash/">something like lodash</a>, only it is composed of methods that I am actually using in my various other libraries and javaScript files that have to do with the over all logic of this project. This is a usual library that will be found in just about any of my javaScript or canvas examples another the collection of methods will change up a little from one example to another. I do however have another <a href="/2021/08/06/js-javascript-example-utils/">utils javaScript example</a> in which I have one that is composed with a whole much of usual suspect type methods such as the distance formula and bounding box.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UTILS</span></div><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"><span class="comment">// get a value by way of a per value (0-1), and a min and max value</span></div><div class="line">utils.valueByRange = <span class="function"><span class="keyword">function</span>(<span class="params">per, nMin, nMax</span>)</span>&#123;</div><div class="line">    per = per === <span class="literal">undefined</span> ? <span class="number">0</span> : per;</div><div class="line">    nMin = nMin === <span class="literal">undefined</span> ? <span class="number">0</span> : nMin;</div><div class="line">    nMax = nMax === <span class="literal">undefined</span> ? <span class="number">1</span> : nMax;</div><div class="line">    <span class="keyword">return</span> nMin + <span class="built_in">Math</span>.round(per * (nMax - nMin));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// bounding box</span></div><div class="line">utils.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, w1, h1, x2, y2, w2, h2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !(</div><div class="line">        y1 + h1 &lt; y2 ||</div><div class="line">        y1 &gt; y2 + h2 ||</div><div class="line">        x1 + w1 &lt; x2 ||</div><div class="line">        x1 &gt; x2 + w2);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// distance</span></div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// angle from one point to another</span></div><div class="line">utils.angleToPoint = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2, scale</span>) </span>&#123;</div><div class="line">    scale = scale === <span class="literal">undefined</span> ? <span class="built_in">Math</span>.PI * <span class="number">2</span> : scale;</div><div class="line">    <span class="keyword">var</span> aTan = <span class="built_in">Math</span>.atan2(y1 - y2, x1 - x2);</div><div class="line">    <span class="keyword">return</span> (aTan + <span class="built_in">Math</span>.PI) / (<span class="built_in">Math</span>.PI * <span class="number">2</span>) * scale;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get a point relative to a canvas element rather than window</span></div><div class="line">utils.getCanvasRelative = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = e.target,</div><div class="line">    bx = canvas.getBoundingClientRect(),</div><div class="line">    pos = &#123;</div><div class="line">        <span class="attr">x</span>: <span class="built_in">Math</span>.floor((e.touches ? e.touches[<span class="number">0</span>].clientX : e.clientX) - bx.left),</div><div class="line">        <span class="attr">y</span>: <span class="built_in">Math</span>.floor((e.touches ? e.touches[<span class="number">0</span>].clientY : e.clientY) - bx.top),</div><div class="line">        <span class="attr">bx</span>: bx</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// adjust for native canvas matrix size</span></div><div class="line">    pos.x = <span class="built_in">Math</span>.floor((pos.x / canvas.scrollWidth) * canvas.width);</div><div class="line">    pos.y = <span class="built_in">Math</span>.floor((pos.y / canvas.scrollHeight) * canvas.height);</div><div class="line">    <span class="keyword">return</span> pos;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// deep clone using JSON</span></div><div class="line">utils.deepCloneJSON = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</div><div class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(e.message);</div><div class="line">        <span class="built_in">console</span>.log(obj);</div><div class="line">        <span class="keyword">return</span> &#123;&#125;;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="2-2-The-units-js-lib-for-now"><a href="#2-2-The-units-js-lib-for-now" class="headerlink" title="2.2 - The units.js lib for now"></a>2.2 - The units.js lib for now</h3><p>This is a lib in which I have pulled a lot of logic out from game.js and has to do with units that will be found in a map. I have expanded on it a little more sense then, and will likely continue doing so in future revisions so I think I should not write to much about this one at this time.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> unitMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">// PUBLIC API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     SET STAT HELPER</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line">   <span class="keyword">var</span> setStat = &#123;&#125;;</div><div class="line">   </div><div class="line">   setStat.attack = <span class="function"><span class="keyword">function</span>(<span class="params">unit</span>)</span>&#123;</div><div class="line">       unit.attack = unit.baseAttack.map(<span class="function"><span class="keyword">function</span>(<span class="params">ba, i</span>)</span>&#123;</div><div class="line">           <span class="comment">// ref to 'current' weapon if any</span></div><div class="line">           <span class="keyword">var</span> cw = unit.currentWeapon != <span class="literal">null</span> ? unit.currentWeapon.attack[i]: <span class="number">0</span>;</div><div class="line">           <span class="comment">// base attack value + current attack</span></div><div class="line">           <span class="keyword">return</span> ba + cw;</div><div class="line">           </div><div class="line">       &#125;);</div><div class="line">   &#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     CREATE A UNIT</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line">    <span class="comment">// create a base unit object</span></div><div class="line">    <span class="keyword">var</span> createBaseUnit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> unit = &#123;</div><div class="line">            <span class="comment">// current unit stats</span></div><div class="line">            maxHP: <span class="number">1</span>,             <span class="comment">// max number of hit points for the unit</span></div><div class="line">            maxCellsPerTurn: <span class="number">0</span>,   <span class="comment">// the max number of cells a unit can move</span></div><div class="line">            baseAttack: [<span class="number">1</span>, <span class="number">1</span>],   <span class="comment">// base attack</span></div><div class="line">            baseDefense: [<span class="number">0</span>, <span class="number">0</span>],  <span class="comment">// base defense</span></div><div class="line">            attack: [<span class="number">0</span>, <span class="number">0</span>],</div><div class="line">            <span class="comment">// equipment</span></div><div class="line">            meleeWeapon: <span class="literal">null</span>,</div><div class="line">            <span class="attr">currentWeapon</span>: <span class="literal">null</span>,  <span class="comment">// the current active weapon</span></div><div class="line">            <span class="comment">// current values</span></div><div class="line">            HP: <span class="number">1</span>,</div><div class="line">            <span class="attr">weaponIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">sheetIndex</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">type</span>: <span class="literal">null</span>,</div><div class="line">            <span class="attr">meleeTarget</span>: <span class="literal">null</span>, <span class="comment">// cell index to attack in 'melee' processTurn state</span></div><div class="line">            moveCells: [], <span class="comment">// array of cells to move in 'move' processTurn state</span></div><div class="line">            currentCellIndex: <span class="literal">null</span>,</div><div class="line">            <span class="attr">active</span>: <span class="literal">true</span></div><div class="line">        &#125;;</div><div class="line">        setStat.attack(unit);</div><div class="line">        <span class="keyword">return</span> unit;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> UNIT_TYPES = &#123;&#125;;</div><div class="line">    <span class="comment">// player type</span></div><div class="line">    UNIT_TYPES.player = &#123;</div><div class="line">        <span class="attr">create</span> : <span class="function"><span class="keyword">function</span>(<span class="params">player</span>)</span>&#123;</div><div class="line">            player.maxCellsPerTurn = <span class="number">3</span>;</div><div class="line">            player.sheetIndex = <span class="number">2</span>; <span class="comment">// player sheet</span></div><div class="line">            player.maxHP = <span class="number">50</span>;</div><div class="line">            player.baseAttack = [<span class="number">1</span>, <span class="number">3</span>];</div><div class="line">            player.baseDefense = [<span class="number">1</span>, <span class="number">2</span>];</div><div class="line">            player.currentWeapon = &#123;</div><div class="line">                <span class="attr">attack</span>: [<span class="number">5</span>, <span class="number">7</span>]</div><div class="line">            &#125;;</div><div class="line">            setStat.attack(player);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// enemy type</span></div><div class="line">    UNIT_TYPES.enemy = &#123;</div><div class="line">        <span class="attr">create</span> : <span class="function"><span class="keyword">function</span>(<span class="params">enemy</span>)</span>&#123;</div><div class="line">            enemy.maxCellsPerTurn = <span class="number">2</span>;</div><div class="line">            enemy.sheetIndex = <span class="number">3</span>;</div><div class="line">            enemy.maxHP = <span class="number">8</span>;</div><div class="line">            enemy.baseAttack = [<span class="number">2</span>, <span class="number">5</span>];</div><div class="line">            enemy.baseDefense = [<span class="number">1</span>, <span class="number">2</span>];</div><div class="line">            setStat.attack(enemy);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// wall type</span></div><div class="line">    UNIT_TYPES.wall = &#123;</div><div class="line">        <span class="attr">create</span> : <span class="function"><span class="keyword">function</span>(<span class="params">wall</span>)</span>&#123;</div><div class="line">            wall.sheetIndex = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// Public unitMod.create method</span></div><div class="line">    api.createUnit = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> unit = createBaseUnit();</div><div class="line">        unit.type = type;</div><div class="line">        <span class="comment">// call create method for the type</span></div><div class="line">        UNIT_TYPES[type].create(unit);</div><div class="line">        <span class="comment">// return the unit</span></div><div class="line">        <span class="keyword">return</span> unit;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">/********** **********</span></div><div class="line">     MELEE ATTACK</div><div class="line">*********** *********/</div><div class="line"> </div><div class="line">    <span class="comment">// do a melee attack with the given units</span></div><div class="line">    api.meleeAttack = <span class="function"><span class="keyword">function</span>(<span class="params">attacker, target</span>)</span>&#123;</div><div class="line">        <span class="comment">// make sure attack stat is up to date</span></div><div class="line">        setStat.attack(attacker);</div><div class="line">        <span class="comment">// figure raw attack</span></div><div class="line">        <span class="keyword">var</span> fa = attacker.attack,</div><div class="line">        ra = utils.valueByRange(<span class="built_in">Math</span>.random(), fa[<span class="number">0</span>], fa[<span class="number">1</span>]);</div><div class="line">        <span class="comment">// figure target defense</span></div><div class="line">        <span class="keyword">var</span> bd = target.baseDefense,</div><div class="line">        d = utils.valueByRange(<span class="built_in">Math</span>.random(), bd[<span class="number">0</span>], bd[<span class="number">1</span>]);</div><div class="line">        <span class="comment">// figure attack value</span></div><div class="line">        <span class="keyword">var</span> a = ra - d;</div><div class="line">        <span class="comment">// attack can not go below zero</span></div><div class="line">        a = a &lt; <span class="number">0</span> ? <span class="number">0</span> : a;</div><div class="line">        <span class="comment">// take hp from target</span></div><div class="line">        target.HP -= a;</div><div class="line">        target.HP = target.HP &lt; <span class="number">0</span> ? <span class="number">0</span> : target.HP;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h3 id="2-3-The-map-js-lib"><a href="#2-3-The-map-js-lib" class="headerlink" title="2.3 - The map.js lib"></a>2.3 - The map.js lib</h3><p>This is the map.js lib from my other javaScript example that has to do with grid unit movement, that also includes path detection code based on what I worked out for my post on that subject also. I have not changed much with this lib sense then and at this point I think that any future work might just involve fixing any unseen bugs, and various other improvements rather than adding new feature to this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mapMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// create Cells helper</span></div><div class="line">    <span class="keyword">var</span> createCells = <span class="function"><span class="keyword">function</span> (<span class="params">map</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cells = [];</div><div class="line">        <span class="keyword">var</span> len = map.w * map.h,</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">            cells.push(&#123;</div><div class="line">                <span class="attr">i</span>: i,</div><div class="line">                <span class="attr">x</span>: i % map.w,</div><div class="line">                <span class="attr">y</span>: <span class="built_in">Math</span>.floor(i / map.w),</div><div class="line">                <span class="attr">walkable</span>: <span class="literal">true</span>,</div><div class="line">                <span class="attr">closed</span>: <span class="literal">false</span>,</div><div class="line">                <span class="attr">data</span>: &#123;&#125;,</div><div class="line">                <span class="attr">unit</span>: <span class="literal">null</span> <span class="comment">// reference to current unit here or null if empty</span></div><div class="line">            &#125;);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> cells;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// PUBLIC API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// create a new map object</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> map = &#123;</div><div class="line">            <span class="attr">w</span>: opt.w || <span class="number">9</span>,</div><div class="line">            <span class="attr">h</span>: opt.h || <span class="number">7</span>,</div><div class="line">            <span class="attr">cellSize</span>: <span class="number">32</span>,</div><div class="line">            <span class="attr">margin</span>: &#123;</div><div class="line">                <span class="attr">x</span>: opt.marginX == <span class="literal">undefined</span> ? <span class="number">5</span> : opt.marginX,</div><div class="line">                <span class="attr">y</span>: opt.marginY == <span class="literal">undefined</span> ? <span class="number">5</span> : opt.marginY</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">cells</span>: []</div><div class="line">        &#125;;</div><div class="line">        map.cells = opt.cells || createCells(map);</div><div class="line">        <span class="keyword">return</span> map;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return a cell at the given position, or false for out of bounds values</span></div><div class="line">    api.get = <span class="function"><span class="keyword">function</span> (<span class="params">map, xi, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">arguments</span>.length === <span class="number">2</span>)&#123;</div><div class="line">            <span class="keyword">return</span> map.cells[xi];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (xi &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || xi &gt;= map.w || y &gt;= map.h) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> map.cells[y * map.w + xi];</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a cell in the current map by way of</span></div><div class="line">    <span class="comment">// a canvas relative x and y pixel pos</span></div><div class="line">    api.getCellByPointer = <span class="function"><span class="keyword">function</span> (<span class="params">map, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cx = <span class="built_in">Math</span>.floor((x - map.margin.x) / map.cellSize),</div><div class="line">        cy = <span class="built_in">Math</span>.floor((y - map.margin.y) / map.cellSize);</div><div class="line">        <span class="keyword">return</span> api.get(map, cx, cy)</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">/***</span></div><div class="line">PATHS</div><div class="line">***/</div><div class="line"> </div><div class="line">    <span class="comment">// sort a list of open nodes</span></div><div class="line">    <span class="keyword">var</span> sortOpen = <span class="function"><span class="keyword">function</span> (<span class="params">opened</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> opened.sort(<span class="function"><span class="keyword">function</span> (<span class="params">nodeA, nodeB</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (nodeA.weight &lt; nodeB.weight) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (nodeA.weight &gt; nodeB.weight) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// set weight for a node</span></div><div class="line">    <span class="keyword">var</span> setWeight = <span class="function"><span class="keyword">function</span> (<span class="params">endNode, neighbor</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> utils.distance(endNode.x, endNode.y, neighbor.x, neighbor.y);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// build a path based an parent property</span></div><div class="line">    <span class="keyword">var</span> buildPath = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> path = [];</div><div class="line">        <span class="keyword">while</span> (node.parent) &#123;</div><div class="line">            path.push([node.x, node.y]);</div><div class="line">            node = node.parent;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//path.push([node.x, node.y]);</span></div><div class="line">        <span class="keyword">return</span> path;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// for Each Neighbor for the given grid, node, and open list</span></div><div class="line">    <span class="keyword">var</span> forNeighbors = <span class="function"><span class="keyword">function</span> (<span class="params">grid, node, endNode, opened</span>) </span>&#123;</div><div class="line">        <span class="comment">//var neighbors = grid.getNeighbors(node);</span></div><div class="line">        <span class="keyword">var</span> neighbors = mapMod.getNeighbors(grid, node);</div><div class="line">        <span class="keyword">var</span> ni = <span class="number">0</span>,</div><div class="line">        nl = neighbors.length;</div><div class="line">        <span class="keyword">while</span> (ni &lt; nl) &#123;</div><div class="line">            <span class="keyword">var</span> neighbor = neighbors[ni];</div><div class="line">            <span class="comment">// if the neighbor is closed continue looping</span></div><div class="line">            <span class="keyword">if</span> (neighbor.closed) &#123;</div><div class="line">                ni += <span class="number">1</span>;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// set weight for the neighbor</span></div><div class="line">            neighbor.weight = setWeight(endNode, neighbor);</div><div class="line">            <span class="comment">// if the node is not opened</span></div><div class="line">            <span class="keyword">if</span> (!neighbor.opened) &#123;</div><div class="line">                neighbor.parent = node;</div><div class="line">                opened.push(neighbor);</div><div class="line">                neighbor.opened = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            ni += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    api.getPath = <span class="function"><span class="keyword">function</span> (<span class="params">grid, sx, sy, ex, ey</span>) </span>&#123;</div><div class="line">        <span class="comment">// copy the given grid</span></div><div class="line">        <span class="comment">//var grid = Grid.fromMatrix(givenGrid.nodes),</span></div><div class="line">        <span class="keyword">var</span> grid = utils.deepCloneJSON(grid),</div><div class="line">        <span class="comment">//var grid = utils.deepClone(grid, &#123;</span></div><div class="line">        <span class="comment">//    forRecursive: function()&#123; return &#123;&#125; &#125;</span></div><div class="line">        <span class="comment">//&#125;),</span></div><div class="line">        nodes = api.chunk(grid),</div><div class="line">        path = [],</div><div class="line">        opened = [],</div><div class="line">        node;</div><div class="line">        <span class="comment">// set startNode and End Node to copy of grid</span></div><div class="line">        <span class="keyword">var</span> startNode = nodes[sy][sx];</div><div class="line">        endNode = nodes[ey][ex];</div><div class="line">        <span class="comment">// push start Node to open list</span></div><div class="line">        opened.push(startNode);</div><div class="line">        startNode.opened = <span class="literal">true</span>;</div><div class="line">        startNode.weight = <span class="number">0</span>;</div><div class="line">        <span class="comment">// start walking</span></div><div class="line">        <span class="keyword">while</span> (opened.length &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// pop out next Node from open list</span></div><div class="line">            node = opened.pop();</div><div class="line">            node.closed = <span class="literal">true</span>;</div><div class="line">            <span class="comment">// if the node is the end node</span></div><div class="line">            <span class="keyword">if</span> (node === endNode) &#123;</div><div class="line">                <span class="keyword">return</span> buildPath(node);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// loop current neighbors</span></div><div class="line">            forNeighbors(grid, node, endNode, opened);</div><div class="line">            <span class="comment">// sort the list of nodes be weight value to end node</span></div><div class="line">            sortOpen(opened);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return an empty array if we get here (can not get to end node)</span></div><div class="line">        <span class="keyword">return</span> [];</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get a chunk form of a grid</span></div><div class="line">    api.chunk = <span class="function"><span class="keyword">function</span> (<span class="params">grid</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> arr = [],</div><div class="line">        row,</div><div class="line">        i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i &lt; grid.cells.length) &#123;</div><div class="line">            row = grid.cells.slice(i, i + grid.w);</div><div class="line">            arr.push(row);</div><div class="line">            i += grid.w;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> arr;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return true if the given x and y position is in bounds</span></div><div class="line">    api.isInBounds = <span class="function"><span class="keyword">function</span> (<span class="params">grid, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> (x &gt;= <span class="number">0</span> &amp;&amp; x &lt; grid.w) &amp;&amp; (y &gt;= <span class="number">0</span> &amp;&amp; y &lt; grid.h);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// is the given cell location walkable?</span></div><div class="line">    api.isWalkable = <span class="function"><span class="keyword">function</span> (<span class="params">grid, x, y</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (api.isInBounds(grid, x, y)) &#123;</div><div class="line">            <span class="keyword">return</span> api.get(grid, x, y).walkable; <span class="comment">//grid.nodes[y][x].walkable;</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get the four Neighbors of a node</span></div><div class="line">    api.getNeighbors = <span class="function"><span class="keyword">function</span> (<span class="params">grid, node</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> x = node.x,</div><div class="line">        y = node.y,</div><div class="line">        neighbors = [];</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x, y - <span class="number">1</span>)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y - 1][x]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x, y - <span class="number">1</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x, y + <span class="number">1</span>)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y + 1][x]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x, y + <span class="number">1</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x - <span class="number">1</span>, y)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y][x - 1]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x - <span class="number">1</span>, y));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (api.isWalkable(grid, x + <span class="number">1</span>, y)) &#123;</div><div class="line">            <span class="comment">//neighbors.push(this.nodes[y][x + 1]);</span></div><div class="line">            neighbors.push(mapMod.get(grid, x + <span class="number">1</span>, y));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> neighbors;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h3 id="2-4-The-pool-js-file"><a href="#2-4-The-pool-js-file" class="headerlink" title="2.4 - The pool.js file"></a>2.4 - The pool.js file</h3><p>This is a object pool library that I puled from my game framework project that I have been working on for a while. As such I am seeing some things that I think I would like to change and add from that thus far, and when I do I will likely add those changes to future revisions of that framework.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> poolMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// get next inactive object in the given pool</span></div><div class="line">    <span class="keyword">var</span> getInactive = <span class="function"><span class="keyword">function</span> (<span class="params">pool</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a new pool</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.count = opt.count || <span class="number">10</span>;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        pool = &#123;</div><div class="line">            <span class="attr">objects</span>: [],</div><div class="line">            <span class="attr">secsCap</span>: opt.secsCap === <span class="literal">undefined</span> ? <span class="literal">Infinity</span> : opt.secsCap,</div><div class="line">            <span class="attr">disableLifespan</span>: opt.disableLifespan || <span class="literal">false</span>,</div><div class="line">            <span class="attr">data</span>: opt.data || &#123;&#125;,</div><div class="line">            <span class="attr">spawn</span>: opt.spawn || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, opt</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">purge</span>: opt.purge || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">update</span>: opt.update || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, secs</span>) </span>&#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">while</span> (i &lt; opt.count) &#123;</div><div class="line">            pool.objects.push(&#123;</div><div class="line">                <span class="attr">active</span>: <span class="literal">false</span>,</div><div class="line">                <span class="attr">i</span>: i,</div><div class="line">                <span class="attr">x</span>: opt.x === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.x,</div><div class="line">                <span class="attr">y</span>: opt.y === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.y,</div><div class="line">                <span class="attr">w</span>: opt.w === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.w,</div><div class="line">                <span class="attr">h</span>: opt.h === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.h,</div><div class="line">                <span class="attr">heading</span>: opt.heading === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.heading,</div><div class="line">                <span class="attr">pps</span>: opt.pps === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.pps,</div><div class="line">                <span class="attr">lifespan</span>: opt.lifespan || <span class="number">3</span>,</div><div class="line">                <span class="attr">data</span>: &#123;&#125;</div><div class="line">            &#125;);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> pool;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// spawn the next inactive object in the given pool</span></div><div class="line">    api.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">pool, state, opt</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = getInactive(pool);</div><div class="line">        state = state || &#123;&#125;;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (obj) &#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active = <span class="literal">true</span>;</div><div class="line">                pool.spawn.call(pool, obj, pool, state, opt);</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// spawn all objects</span></div><div class="line">    api.spawnAll = <span class="function"><span class="keyword">function</span>(<span class="params">pool, state, opt</span>)</span>&#123;</div><div class="line">        pool.objects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active = <span class="literal">true</span>;</div><div class="line">                pool.spawn.call(pool, obj, pool, state, opt);</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> pool.objects;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// purge an object ( make it inactive and call the purge method for the pool )</span></div><div class="line">    api.purge = <span class="function"><span class="keyword">function</span>(<span class="params">pool, obj, state</span>)</span>&#123;</div><div class="line">        obj.active = <span class="literal">false</span>;</div><div class="line">        pool.purge.call(pool, obj, pool, state);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// spawn all objects</span></div><div class="line">    api.purgeAll = <span class="function"><span class="keyword">function</span>(<span class="params">pool, state, opt</span>)</span>&#123;</div><div class="line">        pool.objects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active =  <span class="literal">false</span>;</div><div class="line">                pool.purge.call(pool, obj, pool, state);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> pool.objects;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a pool object by a secs value</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">pool, secs, state</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        state = state || &#123;&#125;; <span class="comment">// your projects state object</span></div><div class="line">        secs = secs &gt; pool.secsCap ? pool.secsCap : secs;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                pool.update.call(pool, obj, pool, state, secs);</div><div class="line">                <span class="comment">// if disableLifespan featre</span></div><div class="line">                <span class="keyword">if</span>(pool.disableLifespan)&#123;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">// else use lifespan feature</span></div><div class="line">                    obj.lifespan -= secs;</div><div class="line">                    obj.lifespan = obj.lifespan &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.lifespan;</div><div class="line">                    <span class="keyword">if</span> (obj.lifespan === <span class="number">0</span>) &#123;</div><div class="line">                        obj.active = <span class="literal">false</span>;</div><div class="line">                        <span class="comment">//pool.purge.call(pool, obj, pool, state);</span></div><div class="line">                        api.purge.call(pool, pool, obj, state);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// set all to inActive or active state</span></div><div class="line">    api.setActiveStateForAll = <span class="function"><span class="keyword">function</span> (<span class="params">pool, bool</span>) </span>&#123;</div><div class="line">        bool = bool === <span class="literal">undefined</span> ? <span class="literal">false</span> : bool;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            obj.active = bool;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// move the given object by its current heading and pps</span></div><div class="line">    api.moveByPPS = <span class="function"><span class="keyword">function</span> (<span class="params">obj, secs</span>) </span>&#123;</div><div class="line">        obj.x += <span class="built_in">Math</span>.cos(obj.heading) * obj.pps * secs;</div><div class="line">        obj.y += <span class="built_in">Math</span>.sin(obj.heading) * obj.pps * secs;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// check bounds for the given display object and canvas and return true if the object</span></div><div class="line">    <span class="comment">// is out of bounds and false if it is not.</span></div><div class="line">    api.checkBounds = <span class="function"><span class="keyword">function</span> (<span class="params">obj, canvas</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj.x &gt;= canvas.width || obj.x &lt; obj.w * <span class="number">-1</span> || obj.y &gt; canvas.height || obj.y &lt; obj.h * <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// bounding box</span></div><div class="line">    api.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> utils.boundingBox(a.x, a.y, a.w, a.h, b.x, b.y, b.w, b.h);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// wrap an object to an area like a canvas</span></div><div class="line">    api.wrap = <span class="function"><span class="keyword">function</span>(<span class="params">obj, area, space</span>)</span>&#123;</div><div class="line">        area = area || &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>, <span class="attr">width</span>: <span class="number">640</span>, <span class="attr">height</span>: <span class="number">480</span> &#125;;</div><div class="line">        space = space === <span class="literal">undefined</span> ? <span class="number">32</span> : space;</div><div class="line">        <span class="keyword">if</span>(!utils.boundingBox(obj.x, obj.y, obj.w, obj.h, space * <span class="number">-1</span>, space * <span class="number">-1</span>, area.width + space, area.height + space))&#123;</div><div class="line">            obj.x = utils.mod(obj.x + space, area.width + space * <span class="number">2</span>) - space;</div><div class="line">            obj.y = utils.mod(obj.y + space, area.height + space * <span class="number">2</span>) - space;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a collection of overlaying active objects from a pool, that overlap with the gievn object</span></div><div class="line">    api.getOverlaping = <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        obj2,</div><div class="line">        overlap = [];</div><div class="line">        len = pool.objects.length;</div><div class="line">        <span class="keyword">if</span>(obj.active)&#123;</div><div class="line">            <span class="keyword">while</span>(i &lt; len)&#123;</div><div class="line">                obj2 = pool.objects[i];</div><div class="line">                <span class="keyword">if</span>(obj != obj2 &amp;&amp; obj2.active)&#123;</div><div class="line">                    <span class="keyword">if</span>(utils.boundingBox(obj.x, obj.y, obj.w, obj.h, obj2.x, obj2.y, obj2.w, obj2.h))&#123;</div><div class="line">                         overlap.push(obj2);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                i += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> overlap;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a current active count for a pool</span></div><div class="line">    api.getActiveCount = <span class="function"><span class="keyword">function</span>(<span class="params">pool</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> pool.objects.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, obj</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> obj.active ? acc += <span class="number">1</span>: acc;</div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get active objects from a pool</span></div><div class="line">    api.getActiveObjects = <span class="function"><span class="keyword">function</span>(<span class="params">pool</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> pool.objects.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, obj</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(obj.active)&#123;</div><div class="line">                acc.push(obj);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> acc;</div><div class="line">        &#125;, []);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get distance to object method</span></div><div class="line">    api.getDistanceToObj = <span class="function"><span class="keyword">function</span>(<span class="params">obj1, obj2</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> x1 = obj2.x + obj2.w / <span class="number">2</span>,</div><div class="line">        y1 = obj2.y + obj2.h / <span class="number">2</span>,</div><div class="line">        x2 = obj1.x + obj1.w / <span class="number">2</span>,</div><div class="line">        y2 = obj1.y + obj1.h / <span class="number">2</span>;</div><div class="line">        <span class="keyword">return</span> utils.distance(x1, y1, x2, y2);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return public method</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="3-The-state-machine-and-main-js"><a href="#3-The-state-machine-and-main-js" class="headerlink" title="3 - The state machine, and main.js"></a>3 - The state machine, and main.js</h2><p>For this example I made a new kind of state machine from the ground up rather than making use of what I have all ready made for this sort of thing. Still I am reproducing certain standards that I think such a system should have. I do this because I think that making a state machine from the ground up is just one of those things that I have have not got down to a science just yet. So I end up making a new one for each stand alone example thus far. That is not to say that I have not made an effort to make my own versions of a end all state machine library or framework rather. I have a javaScript example where the focus is to work out some things that I should have in such a project, and I also have a canvas example in which I touch base on this topic. I also to have a game framework project that I have been working on a little jow and then, so this is a wheel that I keep reinventing,and will likely continue doing until I have something that will worm well for me.</p>
<h3 id="3-1-The-root-sm-js-file"><a href="#3-1-The-root-sm-js-file" class="headerlink" title="3.1 - The root sm.js file"></a>3.1 - The root sm.js file</h3><p>This is the main state machine file thus far.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>),</div><div class="line">ctx = canvas.getContext(<span class="string">'2d'</span>),</div><div class="line">container = <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">container.appendChild(canvas);</div><div class="line">canvas.width = <span class="number">320</span>;</div><div class="line">canvas.height = <span class="number">240</span>;</div><div class="line">canvas.className = <span class="string">'canvas-layer'</span></div><div class="line">ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line"> </div><div class="line"><span class="comment">// disable default action for onselectstart</span></div><div class="line">canvas.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line"> </div><div class="line"><span class="comment">// state machine object</span></div><div class="line"><span class="keyword">var</span> sm = &#123;</div><div class="line">    <span class="attr">ver</span>: <span class="string">'0.5.0'</span>,</div><div class="line">    <span class="attr">fps</span>: <span class="number">12</span>,</div><div class="line">    <span class="attr">lt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line"> </div><div class="line">    <span class="comment">// states</span></div><div class="line">    states:&#123;&#125;,            <span class="comment">// collection of state objects</span></div><div class="line">    stateObj: <span class="literal">null</span>,       <span class="comment">// ref to current state object</span></div><div class="line">    currentState: <span class="string">''</span>,     <span class="comment">// current state object key name (see setState call in main.js)</span></div><div class="line"> </div><div class="line">    game: gameMod.create(&#123;</div><div class="line">        <span class="attr">marginX</span> : <span class="number">14</span>,</div><div class="line">        <span class="attr">marginY</span> : <span class="number">7</span>,</div><div class="line">        <span class="attr">w</span>: <span class="number">9</span>,</div><div class="line">        <span class="attr">h</span>: <span class="number">7</span>,</div><div class="line">        <span class="attr">maps</span>: [</div><div class="line">            <span class="comment">// TOP</span></div><div class="line">            <span class="string">'111111111'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'103030000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'100000001'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'111111111'</span> +</div><div class="line">            <span class="string">'000000000'</span> +</div><div class="line">            <span class="string">'000000300'</span> + </div><div class="line">            <span class="string">'000000000'</span> + </div><div class="line">            <span class="string">'000000000'</span> +</div><div class="line">            <span class="string">'000000000'</span> +</div><div class="line">            <span class="string">'100100000'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'111111111'</span> +</div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000301'</span> +</div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000301'</span> +</div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000301'</span>,</div><div class="line">            </div><div class="line">            <span class="comment">// middle</span></div><div class="line">            <span class="string">'100000001'</span> +</div><div class="line">            <span class="string">'103000001'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'100000001'</span> + </div><div class="line">            <span class="string">'100000001'</span> + </div><div class="line">            <span class="string">'103000001'</span> + </div><div class="line">            <span class="string">'100000001'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'100100000'</span> +</div><div class="line">            <span class="string">'100111010'</span> +</div><div class="line">            <span class="string">'000001010'</span> +</div><div class="line">            <span class="string">'100101030'</span> +</div><div class="line">            <span class="string">'100100111'</span> +</div><div class="line">            <span class="string">'100100200'</span> +</div><div class="line">            <span class="string">'100100000'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000031'</span> +</div><div class="line">            <span class="string">'000111111'</span> +</div><div class="line">            <span class="string">'111100031'</span> +</div><div class="line">            <span class="string">'000000001'</span> +</div><div class="line">            <span class="string">'000000001'</span>,</div><div class="line">            </div><div class="line">            <span class="comment">// bottom   </span></div><div class="line">            <span class="string">'100000001'</span> + </div><div class="line">            <span class="string">'100000001'</span> + </div><div class="line">            <span class="string">'100000001'</span> + </div><div class="line">            <span class="string">'103000000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'103030000'</span> + </div><div class="line">            <span class="string">'111111111'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'100100000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'100000000'</span> + </div><div class="line">            <span class="string">'000000000'</span> + </div><div class="line">            <span class="string">'000000000'</span> + </div><div class="line">            <span class="string">'000000300'</span> + </div><div class="line">            <span class="string">'111111111'</span>,</div><div class="line"> </div><div class="line">            <span class="string">'000000001'</span> + </div><div class="line">            <span class="string">'000000001'</span> + </div><div class="line">            <span class="string">'000000001'</span> + </div><div class="line">            <span class="string">'000000301'</span> + </div><div class="line">            <span class="string">'000000001'</span> + </div><div class="line">            <span class="string">'000000301'</span> + </div><div class="line">            <span class="string">'111111111'</span></div><div class="line">            </div><div class="line">        ]</div><div class="line">    &#125;),</div><div class="line">    <span class="attr">canvas</span>: canvas,</div><div class="line">    <span class="attr">ctx</span>: ctx,</div><div class="line">    <span class="attr">input</span>: &#123;</div><div class="line">        <span class="attr">pointerDown</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">pos</span>: &#123;</div><div class="line">            <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">y</span>: <span class="number">0</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// set the current state</span></div><div class="line">sm.setState = <span class="function"><span class="keyword">function</span>(<span class="params">newStateKey</span>)</span>&#123;</div><div class="line">    sm.currentState = newStateKey;</div><div class="line">    sm.stateObj = sm.states[sm.currentState];</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// call the given eventKey in the events object of the current state object</span></div><div class="line">sm.callStateEvent = <span class="function"><span class="keyword">function</span>(<span class="params">eventKey, e, opt</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(sm.stateObj)&#123;</div><div class="line">        <span class="keyword">var</span> events = sm.stateObj.events;</div><div class="line">        <span class="keyword">if</span>(events)&#123;</div><div class="line">            <span class="keyword">if</span>(events[eventKey])&#123;</div><div class="line">                events[eventKey].call(sm, e, opt, sm)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// pointer events</span></div><div class="line"><span class="keyword">var</span> pointerHanders = &#123;</div><div class="line">    <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = sm.input.pos = utils.getCanvasRelative(e);</div><div class="line">        <span class="keyword">if</span>(e.type === <span class="string">'touchstart'</span>)&#123;</div><div class="line">            e.preventDefault();</div><div class="line">        &#125;</div><div class="line">        sm.input.pointerDown = <span class="literal">true</span>;</div><div class="line">        sm.callStateEvent(<span class="string">'pointerStart'</span>, e, pos);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">move</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> pos = sm.input.pos = utils.getCanvasRelative(e);</div><div class="line">        sm.callStateEvent(<span class="string">'pointerMove'</span>, e, pos);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">end</span>: <span class="function"><span class="keyword">function</span> (<span class="params">sm, e</span>) </span>&#123;</div><div class="line">        sm.input.pointerDown = <span class="literal">false</span>;</div><div class="line">        sm.callStateEvent(<span class="string">'pointerEnd'</span>, e, sm.input.pos);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> createPointerHandler = <span class="function"><span class="keyword">function</span> (<span class="params">sm, type</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        pointerHanders[type](sm, e);</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line">canvas.addEventListener(<span class="string">'touchstart'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'touchmove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'touchend'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'mousedown'</span>, createPointerHandler(sm, <span class="string">'start'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'mousemove'</span>, createPointerHandler(sm, <span class="string">'move'</span>));</div><div class="line">canvas.addEventListener(<span class="string">'mouseup'</span>, createPointerHandler(sm, <span class="string">'end'</span>));</div></pre></td></tr></table></figure>
<h3 id="3-2-The-title-state-object"><a href="#3-2-The-title-state-object" class="headerlink" title="3.2 - The title state object"></a>3.2 - The title state object</h3><p>The title screen state object of the state machine.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">sm.states.title = &#123;</div><div class="line">    <span class="attr">key</span>: <span class="string">'title'</span>,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, secs</span>)</span>&#123;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, layers</span>)</span>&#123;</div><div class="line">        draw.back(sm);</div><div class="line">        draw.titleText(sm);</div><div class="line">        draw.ver(sm);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">events</span>: &#123;</div><div class="line">        <span class="attr">pointerEnd</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e, pos, sm</span>)</span>&#123;</div><div class="line">            <span class="comment">// set up a new game</span></div><div class="line">            gameMod.setupGame(sm.game, <span class="literal">true</span>);</div><div class="line">            <span class="comment">// change to game state</span></div><div class="line">            sm.setState(<span class="string">'game'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="3-3-The-game-state-object"><a href="#3-3-The-game-state-object" class="headerlink" title="3.3 - The game state object"></a>3.3 - The game state object</h3><p>The main game state object of the state machine.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">sm.states.game = &#123;</div><div class="line">    <span class="attr">key</span>: <span class="string">'game'</span>,</div><div class="line">    <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, secs</span>)</span>&#123;</div><div class="line">        gameMod.update(sm, secs);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">draw</span>: <span class="function"><span class="keyword">function</span>(<span class="params">sm, layers</span>)</span>&#123;</div><div class="line">        draw.back(sm);</div><div class="line">        draw.map(sm);</div><div class="line">        <span class="keyword">if</span>(sm.game.mode === <span class="string">'map'</span>)&#123;</div><div class="line">            draw.info(sm);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sm.game.mode === <span class="string">'menu'</span>)&#123;</div><div class="line">            draw.back(sm, <span class="string">'rgba(0,0,0,0.5)'</span>);</div><div class="line">            draw.options(sm);</div><div class="line">        &#125;</div><div class="line">        draw.ver(sm);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">events</span>: &#123;</div><div class="line">        <span class="attr">pointerStart</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e, pos, sm</span>)</span>&#123;</div><div class="line">            gameMod.pointerStart(sm, pos.x, pos.y);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">pointerEnd</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e, pos, sm</span>)</span>&#123;</div><div class="line">            gameMod.pointerEnd(sm, pos.x, pos.y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="3-4-The-main-js-file"><a href="#3-4-The-main-js-file" class="headerlink" title="3.4 - The main.js file"></a>3.4 - The main.js file</h3><p>The main javaScript file thus far where I am starting the main javaScript loop.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// set the current state</span></div><div class="line">sm.setState(<span class="string">'game'</span>);</div><div class="line"> </div><div class="line"><span class="comment">// loop with frame capping set by sm.fps value</span></div><div class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - sm.lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt;= <span class="number">1</span> / sm.fps)&#123;</div><div class="line">        sm.stateObj.update.call(sm, sm, secs);</div><div class="line">        sm.stateObj.draw.call(sm, sm, &#123;&#125;); <span class="comment">// empty object for 'layers' at least for now</span></div><div class="line">        sm.lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="4-Conclusion"><a href="#4-Conclusion" class="headerlink" title="4 - Conclusion"></a>4 - Conclusion</h2><p>So far I have to say that I like this example, and I would like to keep working on it at least a little while longer. In fact I might even make this the main thing that I am working out outside of this blog for a while. I do not want this to end up being the kind of project that I end up spending years of my life working on touch at least not in the form of what I have in mind of this specific javaScript project example at least. There is the idea of taking what I have worked out with this example thus far and once again starting a whole other project in which I continue to expand on this, but even when it comes to that I want to try my best to not go nuts with features. The project is all ready getting a little involve and less is often more when it comes to making a game.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/" data-id="clkyg7a5n02tl0gv14zd7u1zt" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/12/17/lodash_clamp/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          The lodash clamp number method and adding a wrap number method
        
      </div>
    </a>
  
  
    <a href="/2021/12/03/threejs-examples-menus/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Menus System threejs project example</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/index.html';
    this.page.identifier = '944';
    this.page.title = 'Making a turn based RPG game javaScript project example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.38px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.48px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.33px;">angular</a> <a href="/tags/animation/" style="font-size: 11.9px;">animation</a> <a href="/tags/automation/" style="font-size: 11.9px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.38px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.71px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.57px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.86px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.95px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.43px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.81px;">electronjs</a> <a href="/tags/express/" style="font-size: 17.14px;">express</a> <a href="/tags/games/" style="font-size: 17.62px;">games</a> <a href="/tags/git/" style="font-size: 13.81px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15.24px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.9px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.76px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.48px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.43px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 18.1px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.57px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.52px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.1px;">phaser</a> <a href="/tags/python/" style="font-size: 16.19px;">python</a> <a href="/tags/statistics/" style="font-size: 14.29px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.05px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.67px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/02/threejs-matrix4/">Matrix4 Objects in threejs</a>
          </li>
        
          <li>
            <a href="/2023/08/01/linux-folders/">Linux Root Folders</a>
          </li>
        
          <li>
            <a href="/2023/07/27/threejs-materials-loader/">The Matheral Loader in threejs</a>
          </li>
        
          <li>
            <a href="/2023/07/25/linux-lsb-release/">Linux System Base Release command lsb_release for Distribution info</a>
          </li>
        
          <li>
            <a href="/2023/07/19/threejs-object-loader/">The Object Loader in threejs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2021/12/10/js-javascript-example-turn-based-rpg/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>