<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner_2023.png">
  
  <title>The Buffer Geometry Constructor in threejs | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The basic example of a buffer Geometry in the three.js documentation works okay as a starting point, but it does not cover every little detail when it comes to what I should be aware of when making a">
<meta property="og:type" content="article">
<meta property="og:title" content="The Buffer Geometry Constructor in threejs">
<meta property="og:url" content="https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="The basic example of a buffer Geometry in the three.js documentation works okay as a starting point, but it does not cover every little detail when it comes to what I should be aware of when making a">
<meta property="og:updated_time" content="2023-08-23T16:58:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Buffer Geometry Constructor in threejs">
<meta name="twitter:description" content="The basic example of a buffer Geometry in the three.js documentation works okay as a starting point, but it does not cover every little detail when it comes to what I should be aware of when making a">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-threejs-buffer-geometry" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/22/threejs-buffer-geometry/" class="article-date"> Published:
  <time datetime="2021-04-22T20:11:00.000Z" itemprop="datePublished">2021-04-22</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2021/04/22/threejs-buffer-geometry/" class="article-date"> Modified:
  <time datetime="2023-08-23T16:58:49.000Z" itemprop="dateModified">2023-08-23</time>
</a>

    <span class="article-date">V1.75</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/three-js/">three.js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      The Buffer Geometry Constructor in threejs
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>The basic example of a <a href="https://threejs.org/docs/index.html#api/en/core/BufferGeometry.groups" target="_blank" rel="external">buffer Geometry in the three.js documentation works okay</a> as a starting point, but it does not cover every little detail when it comes to what I should be aware of when making a custom geometry. There is not just creating the positions attribute of a geometry, but also the normal, and uv attributes for a geometry as well that are also of importance when it comes to using custom geometries with various materials that use textures and respond to light sources. There are also a whole bunch of other details such as working out an array of groups, and material index values.</p>
<p>So in this post I will be going over the basic examples that I have worked out thus far when it comes to just working with some very simple starting points with a custom geometry using the buffer geometry constructor rather than the plain old geometry constructor. Also in this post I will be going over some examples that are just examples of the various prototype methods and features that one should know about when it comes to working with buffer geometry in general, regardless of what it was made.</p>
<a id="more"></a>
<iframe class="youtube_video" src="https://www.youtube.com/embed/l0CkGHtllxw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<h2 id="The-buffer-geometry-constructor-in-threejs-and-what-to-know-first"><a href="#The-buffer-geometry-constructor-in-threejs-and-what-to-know-first" class="headerlink" title="The buffer geometry constructor in threejs and what to know first"></a>The buffer geometry constructor in threejs and what to know first</h2><p>This is a post on the buffer geometry constructor in three.js which was one of two options to create a custom geometry in three.js before r125, but after r125 is now they only way to do so when it comes to the core library by itself at least. This is then not a <a href="/2018/04/04/threejs-getting-started/">getting started type post with three.js</a> or any additional skills that are required before hand. However in this section I will be going over some things that you might want to read up more on, as well as be aware of for one reason or another, before continuing to read the rest of this post.</p>
<h3 id="The-Scene-Object-Mesh-Objects-Cameras-and-Object3d-in-general"><a href="#The-Scene-Object-Mesh-Objects-Cameras-and-Object3d-in-general" class="headerlink" title="The Scene Object, Mesh Objects, Cameras, and Object3d in general"></a>The Scene Object, Mesh Objects, Cameras, and Object3d in general</h3><p>In order to make use of a geometry I will need a <a href="/2018/05/04/threejs-mesh/">Mesh object</a> and pass the geometry to the mesh object as the first argument, and a material as the second argument. After that I will want to make the mesh object a child of a <a href="/2018/05/03/threejs-scene/">Scene object</a>, which I can then pass to a renderer with a camera such as the <a href="/2018/04/07/threejs-camera-perspective/">perspective camera</a>. All of these objects that is a Mesh object, scene object, and a camera are all based on a base class called <a href="/2018/04/23/threejs-object3d">Object3d</a>.</p>
<h3 id="Know-a-thing-or-two-about-materials-also"><a href="#Know-a-thing-or-two-about-materials-also" class="headerlink" title="Know a thing or two about materials also"></a>Know a thing or two about materials also</h3><p>In order to do anything interesting with a geometry in threejs I am going to want to make the geometry part of a Mesh object, or in some cased a Line object. When creating a Mesh object I will want to of course pass the geometry to the mesh constructor, but I will also want to pass <a href="/2018/04/30/threejs-materials/">a material</a> along with it to. In the event that I just care about the position property and that is it, then I can pass the geometry to the Line constructor and use a line material actually, with lines I do not have to have so much about the other attributes. However when it comes to using the Mesh object I am going to want to have a position, and at least a normal attribute when it comes to using the normal material. Often I will also need a uv attribute also if I want to do anything with textures using materials like the basic material, and the standard material.</p>
<h3 id="The-source-code-of-these-examples-is-on-my-github"><a href="#The-source-code-of-these-examples-is-on-my-github" class="headerlink" title="The source code of these examples is on my github"></a>The source code of these examples is on my github</h3><p>The source code for these examples can be found in my test <a href="https://github.com/dustinpfister/test_threejs/tree/master/views/forpost/threejs-buffer-geometry" target="_blank" rel="external">threejs github repo</a>. The latest state of the source code can always be found there if I just happen to be working on some new examples, as well as making some changes to the ones that I have all ready made. If you want to make a pull request for whatever the reason that would also of course be the place to do so.</p>
<h3 id="Version-Numbers-matter-with-threejs"><a href="#Version-Numbers-matter-with-threejs" class="headerlink" title="Version Numbers matter with threejs."></a>Version Numbers matter with threejs.</h3><p>When I first wrote this post I was using r127 of threejs, and the last time I came around to doing a little editing I was using <a href="https://github.com/dustinpfister/test_threejs/blob/master/views/demos/r146/README.md" target="_blank" rel="external">r146 and thus updated the demos to the style rules</a> I set for that revision. Still at some point in the future the code here may very well break on older or newer version of threejs. I do try to do my best to keep my threejs content up to date, but at times it might be a while between edits.</p>
<p>As of <a href="https://github.com/mrdoob/three.js/releases/tag/r125" target="_blank" rel="external">revision 125 of threejs</a> the <a href="/2018/04/14/threejs-geometry/">Geometry Constructor</a> has been removed which will result in code breaking changes for a whole Internet of threejs examples out on the open web. There where some nice things to say about this class, and maybe in some ways it helped to make things easier. However now that I know how to work with the buffer geometry class well, I have to say that I do not miss it.</p>
<h2 id="1-Basic-custom-buffer-geometry-examples"><a href="#1-Basic-custom-buffer-geometry-examples" class="headerlink" title="1 - Basic custom buffer geometry examples"></a>1 - Basic custom buffer geometry examples</h2><p>For this first section on the general topic of buffer geometry I will be going over a number of examples that have to do with the creation of custom buffer geometry objects. The very first step with this is to work out the state of the position attribute of the geometry. That is the state of each point, the order of each point, and also if an index will be used with this or not. In some cases it is just the position attribute that will be needed, but there are some additional core attributes that are important for the sake of textures, and shading.</p>
<h3 id="1-1-The-Position-attribute-of-buffer-geometry"><a href="#1-1-The-Position-attribute-of-buffer-geometry" class="headerlink" title="1.1 - The Position attribute of buffer geometry"></a>1.1 - The Position attribute of buffer geometry</h3><p>This first example is not all that different from that of the example that I have found at the official three.js documentation website. However I made an effort to try to make the example yet even more easy to follow by having the geometry be just a single triangle. The first and for most step is to come up with the <a href="/2021/06/07/threejs-buffer-geometry-attributes-position/">position attribute</a>, there is also the normal and uv attributes that are important when it comes to light and textures, but for this basic example it is just the position attribute that I am going to care about for now.</p>
<p>The position attribute, as the name suggests, is the attribute that contains the values that will be the actual points in space. However there is not just the position of each point of each triangle, but also the order in which they are placed in the array as well that comes into play. It turns out that the order of the points of each triangle is what is used to set which side of a triangle is in fact the front side of the triangle.</p>
<p>I started out by just calling the Buffer Geometry constructor with the new keyword to create a new clean instance of the buffer geometry. The next step is to add some points or vertices as they are often called for the geometry. To do this I will want to create an instance of a Float32Array which is one of the many kinds of type arrays to work with in javaScript now these days. </p>
<p>I then just added three points to the array by having just a linear collection of numbers where the first number is the x axis of the first point, the second element is y for the first point, the third is for the z value of the first point, and so on when it comes to additional points. I then just need to use the set attribute method of the buffer geometry instance of create the position attribute of the geometry passing the array of points as the first argument and the number 3 as the next argument.</p>
<p>I now just need to add this geometry to a mesh by calling the mesh constructor, and passing the geometry as the first argument, and then a material as the second argument. When it comes to a very basic example like this one, the basic material will work just fine for this simple example that is just a single face.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY, MESH</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">    <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">     <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">     <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></div><div class="line">]);</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    geometry,</div><div class="line">    <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</div><div class="line">        <span class="attr">side</span>: THREE.DoubleSide</div><div class="line">    &#125;)</div><div class="line">);</div><div class="line">scene.add(mesh);</div><div class="line">camera.lookAt(mesh.position)</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span> );</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<p>This might be okay when it comes to just starting out, but there is a great deal more to do on top of just this even when it comes to just playing around with a single triangle. You will notice for example that I used the THREE.DocubleSide value for the side property of the basic material that I am using to skin the triangle here. So there is then the question of being able to set which side of the triangle is the ‘front side’, and also lots of other things that have to do with textures. So lets look at a few more examples that have to do with creating a custom buffer geometry instance from the ground up.</p>
<h3 id="1-2-Creating-a-normal-attribute-and-using-the-normal-material"><a href="#1-2-Creating-a-normal-attribute-and-using-the-normal-material" class="headerlink" title="1.2 - Creating a normal attribute and using the normal material"></a>1.2 - Creating a normal attribute and using the normal material</h3><p>So if I take my basic example that I worked out above and switch to the normal material rather than the basic material, then I get nothing. That should be what is expected sense there is no <a href="/2021/06/08/threejs-buffer-geometry-attributes-normals/">normal attribute</a> for the geometry just yet. For this demo I am making the normal attribute in more or less the same way as the position attribute in the sense that I often use the same kind of typed array and once again the item count here is 3. What will differ is that I will be setting a value of ‘normal’ when calling the set Attribute method of the buffer geometry object, and also the values of the normals themselves of course. By default I often start out by pointing them all up ( 0, 1, 0 ), and then adjust from there if I am to do this sort of thing manually like in this demo. However there are of course methods that help to automate this, and more often than not they work okay.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// START GEOMETRY / POSITION ATTRIBUTE / NORMAL ATTRIBUTE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> data_pos = [</div><div class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">    <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">    <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></div><div class="line">];</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>( data_pos), <span class="number">3</span>) );</div><div class="line"><span class="keyword">const</span> data_normal = [</div><div class="line">   <span class="number">0</span>, <span class="number">-0</span>, <span class="number">1</span>,</div><div class="line">   <span class="number">0</span>, <span class="number">-0</span>, <span class="number">1</span>,</div><div class="line">   <span class="number">0</span>, <span class="number">-0</span>, <span class="number">1</span></div><div class="line">];</div><div class="line">geometry.setAttribute(<span class="string">'normal'</span>, <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>( data_normal ), <span class="number">3</span>) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GRID / MESH OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        geometry,</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;</div><div class="line">            <span class="attr">side</span>: THREE.FrontSide</div><div class="line">        &#125;));</div><div class="line">mesh1.rotateY(<span class="built_in">Math</span>.PI * <span class="number">0.15</span>);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// VERTEX HELPERS IF THERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">if</span>(THREE.VertexNormalsHelper)&#123;</div><div class="line">    <span class="keyword">const</span> vertHelper1 = <span class="keyword">new</span> THREE.VertexNormalsHelper(mesh1, <span class="number">0.5</span>, <span class="number">0x00ff00</span>);</div><div class="line">    scene.add(vertHelper1);</div><div class="line">&#125;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">3</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<p>This might prove to be a good start at least, but in order to really know what is going on with face normals I might need to use some kind of helper to see what the direction of each normal vector is. With that said in this example I am making use of the THREE.VertextNormalsHelper which I can add to a project on top of the threejs file. This file should be located in the examples folder of the threejs Github repository. However depeding on what revision you are using the type of file that you need might not be there anymore. If you are using the module form of threejs you will need to use the JSM file, if you are still using an older version of threejs the js folder might still be there.</p>
<p>There might be <a href="https://stackoverflow.com/questions/29202480/three-js-calculating-vertex-normals" target="_blank" rel="external">more then one way to go about making a normals attribute</a>, but the quick and simple way might be to just call the <a href="/2022/04/22/threejs-buffer-geometry-compute-vertex-normals/">compute vertex normals method</a> of the geometry.</p>
<h3 id="1-3-The-uv-attribute"><a href="#1-3-The-uv-attribute" class="headerlink" title="1.3 - The uv attribute"></a>1.3 - The uv attribute</h3><p>There is then the position attribute, the normals attribute and then one more major attribute of interest in order to make a geometry that will work well with most materials and that is the <a href="/2021/06/09/threejs-buffer-geometry-attributes-uv/">uv attribute</a>. </p>
<p>This is where I store data that will have to do with texture offset data that will be used to map a 2d texture to the 3d model. So in order to really get a sense of what the deal is with this uv attribute on top of how to create the attribute I will also want to have a texture for the material that I use with the mesh as well. </p>
<p>So once again I will need to create an attribute this time for the uv, however in order to really know if what I have done is working or not I will also need a texture to use with the material. There are a number of ways to create o load a textures, however for this example I will want to just stick with a JavaScript solution to make the texture. One way to do about doing this would be to make use of a <a href="/2022/04/15/threejs-data-texture/">Data texture</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER, LIGHT</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">3</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// LIGHT</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> dl = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">1</span>);</div><div class="line">dl.position.set(<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>)</div><div class="line">scene.add(dl);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></div><div class="line">        ]);</div><div class="line"><span class="comment">// create position property</span></div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line"><span class="comment">// compute vertex normals</span></div><div class="line">geometry.computeVertexNormals();</div><div class="line"><span class="comment">// creating a uv</span></div><div class="line"><span class="keyword">const</span> uvs = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">            <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">1</span></div><div class="line">        ]);</div><div class="line">geometry.setAttribute(<span class="string">'uv'</span>, <span class="keyword">new</span> THREE.BufferAttribute(uvs, <span class="number">2</span>));</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// TEXTURE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> width = <span class="number">4</span>,</div><div class="line">height = <span class="number">4</span>;</div><div class="line"><span class="keyword">const</span> size = width * height;</div><div class="line"><span class="keyword">const</span> data = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="number">4</span> * size);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">    <span class="keyword">const</span> stride = i * <span class="number">4</span>;</div><div class="line">    <span class="keyword">const</span> v = <span class="built_in">Math</span>.floor(THREE.MathUtils.seededRandom() * <span class="number">255</span>);</div><div class="line">    data[stride] = v;</div><div class="line">    data[stride + <span class="number">1</span>] = v;</div><div class="line">    data[stride + <span class="number">2</span>] = v;</div><div class="line">    data[stride + <span class="number">3</span>] = <span class="number">255</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> texture = <span class="keyword">new</span> THREE.DataTexture(data, width, height);</div><div class="line">texture.needsUpdate = <span class="literal">true</span>;</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        geometry,</div><div class="line">        <span class="keyword">new</span> THREE.MeshStandardMaterial(&#123;</div><div class="line">            <span class="attr">map</span>: texture,</div><div class="line">            <span class="attr">side</span>: THREE.FrontSide</div><div class="line">        &#125;));</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">mesh1.rotateY(<span class="built_in">Math</span>.PI * <span class="number">0.15</span>);</div><div class="line">mesh1.position.x = <span class="number">-0.50</span>;</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">// vertex helper</span></div><div class="line"><span class="keyword">const</span> vertHelper = <span class="keyword">new</span> THREE.VertexNormalsHelper(mesh1, <span class="number">0.5</span>, <span class="number">0x00ff00</span>);</div><div class="line">scene.add(vertHelper)</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="1-4-Material-index-values-and-groups"><a href="#1-4-Material-index-values-and-groups" class="headerlink" title="1.4 - Material index values and groups"></a>1.4 - Material index values and groups</h3><p>So how about material index values for a geometry that consists of more then one face? Well this is where the add group method comes into play as it can be used to create an array of group objects where each group object contains a material index property. For this example I am then going to want to have just a slightly more complex geometry in which I now have two triangle in space rather than just one. Sense that is the case I and then call the add group method twice to create two face objects for each triangle while doing so I can set what the material index values should be.</p>
<p>Now that I have that done when I create a mesh with this geometry I can now pass an array of materials, and each material will then be used for each face depending on the material index values.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// ARRAY OF MATERIALS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> materials = [</div><div class="line">    <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</div><div class="line">        <span class="attr">color</span>: <span class="string">'red'</span>,</div><div class="line">        <span class="attr">side</span>: THREE.DoubleSide</div><div class="line">    &#125;),</div><div class="line">    <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</div><div class="line">        <span class="attr">color</span>: <span class="string">'lime'</span>,</div><div class="line">        <span class="attr">side</span>: THREE.DoubleSide</div><div class="line">    &#125;)</div><div class="line">];</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY - with groups</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// triangle 1</span></div><div class="line">            <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">// triangle 2</span></div><div class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</div><div class="line">            <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></div><div class="line">        ]);</div><div class="line"><span class="comment">// create position property</span></div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line"><span class="comment">// add groups, and set material index values</span></div><div class="line">geometry.addGroup(<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>);</div><div class="line">geometry.addGroup(<span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH using custrom geometry with groups added, and an array of materials</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.Mesh( geometry, materials) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">3</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="1-5-Basic-example-of-adding-an-index-to-a-geometry"><a href="#1-5-Basic-example-of-adding-an-index-to-a-geometry" class="headerlink" title="1.5 - Basic example of adding an index to a geometry"></a>1.5 - Basic example of adding an index to a geometry</h3><p>One thing that you should at least be aware of is if a <a href="/2022/12/09/threejs-buffer-geometry-index/">geometry has an index or not</a>. What this means is that of a geometry has an index that means that there are just a few points in the position attribute, and then there are many triangles being drawn from the same set of points. If there is no index, then that means that there needs to be a point for every triangle in the position attribute.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// CUSTOM GEO WITH JUST A POSITION, AND NORMAL ATTRIBUTES</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="comment">// position array of 4 points</span></div><div class="line"><span class="keyword">const</span> pos = <span class="keyword">new</span> THREE.BufferAttribute(</div><div class="line">    <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">        <span class="number">0</span>,<span class="number">-3</span>, <span class="number">0</span>,  <span class="comment">// 0</span></div><div class="line">        <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>,  <span class="comment">// 1</span></div><div class="line">       <span class="number">-5</span>, <span class="number">0</span>, <span class="number">0</span>,  <span class="comment">// 2</span></div><div class="line">        <span class="number">0</span>, <span class="number">0</span>,<span class="number">-5</span>   <span class="comment">// 3</span></div><div class="line">    ]),</div><div class="line">    <span class="number">3</span>    <span class="comment">// 3 numbers for every item in the buffer attribute ( x, y, z)</span></div><div class="line">);</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, pos);</div><div class="line"><span class="comment">// using computeVertexNormals to create normal attribute</span></div><div class="line">geometry.computeVertexNormals();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">//CREATING AN INDEX BY USING THE setIndex METHOD AND PASSING AN ARRAY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// drawing 2 trangles with just 4 points in the position attribute by giving an</span></div><div class="line"><span class="comment">// array of index values for points in the position attribute to the setIndex method</span></div><div class="line">geometry.setIndex( [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>] );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE CHILD OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(geometry, <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123; <span class="attr">side</span>: THREE.DoubleSide &#125;) );</div><div class="line">scene.add(mesh);</div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">-2</span>, <span class="number">0</span>, <span class="number">-2</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="2-Working-with-light"><a href="#2-Working-with-light" class="headerlink" title="2 - Working with light"></a>2 - Working with light</h2><p>Now it is time to see how a custom geometry works with a situation involving a few light sources, and how the use of a materials that will respond to light will work with the custom geometry as well. So then in this section I will be going over code in which I am working out some simple custom geometry, and then using one or more light sources in the scene. For the most part it is just the position attribute and the normal attribute that is of concern if I only care about solid color shading for each triangle. There are some exceptions to this though when it comes to getting into indexed geometry, and with that tangent attributes and normal maps that will be used with the material.</p>
<p>The uv attribute will very much be needed as well if I want to add color maps, and also of course all the various other maps that are used for applying texture such as the normal maps that are used to address problems with indexed geometry. With all of that said I think that it is called for to have a whole section in this post on the subject of light, and with that overlap between light, geometry, and materials.</p>
<h3 id="2-1-Simple-two-triangle-demo-with-Directional-light"><a href="#2-1-Simple-two-triangle-demo-with-Directional-light" class="headerlink" title="2.1 - Simple two triangle demo with Directional light"></a>2.1 - Simple two triangle demo with Directional light</h3><p>For this demo I am making a non indexed geometry that is just composed of two triangles. The only main thing that I want to make sure I am doing with this is to just make sure that these two trainees are not on the same plane. After that I just need to set up the normal attribute for this one I am just calling the compute vertex normal method to do so.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MATERIALS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> materials = <span class="keyword">new</span> THREE.MeshStandardMaterial(&#123;</div><div class="line">    <span class="attr">color</span>: <span class="number">0xff0000</span>,</div><div class="line">    <span class="attr">side</span>: THREE.FrontSide</div><div class="line">&#125;);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">    <span class="number">0.00</span>,  <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">1.00</span>,  <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">0.50</span>,  <span class="number">1.00</span>, <span class="number">-0.50</span>,</div><div class="line">    <span class="number">1.00</span>,  <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">0.75</span>,  <span class="number">0.00</span>, <span class="number">-1.00</span>,</div><div class="line">    <span class="number">0.50</span>,  <span class="number">1.00</span>, <span class="number">-0.50</span></div><div class="line">]);</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line">geometry.computeVertexNormals();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE CHILD OBJECTS - GRID, MESH, AND LIGHTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( geometry, materials);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> dl = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">1</span>);</div><div class="line">dl.position.set(<span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>);</div><div class="line">scene.add(dl);</div><div class="line"><span class="comment">//-------- ---------- </span></div><div class="line"><span class="comment">// LOOP</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="2-2-Indexed-geometry-and-normal-maps"><a href="#2-2-Indexed-geometry-and-normal-maps" class="headerlink" title="2.2 - Indexed geometry and normal maps"></a>2.2 - Indexed geometry and normal maps</h3><p>As of this writing this is a topic in which I am trying to do more research as I have only got so far with it at this time. The general thing with this is that there are problems with lightning when dealing with an indexed geometry as the state of the normal attribute will differ compared to that of a non indexed geometry. There are then two general ways of dealing with this it would seem, one of which would be to just not use an index. The other way of dealing with this would be to stick with using an index, but learn a thing or two about normal maps as a way to address these lighting problems.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// TEXTURES / MATERIALS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> data_normalmap = [</div><div class="line">    [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</div><div class="line">    [<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</div><div class="line">    [<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">9</span>,<span class="number">9</span>,<span class="number">9</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</div><div class="line">    [<span class="number">9</span>,<span class="number">2</span>,<span class="number">0</span>],[<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</div><div class="line">].map( <span class="function">(<span class="params">ci_array</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> r = <span class="built_in">Math</span>.round( <span class="number">255</span> * (ci_array[<span class="number">0</span>] / <span class="number">9</span>) );</div><div class="line">    <span class="keyword">const</span> g = <span class="built_in">Math</span>.round( <span class="number">255</span> * (ci_array[<span class="number">0</span>] / <span class="number">9</span>) );</div><div class="line">    <span class="keyword">const</span> b = <span class="built_in">Math</span>.round( <span class="number">255</span> * (ci_array[<span class="number">0</span>] / <span class="number">9</span>) );</div><div class="line">    <span class="keyword">return</span> [ r, g, b, <span class="number">255</span>];</div><div class="line">&#125;).flat();</div><div class="line"></div><div class="line"><span class="keyword">const</span> texture_normal = <span class="keyword">new</span> THREE.DataTexture( <span class="keyword">new</span> <span class="built_in">Uint8Array</span>( data_normalmap ), <span class="number">4</span>,  <span class="number">4</span> );</div><div class="line">texture_normal.needsUpdate = <span class="literal">true</span>;</div><div class="line"><span class="keyword">const</span> material_nm = <span class="keyword">new</span> THREE.MeshPhongMaterial(&#123;</div><div class="line">    <span class="attr">color</span>: <span class="number">0xff0000</span>,</div><div class="line">    <span class="attr">normalMap</span>: texture_normal,</div><div class="line">    <span class="attr">side</span>: THREE.FrontSide</div><div class="line">&#125;);</div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshPhongMaterial(&#123;</div><div class="line">    <span class="attr">color</span>: <span class="number">0xff0000</span>,</div><div class="line">    <span class="attr">side</span>: THREE.FrontSide</div><div class="line">&#125;);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY - indexed</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">    <span class="number">0.00</span>,  <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">2.00</span>,  <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">0.00</span>,  <span class="number">2.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">0.00</span>,  <span class="number">0.00</span>, <span class="number">-3.50</span></div><div class="line">]);</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line">geometry.setIndex([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]);</div><div class="line">geometry.computeVertexNormals();</div><div class="line"><span class="keyword">const</span> data_uv = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</div><div class="line">    <span class="number">0.00</span>,  <span class="number">1.00</span>,</div><div class="line">    <span class="number">0.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">1.00</span>,  <span class="number">0.00</span>,</div><div class="line">    <span class="number">1.00</span>,  <span class="number">1.00</span>,</div><div class="line">]);</div><div class="line">geometry.setAttribute(<span class="string">'uv'</span>, <span class="keyword">new</span> THREE.BufferAttribute(data_uv, <span class="number">2</span>));</div><div class="line">geometry.computeTangents();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY - non-indexed</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry_ni = geometry.toNonIndexed();</div><div class="line">geometry_ni.computeVertexNormals();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE CHILD OBJECTS - GRID, MESH, AND LIGHTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh( geometry, material_nm);</div><div class="line">mesh1.position.set(<span class="number">0</span>,<span class="number">0.01</span>,<span class="number">2</span>);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> mesh2 = <span class="keyword">new</span> THREE.Mesh( geometry_ni, material);</div><div class="line">mesh2.position.set(<span class="number">0</span>,<span class="number">0.01</span>,<span class="number">-2</span>);</div><div class="line">scene.add(mesh2);</div><div class="line"><span class="keyword">const</span> dl = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">1</span>);</div><div class="line">dl.position.set(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</div><div class="line">scene.add(dl);</div><div class="line">scene.add( <span class="keyword">new</span> THREE.VertexNormalsHelper(mesh1, <span class="number">0.5</span>, <span class="number">0x00ff00</span>) );</div><div class="line"><span class="comment">//-------- ---------- </span></div><div class="line"><span class="comment">// LOOP</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">6</span>, <span class="number">3</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="3-Prototype-methods-of-the-Buffer-Geometry-class"><a href="#3-Prototype-methods-of-the-Buffer-Geometry-class" class="headerlink" title="3 - Prototype methods of the Buffer Geometry class"></a>3 - Prototype methods of the Buffer Geometry class</h2><p>There are a number of methods to work with in the buffer geometry class prototype that one should be aware of. In this section then I will be writing about at least a few of these buffer geometry class prototype methods. We have all ready covered a number of them in the basic section of course such as the setAttribute method that is used to define attributes for a blank geometry object. However there are a whole lot more that prove to be useful for various things that will pop up now and then.</p>
<h3 id="3-1-Rotation-Methods"><a href="#3-1-Rotation-Methods" class="headerlink" title="3.1 - Rotation Methods"></a>3.1 - Rotation Methods</h3><p>When I add a geometry to a Mesh object the resulting Mesh object is based off of Object3d and as such it has a position and rotation property that can be used as a way to translate and rotate the mesh object as a whole. However I think that it is important to point out that this is the way to go about moving a geometry around once the translation and rotation of a geometry is in the initial fixed state that I want. If that is not the case I will want to adjust that using the translate and <a href="/2021/05/20/threejs-buffer-geometry-rotation/">rotation methods of the Buffer geometry</a> class instance, and not that of the containing mesh object. </p>
<p>When doing this sort of thing I typically will only want to adjust the position and rotation of the geometry just once, when it comes to updating things over and over again in a loop I will want to stick to the object3d values that there are to work with.</p>
<p>In the even that I do want to update the geometry over and over again I tend to run into problems compared to what I am used to when working with the Euler class that I deal with when working with the rotation property of an mesh object. The main problem that I run into is that the rotation methods of buffer geometry apply deltas to the current state of the geometry rather than setting the rotation from a kind of home position. One way to address this would be to use the copy method to always set the geometry to a desired starting state, and then translate from there as I am doing in this sections source code example.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">7</span>, <span class="number">7</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.ConeGeometry(<span class="number">0.25</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">30</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial()</div><div class="line">);</div><div class="line">mesh1.position.set(<span class="number">-1.5</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="keyword">const</span> mesh2 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.ConeGeometry(<span class="number">0.25</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">30</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial()</div><div class="line">);</div><div class="line">mesh2.position.set(<span class="number">1.5</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">scene.add(mesh2);</div><div class="line"><span class="comment">// CHILD MESH OBEJECTS</span></div><div class="line"><span class="keyword">const</span> childMaterial = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123; </div><div class="line">    <span class="attr">transparent</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">opacity</span>: <span class="number">0.5</span></div><div class="line">&#125;);</div><div class="line">mesh1.add( <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>),</div><div class="line">    childMaterial) );</div><div class="line">mesh2.add( <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>),</div><div class="line">    childMaterial) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// LOOP</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">6</span>, <span class="number">8</span>, <span class="number">6</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">let</span> frame = <span class="number">0</span>,</div><div class="line">maxFrame = <span class="number">200</span>,</div><div class="line">fps_target = <span class="number">24</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>,</div><div class="line">    per = frame / maxFrame,</div><div class="line">    bias = <span class="built_in">Math</span>.abs(<span class="number">.5</span> - per) / <span class="number">.5</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span> (secs &gt;= <span class="number">1</span> / fps_target) &#123;</div><div class="line">        <span class="comment">// ROTATION OF GEOMETRY COMPARED TO MESH</span></div><div class="line">        <span class="keyword">const</span> rx = <span class="built_in">Math</span>.PI * <span class="number">2</span> * per,</div><div class="line">        rz = <span class="built_in">Math</span>.PI * <span class="number">8</span> * per;</div><div class="line">        <span class="comment">// USING COPY AND ROTATION METHODS</span></div><div class="line">        mesh1.geometry.copy( <span class="keyword">new</span> THREE.ConeGeometry(<span class="number">0.25</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">30</span>) );</div><div class="line">        mesh1.geometry.rotateX( rx );</div><div class="line">        mesh1.geometry.rotateZ( rz );</div><div class="line">        <span class="comment">// USING OBJECT3D ROTATION PROPERTY OF MESH2 to ROTATE THE MESH OBJECT</span></div><div class="line">        <span class="comment">// RATHER THAN THE GEOMETRY</span></div><div class="line">        mesh2.rotation.set(rx ,<span class="number">0</span>, rz)</div><div class="line">        <span class="comment">// render, step frame, ect...</span></div><div class="line">        renderer.render(scene, camera);</div><div class="line">        frame += <span class="number">1</span>;</div><div class="line">        frame %= maxFrame;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h3 id="3-2-BufferGeometry-toJSON-Converting-buffer-geometry-to-JSON-TEXT"><a href="#3-2-BufferGeometry-toJSON-Converting-buffer-geometry-to-JSON-TEXT" class="headerlink" title="3.2 - BufferGeometry.toJSON - Converting buffer geometry to JSON TEXT"></a>3.2 - BufferGeometry.toJSON - Converting buffer geometry to JSON TEXT</h3><p>One thing that I would like to do now and then is to convert the current state of a buffer geometry instance to a standard JOSN format that I can then sore as a file or some other from of storage. Later I would then use some kind of means to load this json data as a way to create a geometry form the stored json data.</p>
<p>Built into threejs itself there is the buffer geometry loader, in a later section in this post I should have at least one example of that here, but first in order to use that loader I will need some JOSN to load. When doing so I have found that the first thing that I want to do is call the to <a href="https://threejs.org/docs/#api/en/core/BufferGeometry.toNonIndexed" target="_blank" rel="external">non index method</a>, if I do not when calling the to JSON method I will get a different from of json when the buffer geometry is the product of one of the built in geometry constrictors.</p>
<p>After calling the <a href="https://threejs.org/docs/#api/en/core/BufferGeometry.toJSON" target="_blank" rel="external">to josn method</a> the end result will end up being an object that is ready to use with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="external">JSON stringify method</a>. After passing the object to the strignify method the end result will then be JSON text that I can store as a file and then use with the loader. Alliteratively there is working directly with the parse method of the buffer geometry loader, when using the the first argument is expected to be an object so I will want to pass the text to the <a href="/2020/02/28/js-json-parse/">JSON parse method</a> first.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// Scene, Camera, renderer</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">65</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">10</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// BUFFER GEOMETRY TO TEXT</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line"><span class="comment">// make sure to use to non indexed before calling to json</span></div><div class="line"><span class="keyword">const</span> buffObj = geo.toNonIndexed().toJSON();</div><div class="line"><span class="keyword">const</span> text = <span class="built_in">JSON</span>.stringify(buffObj);</div><div class="line"><span class="built_in">console</span>.log(text);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// TEXT TO BUFFER GEOMETRY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> loader = <span class="keyword">new</span> THREE.BufferGeometryLoader();</div><div class="line"><span class="keyword">const</span> obj = <span class="built_in">JSON</span>.parse(text);</div><div class="line"><span class="keyword">const</span> geo2 = loader.parse( obj );</div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(geo2);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add(mesh);</div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera)</div></pre></td></tr></table></figure>
<h3 id="3-3-The-Compute-vertex-normals-method"><a href="#3-3-The-Compute-vertex-normals-method" class="headerlink" title="3.3 - The Compute vertex normals method"></a>3.3 - The Compute vertex normals method</h3><p>A very useful method in the buffer geometry class that can often make quick work of setting up a normal attribute would be the compute vertex normals method. This method will work fine in most cases when it comes to looking into ways to automate this process, however I am sure there are some cases in which I will still need to work this out manually. To make sure that the normals are set up the way that they should be be sure to still make use of tools like the MeshNormalMaterial, and better yet the Vertex Normals Helper to still make sure that things are as they should be with the normal attribute.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// START GEOMETRY / POSITION ATTRIBUTE / NORMAL ATTRIBUTE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> data_pos = [ <span class="number">-1</span>, <span class="number">0.1</span>, <span class="number">0</span>,   <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">0</span>,   <span class="number">0</span>, <span class="number">1.1</span>, <span class="number">0</span> ];</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>( data_pos), <span class="number">3</span>) );</div><div class="line"><span class="comment">// USING COMPUTE VERTEX NORMALS TO ADD A NORMAL ATTRIBUTE</span></div><div class="line">geometry.computeVertexNormals();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE CHILD OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        geometry,</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;</div><div class="line">            <span class="attr">side</span>: THREE.FrontSide</div><div class="line">        &#125;));</div><div class="line">scene.add(mesh1);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// VERTEX HELPERS IF THERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">if</span>(THREE.VertexNormalsHelper)&#123;</div><div class="line">    <span class="keyword">const</span> vertHelper1 = <span class="keyword">new</span> THREE.VertexNormalsHelper(mesh1, <span class="number">0.5</span>, <span class="number">0x00ff00</span>);</div><div class="line">    scene.add(vertHelper1);</div><div class="line">&#125;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="3-4-Apply-Quaternion"><a href="#3-4-Apply-Quaternion" class="headerlink" title="3.4 - Apply Quaternion"></a>3.4 - Apply Quaternion</h3><p>The apply quaternion method can be used to rotate the geometry by way of a quaternion object rather than using the various rotate methods. These <a href="/2023/03/24/threejs-quaternion/">quaternion objects</a> are something that you will want to look into more at some point sooner or later as they are very helpful when working out problems that have to do with setting orations of objects, and also in this case geometry.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY - rotation by way of quaternion object</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.CylinderGeometry(<span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">40</span>);</div><div class="line"><span class="keyword">const</span> q = <span class="keyword">new</span> THREE.Quaternion();</div><div class="line">q.setFromAxisAngle( <span class="keyword">new</span> THREE.Vector3( <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), <span class="number">45</span> );</div><div class="line">geometry.applyQuaternion(q);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE CHILD OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.PointsMaterial( &#123; <span class="attr">size</span>: <span class="number">0.1</span>&#125; );</div><div class="line"><span class="keyword">const</span> points = <span class="keyword">new</span> THREE.Points( geometry, material );</div><div class="line">scene.add(points);</div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper( <span class="number">10</span>, <span class="number">10</span> ) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">1</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">0</span>);</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="3-5-The-center-method"><a href="#3-5-The-center-method" class="headerlink" title="3.5 - The center method"></a>3.5 - The center method</h3><p>If I just want to quickly center a geometry based on the current state of the bound box property of the geometry I can just simply call the center method. If the bound box property is not there, then it will be created or updated. Also this should go without saying, but yes I will need a position attribute first of course. So then in this demo I am just creating a few points in a position attribute and then drawing two triangles with an index. I am then creating the normals attribute by calling the compute vertex normals method, and then after that I am centering the geometry as the points are all positive for this and I want them to be centered. This is a nice quick way to just center, but it is not at all a replacement for the translate method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([ <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,    <span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,    <span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,    <span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span> ]);</div><div class="line">geometry.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line">geometry.setIndex([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]);</div><div class="line">geometry.computeVertexNormals();</div><div class="line">geometry.center();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH, MATERIAL</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    geometry,</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;</div><div class="line">        <span class="attr">side</span>: THREE.DoubleSide</div><div class="line">    &#125;)</div><div class="line">);</div><div class="line">scene.add(mesh);</div><div class="line">camera.lookAt(mesh.position)</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span> );</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="3-6-Translate-Geometry"><a href="#3-6-Translate-Geometry" class="headerlink" title="3.6 - Translate Geometry"></a>3.6 - Translate Geometry</h3><p>The translate method of the buffer geometry class can be used to move around the geometry relative to the origin. This can be used in conjunction with the position property of the object 3d class that is used to set the position of the containing object rather that the geometry. Sense the act or translating a geometry can often result in the use of more overhead translation of geometry is typicality done just one to adjust things and then object3c lass level feature are used from there.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.5</span>, <span class="number">1000</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GEOMETRY</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> geometry_source = <span class="keyword">new</span> THREE.BufferGeometry();</div><div class="line"><span class="keyword">const</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([ <span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>,    <span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,    <span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,    <span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span> ]);</div><div class="line">geometry_source.setAttribute(<span class="string">'position'</span>, <span class="keyword">new</span> THREE.BufferAttribute(vertices, <span class="number">3</span>));</div><div class="line">geometry_source.setIndex([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]);</div><div class="line">geometry_source.computeVertexNormals();</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH, MATERIAL</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">[ [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>], [<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>], [<span class="number">0</span>,<span class="number">1</span>,<span class="number">-4</span>], ].forEach( <span class="function">(<span class="params">pos, i, arr</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> geometry = geometry_source.clone().translate( pos[<span class="number">0</span>], pos[<span class="number">1</span>], pos[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        geometry,</div><div class="line">        <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</div><div class="line">            <span class="attr">side</span>: THREE.FrontSide,</div><div class="line">            <span class="attr">transparent</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">opacity</span>: <span class="number">0.5</span></div><div class="line">        &#125;)</div><div class="line">    );</div><div class="line">    mesh.renderOrder = arr.length - i;</div><div class="line">    scene.add(mesh);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">-0.25</span>, <span class="number">1</span>, <span class="number">4</span>);</div><div class="line">camera.lookAt( <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span> );</div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="4-The-Buffer-Geometry-loader"><a href="#4-The-Buffer-Geometry-loader" class="headerlink" title="4 - The Buffer Geometry loader"></a>4 - The Buffer Geometry loader</h2><p>If I have a josn file to load that is formatted the way as I have outline in the above example for doing so I can use the <a href="https://threejs.org/docs/#api/en/loaders/BufferGeometryLoader" target="_blank" rel="external">buffer geometry loader</a> to load the json text file. I just need to create an instance of the threejs buffer geometry loader, and then call the load method of the loader instance that is returned when calling the constructor function with the new keyword. Well at least that might be all that I need to do if I just need to load one file rather than a massive collection of these kinds of JSON files. When it comes to loading a lot of JSON files, and not just JSON files of geometry but all kinds of various assets, and having an over all progress bar and so on that is where this kind of thing can turn into a bit of a rabbit hole. Still it goes without saying that this is something that I should at least write a thing or two about in this general overview of buffer geometry. If you want to read more about what I have in terms of this kind of topic you might want to check out <a href="/2018/04/12/threejs-buffer-geometry-loader/">my main blog post on the buffer geometry loader</a>.</p>
<h3 id="4-1-Basic-single-file-buffer-geometry-loader-example"><a href="#4-1-Basic-single-file-buffer-geometry-loader-example" class="headerlink" title="4.1 - Basic single file buffer geometry loader example"></a>4.1 - Basic single file buffer geometry loader example</h3><p>The most basic form of this would be to just load a single JSON file that contains buffer geometry data with the Buffer Geometry loader. To do this I just need to create a single buffer geometry loader object by calling THREE.BufferGeometryLoader(). Once I have a buffer geometry loader instance I can then call the load method, and pass the url to the JSON file as the first argument. After passing the url, I will then also want to pass a function that I will want to fire when this file is done loading as the second argument. There are additional functions that I might want to pass after that, but for this basic example of the buffer geometry loader I might just keep it with that for now.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">65</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.1</span>, <span class="number">100</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>)  || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GRID</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">scene.add( <span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>) );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// Loader</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">camera.position.set(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> loader = <span class="keyword">new</span> THREE.BufferGeometryLoader();</div><div class="line"><span class="comment">// load a resource</span></div><div class="line">loader.load(</div><div class="line">    <span class="comment">// resource URL</span></div><div class="line">    <span class="string">'/json/vertcolor-trees/6tri/0.json'</span>,</div><div class="line">    <span class="comment">// onLoad callback</span></div><div class="line">    (geometry) =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">            geometry,</div><div class="line">            <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</div><div class="line">                <span class="attr">vertexColors</span>: <span class="literal">true</span>, </div><div class="line">                <span class="attr">side</span>: THREE.DoubleSide</div><div class="line">            &#125;));</div><div class="line">        scene.add(mesh);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>Something like this might work okay if I just want to load a single JSON file. However there is a whole lot more to this sort of thing when it comes to how to go about parsing a large collection of files.</p>
<h3 id="4-2-Loading-more-and-one-file-with-THREE-LoadingManager-and-using-Promsies"><a href="#4-2-Loading-more-and-one-file-with-THREE-LoadingManager-and-using-Promsies" class="headerlink" title="4.2 - Loading more and one file with THREE.LoadingManager, and using Promsies."></a>4.2 - Loading more and one file with THREE.LoadingManager, and using Promsies.</h3><p>This is where things can start to get a little messy I have found thus far. However there are tools to work with in threejs, and also of course many native javaScript features that can help in the process of doing this sort of thing. For this example I am now making use of the <a href="https://threejs.org/docs/#api/en/loaders/managers/LoadingManager" target="_blank" rel="external">loading manager class</a> as a way to define some callbacks that I would like to fire when all of the files that I want to load are in fact done loading. On top of this I am also now making use of those additional call back functions that can be passed when calling the buffer geometry loader as well. The end result is a load buffer geometry JSON helper function that will load not just one url, but an array of urls, and if all goes well will resolve with a scene object where each child of the scene object contains the geometry of each file that was loaded.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">4</span> / <span class="number">3</span>, <span class="number">0.1</span>, <span class="number">100</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// HELPER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> loadBufferGeometryJSON = <span class="function">(<span class="params"> urls = [], w = <span class="number">2</span>, scale = <span class="number">5</span>, material = <span class="keyword">new</span> THREE.MeshNormalMaterial(</span>) ) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> scene_source = <span class="keyword">new</span> THREE.Scene();</div><div class="line">    <span class="keyword">const</span> onBuffLoad =  <span class="function">(<span class="params">geometry, i</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">const</span> x = i % w;</div><div class="line">        <span class="keyword">const</span> z = <span class="built_in">Math</span>.floor( i / w);</div><div class="line">        <span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh( geometry, material);</div><div class="line">        mesh.name = <span class="string">'buffer_source_'</span> + i;</div><div class="line">        mesh.position.set(x, <span class="number">0</span>, z).multiplyScalar(scale);</div><div class="line">        scene_source.add(mesh);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">const</span> onBuffProgress =  <span class="function">(<span class="params">geometry</span>) =&gt;</span> &#123;&#125;;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params"> resolve, reject </span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">const</span> manager = <span class="keyword">new</span> THREE.LoadingManager();</div><div class="line">        manager.onLoad = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            resolve(scene_source);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">const</span> onBuffError =  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</div><div class="line">           reject(err);</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">const</span> loader = <span class="keyword">new</span> THREE.BufferGeometryLoader(manager);</div><div class="line">        urls.forEach( <span class="function">(<span class="params">url, index</span>) =&gt;</span> &#123;</div><div class="line">            loader.load(url, (geometry) =&gt; &#123; onBuffLoad(geometry, index) &#125;, onBuffProgress, onBuffError);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// GRID/ LIGHT / CAMERA POS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> grid = <span class="keyword">new</span> THREE.GridHelper(<span class="number">100</span>, <span class="number">10</span>);</div><div class="line">scene.add(grid)</div><div class="line"><span class="keyword">const</span> pl = <span class="keyword">new</span> THREE.PointLight(<span class="number">0xffffff</span>, <span class="number">1</span>, <span class="number">100</span>);</div><div class="line">pl.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">scene.add(pl);</div><div class="line">camera.position.set(<span class="number">-10</span>, <span class="number">15</span>, <span class="number">15</span>);</div><div class="line">camera.lookAt( <span class="number">5</span>, <span class="number">0</span>, <span class="number">5</span>);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// BUFFER GEOMETRY LOADER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> URLS = [</div><div class="line">   <span class="string">'/json/vertcolor-trees/6tri/0.json'</span>,</div><div class="line">   <span class="string">'/json/vertcolor-trees/6tri/1.json'</span>,</div><div class="line">   <span class="string">'/json/vertcolor-trees/6tri/2.json'</span>,</div><div class="line">   <span class="string">'/json/vertcolor-trees/6tri/3.json'</span></div><div class="line">];</div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;<span class="attr">vertexColors</span>: <span class="literal">true</span>, <span class="attr">side</span>: THREE.DoubleSide &#125;);</div><div class="line">loadBufferGeometryJSON(URLS, <span class="number">2</span>, <span class="number">10</span>, material)</div><div class="line">.then( <span class="function">(<span class="params">scene_source</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'JSON files are loaded!'</span>);</div><div class="line">    scene.add( scene_source );</div><div class="line">    renderer.render(scene, camera);</div><div class="line">&#125;)</div><div class="line">.catch( <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.warn(<span class="string">'No Good.'</span>);</div><div class="line">    <span class="built_in">console</span>.warn(e);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="5-Morph-Attributes"><a href="#5-Morph-Attributes" class="headerlink" title="5 - Morph Attributes"></a>5 - Morph Attributes</h2><p>In the opening sections of this post I wrote a thing or two about the various attributes that are used to compose a buffer geometry object. There is the position attribute that is the actual points in space which can be index, or not indexed. Then there is the normal attribute that can be used to define what side of a face is the front side of a face and is also used in the process of rendering with many materials. There is also the uv attribute which is what it is used to define what the offsets are in a texture when it comes to mapping a 2d texture to a 3d object. However in this section I will now be writing about <a href="/2023/02/03/threejs-buffer-geometry-morph-attributes">morph attributes</a> where are a way to go about defining an array of attributes for each of these attributes each of which is a state for all of them. These morph attributes can then be used to change from one state to another, not just with the position attribute but all of the various attributes.</p>
<h3 id="5-1-Basic-example-on-morph-attributes"><a href="#5-1-Basic-example-on-morph-attributes" class="headerlink" title="5.1 - Basic example on morph attributes"></a>5.1 - Basic example on morph attributes</h3><p>This is a basic example on morph attributes that I copied over from my post on the subject that is based on one of the official examples on morph attributes that can be <a href="https://github.com/mrdoob/three.js/blob/r146/examples/webgl_morphtargets.html" target="_blank" rel="external">found here</a>. It involves just creating a buffer geometry with the built in box geometry constructor function. Then one just needs to start out by creating an empty array for the position attribute in the morph attributes property of the returned geometry. After that it is a matter of adding at least one or more elements to this array that are other states to morph to from the starting box geometry state. For this there is some code that will create a new position attribute that is a sphere like state to transition to for each point in this box geometry. </p>
<p>There is then making a mesh object with the geometry like always. However now I can use the morph Target Influences property of the mesh object to set what the alpha value should be between the starting state, and the the sphere state.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">50</span>, <span class="number">32</span> / <span class="number">24</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGL1Renderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>, <span class="literal">false</span>);</div><div class="line">(<span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body).appendChild(renderer.domElement);</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// SHADER MATERIAL</span></div><div class="line"><span class="comment">// base on this: https://github.com/mrdoob/three.js/blob/master/examples/webgl_morphtargets.html</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>);</div><div class="line">geo.morphAttributes.position = [];</div><div class="line"><span class="keyword">const</span> pos = geo.attributes.position;</div><div class="line"><span class="keyword">const</span> data_pos = [];</div><div class="line"><span class="keyword">for</span> ( <span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pos.count; i ++ ) &#123;</div><div class="line">     <span class="keyword">const</span> x = pos.getX( i );</div><div class="line">     <span class="keyword">const</span> y = pos.getY( i );</div><div class="line">     <span class="keyword">const</span> z = pos.getZ( i );</div><div class="line">     data_pos.push(</div><div class="line">         x * <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - ( y * y / <span class="number">2</span> ) - ( z * z / <span class="number">2</span> ) + ( y * y * z * z / <span class="number">3</span> ) ),</div><div class="line">         y * <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - ( z * z / <span class="number">2</span> ) - ( x * x / <span class="number">2</span> ) + ( z * z * x * x / <span class="number">3</span> ) ),</div><div class="line">         z * <span class="built_in">Math</span>.sqrt( <span class="number">1</span> - ( x * x / <span class="number">2</span> ) - ( y * y / <span class="number">2</span> ) + ( x * x * y * y / <span class="number">3</span> ) )</div><div class="line">     );</div><div class="line">&#125;</div><div class="line">geo.morphAttributes.position[ <span class="number">0</span> ] = <span class="keyword">new</span> THREE.Float32BufferAttribute( data_pos, <span class="number">3</span> );</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// MATERIAL, MESH</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123; <span class="attr">side</span>: THREE.DoubleSide&#125;);</div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(geo, material);</div><div class="line">scene.add(mesh);</div><div class="line">mesh.morphTargetInfluences[ <span class="number">0</span> ] = <span class="number">0.75</span>;</div><div class="line">mesh.geometry.computeVertexNormals();</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>I have a lot of work cut out for me when it comes to working on editing a lot of my old three.js content. A lot of my examples made use of the old geometry constructor, so They will need to be updated to work with the buffered geometry constructor if I want them to still work with late versions of three.js. The only other options would be to just make quick edits that mention what version of three.js I was using when I made they example which might prove to be a good temporarily fix when it comes to editing.</p>
<p>There might be more to work out when it comes to just some very basic examples like the ones that I worked out for this post when it comes to the various properties of a geometry and how they apply to various features of three.js. For now they seem to work okay, but I am sure that there will be some minor fixes for some of these examples when and if I get around to them.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/" data-id="cllo1crdu02l560v1agshs7vy" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/three-js/">three.js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/23/threejs-examples-house/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Simple house model example in threejs
        
      </div>
    </a>
  
  
    <a href="/2021/04/21/threejs-materials-transparent/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Transparent Materials in threejs</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/index.html';
    this.page.identifier = '851';
    this.page.title = 'The Buffer Geometry Constructor in threejs';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.38px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.48px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.33px;">angular</a> <a href="/tags/animation/" style="font-size: 11.9px;">animation</a> <a href="/tags/automation/" style="font-size: 11.9px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.38px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.71px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.57px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.86px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.95px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.43px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.81px;">electronjs</a> <a href="/tags/express/" style="font-size: 17.14px;">express</a> <a href="/tags/games/" style="font-size: 17.62px;">games</a> <a href="/tags/git/" style="font-size: 13.81px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15.24px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.9px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.76px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.48px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.43px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 18.1px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.57px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.52px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.1px;">phaser</a> <a href="/tags/python/" style="font-size: 16.19px;">python</a> <a href="/tags/statistics/" style="font-size: 14.29px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.05px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.67px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/23/threejs-sprite/">Sprite Objects, and 2d overlays in threejs</a>
          </li>
        
          <li>
            <a href="/2023/08/17/threejs-buffer-geometry-attributes-tangent/">The tangent attribute of buffer geometry and normal maps in threejs</a>
          </li>
        
          <li>
            <a href="/2023/08/10/threejs-matcap-material/">The Matcap material in threejs</a>
          </li>
        
          <li>
            <a href="/2023/08/02/threejs-matrix4/">Matrix4 Objects in threejs</a>
          </li>
        
          <li>
            <a href="/2023/08/01/linux-folders/">Linux Root Folders</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2021/04/22/threejs-buffer-geometry/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>