<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Clicking a mesh in three.js with the Raycaster class | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2021/05/18/threejs-raycaster/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="When making a three.js project there might be situations in which it would be nice to have a way to click on a mesh object in a scene object. When dong so this will result in some kind of action being">
<meta property="og:type" content="article">
<meta property="og:title" content="Clicking a mesh in three.js with the Raycaster class">
<meta property="og:url" content="https://dustinpfister.github.io/2021/05/18/threejs-raycaster/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="When making a three.js project there might be situations in which it would be nice to have a way to click on a mesh object in a scene object. When dong so this will result in some kind of action being">
<meta property="og:updated_time" content="2022-10-07T18:13:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Clicking a mesh in three.js with the Raycaster class">
<meta name="twitter:description" content="When making a three.js project there might be situations in which it would be nice to have a way to click on a mesh object in a scene object. When dong so this will result in some kind of action being">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-threejs-raycaster" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/18/threejs-raycaster/" class="article-date"> Published:
  <time datetime="2021-05-18T13:46:00.000Z" itemprop="datePublished">2021-05-18</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2021/05/18/threejs-raycaster/" class="article-date"> Modified:
  <time datetime="2022-10-07T18:13:13.000Z" itemprop="dateModified">2022-10-07</time>
</a>

    <span class="article-date">V1.31</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/three-js/">three.js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Clicking a mesh in three.js with the Raycaster class
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>When making a <a href="https://threejs.org/docs/#manual/en/introduction/Creating-a-scene" target="_blank" rel="external">three.js</a> project there might be situations in which it would be nice to have a way to click on a <a href="/2018/05/04/threejs-mesh/">mesh object</a> in a <a href="/2018/05/03/threejs-scene/">scene object</a>. When dong so this will result in some kind of action being preformed that is event driven by way of user input rather than some kind of script. To do this I need a way to cast a ray from the <a href="/2018/04/06/threejs-camera/">camera</a> that I am using outward based on a 2d location of the canvas element of the <a href="/2018/11/24/threejs-webglrenderer/">renderer</a>, and then get a collection of mesh objects that intersect with this ray that is going from the camera outward. Luckily this kind of functionality is built into three.js itself and it is called the <a href="https://threejs.org/docs/#api/en/core/Raycaster" target="_blank" rel="external">THREE.RayCaster Class</a>.</p>
<p>There is also the idea of using a raycatser by positioning one at some location in world space, set a direction, and then just get a point on a surface of nay kind of geometry. There are all kinds of use case examples for that kind of situation that have to do with knowing how to position one mesh object onto the surface of another mesh object.</p>
<p>There is just getting started with the very basics when it comes to ray casting in three.js, and of course I will be starting out with that in this post. However there might be a whole bunch more advanced topics that will also come up when it comes to this sort of thing. So I think that it might be called for to go over at least a few examples of the ray cater class in three.js.</p>
<a id="more"></a>
<iframe class="youtube_video" src="https://www.youtube.com/embed/uD9kTlszL2c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<h2 id="Clicking-a-Mesh-in-three-js-and-what-to-know-before-hand"><a href="#Clicking-a-Mesh-in-three-js-and-what-to-know-before-hand" class="headerlink" title="Clicking a Mesh in three.js and what to know before hand"></a>Clicking a Mesh in three.js and what to know before hand</h2><p>This is a post on using the THREE.Raycaster class in three.js as a way to help with the process of clicking on a mesh object. This is then a post on a topic that might prove to be a little to advanced for some developers that are still a little to new with <a href="/2018/04/04/threejs-getting-started/">three.js</a> and <a href="/2018/11/27/js-getting-started/">javaScript</a>. In this section I will then be going over a few topics that are worth checking out for the first time, or refreshing on before continuing with the rest of the continent here.</p>
<h3 id="Source-code-is-on-Github"><a href="#Source-code-is-on-Github" class="headerlink" title="Source code is on Github"></a>Source code is on Github</h3><p>The source code examples that I am wiring about here as well as additional draft examples, notes and  much more can be found in my <a href="https://github.com/dustinpfister/test_threejs/tree/master/views/forpost/threejs-raycaster" target="_blank" rel="external">test threejs repository on Github</a>. This is also where I park the source code for my many other <a href="/categories/three-js/">posts on threejs</a>.</p>
<h3 id="version-Numbers-matter-with-three-js"><a href="#version-Numbers-matter-with-three-js" class="headerlink" title="version Numbers matter with three.js"></a>version Numbers matter with three.js</h3><p>When I made these examples and wrote this post I was using r127 of three.js which was still a fairly later version of three.js as of this writing. The last time I cam around to do a little editing, and expand with new examples I was using r140 of the library. Code breaking changes are always made with three.js as new revisions come out so if you run into problems with getting this to work on your end that might be the first thing you should check actually.</p>
<h2 id="1-Basic-examples-of-the-Raycaster-class"><a href="#1-Basic-examples-of-the-Raycaster-class" class="headerlink" title="1 - Basic examples of the Raycaster class"></a>1 - Basic examples of the Raycaster class</h2><p>When it comes to starting out with anything in threejs, or when it comes to just about anything in programing there is thinking in terms of first starting out with a simple hello world style example of what that something is. So then in this section I will be starting out with some fairly simple examples of the use of the raycaster class, before moving on to more complex examples of various use cases.</p>
<h3 id="1-1-Sphere-Raycaster-example"><a href="#1-1-Sphere-Raycaster-example" class="headerlink" title="1.1 - Sphere Raycaster example"></a>1.1 - Sphere Raycaster example</h3><p>The goal here is to use the raycaster class to get a position on the surface of a sphere, and then use that as a way to position a new mesh object on the surface of that sphere. There <a href="/2021/05/14/threejs-examples-position-things-to-sphere-surface/">may be better ways of doing this sort of thing</a> when it comes to a sphere geometry as I could just use the apply Euler, normalize, and multiply scalar methods to do with actually. However this is very much a post on the raycaster class so I am  using just that.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SPHERE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH - SPHERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> sphere = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">3</span>, <span class="number">30</span>, <span class="number">30</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">scene.add(sphere);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RAYCASTER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> v_ray_origin = <span class="keyword">new</span> THREE.Vector3(<span class="number">50</span>, <span class="number">50</span>, <span class="number">25</span>); <span class="comment">// where the ray comes from</span></div><div class="line"><span class="keyword">const</span> v_ray_dir = v_ray_origin.clone().negate().normalize(); <span class="comment">// getting direction by inverting origin</span></div><div class="line"><span class="keyword">const</span> near = <span class="number">0</span>, far = <span class="number">100</span>;</div><div class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> THREE.Raycaster(v_ray_origin, v_ray_dir, near, far);</div><div class="line"><span class="comment">// intersect</span></div><div class="line"><span class="keyword">const</span> result = raycaster.intersectObject(sphere, <span class="literal">false</span>)</div><div class="line"><span class="keyword">if</span>(result.length &gt; <span class="number">0</span>)&#123;</div><div class="line">    <span class="keyword">const</span> hit = result[<span class="number">0</span>];</div><div class="line">    <span class="built_in">console</span>.log(hit.point);</div><div class="line">    <span class="comment">// create mesh at point</span></div><div class="line">    <span class="keyword">const</span> box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">    box.position.copy(hit.point.clone().normalize().multiplyScalar(<span class="number">3.5</span>));</div><div class="line">    box.lookAt(sphere.position);</div><div class="line">    scene.add(box);</div><div class="line">&#125;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h3 id="1-2-Torus-Raycaster-example"><a href="#1-2-Torus-Raycaster-example" class="headerlink" title="1.2 - Torus  Raycaster example"></a>1.2 - Torus  Raycaster example</h3><p>This will be another quick example of using a raycaster to position one mesh object to the surface of another, this time I will be doing so with a torus geometry.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SPHERE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH - SPHERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> torus = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.TorusGeometry(<span class="number">4</span>, <span class="number">0.75</span>, <span class="number">20</span>, <span class="number">20</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;<span class="attr">wireframe</span>: <span class="literal">true</span>&#125;));</div><div class="line">torus.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>)</div><div class="line">scene.add(torus);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RAYCASTER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> v_ray_origin = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>); <span class="comment">// where the ray comes from</span></div><div class="line"><span class="keyword">let</span> radian = <span class="built_in">Math</span>.PI / <span class="number">180</span> * <span class="number">300</span>;</div><div class="line"><span class="keyword">let</span> v_lookat = <span class="keyword">new</span> THREE.Vector3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>).applyEuler( <span class="keyword">new</span> THREE.Euler(<span class="number">0</span>, radian, <span class="number">0</span>) ).multiplyScalar(<span class="number">4</span>);</div><div class="line"><span class="comment">// object to helper set dir</span></div><div class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> THREE.Object3D();</div><div class="line">obj.position.copy(v_ray_origin);</div><div class="line">obj.lookAt(v_lookat);</div><div class="line"><span class="keyword">const</span> v_ray_dir = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">v_ray_dir.applyEuler(obj.rotation).normalize();</div><div class="line"><span class="comment">// create raycaster</span></div><div class="line"><span class="keyword">const</span> near = <span class="number">0</span>, far = <span class="number">100</span>;</div><div class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> THREE.Raycaster(v_ray_origin, v_ray_dir, near, far);</div><div class="line"><span class="comment">// intersect</span></div><div class="line"><span class="keyword">const</span> result = raycaster.intersectObject(torus, <span class="literal">false</span>)</div><div class="line"><span class="keyword">if</span>(result.length &gt; <span class="number">0</span>)&#123;</div><div class="line">    <span class="keyword">const</span> hit = result[<span class="number">0</span>];</div><div class="line">    <span class="comment">// create mesh at point</span></div><div class="line">    <span class="keyword">const</span> box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">    box.position.copy( hit.point );</div><div class="line">    box.lookAt(v_lookat);</div><div class="line">    scene.add(box);</div><div class="line">&#125;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RENDER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line">renderer.render(scene, camera);</div></pre></td></tr></table></figure>
<h2 id="2-Mouse-over-example-of-the-Raycaster-class"><a href="#2-Mouse-over-example-of-the-Raycaster-class" class="headerlink" title="2 - Mouse over example of the Raycaster class"></a>2 - Mouse over example of the Raycaster class</h2><p>For this example I am going to b going over an example where I am using a raycaster to find out if a mesh in the scene has been clicked or touched. In the event that is was I will just do something that will be a confirmation of sorts that it has been clicked such as increase the scale. </p>
<p>The main method of interest with the Raycaster class is the intersect objects method, but in order to set the state of the Raycaster instance first I will want to use the set from camera method. In order to use the set from camera method of course I am going to need an instance of a camera, but I am also going to need a Vector2 instance that is the mouse or pointer position in the canvas.</p>
<p>So then I create my instance of raycaster, and then also an instance of the Vecot2 class. I can then use mouse, touch, or pointer events to get a canvas relative position that was clicked and use that to update the state of the vecotr2 that I will be using with the set from camera method. In a main update method I can then call the set from camera method, and pass the camera along with the current state of the vecotr2 class that can be mutated by pointer events.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SCENE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">9</span>, <span class="number">9</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MOUSE OVER EVENT</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> THREE.Raycaster();</div><div class="line"><span class="keyword">const</span> mouse = <span class="keyword">new</span> THREE.Vector2(<span class="number">-5</span>, <span class="number">-5</span>);</div><div class="line"><span class="comment">// update mouse Vector2 on pointer down event</span></div><div class="line"><span class="keyword">const</span> onDown = <span class="function">(<span class="params"> event </span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// calculate mouse position in normalized device coordinates</span></div><div class="line">    <span class="comment">// (-1 to +1) for both components</span></div><div class="line">    <span class="keyword">const</span> canvas = event.target,</div><div class="line">    box = canvas.getBoundingClientRect(),</div><div class="line">    x = event.clientX - box.left,</div><div class="line">    y = event.clientY - box.top;</div><div class="line">    <span class="comment">// set mouse Vector2 values</span></div><div class="line">    mouse.x = ( x / canvas.scrollWidth ) * <span class="number">2</span> - <span class="number">1</span>;</div><div class="line">    mouse.y = - ( y / canvas.scrollHeight ) * <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// set vector2 baco to -5 -5 on pointer up</span></div><div class="line"><span class="keyword">const</span> onUp = <span class="function">(<span class="params"> event </span>) =&gt;</span> &#123;</div><div class="line">    mouse.x = <span class="number">-5</span>;</div><div class="line">    mouse.y = - <span class="number">-5</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// Attach mouse event</span></div><div class="line">renderer.domElement.addEventListener( <span class="string">'pointerdown'</span>, onDown, <span class="literal">false</span> );</div><div class="line">renderer.domElement.addEventListener( <span class="string">'pointerup'</span>, onUp, <span class="literal">false</span> );</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// CHILD OBJECTS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> boxGroup = <span class="keyword">new</span> THREE.Group();</div><div class="line">scene.add(boxGroup);</div><div class="line"><span class="comment">// box 1</span></div><div class="line"><span class="keyword">let</span> box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">box.position.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">boxGroup.add(box);</div><div class="line"><span class="comment">// box 2</span></div><div class="line">box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">box.position.set(<span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">boxGroup.add(box);</div><div class="line"><span class="comment">// box 3</span></div><div class="line">box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">box.position.set(<span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">boxGroup.add(box);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// LOOP</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// orbit controls</span></div><div class="line"><span class="keyword">const</span> controls = <span class="keyword">new</span> THREE.OrbitControls(camera, renderer.domElement);</div><div class="line"><span class="keyword">let</span> lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="keyword">const</span> fps = <span class="number">30</span>;</div><div class="line"><span class="keyword">const</span> update = <span class="function">(<span class="params">group</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// default scale</span></div><div class="line">    group.children.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">        obj.scale.set(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// update the picking ray with the camera and mouse position</span></div><div class="line">    raycaster.setFromCamera( mouse, camera );</div><div class="line">    <span class="keyword">const</span> intersects = raycaster.intersectObjects(group.children, <span class="literal">true</span> );</div><div class="line">    <span class="keyword">if</span>(intersects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">const</span> mesh = intersects[<span class="number">0</span>].object;</div><div class="line">        mesh.scale.set(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span> (secs &gt; <span class="number">1</span> / fps) &#123;</div><div class="line">        <span class="comment">// update</span></div><div class="line">        update(boxGroup);</div><div class="line">        <span class="comment">// render</span></div><div class="line">        renderer.render(scene, camera);</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<h2 id="3-Cube-Group-Raycaster-class-example"><a href="#3-Cube-Group-Raycaster-class-example" class="headerlink" title="3 - Cube Group Raycaster class example"></a>3 - Cube Group Raycaster class example</h2><p>For this example of the Raycaster class I decided to make use of a module that I made for my <a href="/2021/05/10/threejs-examples-nested-groups/">post on nested groups in three.js</a> that is a kind of cube group model. This module is just a way to create a group of eight mesh objects where each mesh object has an instance of the built in box geometry of three.js as its geometry. These eight mesh objects are positioned in such a way so that they from a larger cube of cubes sort of speak. I can then use an update method of the cube group module to update the state of ones of these cube groups so that the cubes expand outward from the center of the group, and back again.</p>
<h3 id="3-1-Cube-Group-module"><a href="#3-1-Cube-Group-module" class="headerlink" title="3.1 - Cube Group module"></a>3.1 - Cube Group module</h3><p>Here I have the state of the cube group module as I have used it for this example. I did not change much with this from what I have worked out in the for the other three.js example post. Still I often do make a few minor changes here and there with these when I use them in other projects, so I just got into the habit of always posing what it is that I am using here.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> ANGLES_A = [<span class="number">225</span>, <span class="number">315</span>, <span class="number">135</span>, <span class="number">45</span>];</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> toRadians = <span class="function"><span class="keyword">function</span> (<span class="params">array</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> array.map(<span class="function"><span class="keyword">function</span>(<span class="params">deg</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">Math</span>.PI / <span class="number">180</span> * deg;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// create a single cube mesh</span></div><div class="line">    <span class="keyword">var</span> createCube = <span class="function"><span class="keyword">function</span> (<span class="params">rotationCounts, position, materials</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">                <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</div><div class="line">                materials || <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">        <span class="comment">// USER DATA OBJECT FOR A SINGLE CUBE</span></div><div class="line">        <span class="keyword">var</span> ud = cube.userData;</div><div class="line">        ud.rotationCounts = rotationCounts || [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</div><div class="line">        cube.position.copy(position || <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">        <span class="keyword">return</span> cube;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// update a single cube</span></div><div class="line">    <span class="keyword">var</span> updateCube = <span class="function"><span class="keyword">function</span> (<span class="params">cube, per</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ud = cube.userData,</div><div class="line">        rc = ud.rotationCounts,</div><div class="line">        pi2 = <span class="built_in">Math</span>.PI * <span class="number">2</span>;</div><div class="line">        cube.rotation.x = pi2 * rc[<span class="number">0</span>] * per;</div><div class="line">        cube.rotation.y = pi2 * rc[<span class="number">1</span>] * per;</div><div class="line">        cube.rotation.z = pi2 * rc[<span class="number">2</span>] * per;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// public method to create a cube group</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.cubeRotations = opt.cubeRotations || [];</div><div class="line">        <span class="keyword">var</span> cubes = <span class="keyword">new</span> THREE.Group(),</div><div class="line">        <span class="comment">// USER DATA OBJECT FOR A GROUP OF CUBES</span></div><div class="line">        gud = cubes.userData;</div><div class="line">        gud.frame = <span class="number">0</span>;</div><div class="line">        gud.maxFrame = opt.maxFrame || <span class="number">60</span>;</div><div class="line">        gud.fps = opt.fps || <span class="number">30</span>;</div><div class="line">        gud.anglesA = toRadians(opt.anglesA || ANGLES_A);</div><div class="line">        gud.yDelta = opt.yDelta === <span class="literal">undefined</span> ? <span class="number">2</span> : opt.yDelta;</div><div class="line">        gud.xzDelta = opt.xzDelta === <span class="literal">undefined</span> ? <span class="number">2</span> : opt.xzDelta;</div><div class="line">        gud.rotations = opt.rotations || [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</div><div class="line">        gud.secs = <span class="number">0</span>;</div><div class="line">        gud.type = <span class="string">'cubegroup'</span>;</div><div class="line">        gud.active = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(i &lt; <span class="number">8</span>)&#123;</div><div class="line">            <span class="keyword">var</span> cubeRotations = opt.cubeRotations[i] || [<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.00</span>];</div><div class="line">            <span class="keyword">var</span> cube = createCube(</div><div class="line">                cubeRotations, </div><div class="line">                <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">                opt.materials);</div><div class="line">            cubes.add(cube);</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;;        </div><div class="line">        <span class="keyword">return</span> cubes;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> setCubesRotation = <span class="function"><span class="keyword">function</span>(<span class="params">cubes, per</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gud = cubes.userData,</div><div class="line">        r = gud.rotations,</div><div class="line">        PI2 = <span class="built_in">Math</span>.PI * <span class="number">2</span>;</div><div class="line">        <span class="keyword">var</span> x = PI2 * r[<span class="number">0</span>] * per,</div><div class="line">        y = PI2 * r[<span class="number">1</span>] * per,</div><div class="line">        z = PI2 * r[<span class="number">2</span>] * per;</div><div class="line">        cubes.rotation.set(x, y, z);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> updateCubes = <span class="function"><span class="keyword">function</span>(<span class="params">cubes, per, bias</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> gud = cubes.userData;</div><div class="line">        <span class="comment">// update cubes</span></div><div class="line">        cubes.children.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">cube, i</span>) </span>&#123;</div><div class="line">            <span class="comment">// start values</span></div><div class="line">            <span class="keyword">var</span> sx = i % <span class="number">2</span> - <span class="number">0.5</span>,</div><div class="line">            sz = <span class="built_in">Math</span>.floor(i / <span class="number">2</span>) - <span class="built_in">Math</span>.floor(i / <span class="number">4</span>) * <span class="number">2</span> - <span class="number">0.5</span>,</div><div class="line">            sy = <span class="built_in">Math</span>.floor(i / (<span class="number">2</span> * <span class="number">2</span>)) - <span class="number">0.5</span>;</div><div class="line">            <span class="comment">// adjusted</span></div><div class="line">            <span class="keyword">var</span> aIndex = i % <span class="number">4</span>,</div><div class="line">            bIndex = <span class="built_in">Math</span>.floor(i / <span class="number">4</span>),</div><div class="line">            r1 = gud.anglesA[aIndex],</div><div class="line">            x = sx + <span class="built_in">Math</span>.cos(r1) * gud.xzDelta * bias,</div><div class="line">            y = sy + gud.yDelta * bias * (bIndex === <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>),</div><div class="line">            z = sz + <span class="built_in">Math</span>.sin(r1) * gud.xzDelta * bias;</div><div class="line">            <span class="comment">// set position of cube</span></div><div class="line">            cube.position.set(x, y, z);</div><div class="line">            <span class="comment">// call cube update method</span></div><div class="line">            updateCube(cube, per);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// update the group</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span>(<span class="params">cubes, secs</span>) </span>&#123;</div><div class="line">        <span class="comment">// GROUP USER DATA OBJECT</span></div><div class="line">        <span class="keyword">var</span> gud = cubes.userData;</div><div class="line">        <span class="keyword">var</span> per = gud.frame / gud.maxFrame,</div><div class="line">        bias = <span class="number">1</span> - <span class="built_in">Math</span>.abs(per - <span class="number">0.5</span>) / <span class="number">0.5</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span>(gud.active)&#123;</div><div class="line">            updateCubes(cubes, per, bias);</div><div class="line">            <span class="comment">// whole group rotation</span></div><div class="line">            setCubesRotation(cubes, bias);</div><div class="line">            <span class="comment">// step frame</span></div><div class="line">            gud.secs += secs;</div><div class="line">            <span class="keyword">if</span>(gud.secs &gt;= <span class="number">1</span> / gud.fps)&#123;</div><div class="line">                gud.frame += <span class="number">1</span>; <span class="comment">// gud.fps * secs;</span></div><div class="line">                gud.frame %= gud.maxFrame;</div><div class="line">                gud.secs %= <span class="number">1</span> / gud.fps;</div><div class="line">                <span class="keyword">if</span>(gud.frame === <span class="number">0</span>)&#123;</div><div class="line">                    gud.active = <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;</div><div class="line">    (<span class="keyword">this</span>[<span class="string">'CubeGroupMod'</span>] = &#123;&#125;));</div></pre></td></tr></table></figure>
<h3 id="3-2-the-main-javaScript-file"><a href="#3-2-the-main-javaScript-file" class="headerlink" title="3.2 - the main javaScript file"></a>3.2 - the main javaScript file</h3><p>Now for a main javaScript file in which I am using the Raycaster class to run an animation for any and all cube groups that intersect when using a Raycater. When it comes to working with an instance of this cube group of mine it is a little different from working with a collection of mesh objects, as what I am dealing with here is a collection of groups of mesh objects. However the situation is not all that more involved as I just need to loop over the collection of cube groups, and pass the children of each group to the intersects objects method. I can then just the the first mesh object if any and just use the parent property of that mesh to get a reference to the group of cube mesh objects. I can then set the active flag of the cube group to true.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> raycaster = <span class="keyword">new</span> THREE.Raycaster();</div><div class="line"><span class="keyword">var</span> mouse = <span class="keyword">new</span> THREE.Vector2(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"> </div><div class="line"><span class="comment">// on mouse move</span></div><div class="line"><span class="keyword">var</span> onMouseMove = <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> canvas = event.target,</div><div class="line">    box = canvas.getBoundingClientRect(),</div><div class="line">    x = event.clientX - box.left,</div><div class="line">    y = event.clientY - box.top;</div><div class="line">    mouse.x = ( x / canvas.scrollWidth ) * <span class="number">2</span> - <span class="number">1</span>;</div><div class="line">    mouse.y = - ( y / canvas.scrollHeight ) * <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// update the picking ray with the camera and mouse position</span></div><div class="line"><span class="keyword">var</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">cubeGroups, secs</span>)</span>&#123;</div><div class="line">    raycaster.setFromCamera( mouse, camera );</div><div class="line">    cubeGroups.children.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">cubeGroup</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> intersects = raycaster.intersectObjects( cubeGroup.children, <span class="literal">true</span> );</div><div class="line">        <span class="keyword">if</span>(intersects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">var</span> mesh = intersects[<span class="number">0</span>].object,</div><div class="line">            group = mesh.parent;</div><div class="line">            group.userData.active = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        CubeGroupMod.update(cubeGroup, secs);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// creating a scene</span></div><div class="line"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">9</span>, <span class="number">9</span>));</div><div class="line"> </div><div class="line"><span class="keyword">var</span> cubeGroups = <span class="keyword">new</span> THREE.Group();</div><div class="line">scene.add(cubeGroups);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> cg = CubeGroupMod.create(&#123;</div><div class="line">   <span class="attr">maxFrame</span>: <span class="number">30</span>,</div><div class="line">   <span class="attr">yDelta</span>: <span class="number">0.5</span>,</div><div class="line">   <span class="attr">xzDelta</span>: <span class="number">0.5</span></div><div class="line">&#125;);</div><div class="line">cg.position.x = <span class="number">0</span>;</div><div class="line">cubeGroups.add(cg);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> cg = CubeGroupMod.create(&#123;</div><div class="line">   <span class="attr">maxFrame</span>: <span class="number">30</span>,</div><div class="line">   <span class="attr">yDelta</span>: <span class="number">0.5</span>,</div><div class="line">   <span class="attr">xzDelta</span>: <span class="number">0.5</span></div><div class="line">&#125;);</div><div class="line">cg.position.x = <span class="number">3</span>;</div><div class="line">cubeGroups.add(cg);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> cg = CubeGroupMod.create(&#123;</div><div class="line">   <span class="attr">maxFrame</span>: <span class="number">30</span>,</div><div class="line">   <span class="attr">yDelta</span>: <span class="number">0.5</span>,</div><div class="line">   <span class="attr">xzDelta</span>: <span class="number">0.5</span></div><div class="line">&#125;);</div><div class="line">cg.position.x = <span class="number">-3</span>;</div><div class="line">cubeGroups.add(cg);</div><div class="line"> </div><div class="line"><span class="comment">// camera and renderer</span></div><div class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>).appendChild(renderer.domElement);</div><div class="line"> </div><div class="line">renderer.domElement.addEventListener( <span class="string">'mousemove'</span>, onMouseMove, <span class="literal">false</span> );</div><div class="line"> </div><div class="line"><span class="keyword">var</span> controls = <span class="keyword">new</span> THREE.OrbitControls(camera, renderer.domElement);</div><div class="line"> </div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">var</span> lt = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">maxFrame = <span class="number">300</span>,</div><div class="line">fps = <span class="number">30</span>;</div><div class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    per = frame / maxFrame,</div><div class="line">    bias = <span class="number">1</span> - <span class="built_in">Math</span>.abs(per - <span class="number">0.5</span>) / <span class="number">0.5</span>,</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span> (secs &gt; <span class="number">1</span> / fps) &#123;</div><div class="line"> </div><div class="line">        update(cubeGroups, secs);</div><div class="line"> </div><div class="line">        renderer.render(scene, camera);</div><div class="line">        frame += fps * secs;</div><div class="line">        frame %= maxFrame;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<p>So then the outcome of this is more or less what I had in mind when it comes to what I wanted to do. When I mouse over a cube group the cube group beginnings an animation loop, until the loop is over at which point the active false ends up getting set back to false. Maybe not the most interesting example, but I wanted to do something at least a little more advanced then just the usual basic copy and paste cook book style code examples.</p>
<h2 id="4-Animation-loop-examples"><a href="#4-Animation-loop-examples" class="headerlink" title="4 - Animation loop examples"></a>4 - Animation loop examples</h2><p>In this section I will then be going over at least one if not more source code examples for any videos that I have made for this post. As of this writing I made just once video that has to do with using the raycaster class to get the position of a location on the surface of a torus geometry. In time when I get around to editing this post again, which I might very well do because this is an important subject I am sure that the collection will grow here.</p>
<h3 id="4-1-Torus"><a href="#4-1-Torus" class="headerlink" title="4.1 - Torus"></a>4.1 - Torus</h3><p>The first video that I made for this post is based off of this source code that I will be writing about in this section. For this video I just wanted to move a mesh object around with the center of the mesh located at the position at which the raycatser has round on the surface. The goal here then is to just show one of the core use cases of the raycaster class which is to use it as a tool to find a location on the surface of a geometry, typically to help with setting the position of the a mesh object on the surface of another.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SPHERE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// set mesh posiiton if we have a hit</span></div><div class="line"><span class="keyword">const</span> setMeshIfHit = <span class="function">(<span class="params">raycaster, mesh, target, v_lookat</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> result = raycaster.intersectObject(target, <span class="literal">false</span>);</div><div class="line">    <span class="keyword">if</span>(result.length &gt; <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">const</span> hit = result[<span class="number">0</span>];</div><div class="line">        mesh.position.copy( hit.point );</div><div class="line">        mesh.lookAt(v_lookat);</div><div class="line">   &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get dir</span></div><div class="line"><span class="keyword">const</span> getDir = <span class="function">(<span class="params">v_origin, v_lookat</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> obj = <span class="keyword">new</span> THREE.Object3D();</div><div class="line">    obj.position.copy(v_origin);</div><div class="line">    obj.lookAt(v_lookat);</div><div class="line">    <span class="keyword">const</span> dir = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    dir.applyEuler(obj.rotation).normalize();</div><div class="line">    <span class="keyword">return</span> dir;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get look at vector</span></div><div class="line"><span class="keyword">const</span> getLookAt = <span class="function">(<span class="params">deg, radius</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> radian = <span class="built_in">Math</span>.PI / <span class="number">180</span> * deg;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> THREE.Vector3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>).applyEuler( <span class="keyword">new</span> THREE.Euler(<span class="number">0</span>, radian, <span class="number">0</span>) ).multiplyScalar(radius);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH - SPHERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> torus_radius = <span class="number">4</span>;</div><div class="line"><span class="keyword">const</span> torus = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.TorusGeometry(torus_radius, <span class="number">1.25</span>, <span class="number">20</span>, <span class="number">20</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123;<span class="attr">wireframe</span>: <span class="literal">true</span>&#125;));</div><div class="line">torus.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>)</div><div class="line">scene.add(torus);</div><div class="line"><span class="comment">// create mesh at point</span></div><div class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">1.5</span>, <span class="number">1.5</span>, <span class="number">1.5</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">scene.add(box);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RAYCASTER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// create raycaster</span></div><div class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> THREE.Raycaster();</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">300</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> a = frame / frameMax;</div><div class="line">    <span class="keyword">let</span> b = <span class="number">1</span> - <span class="built_in">Math</span>.abs(<span class="number">0.5</span> - a * <span class="number">2</span> % <span class="number">1</span> ) / <span class="number">0.5</span>;</div><div class="line">    <span class="keyword">let</span> v_lookat = getLookAt(<span class="number">360</span> * a, torus_radius);</div><div class="line">    <span class="keyword">let</span> v_ray_origin = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">-20</span> + <span class="number">40</span> * b, <span class="number">0</span>)</div><div class="line">    <span class="keyword">let</span> v_ray_dir = getDir(v_ray_origin,  v_lookat);</div><div class="line">    raycaster.set(v_ray_origin, v_ray_dir);</div><div class="line">    setMeshIfHit(raycaster, box, torus, v_lookat);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<p>There is still finding ways to adjust the geometry of the sphere that I am moving on the surface of the torus, by ether translating the geometry of the sphere, or making use of the <a href="/2022/10/07/threejs-buffer-geometry-compute-bounding-box/">compute bounding box method</a> of buffer geometry and get size method of the box3 class. In any case the core idea is working just fine in this video when it just comes to getting a position on the surface of a geometry.</p>
<h3 id="4-2-Torus-bounding-box-and-lerp-to-adjust-mesh-position-from-hit-position"><a href="#4-2-Torus-bounding-box-and-lerp-to-adjust-mesh-position-from-hit-position" class="headerlink" title="4.2 - Torus, bounding box, and lerp to adjust mesh position from hit position"></a>4.2 - Torus, bounding box, and lerp to adjust mesh position from hit position</h3><p>So far it looks like raycaster works more or less okay for getting a desired position on the surface of a geometry. However now there is just the question of how to go about adjusting from that position depending the size of the geometry that I am using with a mesh that I wish to place on the surface. If I just place a mesh at the hit location without doing anything to translate the geometry, or adjust that values that I use to position the child mesh lets call it, then things might not always look so great.</p>
<p>The first thing to keep in mind here is that I am not dealing with a problem with Raycaster, but rather the position of the geometry relative to the origin of the mesh. When it comes to a box geometry I can just get the size of the geometry, and then divide the desired axis by half as the origin is typically in the center of the geometry when it is created by such a built in constructor. That is what I am doing here in this example.</p>
<p>The main tools that are my friend here are Vecotr3 class methods such as the lerp and distance to methods, along with the bounding box property of the child mesh geometry. So there is also the Compute Bounding box method of the buffer geometry, and also the Box3 class, and with that the getSize method of the box3 class. Using all these tools I updated the source code of my set mesh if hit helper function to adjust the position of the mesh object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// SPHERE, CAMERA, RENDERER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</div><div class="line">scene.add(<span class="keyword">new</span> THREE.GridHelper(<span class="number">10</span>, <span class="number">10</span>));</div><div class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">60</span>, <span class="number">320</span> / <span class="number">240</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</div><div class="line">camera.position.set(<span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>);</div><div class="line">camera.lookAt(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</div><div class="line">renderer.setSize(<span class="number">640</span>, <span class="number">480</span>);</div><div class="line">( <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>) || <span class="built_in">document</span>.body ).appendChild(renderer.domElement);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// set mesh posiiton if we have a hit</span></div><div class="line"><span class="keyword">const</span> setMeshIfHit = <span class="function">(<span class="params">raycaster, mesh, target, adjustAxis, adjustMulti</span>) =&gt;</span> &#123;</div><div class="line">    adjustAxis = adjustAxis || <span class="string">'z'</span>;</div><div class="line">    adjustMulti = adjustMulti === <span class="literal">undefined</span> ? <span class="number">0.5</span> : adjustMulti;</div><div class="line">    <span class="comment">// raycatsre result</span></div><div class="line">    <span class="keyword">const</span> result = raycaster.intersectObject(target, <span class="literal">false</span>);</div><div class="line">    <span class="comment">//if we have a hit, update mesh pos</span></div><div class="line">    <span class="keyword">if</span>(result.length &gt; <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">const</span> hit = result[<span class="number">0</span>];</div><div class="line">        <span class="comment">// use distance to, lerp, and bounding box to adjust</span></div><div class="line">        mesh.geometry.computeBoundingBox();</div><div class="line">        <span class="keyword">let</span> v_size = <span class="keyword">new</span> THREE.Vector3();</div><div class="line">        mesh.geometry.boundingBox.getSize(v_size);</div><div class="line">        <span class="keyword">let</span> hh = v_size[adjustAxis] * adjustMulti;</div><div class="line">        <span class="keyword">let</span> d = hit.point.distanceTo(raycaster.ray.origin);</div><div class="line">        mesh.position.copy( hit.point ).lerp(raycaster.ray.origin, hh / d);</div><div class="line">        <span class="comment">//mesh.position.copy( hit.point );</span></div><div class="line">        <span class="comment">// can use the origin prop of the Ray class</span></div><div class="line">        mesh.lookAt(raycaster.ray.origin);</div><div class="line">   &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get dir</span></div><div class="line"><span class="keyword">const</span> getDir = <span class="function">(<span class="params">v_origin, v_lookat</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> obj = <span class="keyword">new</span> THREE.Object3D();</div><div class="line">    obj.position.copy(v_origin);</div><div class="line">    obj.lookAt(v_lookat);</div><div class="line">    <span class="keyword">const</span> dir = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    dir.applyEuler(obj.rotation).normalize();</div><div class="line">    <span class="keyword">return</span> dir;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// get look at vector</span></div><div class="line"><span class="keyword">const</span> getLookAt = <span class="function">(<span class="params">deg, radius</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> radian = <span class="built_in">Math</span>.PI / <span class="number">180</span> * deg;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> THREE.Vector3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>).applyEuler( <span class="keyword">new</span> THREE.Euler(<span class="number">0</span>, radian, <span class="number">0</span>) ).multiplyScalar(radius);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// MESH - SPHERE</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="keyword">const</span> torus_radius = <span class="number">4</span>;</div><div class="line"><span class="comment">// the torus mesh</span></div><div class="line"><span class="keyword">const</span> torus = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">        <span class="keyword">new</span> THREE.TorusGeometry(torus_radius, <span class="number">1.25</span>, <span class="number">40</span>, <span class="number">40</span>),</div><div class="line">        <span class="keyword">new</span> THREE.MeshNormalMaterial(&#123; <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.8</span> &#125;));</div><div class="line">torus.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>);</div><div class="line">scene.add(torus);</div><div class="line"><span class="comment">// raycaster point mesh</span></div><div class="line"><span class="keyword">const</span> mesh_ray = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.ConeGeometry(<span class="number">0.25</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">10</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">mesh_ray.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>);</div><div class="line">scene.add(mesh_ray);</div><div class="line"><span class="comment">// create a mesh object</span></div><div class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(</div><div class="line">    <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">0.75</span>, <span class="number">2</span>, <span class="number">1.25</span>),</div><div class="line">    <span class="keyword">new</span> THREE.MeshNormalMaterial());</div><div class="line">mesh.geometry.rotateX(<span class="built_in">Math</span>.PI * <span class="number">0.5</span>);</div><div class="line"><span class="comment">// just translating the geometry works, but I would rather adjust by another means</span></div><div class="line"><span class="comment">//box.geometry.translate(0, 0, -0.75);</span></div><div class="line">scene.add(mesh);</div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// RAYCASTER</span></div><div class="line"><span class="comment">//-------- ----------</span></div><div class="line"><span class="comment">// create raycaster</span></div><div class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> THREE.Raycaster();</div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="comment">// ANIMATION LOOP</span></div><div class="line"><span class="comment">// ---------- ----------</span></div><div class="line"><span class="keyword">const</span> FPS_UPDATE = <span class="number">20</span>, <span class="comment">// fps rate to update ( low fps for low CPU use, but choppy video )</span></div><div class="line">FPS_MOVEMENT = <span class="number">30</span>;     <span class="comment">// fps rate to move object by that is independent of frame update rate</span></div><div class="line">FRAME_MAX = <span class="number">300</span>;</div><div class="line"><span class="keyword">let</span> secs = <span class="number">0</span>,</div><div class="line">frame = <span class="number">0</span>,</div><div class="line">lt = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="comment">// update</span></div><div class="line"><span class="keyword">new</span> THREE.OrbitControls(camera, renderer.domElement);</div><div class="line"><span class="keyword">const</span> update = <span class="function"><span class="keyword">function</span>(<span class="params">frame, frameMax</span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> a = frame / frameMax;</div><div class="line">    <span class="keyword">let</span> b = <span class="number">1</span> - <span class="built_in">Math</span>.abs(<span class="number">0.5</span> - a * <span class="number">2</span> % <span class="number">1</span> ) / <span class="number">0.5</span>;</div><div class="line">    <span class="comment">// update raycaster</span></div><div class="line">    <span class="keyword">let</span> v_lookat = getLookAt(<span class="number">360</span> * a, torus_radius);</div><div class="line">    <span class="keyword">let</span> v_ray_origin = <span class="keyword">new</span> THREE.Vector3(<span class="number">0</span>, <span class="number">-5</span> + <span class="number">10</span> * b, <span class="number">0</span>);</div><div class="line">    <span class="keyword">let</span> v_ray_dir = getDir(v_ray_origin,  v_lookat);</div><div class="line">    raycaster.set(v_ray_origin, v_ray_dir);</div><div class="line">    <span class="comment">// update mesh_ray to have the same position as the raycaster origin</span></div><div class="line">    mesh_ray.position.copy(v_ray_origin);</div><div class="line">    mesh_ray.lookAt(v_lookat);</div><div class="line">    <span class="comment">// if we have a hit, update the mesh object</span></div><div class="line">    setMeshIfHit(raycaster, mesh, torus);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// loop</span></div><div class="line"><span class="keyword">const</span> loop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span>(secs &gt; <span class="number">1</span> / FPS_UPDATE)&#123;</div><div class="line">        <span class="comment">// update, render</span></div><div class="line">        update( <span class="built_in">Math</span>.floor(frame), FRAME_MAX);</div><div class="line">        renderer.render(scene, camera);</div><div class="line">        <span class="comment">// step frame</span></div><div class="line">        frame += FPS_MOVEMENT * secs;</div><div class="line">        frame %= FRAME_MAX;</div><div class="line">        lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure>
<p>Although this might be working okay with the box ge9ometry mesh that I am using in this example you will notice that i added some arguments for changing what the adjust axis is, as well as a multiplier for that axis. The reason why is because when using many other states of geometry I might need to adjust what those values are. However maybe the best way of making sure that this always works well is to adjust the geometry so that the origin is always in a standard location that is like that of what happens with the box geometry. In other words make sure that it is always more or less in the center of the geometry, and that the rotation of the geometry is consistent</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>So then the raycaster class is a useful tool to go about clicking on mesh objects in three.js. However I am sure that there are many uses for the class that will come up when it comes to writing scripts that update some kind of simulation also when it comes to getting a collection of mesh objects from a given object outward or anything to that effect. I think that there might be a need for maybe a few more basic examples of this kind of class as I am sure that there are a number of issues that will come up here and there when using this class. Not just with the class itself, but also when it comes to three.js, and javaScript in general. For example many of the examples that I have worked out as of this writing will just work with a mouse, but I did not do anything when it comes to working with touch devices, and this day in age I have to take that into account when making any kind of production project.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2021/05/18/threejs-raycaster/" data-id="cleu7szaj02eeecv1kmsi16dx" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2021/05/18/threejs-raycaster/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/three-js/">three.js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/05/19/threejs-examples-tree-sphere/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Tree Sphere threejs example
        
      </div>
    </a>
  
  
    <a href="/2021/05/17/threejs-examples-build-a-box/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Build a Box Helper Three.js example</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2021/05/18/threejs-raycaster/index.html';
    this.page.identifier = '869';
    this.page.title = 'Clicking a mesh in three.js with the Raycaster class';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.27px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.45px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.18px;">angular</a> <a href="/tags/animation/" style="font-size: 11.82px;">animation</a> <a href="/tags/automation/" style="font-size: 11.82px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.27px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.45px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.64px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.73px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.91px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.36px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.64px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.82px;">express</a> <a href="/tags/games/" style="font-size: 17.27px;">games</a> <a href="/tags/git/" style="font-size: 12.73px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.82px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.55px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.45px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.36px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.73px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.64px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.55px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.55px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.91px;">python</a> <a href="/tags/statistics/" style="font-size: 14.09px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.09px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.36px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/03/threejs-examples-breath-module/">A Breath Module threejs project example</a>
          </li>
        
          <li>
            <a href="/2023/02/23/threejs-points/">Points in threejs</a>
          </li>
        
          <li>
            <a href="/2023/02/17/threejs-examples-tracks/">Train Track threejs module project example</a>
          </li>
        
          <li>
            <a href="/2023/02/10/threejs-curves-cubicbeziercurve3/">Cubic Bezier Curves in threejs</a>
          </li>
        
          <li>
            <a href="/2023/02/03/threejs-buffer-geometry-morph-attributes/">Morph Attributes of buffer geometry objects</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2021/05/18/threejs-raycaster/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>