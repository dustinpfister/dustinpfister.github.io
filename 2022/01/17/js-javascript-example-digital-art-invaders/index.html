<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- disqus image-->
  <meta property="og:image" content="https://dustinpfister.github.io/css/images/banner.jpg">
  
  <title>Invaders Digital Art javaScript example | Dustin John Pfister at github pages</title>
  
  <!-- no index tag or blank here -->
  
  
  <link rel="canonical" href="https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Continuing with a digital art collection of javaScript examples I have made yet another quick project following the same general thought process with the others when it comes to sticking with a fairly">
<meta property="og:type" content="article">
<meta property="og:title" content="Invaders Digital Art javaScript example">
<meta property="og:url" content="https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/index.html">
<meta property="og:site_name" content="Dustin John Pfister at github pages">
<meta property="og:description" content="Continuing with a digital art collection of javaScript examples I have made yet another quick project following the same general thought process with the others when it comes to sticking with a fairly">
<meta property="og:updated_time" content="2022-01-23T17:37:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Invaders Digital Art javaScript example">
<meta name="twitter:description" content="Continuing with a digital art collection of javaScript examples I have made yet another quick project following the same general thought process with the others when it comes to sticking with a fairly">
  
    <link rel="alternate" href="/atom.xml" title="Dustin John Pfister at github pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XLNG6JRW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y8XLNG6JRW');
</script>
<!-- End Google Analytics -->


  <!-- structured data set in structured-data.ejs -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Person",
    "email": "distin.pfister@gmail.com",
    "givenName": "Dustin",
    "familyName" : "Pfister",
    "additionalName": "John",
    "name": "Dustin John Pfister",
    "gender": "Male"
}
</script>
<!-- end structured data -->
  
  <!-- adsense if indexed -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1658284027672315",
    enable_page_level_ads: true
  });
  </script>
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <!-- added the image, as well as the link to my youtube -->
        <a href="https://www.youtube.com/user/javaweaver"><div class="selfimage"></div></a>
        <!--<a href="/" id="logo">Dustin John Pfister at github pages</a>-->
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/2021/02/19/threejs-examples/">ThreeJS</a>
        
          <a class="main-nav-link" href="/2020/03/23/canvas-example/">Canvas</a>
        
          <a class="main-nav-link" href="https://www.youtube.com/user/javaweaver">Youtube</a>
        
          <a class="main-nav-link" href="https://github.com/dustinpfister">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <!-- removed rss link-->
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://dustinpfister.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article itemscope itemtype="http://schema.org/Blog" id="post-js-javascript-example-digital-art-invaders" class="article article-type-post" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/17/js-javascript-example-digital-art-invaders/" class="article-date"> Published:
  <time datetime="2022-01-17T12:36:00.000Z" itemprop="datePublished">2022-01-17</time>
</a>

    <!-- other info (dustin) -->
    <a href="/2022/01/17/js-javascript-example-digital-art-invaders/" class="article-date"> Modified:
  <time datetime="2022-01-23T17:37:29.000Z" itemprop="dateModified">2022-01-23</time>
</a>

    <span class="article-date">V1.17</span>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/js/">js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Invaders Digital Art javaScript example
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="text">
      
        <p>Continuing with a digital art collection of <a href="/2021/04/02/js-javascript-example/">javaScript examples</a> I have made yet another quick project following the same general thought process with the others when it comes to sticking with a fairly simple idea, and getting the core of that idea done within the span of just few days. This time I wanted to make a digital art project that involves display objects that repentants fixed structures that spawn at the center of the canvas, and additional display objects that spawn from outside the canvas and move in to where the buildings are to attack and destroy these structures. The structures themselves also fight back, and both kinds of display units fire yet another kind of display object that is a shot object at each other. So then this digital art project is then something that resembles a kind of game, but because it is a digital art project that means I do not have to worry about UI design, save states, menus, and all kinds of additional features that I would need to work out of it where a game. This allows me to focus more so on just game logic, and also how the project looks as this is a digital art project.</p>
<a id="more"></a>
<h2 id="1-The-utilities-library"><a href="#1-The-utilities-library" class="headerlink" title="1 - The utilities library"></a>1 - The utilities library</h2><p>With just about all of these javaScript examples I often have a <a href="/2021/08/06/js-javascript-example-utils/">general utilities library</a> where I park various methods that I will end up using in one or more additional files in an over all project such as this one. These are then typical usual suspect type methods that have to do with things like getting the distance between two points, bounding box collision detection, working with angles, the Document Object Model and so forth. The collection of methods in a module such as this will change from one project to the next so it is a kind of custom cut, application specific utilizes library.</p>
<p>One method that I have in here is a method similar to that of the <a href="/2018/09/24/lodash_get/">lodash get method</a> where I can pass an object, then a string that is a path to a value in that object, and then an optional default value to return in the vent that there is not a value at that path location. Another method that I have here is a kind of get a value within a range by a number between 0 and 1 method. This is another kind of method that helps with something that seems to happen fairly often when making this kind of a project. That is that I give the method a value between 0 and 1, which can also be the result of a Math random call, and then the next values are a range of values, a kind of min and max so that they return value is the per value that is between these values.</p>
<p>I then have my create canvas method that I started when working out my <a href="/2020/03/23/canvas-example/">collection if vanilla javaScript canvas examples</a>. When it comes to those examples I started each project from the ground up, as I do with these examples, rather than using <a href="/2021/08/27/js-javascript-example-canvas-module/">some kind of canvas framework</a> for better or worse that is one of rules when it came to making that series of examples. However I made one little exception from one project to the next, and that exception was this method.</p>
<p>I then have a number of typical methods that I use in almost every project like this such as a mathematical module method, and distance and bounding box method. I also have a few methods that have to do with working with angles.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> utils = &#123;&#125;;</div><div class="line"><span class="comment">// get a nested object node from a source object by path string</span></div><div class="line">utils.getPath = <span class="function"><span class="keyword">function</span>(<span class="params">sourceObj, pathStr, def</span>)</span>&#123;</div><div class="line">   <span class="keyword">var</span> propNames = pathStr.split(<span class="string">'.'</span>);</div><div class="line">   <span class="keyword">var</span> node = sourceObj[propNames[<span class="number">0</span>]];</div><div class="line">   <span class="keyword">var</span> i = <span class="number">1</span>, len = propNames.length;</div><div class="line">   <span class="keyword">while</span>(i &lt; len)&#123;</div><div class="line">      <span class="keyword">try</span>&#123;</div><div class="line">          node = node[propNames[i]];</div><div class="line">          <span class="keyword">if</span>(node === <span class="literal">undefined</span>)&#123;</div><div class="line">              <span class="keyword">return</span> def;</div><div class="line">          &#125;</div><div class="line">      &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">          <span class="keyword">return</span> def;</div><div class="line">      &#125;</div><div class="line">      i += <span class="number">1</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> node;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// get a value by way of a per value (0-1), and a min and max value</span></div><div class="line">utils.valueByRange = <span class="function"><span class="keyword">function</span>(<span class="params">per, a, b</span>)</span>&#123;</div><div class="line">    per = per === <span class="literal">undefined</span> ? <span class="number">0</span> : per;</div><div class="line">    <span class="keyword">var</span> nMin, nMax;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> a === <span class="string">'object'</span>)&#123;</div><div class="line">        nMin = a[<span class="number">0</span>];</div><div class="line">        nMax = a[<span class="number">1</span>];</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        nMin = a === <span class="literal">undefined</span> ? <span class="number">0</span> : a;</div><div class="line">        nMax = b === <span class="literal">undefined</span> ? <span class="number">1</span> : b;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> nMin + <span class="built_in">Math</span>.round(per * (nMax - nMin));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// create a canvas element</span></div><div class="line">utils.createCanvas = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">    opt = opt || &#123;&#125;;</div><div class="line">    opt.container = opt.container || <span class="built_in">document</span>.getElementById(<span class="string">'canvas-app'</span>) || <span class="built_in">document</span>.body;</div><div class="line">    opt.canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</div><div class="line">    opt.ctx = opt.canvas.getContext(<span class="string">'2d'</span>);</div><div class="line">    <span class="comment">// assign the 'canvas_example' className</span></div><div class="line">    opt.canvas.className = <span class="string">'canvas_example'</span>;</div><div class="line">    <span class="comment">// set native width</span></div><div class="line">    opt.canvas.width = opt.width === <span class="literal">undefined</span> ? <span class="number">320</span> : opt.width;</div><div class="line">    opt.canvas.height = opt.height === <span class="literal">undefined</span> ? <span class="number">240</span> : opt.height;</div><div class="line">    <span class="comment">// translate by 0.5, 0.5</span></div><div class="line">    opt.ctx.translate(<span class="number">0.5</span>, <span class="number">0.5</span>);</div><div class="line">    <span class="comment">// disable default action for onselectstart</span></div><div class="line">    opt.canvas.onselectstart = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</div><div class="line">    <span class="comment">// append canvas to container</span></div><div class="line">    opt.container.appendChild(opt.canvas);</div><div class="line">    <span class="keyword">return</span> opt;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// mathematical modulo</span></div><div class="line">utils.mod = <span class="function"><span class="keyword">function</span>(<span class="params">x, m</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (x % m + m) % m;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// wrap a number</span></div><div class="line">utils.wrapNumber = <span class="function"><span class="keyword">function</span>(<span class="params">n, min, max</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> r = max - min;</div><div class="line">    <span class="keyword">return</span> (min + ((((n - min) % r) + r) % r));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// distance</span></div><div class="line">utils.distance = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, x2, y2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.pow(x1 - x2, <span class="number">2</span>) + <span class="built_in">Math</span>.pow(y1 - y2, <span class="number">2</span>));</div><div class="line">&#125;;</div><div class="line"><span class="comment">// bounding box</span></div><div class="line">utils.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">x1, y1, w1, h1, x2, y2, w2, h2</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !(</div><div class="line">        y1 + h1 &lt; y2 ||</div><div class="line">        y1 &gt; y2 + h2 ||</div><div class="line">        x1 + w1 &lt; x2 ||</div><div class="line">        x1 &gt; x2 + w2);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//******** **********</span></div><div class="line"><span class="comment">//  ANGLES</span></div><div class="line"><span class="comment">//******** **********</span></div><div class="line"><span class="comment">// PI * 2</span></div><div class="line">utils.PI2 = <span class="built_in">Math</span>.PI * <span class="number">2</span>;</div><div class="line"><span class="comment">// unit conversion</span></div><div class="line">utils.degToRad = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</div><div class="line">   <span class="keyword">return</span> utils.mod(n, <span class="number">360</span>) / <span class="number">360</span> * utils.PI2;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// normalize an angle by half</span></div><div class="line">utils.normalizeHalf = <span class="function"><span class="keyword">function</span> (<span class="params">n, scale</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> c = scale || utils.PI2,</div><div class="line">    h = c / <span class="number">2</span>;</div><div class="line">    <span class="keyword">return</span> utils.mod(n + h, c) - h;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="1-The-improved-object-pool-normalized-library"><a href="#1-The-improved-object-pool-normalized-library" class="headerlink" title="1 - The improved object pool normalized library"></a>1 - The improved object pool normalized library</h2><p>In revision 1 of this example I made an improved object pool library that I will likely use for future projects moving forward as a like it a lot more compared to the library that I based this off of. With my canvas example on object pools I started a library for this kind of thing that I kept copying over to other projects, each time I did so I might not change much of anything to it, other times I made improvements and added features. However with this object pool library I decided to give it a new name to help really set this one apart from the others by calling in pool normalized.</p>
<p>By normalized I mean thinking in terms of having a point in 2d space first and for most rather than a 2d box object with a width and height that is to be place somewhere relative to the upper left corner of the object, which was the nature of the older object pool library.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> poolMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Public API</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// get next inactive object in the given pool</span></div><div class="line">    <span class="keyword">var</span> getInactive = <span class="function"><span class="keyword">function</span> (<span class="params">pool</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">//******** **********</span></div><div class="line"><span class="comment">//  CREATE METHODS</span></div><div class="line"><span class="comment">//******** **********</span></div><div class="line">    <span class="comment">// create a single display object</span></div><div class="line">    <span class="keyword">var</span> createDisp = api.createDisp = <span class="function"><span class="keyword">function</span>(<span class="params">opt, i</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">active</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">pool</span>: opt.pool || <span class="literal">null</span>,</div><div class="line">            <span class="attr">i</span>: i === <span class="literal">undefined</span> ? <span class="number">-1</span> : i,</div><div class="line">            <span class="attr">x</span>: opt.x === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.x,</div><div class="line">            <span class="attr">y</span>: opt.y === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.y,</div><div class="line">            <span class="attr">w</span>: opt.w === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.w,</div><div class="line">            <span class="attr">h</span>: opt.h === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.h,</div><div class="line">            <span class="attr">heading</span>: opt.heading === <span class="literal">undefined</span> ? <span class="number">0</span> : opt.heading,</div><div class="line">            <span class="attr">pps</span>: opt.pps === <span class="literal">undefined</span> ? <span class="number">32</span> : opt.pps,</div><div class="line">            <span class="attr">lifespan</span>: opt.lifespan || <span class="number">3</span>,</div><div class="line">            <span class="attr">data</span>: &#123;&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// create a new pool</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.count = opt.count || <span class="number">10</span>;</div><div class="line">        <span class="comment">// the main pool object</span></div><div class="line">        <span class="keyword">var</span> pool = &#123;</div><div class="line">            <span class="attr">objects</span>: [],</div><div class="line">            <span class="attr">secsCap</span>: opt.secsCap === <span class="literal">undefined</span> ? <span class="literal">Infinity</span> : opt.secsCap,</div><div class="line">            <span class="attr">disableLifespan</span>: opt.disableLifespan || <span class="literal">false</span>,</div><div class="line">            <span class="attr">data</span>: opt.data || &#123;&#125;,</div><div class="line">            <span class="attr">game</span>: opt.game || &#123;&#125;,</div><div class="line">            <span class="attr">spawn</span>: opt.spawn || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, opt</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">purge</span>: opt.purge || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">update</span>: opt.update || <span class="function"><span class="keyword">function</span> (<span class="params">obj, pool, state, secs</span>) </span>&#123;&#125;,</div><div class="line">            <span class="attr">beforeUpdate</span>: opt.beforeUpdate || <span class="function"><span class="keyword">function</span>(<span class="params">pool, state, secs</span>)</span>&#123;&#125;,</div><div class="line">            <span class="attr">afterUpdate</span>: opt.afterUpdate || <span class="function"><span class="keyword">function</span>(<span class="params">pool, state, secs</span>)</span>&#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// populate the pools objects array</span></div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>, dispOpt;</div><div class="line">        <span class="keyword">while</span> (i &lt; opt.count) &#123;</div><div class="line">            <span class="keyword">var</span> dispOpt = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;<span class="attr">pool</span>: pool&#125;, opt)</div><div class="line">            pool.objects.push( createDisp(dispOpt, i) );</div><div class="line">            i += <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// return the pool object</span></div><div class="line">        <span class="keyword">return</span> pool;</div><div class="line">    &#125;;</div><div class="line"><span class="comment">//******** **********</span></div><div class="line"><span class="comment">//  POOL METHODS</span></div><div class="line"><span class="comment">//******** **********</span></div><div class="line">    <span class="comment">// spawn the next inactive object in the given pool</span></div><div class="line">    api.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">pool, state, opt</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = getInactive(pool);</div><div class="line">        state = state || pool.game || &#123;&#125;;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">if</span> (obj) &#123;</div><div class="line">            <span class="keyword">if</span> (!obj.active) &#123;</div><div class="line">                obj.active = <span class="literal">true</span>;</div><div class="line">                pool.spawn.call(pool, obj, pool, state, opt);</div><div class="line">                <span class="keyword">return</span> obj;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a pool object by a secs value</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">pool, secs, state</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> i = pool.objects.length,</div><div class="line">        obj;</div><div class="line">        state = state || pool.game || &#123;&#125;; <span class="comment">// your projects state object</span></div><div class="line">        secs = secs &gt; pool.secsCap ? pool.secsCap : secs;</div><div class="line">        <span class="comment">// call beforeUpdate hook</span></div><div class="line">        pool.beforeUpdate.call(pool, pool, secs, state);</div><div class="line">        <span class="comment">// for each object</span></div><div class="line">        <span class="keyword">while</span> (i--) &#123;</div><div class="line">            obj = pool.objects[i];</div><div class="line">            <span class="keyword">if</span> (obj.active) &#123;</div><div class="line">                pool.update.call(pool, obj, pool, state, secs);</div><div class="line">                <span class="comment">// if disableLifespan featre</span></div><div class="line">                <span class="keyword">if</span>(pool.disableLifespan)&#123;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">// else use lifespan feature</span></div><div class="line">                    obj.lifespan -= secs;</div><div class="line">                    obj.lifespan = obj.lifespan &lt; <span class="number">0</span> ? <span class="number">0</span> : obj.lifespan;</div><div class="line">                    <span class="keyword">if</span> (obj.lifespan === <span class="number">0</span>) &#123;</div><div class="line">                        obj.active = <span class="literal">false</span>;</div><div class="line">                        <span class="comment">//pool.purge.call(pool, obj, pool, state);</span></div><div class="line">                        api.purge.call(pool, pool, obj, state);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// call afterUpdate hook</span></div><div class="line">        pool.afterUpdate.call(pool, pool, secs, state);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get active objects from a pool</span></div><div class="line">    api.getActiveObjects = <span class="function"><span class="keyword">function</span>(<span class="params">pool, bool</span>)</span>&#123;</div><div class="line">        bool = bool === <span class="literal">undefined</span> ? <span class="literal">true</span> : bool;</div><div class="line">        <span class="keyword">return</span> pool.objects.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, obj</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(obj.active === bool)&#123;</div><div class="line">                acc.push(obj);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> acc;</div><div class="line">        &#125;, []);</div><div class="line">    &#125;;</div><div class="line"><span class="comment">//******** **********</span></div><div class="line"><span class="comment">//  DISP OBJECT METHODS</span></div><div class="line"><span class="comment">//******** **********</span></div><div class="line">    <span class="comment">// move the given object by its current heading and pps</span></div><div class="line">    api.moveByPPS = <span class="function"><span class="keyword">function</span> (<span class="params">obj, secs</span>) </span>&#123;</div><div class="line">        obj.x += <span class="built_in">Math</span>.cos(obj.heading) * obj.pps * secs;</div><div class="line">        obj.y += <span class="built_in">Math</span>.sin(obj.heading) * obj.pps * secs;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// bounding box</span></div><div class="line">    api.boundingBox = <span class="function"><span class="keyword">function</span> (<span class="params">obj, obj2</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> x1 = obj.x - obj.w / <span class="number">2</span>,</div><div class="line">        y1 = obj.y - obj.h / <span class="number">2</span>,</div><div class="line">        x2 = obj2.x - obj2.w / <span class="number">2</span>,</div><div class="line">        y2 = obj2.y - obj2.h / <span class="number">2</span>;</div><div class="line">        <span class="keyword">return</span> utils.boundingBox(x1, y1, obj.w, obj.h, x2, y2, obj2.w, obj2.h);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// purge an object ( make it inactive and call the purge method for the pool )</span></div><div class="line">    api.purge = <span class="function"><span class="keyword">function</span>(<span class="params">obj, state</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> pool = obj.pool;</div><div class="line">        state = state || pool.game || &#123;&#125;;</div><div class="line">        obj.active = <span class="literal">false</span>;</div><div class="line">        pool.purge.call(pool, obj, pool, state);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a collection of overlaying active objects from a pool, that overlap with the given object</span></div><div class="line">    api.getOverlaping = <span class="function"><span class="keyword">function</span>(<span class="params">obj, pool</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">        obj2,</div><div class="line">        overlap = [];</div><div class="line">        len = pool.objects.length;</div><div class="line">        <span class="keyword">if</span>(obj.active)&#123;</div><div class="line">            <span class="keyword">while</span>(i &lt; len)&#123;</div><div class="line">                obj2 = pool.objects[i];</div><div class="line">                <span class="keyword">if</span>(obj != obj2 &amp;&amp; obj2.active)&#123;</div><div class="line">                    <span class="keyword">if</span>(api.boundingBox(obj, obj2))&#123;</div><div class="line">                         overlap.push(obj2);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                i += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> overlap;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get the distance between the two given disp objects</span></div><div class="line">    <span class="comment">// or a given position depending on the number of arguments given</span></div><div class="line">    api.distance = <span class="function"><span class="keyword">function</span>(<span class="params">disp, a, b</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> x2 = <span class="number">0</span>, y2 = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> a === <span class="string">'object'</span> &amp;&amp; a != <span class="literal">null</span>)&#123;</div><div class="line">            x2 = a.x;</div><div class="line">            y2 = a.y;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(b != <span class="literal">undefined</span>)&#123;</div><div class="line">            x2 = a;</div><div class="line">            y2 = b;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> utils.distance(disp.x, disp.y, x2, y2);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get the angle from the given disp, to the given other disp or position</span></div><div class="line">    api.getAngleTo = <span class="function"><span class="keyword">function</span>(<span class="params">disp, a, b</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> x2 = <span class="number">0</span>, y2 = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> a === <span class="string">'object'</span> &amp;&amp; a != <span class="literal">null</span>)&#123;</div><div class="line">            x2 = a.x;</div><div class="line">            y2 = a.y;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(b != <span class="literal">undefined</span>)&#123;</div><div class="line">            x2 = a;</div><div class="line">            y2 = b;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.atan2(y2 - disp.y, x2 - disp.x);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return public method</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="2-The-units-module-and-plug-ins"><a href="#2-The-units-module-and-plug-ins" class="headerlink" title="2 - The units module and plug ins"></a>2 - The units module and plug ins</h2><p>Yet another major component that I have started with this example and will likely take with me to additional projects is the unit module that I started in this example. I have made a few modules such as this in past projects, but often then end up being coded together with the game module of a project, as such it is something that I found myself writing over and over again with each project. To help put an end to this I made a stand alone units module, complete with a plug in system that will allow for me to septate logic that has to do with specific kinds of units such as units that move, units that just stay in a fixed location, and various other kinds of units such as shots.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> unitsMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"><span class="comment">//  HARD SETTINGS VALUES</span></div><div class="line">    <span class="keyword">var</span> SECS_CAP = <span class="number">1</span>,</div><div class="line">    UNIT_STATS_DEFAULTS = &#123;</div><div class="line">        <span class="attr">range</span>: <span class="number">100</span>,</div><div class="line">        <span class="attr">attack</span>: <span class="number">1</span>,</div><div class="line">        <span class="attr">subType</span>: <span class="string">'none'</span></div><div class="line">    &#125;,</div><div class="line">    UNIT_PPS_MIN = <span class="number">32</span>,</div><div class="line">    UNIT_PPS_MAX = <span class="number">64</span>;</div><div class="line">    <span class="comment">// the unit types object that is to be extended</span></div><div class="line">    <span class="comment">// by calling unitsMod.load</span></div><div class="line">    <span class="keyword">var</span> UNIT_TYPES = &#123;&#125;;</div><div class="line"><span class="comment">//  PUBLIC API</span></div><div class="line">    <span class="comment">// the public api</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// parse core stats for a unit</span></div><div class="line">    api.coreStats = <span class="function"><span class="keyword">function</span>(<span class="params">unit, spawnOpt, defaults</span>)</span>&#123;</div><div class="line">        defaults = defaults || UNIT_STATS_DEFAULTS;</div><div class="line">        <span class="keyword">var</span> uDat = unit.data;</div><div class="line">        <span class="comment">// parse core stats</span></div><div class="line">        [<span class="string">'attack'</span>, <span class="string">'range'</span>, <span class="string">'subType'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">statKey</span>)</span>&#123;</div><div class="line">            uDat[statKey] = spawnOpt[statKey] === <span class="literal">undefined</span> ? defaults[statKey] : spawnOpt[statKey];</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// totalPower of a pool</span></div><div class="line">    api.totalPower = <span class="function"><span class="keyword">function</span>(<span class="params">pool</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> power = <span class="number">0</span>;</div><div class="line">        <span class="comment">// for each active object</span></div><div class="line">        poolMod.getActiveObjects(pool, <span class="literal">true</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">unit</span>)</span>&#123;</div><div class="line">           <span class="keyword">var</span> uDat = unit.data;</div><div class="line">           <span class="comment">// dps</span></div><div class="line">           power += uDat.attack / uDat.fireRate;</div><div class="line">           <span class="comment">// </span></div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.round(power);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// get a target or set current to default null value</span></div><div class="line">    api.getTarget = <span class="function"><span class="keyword">function</span>(<span class="params">unit, targetPool, game</span>)</span>&#123;</div><div class="line">        <span class="comment">// defualt to no target</span></div><div class="line">        unit.data.target = <span class="literal">null</span>;</div><div class="line">        <span class="comment">// get current active buildings and sort by distance</span></div><div class="line">        <span class="keyword">var</span> targets = poolMod.getActiveObjects(targetPool).sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> d1 = poolMod.distance(unit, a),</div><div class="line">            d2 = poolMod.distance(unit, b);</div><div class="line">            <span class="keyword">if</span>(d1 &lt; d2)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(d1 &gt; d2)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// if we have one or more targets set a target</span></div><div class="line">        <span class="keyword">if</span>(targets.length &gt;= <span class="number">1</span>)&#123;</div><div class="line">            unit.data.target = targets[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// fire at target method</span></div><div class="line">    api.fireAtTarget = <span class="function"><span class="keyword">function</span>(<span class="params">unit, opt</span>)</span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.onNoTarget = opt.onNoTarget || <span class="function"><span class="keyword">function</span>(<span class="params">unit, game</span>)</span>&#123;&#125;;</div><div class="line">        opt.secs = opt.secs || <span class="number">0</span>;</div><div class="line">        opt.game = opt.game || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> uDat = unit.data;</div><div class="line">        <span class="keyword">var</span> target = uDat.target;</div><div class="line">        <span class="comment">// if target is null call onNoTarget</span></div><div class="line">        <span class="keyword">if</span>(target === <span class="literal">null</span>)&#123;</div><div class="line">            opt.onNoTarget(unit, opt.game);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">// if target is longer active, set target back to null, and call onNoTarget</span></div><div class="line">            <span class="keyword">if</span>(!target.active)&#123;</div><div class="line">                uDat.target = <span class="literal">null</span>;</div><div class="line">                opt.onNoTarget(unit, opt.game);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">// attack target!</span></div><div class="line">                uDat.fireSecs += opt.secs;</div><div class="line">                <span class="keyword">if</span>(uDat.fireSecs &gt;= uDat.fireRate)&#123;</div><div class="line">                    uDat.fireSecs = utils.mod(uDat.fireSecs, uDat.fireRate);</div><div class="line">                    <span class="comment">// spawn a shot</span></div><div class="line">                    poolMod.spawn(opt.game.shots, opt.game, &#123;</div><div class="line">                        <span class="attr">subType</span>: uDat.shotSubType,</div><div class="line">                        <span class="attr">strokeStyle</span>: opt.strokeStyle || <span class="string">'yellow'</span>,</div><div class="line">                        <span class="attr">fillStyle</span>: opt.fillStyle || <span class="string">'yellow'</span>,</div><div class="line">                        <span class="attr">attack</span>: uDat.attack,</div><div class="line">                        <span class="attr">sx</span>: unit.x, <span class="attr">sy</span>: unit.y,</div><div class="line">                        <span class="attr">ex</span>: target.x, <span class="attr">ey</span>: target.y,</div><div class="line">                        <span class="attr">heading</span>: poolMod.getAngleTo(unit, target),</div><div class="line">                        <span class="attr">accuracy</span>: uDat.accuracy,</div><div class="line">                        <span class="attr">range</span>: uDat.range,</div><div class="line">                        <span class="attr">hitPool</span>: opt.hitPool</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// load a unit type </span></div><div class="line">    api.load = <span class="function"><span class="keyword">function</span>(<span class="params">typeOptions</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> typeKey = typeOptions.typeKey || <span class="built_in">Object</span>.keys(UNIT_TYPES).length; </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'setting the given typeOptions object at key: '</span> + typeKey);</div><div class="line">        <span class="comment">// just ref the object for now if that works okay</span></div><div class="line">        UNIT_TYPES[typeKey] = typeOptions;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// change the mode of a given unit</span></div><div class="line">    api.changeMode = <span class="function"><span class="keyword">function</span>(<span class="params">unit, modeKey, pool, game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> uDat = unit.data;</div><div class="line">        uDat.mode = modeKey;</div><div class="line">        <span class="keyword">var</span> modeObj = pool.data.modes[uDat.mode]; <span class="comment">//UNIT_MODES[uDat.mode];</span></div><div class="line">        uDat.modeTime = <span class="number">0</span>;</div><div class="line">        uDat.lastRoll = <span class="number">0</span>;</div><div class="line">        <span class="comment">// call init hook of new mode obj</span></div><div class="line">        modeObj.init.call(unit, unit, pool, game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// random heading helper</span></div><div class="line">    api.randomHeading = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> utils.PI2 * <span class="built_in">Math</span>.random();</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// random ppx helper</span></div><div class="line">    api.randomPPS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">return</span> UNIT_PPS_MIN + <span class="built_in">Math</span>.round((UNIT_PPS_MAX - UNIT_PPS_MIN) * <span class="built_in">Math</span>.random());</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public create method</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> typeOptions = UNIT_TYPES[opt.type];</div><div class="line">        <span class="keyword">var</span> unitOpt = typeOptions ? typeOptions : UNIT_OPTIONS;</div><div class="line">        <span class="keyword">var</span> options = <span class="built_in">Object</span>.assign(&#123;&#125;, unitOpt, opt);</div><div class="line">        <span class="comment">// data object should have the modes</span></div><div class="line">        options.data = &#123;</div><div class="line">            <span class="attr">modes</span>: options.modes</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> poolMod.create(options);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public update method</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">units, secs, state</span>) </span>&#123;</div><div class="line">        secs = secs &gt; SECS_CAP ? SECS_CAP : secs;</div><div class="line">        <span class="comment">// update units</span></div><div class="line">        poolMod.update(units, secs, state);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h3 id="2-1-The-attackers-plug-in"><a href="#2-1-The-attackers-plug-in" class="headerlink" title="2.1 - The attackers plug in"></a>2.1 - The attackers plug in</h3><p>The attackers plug in for my units module contains the logic for the units that will spawn from the outside of the canvas and then select a target that is one of the buildings and move it to attack.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line">unitsMod.load( (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    ATTACKER_SPAWN_RADIUS = [<span class="number">450</span>, <span class="number">600</span>];</div><div class="line"> </div><div class="line"><span class="comment">// HELPERS</span></div><div class="line">    <span class="keyword">var</span> getAttackerStartPos = <span class="function"><span class="keyword">function</span>(<span class="params">game</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> canvas = game.sm.canvas,</div><div class="line">        cx = canvas.width / <span class="number">2</span>,</div><div class="line">        cy = canvas.height / <span class="number">2</span>,</div><div class="line">        pos = &#123;&#125;,</div><div class="line">        radian = unitsMod.randomHeading(),</div><div class="line">        radius = utils.valueByRange(<span class="built_in">Math</span>.random(), ATTACKER_SPAWN_RADIUS)</div><div class="line">        pos.x = cx + <span class="built_in">Math</span>.cos(radian) * radius;</div><div class="line">        pos.y = cy + <span class="built_in">Math</span>.sin(radian) * radius;</div><div class="line">        <span class="keyword">return</span> pos;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> setOverlapColor = <span class="function"><span class="keyword">function</span>(<span class="params">unit</span>)</span>&#123;</div><div class="line">        unit.data.fillStyle = <span class="string">'blue'</span>;</div><div class="line">        <span class="keyword">var</span> overlap = poolMod.getOverlaping(unit, unit.pool).length;</div><div class="line">        <span class="keyword">if</span>(overlap &gt; <span class="number">0</span>)&#123;</div><div class="line">            unit.data.fillStyle = <span class="string">'red'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">// THE OPTIONS OBJECT </span></div><div class="line">    <span class="keyword">var</span> UNIT_OPTIONS = &#123;</div><div class="line">        <span class="attr">typeKey</span>: <span class="string">'attackers'</span>,</div><div class="line">        <span class="attr">count</span>: <span class="number">6</span>,</div><div class="line">        <span class="attr">disableLifespan</span>: <span class="literal">true</span></div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// unit modes</span></div><div class="line">    <span class="keyword">var</span> UNIT_MODES = &#123;&#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// attack the current target switching back to idle if the target is null of not active</span></div><div class="line">    UNIT_MODES.attackTarget = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;&#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> uDat = unit.data;</div><div class="line">            <span class="comment">// set overlap color in move mode also for now</span></div><div class="line">            setOverlapColor(unit);</div><div class="line">            <span class="comment">// fire at target</span></div><div class="line">            unitsMod.fireAtTarget(unit, &#123;</div><div class="line">                <span class="attr">game</span>: game,</div><div class="line">                <span class="attr">secs</span>: secs,</div><div class="line">                <span class="attr">hitPool</span>: game.buildings,</div><div class="line">                <span class="attr">onNoTarget</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, game</span>)</span>&#123;</div><div class="line">                    unitsMod.changeMode(unit, <span class="string">'idle'</span>, pool, game);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// move to the current target, and switch to attackTarget mode when it range. For othe cases switch back to idle</span></div><div class="line">    UNIT_MODES.moveToTarget = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;</div><div class="line"> </div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="comment">// set overlap color in move mode also for now</span></div><div class="line">            setOverlapColor(unit);</div><div class="line">            <span class="comment">// update target?</span></div><div class="line">            unitsMod.getTarget(unit, game.buildings, game);</div><div class="line">            <span class="comment">// ref to target</span></div><div class="line">            <span class="keyword">var</span> target = unit.data.target;</div><div class="line">            <span class="comment">// if target is null return to idle mode</span></div><div class="line">            <span class="keyword">if</span>(target === <span class="literal">null</span>)&#123;</div><div class="line">                unitsMod.changeMode(unit, <span class="string">'idle'</span>, pool, game);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">// if target is no longer active, set target back to null, and go back to idle mode</span></div><div class="line">                <span class="keyword">if</span>(!target.active)&#123;</div><div class="line">                    unit.data.target = <span class="literal">null</span>;</div><div class="line">                    unitsMod.changeMode(unit, <span class="string">'idle'</span>, pool, game);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">// distance and abgle</span></div><div class="line">                    <span class="keyword">var</span> d = poolMod.distance(unit, unit.data.target),</div><div class="line">                    a = poolMod.getAngleTo(unit, unit.data.target);</div><div class="line">                    <span class="comment">// set heading of unit to move to target</span></div><div class="line">                    unit.heading = a;</div><div class="line">                    <span class="comment">// if distance to building is greater that range move</span></div><div class="line">                    <span class="keyword">if</span>(d &gt; <span class="number">120</span>)&#123;</div><div class="line">                        poolMod.moveByPPS(unit, secs);</div><div class="line">                    &#125;<span class="keyword">else</span>&#123;</div><div class="line">                       <span class="comment">// else the unit is in range, and thus can attack</span></div><div class="line">                       unitsMod.changeMode(unit, <span class="string">'attackTarget'</span>, pool, game);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// get a target and switch to move to target, or back to idle</span></div><div class="line">    UNIT_MODES.getTarget = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;</div><div class="line">            unit.data.target = <span class="literal">null</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="comment">// try to get a target</span></div><div class="line">            unitsMod.getTarget(unit, game.buildings, game);</div><div class="line">            <span class="comment">// if we have a target move to it</span></div><div class="line">            <span class="keyword">if</span>(unit.data.target)&#123;</div><div class="line">                unitsMod.changeMode(unit, <span class="string">'moveToTarget'</span>, pool, game);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">// no active targets? return to idle</span></div><div class="line">                unitsMod.changeMode(unit, <span class="string">'idle'</span>, pool, game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_MODES.moveOut = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;</div><div class="line">            unit.heading += <span class="built_in">Math</span>.PI;</div><div class="line">            unit.heading = utils.mod(unit.heading, utils.PI2);</div><div class="line"> </div><div class="line">            unit.data.yaw = <span class="built_in">Math</span>.PI / <span class="number">180</span> * (<span class="number">-10</span> + <span class="number">20</span> * <span class="built_in">Math</span>.random())</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> canvas = game.sm.canvas;</div><div class="line">            <span class="comment">// set overlap color in move mode also for now</span></div><div class="line">            setOverlapColor(unit);</div><div class="line">            <span class="keyword">var</span> targets = poolMod.getActiveObjects(game.buildings),</div><div class="line">            targetCount = targets.length;</div><div class="line">            <span class="keyword">if</span>(targetCount &gt; <span class="number">5</span>)&#123;</div><div class="line">                unitsMod.changeMode(unit, <span class="string">'idle'</span>, pool, game);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// distance from center</span></div><div class="line">            <span class="keyword">var</span> dc = poolMod.distance(unit, canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>);</div><div class="line">            <span class="keyword">if</span>(dc &lt; ATTACKER_SPAWN_RADIUS[<span class="number">0</span>])&#123;</div><div class="line">                unit.heading += unit.data.yaw * secs;</div><div class="line">                unit.heading = utils.mod(unit.heading, utils.PI2);</div><div class="line">                poolMod.moveByPPS(unit, secs);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// idle mode - what an attacker should do while it is active, but does not have any kind</span></div><div class="line">    <span class="comment">// of task such as seeking a target, moving to a new location ect, attacking a building ect.</span></div><div class="line">    UNIT_MODES.idle = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;</div><div class="line">            unit.data.target = <span class="literal">null</span>;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="comment">// set overlap color for now in this mode</span></div><div class="line">            setOverlapColor(unit);</div><div class="line">            <span class="comment">// if there are targets switch to getTarget mode</span></div><div class="line">            <span class="keyword">var</span> targets = poolMod.getActiveObjects(game.buildings),</div><div class="line">            targetCount = targets.length;</div><div class="line">            <span class="keyword">if</span>(targetCount &gt; <span class="number">0</span>)&#123;</div><div class="line">                unitsMod.changeMode(unit, <span class="string">'getTarget'</span>, pool, game);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">// if no targets</span></div><div class="line">                unitsMod.changeMode(unit, <span class="string">'moveOut'</span>, pool, game);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_OPTIONS.modes = UNIT_MODES;</div><div class="line"> </div><div class="line">    <span class="comment">// spawn a unit</span></div><div class="line">    UNIT_OPTIONS.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, spawnOpt</span>) </span>&#123;</div><div class="line">        spawnOpt = spawnOpt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> canvas = game.sm.canvas,</div><div class="line">        uDat = unit.data;</div><div class="line">        <span class="comment">// STATS</span></div><div class="line">        <span class="comment">//uDat.attack = 1;</span></div><div class="line">        <span class="comment">//uDat.range = 150;</span></div><div class="line">        unitsMod.coreStats(unit, spawnOpt, &#123;<span class="attr">attack</span>: <span class="number">1</span>, <span class="attr">range</span>: <span class="number">150</span>&#125;);</div><div class="line"> </div><div class="line">        uDat.shotSubType = <span class="string">'shot.shell'</span>;</div><div class="line">        uDat.fireRate = <span class="number">0.25</span>;</div><div class="line">        uDat.fireSecs = <span class="number">0</span>;</div><div class="line">        uDat.accuracy = <span class="number">0.25</span>;</div><div class="line">        uDat.hpMax = <span class="number">10</span>;</div><div class="line">        uDat.hp = unit.data.hpMax;</div><div class="line"> </div><div class="line">        <span class="comment">// the current target to attack</span></div><div class="line">        uDat.target = <span class="literal">null</span>;</div><div class="line">        <span class="comment">// mode of the unit</span></div><div class="line">        uDat.mode = spawnOpt.mode || <span class="string">'idle'</span>;</div><div class="line">        <span class="comment">// colors</span></div><div class="line">        uDat.fillStyle = <span class="string">'#aa0000'</span>;</div><div class="line">        <span class="comment">// alpha</span></div><div class="line">        uDat.alpha = <span class="number">1</span>;</div><div class="line">        <span class="comment">// size</span></div><div class="line">        unit.w = <span class="number">32</span>;</div><div class="line">        unit.h = <span class="number">32</span>;</div><div class="line">        <span class="comment">// start position</span></div><div class="line">        <span class="built_in">Object</span>.assign(unit, getAttackerStartPos(game));</div><div class="line">        <span class="comment">// heading</span></div><div class="line">        unit.heading = unitsMod.randomHeading();</div><div class="line">        <span class="comment">// speed</span></div><div class="line">        unit.pps = <span class="number">64</span>; <span class="comment">//32; //unitsMod.randomPPS();</span></div><div class="line">        <span class="comment">// chance mode</span></div><div class="line">        unitsMod.changeMode(unit, uDat.mode, pool, game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a unit</span></div><div class="line">    UNIT_OPTIONS.update = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, secs</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> modeObj = pool.data.modes[unit.data.mode];</div><div class="line">        <span class="comment">// call the current mode update method</span></div><div class="line">        modeObj.update(unit, pool, game, secs);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_OPTIONS.beforeUpdate = <span class="function"><span class="keyword">function</span>(<span class="params">pool, secs, game</span>)</span>&#123;</div><div class="line">        poolMod.spawn(pool, game, &#123;&#125;);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">// return the OPTIONS object to use to create</span></div><div class="line">    <span class="comment">// this type of unit</span></div><div class="line">    <span class="keyword">return</span> UNIT_OPTIONS;</div><div class="line">&#125;</div><div class="line">    ()) );</div></pre></td></tr></table></figure>
<h3 id="2-2-The-Buildings-plug-in"><a href="#2-2-The-Buildings-plug-in" class="headerlink" title="2.2 - The Buildings plug in"></a>2.2 - The Buildings plug in</h3><p>I then have the fixed buildings in the center of the canvas so of course I am going to want a units plug in for that as well.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line">unitsMod.load( (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line"><span class="comment">// HELPERS</span></div><div class="line"> </div><div class="line">    <span class="comment">// spawn building helper</span></div><div class="line">    <span class="keyword">var</span> spawnBuilding = <span class="function"><span class="keyword">function</span>(<span class="params">game, pool</span>)</span>&#123;</div><div class="line">        <span class="comment">// spawn buidling</span></div><div class="line">        <span class="keyword">var</span> canvas = game.sm.canvas,</div><div class="line">        space = <span class="number">5</span>,</div><div class="line">        unitsPerAxis = <span class="number">5</span>,</div><div class="line">        sx = canvas.width / <span class="number">2</span> - ((<span class="number">32</span> + space) * (unitsPerAxis - <span class="number">1</span> ) / <span class="number">2</span>),</div><div class="line">        sy = canvas.height / <span class="number">2</span> - ((<span class="number">32</span> + space) * ( unitsPerAxis - <span class="number">1</span>) / <span class="number">2</span>);</div><div class="line">        <span class="comment">// get a random area</span></div><div class="line">        <span class="keyword">var</span> areaDisp = poolMod.createDisp(&#123;</div><div class="line">            <span class="attr">x</span>: sx + (<span class="number">32</span> + space) * <span class="built_in">Math</span>.floor( unitsPerAxis * <span class="built_in">Math</span>.random()) ,</div><div class="line">            <span class="attr">y</span>: sy + (<span class="number">32</span> + space) * <span class="built_in">Math</span>.floor( unitsPerAxis * <span class="built_in">Math</span>.random())</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// check to see of area if not taken</span></div><div class="line">        <span class="keyword">var</span> active = poolMod.getActiveObjects(pool),</div><div class="line">        ai = active.length,</div><div class="line">        good = <span class="literal">true</span>;</div><div class="line">        <span class="keyword">while</span>(ai--)&#123;</div><div class="line">            <span class="keyword">var</span> disp = active[ai];</div><div class="line">            <span class="keyword">if</span>(poolMod.boundingBox(areaDisp, disp))&#123;</div><div class="line">                good = <span class="literal">false</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// if we have a good location spawn</span></div><div class="line">        <span class="keyword">if</span>(good)&#123;</div><div class="line">            poolMod.spawn(pool, game, &#123;<span class="attr">x</span>: areaDisp.x, <span class="attr">y</span>: areaDisp.y&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> attackUpdate = <span class="function"><span class="keyword">function</span>(<span class="params">unit, game, secs</span>)</span>&#123;</div><div class="line">        <span class="comment">// set or update target</span></div><div class="line">        unitsMod.getTarget(unit, game.attackers, game);</div><div class="line">        <span class="comment">// if we have a target</span></div><div class="line">        <span class="keyword">if</span>(unit.data.target)&#123;</div><div class="line">            <span class="comment">// check if the target is in range, if so fire</span></div><div class="line">            <span class="keyword">var</span> d = poolMod.distance(unit, unit.data.target);</div><div class="line">            <span class="keyword">if</span>(d &lt;= unit.data.range)&#123;</div><div class="line">                <span class="comment">// fire at target</span></div><div class="line">                unitsMod.fireAtTarget(unit, &#123;</div><div class="line">                    <span class="attr">strokeStyle</span>: <span class="string">'blue'</span>,</div><div class="line">                    <span class="attr">fillStyle</span>: <span class="string">'cyan'</span>,</div><div class="line">                    <span class="attr">game</span>: game,</div><div class="line">                    <span class="attr">secs</span>: secs,</div><div class="line">                    <span class="attr">hitPool</span>: game.attackers,</div><div class="line">                    <span class="attr">onNoTarget</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, game</span>)</span>&#123;</div><div class="line">                  </div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line"><span class="comment">// THE OPTIONS OBJECT </span></div><div class="line">    <span class="keyword">var</span> UNIT_OPTIONS = &#123;</div><div class="line">        <span class="attr">typeKey</span>: <span class="string">'buildings'</span>,</div><div class="line">        <span class="attr">count</span>: <span class="number">10</span>,</div><div class="line">        <span class="attr">disableLifespan</span>: <span class="literal">true</span></div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// unit modes</span></div><div class="line">    <span class="keyword">var</span> UNIT_MODES = &#123;&#125;;</div><div class="line">    </div><div class="line">    <span class="comment">// idle</span></div><div class="line">    UNIT_MODES.idle = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;&#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">           </div><div class="line"> </div><div class="line">            attackUpdate(unit, game, secs);</div><div class="line"> </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_OPTIONS.modes = UNIT_MODES;</div><div class="line"> </div><div class="line">    <span class="comment">// spawn a unit</span></div><div class="line">    UNIT_OPTIONS.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, spawnOpt</span>) </span>&#123;</div><div class="line">        spawnOpt = spawnOpt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> canvas = game.sm.canvas,</div><div class="line">        uDat = unit.data;</div><div class="line">        <span class="comment">// mode of the unit</span></div><div class="line">        uDat.mode = spawnOpt.mode || <span class="string">'idle'</span>;</div><div class="line">        <span class="comment">// STATS</span></div><div class="line">        unitsMod.coreStats(unit, spawnOpt, &#123;<span class="attr">attack</span>: <span class="number">3</span>, <span class="attr">range</span>: <span class="number">150</span>&#125;);</div><div class="line">        uDat.shotSubType = <span class="string">'shot.bullet'</span>;</div><div class="line">        uDat.fireRate = <span class="number">0.5</span>;</div><div class="line">        uDat.fireSecs = <span class="number">0</span>;</div><div class="line">        uDat.accuracy = <span class="number">0.25</span>;</div><div class="line">        uDat.hpMax = <span class="number">10</span>;</div><div class="line">        uDat.hp = unit.data.hpMax;</div><div class="line">        <span class="comment">// colors</span></div><div class="line">        uDat.fillStyle = <span class="string">'white'</span></div><div class="line">        <span class="comment">// alpha</span></div><div class="line">        uDat.alpha = <span class="number">1</span>;</div><div class="line">        <span class="comment">// size</span></div><div class="line">        unit.w = <span class="number">32</span>;</div><div class="line">        unit.h = <span class="number">32</span>;</div><div class="line">        <span class="comment">// start position</span></div><div class="line">        unit.x = spawnOpt.x;</div><div class="line">        unit.y = spawnOpt.y;</div><div class="line">        <span class="comment">// heading and speed not used</span></div><div class="line">        unit.heading = <span class="number">0</span>;</div><div class="line">        unit.pps = <span class="number">0</span>;</div><div class="line">        <span class="comment">// chance mode</span></div><div class="line">        unitsMod.changeMode(unit, uDat.mode, pool, game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a unit</span></div><div class="line">    UNIT_OPTIONS.update = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, secs</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> modeObj = pool.data.modes[unit.data.mode];</div><div class="line">        <span class="comment">// call the current mode update method</span></div><div class="line">        modeObj.update(unit, pool, game, secs);</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_OPTIONS.beforeUpdate = <span class="function"><span class="keyword">function</span>(<span class="params">pool, secs, game</span>)</span>&#123;</div><div class="line">        <span class="comment">// set spawn secs of not there</span></div><div class="line">        pool.data.spawnSecs = pool.data.spawnSecs === <span class="literal">undefined</span> ? <span class="number">0</span> : pool.data.spawnSecs; </div><div class="line">        pool.data.spawnSecs += secs;</div><div class="line">        <span class="keyword">if</span>(pool.data.spawnSecs &gt; <span class="number">1</span>)&#123;</div><div class="line">            spawnBuilding(game, pool);</div><div class="line">            pool.data.spawnSecs = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// return the OPTIONS object to use to create</span></div><div class="line">    <span class="comment">// this type of unit</span></div><div class="line">    <span class="keyword">return</span> UNIT_OPTIONS;</div><div class="line">&#125;</div><div class="line">    ()) );</div></pre></td></tr></table></figure>
<h3 id="2-3-The-shots-plug-in"><a href="#2-3-The-shots-plug-in" class="headerlink" title="2.3 - The shots plug in"></a>2.3 - The shots plug in</h3><p>Both the attacker units and the building units will fire shots at each other, so then there will need to be another plug in for the units module that will contain the logic used for a shared object pool of shots.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div></pre></td><td class="code"><pre><div class="line">unitsMod.load( (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">var</span> SHOT_MAX_ACCURACY_HEADING_DELTA = utils.degToRad(<span class="number">20</span>),</div><div class="line">    SHOT_DEFAULTS = &#123;</div><div class="line">        <span class="attr">range</span>: <span class="number">100</span>,</div><div class="line">        <span class="attr">attack</span>: <span class="number">1</span>,</div><div class="line">        <span class="attr">subType</span>: <span class="string">'shot.bullet'</span></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">   <span class="keyword">var</span> subTypes = &#123;&#125;;</div><div class="line">   </div><div class="line">   subTypes.shot = &#123;&#125;;</div><div class="line">   </div><div class="line">   subTypes.shot.bullet = &#123;</div><div class="line">       <span class="comment">// check for one or more hits of any target in hitPool when moving and do not</span></div><div class="line">       <span class="comment">// care about any end point position</span></div><div class="line">       hitCheck: <span class="literal">true</span>,</div><div class="line">       <span class="attr">endPointCheck</span>: <span class="literal">false</span>,</div><div class="line">       <span class="comment">// a bullet will purge if at range</span></div><div class="line">       atRange : <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            poolMod.purge(unit, game);</div><div class="line">       &#125;,</div><div class="line">       <span class="comment">// when one or more objects are hit</span></div><div class="line">       onHit : <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs, hitObjects</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> uDat = unit.data;</div><div class="line">            <span class="keyword">if</span>(hitObjects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">                <span class="comment">// bullets are single hit</span></div><div class="line">                <span class="keyword">var</span> target = hitObjects[hitObjects.length - <span class="number">1</span>];</div><div class="line">                <span class="comment">//hitObjects.forEach(function(target)&#123;</span></div><div class="line">                    target.data.hp -= uDat.attack;</div><div class="line">                    target.data.hp = target.data.hp &lt; <span class="number">0</span> ? <span class="number">0</span> : target.data.hp;</div><div class="line">                    <span class="keyword">if</span>(target.data.hp === <span class="number">0</span>)&#123;</div><div class="line">                        poolMod.purge(target, game);</div><div class="line">                    &#125;</div><div class="line">                <span class="comment">//&#125;);</span></div><div class="line">            &#125;</div><div class="line">            <span class="comment">// purge shot</span></div><div class="line">            poolMod.purge(unit, game);</div><div class="line">       &#125;,</div><div class="line">       <span class="attr">onEndPoint</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line"> </div><div class="line">       &#125;</div><div class="line">   &#125;;</div><div class="line">   </div><div class="line">   subTypes.shot.shell = &#123;</div><div class="line">       <span class="comment">// no hit detection while moving, but check endPoint</span></div><div class="line">       hitCheck: <span class="literal">false</span>,</div><div class="line">       <span class="attr">endPointCheck</span>: <span class="literal">true</span>,</div><div class="line">       <span class="attr">atRange</span> : <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">           <span class="comment">// purging for now, but the shot should switch to blast mode</span></div><div class="line">           <span class="comment">// also it should not even get to this point</span></div><div class="line">           poolMod.purge(unit, game);</div><div class="line">       &#125;,</div><div class="line">       <span class="attr">onHit</span> : <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs, hitObjects</span>)</span>&#123;&#125;,</div><div class="line">       <span class="attr">onEndPoint</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> uDat = unit.data;</div><div class="line">            <span class="comment">// blast!</span></div><div class="line">            <span class="keyword">var</span> blastRadius = <span class="number">32</span>;</div><div class="line">            unit.w = blastRadius * <span class="number">2</span>;</div><div class="line">            unit.h = blastRadius * <span class="number">2</span>;</div><div class="line">            <span class="keyword">var</span> hitObjects = poolMod.getOverlaping(unit, uDat.hitPool);</div><div class="line">            hitObjects.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> d = poolMod.distance(unit, target);</div><div class="line">                d = d &gt; blastRadius ? blastRadius: d;</div><div class="line">                <span class="keyword">var</span> damagePer = <span class="number">1</span> - (d / blastRadius);</div><div class="line">                target.data.hp -= uDat.attack * damagePer;</div><div class="line">                target.data.hp = target.data.hp &lt; <span class="number">0</span> ? <span class="number">0</span> : target.data.hp;</div><div class="line">                <span class="keyword">if</span>(target.data.hp === <span class="number">0</span>)&#123;</div><div class="line">                    poolMod.purge(target, game);</div><div class="line">                &#125;</div><div class="line">           &#125;);</div><div class="line">           poolMod.purge(unit, game);</div><div class="line">       &#125;</div><div class="line">   &#125;;</div><div class="line"> </div><div class="line"><span class="comment">// THE OPTIONS OBJECT </span></div><div class="line">    <span class="keyword">var</span> UNIT_OPTIONS = &#123;</div><div class="line">        <span class="attr">typeKey</span>: <span class="string">'shots'</span>,</div><div class="line">        <span class="attr">count</span>: <span class="number">10</span>,</div><div class="line">        <span class="attr">disableLifespan</span>: <span class="literal">true</span></div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// unit modes</span></div><div class="line">    <span class="keyword">var</span> UNIT_MODES = &#123;&#125;;</div><div class="line">   </div><div class="line">    <span class="comment">// The atRange mode is what needs to happen when a shot is at or beyond the max range of the shot</span></div><div class="line">    UNIT_MODES.atRange = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;&#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="comment">// call at range method for the current subType</span></div><div class="line">            unit.data.subTypeObj.atRange(unit, pool, game, secs);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// a shot enters hit mode when a shot hits one ore more units in the hitPool of the shot</span></div><div class="line">    UNIT_MODES.hit = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;&#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> uDat = unit.data;</div><div class="line">            <span class="keyword">var</span> hitObjects = poolMod.getOverlaping(unit, uDat.hitPool);</div><div class="line">            unit.data.subTypeObj.onHit(unit, pool, game, secs, hitObjects);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="comment">// The general move mode of a shot</span></div><div class="line">    UNIT_MODES.move = &#123;</div><div class="line">        <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game</span>)</span>&#123;&#125;,</div><div class="line">        <span class="attr">update</span>: <span class="function"><span class="keyword">function</span>(<span class="params">unit, pool, game, secs</span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> uDat = unit.data;</div><div class="line">            <span class="comment">// distance from start position</span></div><div class="line">            <span class="keyword">var</span> ds = poolMod.distance(unit, uDat.sx, uDat.sy);</div><div class="line">            <span class="comment">// move and switch to at rangMode if set range is reached</span></div><div class="line">            poolMod.moveByPPS(unit, secs);</div><div class="line">            <span class="comment">// if distance from start point is at or over range</span></div><div class="line">            <span class="keyword">if</span>(ds &gt;= uDat.range)&#123;</div><div class="line">                <span class="comment">// make sure shot is at range, not beyond</span></div><div class="line">                unit.x = uDat.sx + <span class="built_in">Math</span>.cos(unit.heading) * uDat.range;</div><div class="line">                unit.y = uDat.sy + <span class="built_in">Math</span>.sin(unit.heading) * uDat.range;</div><div class="line">                <span class="comment">// switch to at range mode</span></div><div class="line">                unitsMod.changeMode(unit, <span class="string">'atRange'</span>, pool, game);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// end point check</span></div><div class="line">            <span class="keyword">if</span>(uDat.subTypeObj.endPointCheck)&#123;</div><div class="line">               <span class="comment">// is the distance from the start point greater than that distance to the end point?</span></div><div class="line">               <span class="keyword">var</span> de = utils.distance(uDat.sx, uDat.sy, uDat.ex, uDat.ey);</div><div class="line">               <span class="keyword">if</span>(ds &gt;= de)&#123;</div><div class="line">                   </div><div class="line">                   unit.x = uDat.sx + <span class="built_in">Math</span>.cos(unit.heading) * de;</div><div class="line">                   unit.y = uDat.sy + <span class="built_in">Math</span>.sin(unit.heading) * de;</div><div class="line">                   uDat.subTypeObj.onEndPoint(unit, pool, game, secs);</div><div class="line">               &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// check hit pool and switch to hitMode if one or more objects where hit</span></div><div class="line">            <span class="keyword">if</span>(uDat.hitPool &amp;&amp; uDat.subTypeObj.hitCheck)&#123;</div><div class="line">                <span class="keyword">var</span> hitObjects = poolMod.getOverlaping(unit, uDat.hitPool);</div><div class="line">                <span class="keyword">if</span>(hitObjects.length &gt; <span class="number">0</span>)&#123;</div><div class="line">                    unitsMod.changeMode(unit, <span class="string">'hit'</span>, pool, game);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    UNIT_OPTIONS.modes = UNIT_MODES;</div><div class="line"> </div><div class="line">    <span class="comment">// spawn a unit</span></div><div class="line">    UNIT_OPTIONS.spawn = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, spawnOpt</span>) </span>&#123;</div><div class="line">        spawnOpt = spawnOpt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> canvas = game.sm.canvas,</div><div class="line">        uDat = unit.data;</div><div class="line">        <span class="comment">// current mode of the unit</span></div><div class="line">        uDat.mode = spawnOpt.mode || <span class="string">'move'</span>;</div><div class="line">        <span class="comment">// SHOT STATS</span></div><div class="line">        <span class="comment">// core stats</span></div><div class="line">        unitsMod.coreStats(unit, spawnOpt, SHOT_DEFAULTS);</div><div class="line">        uDat.subTypeObj = utils.getPath(subTypes, uDat.subType, &#123;&#125;);</div><div class="line">        <span class="comment">// shot hitPool - a pool to check on each update to see if something that hot or not</span></div><div class="line">        uDat.hitPool = spawnOpt.hitPool || <span class="literal">null</span>;</div><div class="line">        <span class="comment">// colors</span></div><div class="line">        uDat.strokeStyle = spawnOpt.strokeStyle || <span class="string">'white'</span>;</div><div class="line">        uDat.fillStyle = spawnOpt.fillStyle || <span class="string">'white'</span>;</div><div class="line">        <span class="comment">// alpha</span></div><div class="line">        uDat.alpha = <span class="number">1</span>;</div><div class="line">        <span class="comment">// size</span></div><div class="line">        unit.w = <span class="number">4</span>;</div><div class="line">        unit.h = <span class="number">4</span>;</div><div class="line">        <span class="comment">// start position</span></div><div class="line">        uDat.sx = spawnOpt.sx || <span class="number">0</span>;</div><div class="line">        uDat.sy = spawnOpt.sy || <span class="number">0</span>;</div><div class="line">        unit.x = uDat.sx;</div><div class="line">        unit.y = uDat.sy;</div><div class="line">        <span class="comment">// end x and y used for shells</span></div><div class="line">        uDat.ex = spawnOpt.ex;</div><div class="line">        uDat.ey = spawnOpt.ey;</div><div class="line">        <span class="comment">// heading and speed not used</span></div><div class="line">        unit.heading = spawnOpt.heading || <span class="number">0</span>;</div><div class="line">        <span class="comment">// apply accuracy</span></div><div class="line">        <span class="keyword">var</span> delta = SHOT_MAX_ACCURACY_HEADING_DELTA,</div><div class="line">        accuracy = spawnOpt.accuracy === <span class="literal">undefined</span> ? <span class="number">0</span> : spawnOpt.accuracy;</div><div class="line">        delta = delta * <span class="number">-1</span> + delta * <span class="number">2</span> * <span class="built_in">Math</span>.random();</div><div class="line">        unit.heading += delta * (<span class="number">1</span> - accuracy);</div><div class="line">        unit.pps = <span class="number">128</span>;</div><div class="line">        <span class="comment">// chance mode</span></div><div class="line">        unitsMod.changeMode(unit, uDat.mode, pool, game);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// update a unit</span></div><div class="line">    UNIT_OPTIONS.update = <span class="function"><span class="keyword">function</span> (<span class="params">unit, pool, game, secs</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> modeObj = pool.data.modes[unit.data.mode];</div><div class="line">        <span class="comment">// call the current mode update method</span></div><div class="line">        modeObj.update(unit, pool, game, secs);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the Options object</span></div><div class="line">    <span class="keyword">return</span> UNIT_OPTIONS;</div><div class="line">&#125;</div><div class="line">    ()) );</div></pre></td></tr></table></figure>
<h2 id="3-The-game-module"><a href="#3-The-game-module" class="headerlink" title="3 - The game module"></a>3 - The game module</h2><p>So then sense most of the logic that has to do with the game is pulled out of the main game module and into units module plug ins that results in a cleaner main game module. This is still the module where I will be creating the main game state object as well as updating such an object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gameMod = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// the public api</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// public create method</span></div><div class="line">    api.create = <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>&#123;</div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        <span class="keyword">var</span> game = &#123;</div><div class="line">            <span class="attr">sm</span>: opt.sm || &#123;&#125;,</div><div class="line">            <span class="attr">power</span>: &#123;</div><div class="line">               <span class="attr">buildings</span>: <span class="number">0</span>,</div><div class="line">               <span class="attr">attackers</span>: <span class="number">0</span></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// create game units</span></div><div class="line">        game.buildings = unitsMod.create(&#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'buildings'</span>,</div><div class="line">            <span class="attr">game</span>: game,</div><div class="line">            <span class="attr">count</span>: <span class="number">20</span></div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// create game units</span></div><div class="line">        game.attackers = unitsMod.create(&#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'attackers'</span>,</div><div class="line">            <span class="attr">game</span>: game,</div><div class="line">            <span class="attr">count</span>: <span class="number">10</span></div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// create game units</span></div><div class="line">        game.shots = unitsMod.create(&#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'shots'</span>,</div><div class="line">            <span class="attr">game</span>: game,</div><div class="line">            <span class="attr">count</span>: <span class="number">100</span></div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> game;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public update method</span></div><div class="line">    api.update = <span class="function"><span class="keyword">function</span> (<span class="params">game, secs</span>) </span>&#123;</div><div class="line">        <span class="comment">// update units</span></div><div class="line">        unitsMod.update(game.shots, secs, sm.game);</div><div class="line">        unitsMod.update(game.attackers, secs, sm.game);</div><div class="line">        unitsMod.update(game.buildings, secs, sm.game);</div><div class="line">        <span class="comment">// power stats</span></div><div class="line">        game.power.buildings = unitsMod.totalPower(game.buildings);</div><div class="line">        game.power.attackers = unitsMod.totalPower(game.attackers);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return the public API</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;</div><div class="line">    ());</div></pre></td></tr></table></figure>
<h2 id="4-The-draw-module"><a href="#4-The-draw-module" class="headerlink" title="4 - The draw module"></a>4 - The draw module</h2><p>Sense this is a digital art project of course there is a library that contains a collection of methods that can be used to draw the various aspects of the main game object to the canvas.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> draw = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> DEFAULT_LINE_WIDTH = <span class="number">1</span>,</div><div class="line">    DEFAULT_STROKE_STYLE = <span class="string">'black'</span>,</div><div class="line">    DEFAULT_FILL_STYLE = <span class="string">'white'</span>,</div><div class="line">    DEFAULT_TEXT_COLOR = <span class="string">'yellow'</span>,</div><div class="line">    DEFAULT_COLOR_STOPS = [</div><div class="line">       [<span class="number">0</span>, <span class="string">'black'</span>],</div><div class="line">       [<span class="number">1</span>, <span class="string">'white'</span>]</div><div class="line">    ];</div><div class="line">    <span class="comment">// HELPERS</span></div><div class="line">    <span class="keyword">var</span> createBackground = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, canvas, opt</span>)</span>&#123;</div><div class="line">        <span class="comment">// options</span></div><div class="line">        opt = opt || &#123;&#125;;</div><div class="line">        opt.angle = opt.angle === <span class="literal">undefined</span> ? <span class="built_in">Math</span>.PI * <span class="number">0.25</span>: opt.angle;</div><div class="line">        opt.radius = opt.radius === <span class="literal">undefined</span> ? <span class="number">150</span> : opt.radius;</div><div class="line">        <span class="comment">// create locals</span></div><div class="line">        <span class="keyword">var</span> cx = canvas.width / <span class="number">2</span>,</div><div class="line">        cy = canvas.height / <span class="number">2</span>,</div><div class="line">        dx = <span class="built_in">Math</span>.cos(opt.angle) * opt.radius,</div><div class="line">        dy = <span class="built_in">Math</span>.sin(opt.angle) * opt.radius,</div><div class="line">        sx = cx - dx,</div><div class="line">        sy = cy - dy,</div><div class="line">        ex = cx + dx,</div><div class="line">        ey = cy + dy;</div><div class="line">        <span class="comment">// create gradient</span></div><div class="line">        <span class="keyword">var</span> gradient = ctx.createLinearGradient(sx, sy, ex, ey);</div><div class="line">        <span class="comment">// Add color stops</span></div><div class="line">        <span class="keyword">var</span> colorStops = opt.colorStops || DEFAULT_COLOR_STOPS;</div><div class="line">        colorStops.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">colorStop</span>)</span>&#123;</div><div class="line">            gradient.addColorStop(colorStop[<span class="number">0</span>], colorStop[<span class="number">1</span>]);</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// return gradiant</span></div><div class="line">        <span class="keyword">return</span> gradient;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> drawDisp = <span class="function"><span class="keyword">function</span>(<span class="params">sm, disp, ctx, canvas</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> hpPer = <span class="number">0</span>,</div><div class="line">        dDat = disp.data;</div><div class="line">        <span class="comment">// if the object is active</span></div><div class="line">        <span class="keyword">if</span> (disp.active) &#123;</div><div class="line">            <span class="comment">// draw base area as recr</span></div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.rect(disp.x - disp.w / <span class="number">2</span>, disp.y - disp.h / <span class="number">2</span>, disp.w, disp.h);</div><div class="line">            ctx.fill();</div><div class="line">            ctx.stroke();</div><div class="line">            <span class="comment">// draw base area as circle</span></div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.arc(disp.x, disp.y, (disp.w + disp.h) / <span class="number">2</span> / <span class="number">2</span>, <span class="number">0</span>, utils.PI2);</div><div class="line">            ctx.fill();</div><div class="line">            ctx.stroke();</div><div class="line">            <span class="comment">// hp bar</span></div><div class="line">            <span class="keyword">if</span>(dDat.hp != <span class="literal">undefined</span>)&#123;</div><div class="line">               <span class="keyword">var</span> x = disp.x - disp.w / <span class="number">2</span>,</div><div class="line">               y = disp.y - disp.h / <span class="number">2</span>;</div><div class="line">               hpPer = dDat.hp / dDat.hpMax;</div><div class="line">               ctx.fillStyle = <span class="string">'lime'</span>;</div><div class="line">               ctx.fillRect(x, y, disp.w * hpPer, disp.h * <span class="number">0.15</span> );</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// PUBLIC API METHODS</span></div><div class="line">    <span class="keyword">var</span> api = &#123;&#125;;</div><div class="line">    <span class="comment">// draw the background</span></div><div class="line">    api.background = <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> bg = createBackground(ctx, canvas, sm.background);</div><div class="line">        ctx.fillStyle = bg;</div><div class="line">        ctx.fillRect(<span class="number">-1</span>, <span class="number">-1</span>, canvas.width + <span class="number">2</span>, canvas.height + <span class="number">2</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw the pool</span></div><div class="line">    api.pool = <span class="function"><span class="keyword">function</span> (<span class="params">sm, pool, ctx, canvas</span>) </span>&#123;</div><div class="line">        <span class="comment">//var pool = game.units;</span></div><div class="line">        ctx.lineWidth = DEFAULT_LINE_WIDTH;</div><div class="line">        pool.objects.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">            ctx.fillStyle = obj.data.fillStyle || DEFAULT_FILL_STYLE;</div><div class="line">            ctx.strokeStyle = obj.data.strokeStyle || DEFAULT_STROKE_STYLE;</div><div class="line">            ctx.globalAlpha = obj.data.alpha === <span class="literal">undefined</span> ? <span class="number">1</span>: obj.data.alpha;</div><div class="line">            drawDisp(sm, obj, ctx, canvas);</div><div class="line">        &#125;);</div><div class="line">        ctx.globalAlpha = <span class="number">1</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw status info</span></div><div class="line">    api.status = <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> game = sm.game,</div><div class="line">        power = game.power;</div><div class="line">        ctx.fillStyle = DEFAULT_TEXT_COLOR;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.font = <span class="string">'14px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'power buildings: '</span> + power.buildings, <span class="number">10</span>, <span class="number">10</span>);</div><div class="line">        ctx.fillText(<span class="string">'power attackers: '</span> + power.attackers, <span class="number">10</span>, <span class="number">25</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// draw version number</span></div><div class="line">    api.ver = <span class="function"><span class="keyword">function</span> (<span class="params">sm, ctx, canvas</span>) </span>&#123;</div><div class="line">        ctx.fillStyle = DEFAULT_TEXT_COLOR;</div><div class="line">        ctx.textBaseline = <span class="string">'top'</span>;</div><div class="line">        ctx.textAlign = <span class="string">'left'</span>;</div><div class="line">        ctx.font = <span class="string">'14px arial'</span>;</div><div class="line">        ctx.fillText(<span class="string">'version: '</span> + sm.ver, <span class="number">5</span>, canvas.height - <span class="number">15</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// return public api</span></div><div class="line">    <span class="keyword">return</span> api;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="5-The-main-javaScript-file"><a href="#5-The-main-javaScript-file" class="headerlink" title="5 - The main javaScript file"></a>5 - The main javaScript file</h2><p>I am then just going to need a little more additional logic that will provide a main application loop, and a main state object.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// state object</span></div><div class="line"><span class="keyword">var</span> canvasObj = utils.createCanvas(&#123;</div><div class="line">        <span class="attr">width</span>: <span class="number">640</span>,</div><div class="line">        <span class="attr">height</span>: <span class="number">480</span></div><div class="line">    &#125;);</div><div class="line"><span class="comment">// main sm object</span></div><div class="line"><span class="keyword">var</span> sm = &#123;</div><div class="line">    <span class="attr">ver</span>: <span class="string">'r6'</span>,</div><div class="line">    <span class="attr">lt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    <span class="attr">fps</span>: <span class="number">30</span>,</div><div class="line">    <span class="attr">game</span>: <span class="literal">null</span>,</div><div class="line">    <span class="attr">ctx</span>: canvasObj.ctx,</div><div class="line">    <span class="attr">canvas</span>: canvasObj.canvas,</div><div class="line">    <span class="attr">background</span>: &#123;</div><div class="line">       <span class="attr">angle</span>: <span class="number">1</span>,</div><div class="line">       <span class="attr">degreesPerSec</span>: <span class="number">-5</span>,</div><div class="line">       <span class="attr">radius</span>: <span class="number">200</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// set up game object</span></div><div class="line">sm.game = gameMod.create(&#123;</div><div class="line">        <span class="attr">sm</span>: sm</div><div class="line">    &#125;);</div><div class="line"><span class="comment">// basic app loop</span></div><div class="line"><span class="keyword">var</span> loop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(),</div><div class="line">    secs = (now - sm.lt) / <span class="number">1000</span>;</div><div class="line">    requestAnimationFrame(loop);</div><div class="line">    <span class="keyword">if</span> (secs &gt;= <span class="number">1</span> / sm.fps) &#123;</div><div class="line">        <span class="comment">// update game</span></div><div class="line">        gameMod.update(sm.game, secs);</div><div class="line">        <span class="comment">// draw</span></div><div class="line">        draw.background(sm, sm.ctx, sm.canvas);</div><div class="line">        draw.pool(sm, sm.game.buildings, sm.ctx);</div><div class="line">        draw.pool(sm, sm.game.attackers, sm.ctx);</div><div class="line">        draw.pool(sm, sm.game.shots, sm.ctx);</div><div class="line">        draw.status(sm, sm.ctx, sm.canvas);</div><div class="line">        draw.ver(sm, sm.ctx, sm.canvas);</div><div class="line">        sm.lt = now;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">loop();</div></pre></td></tr></table></figure></p>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6 - Conclusion"></a>6 - Conclusion</h2><p>So then this example turned out pretty great, and I was able to get the core idea of what I had in mind up and running pretty fast. As of this writing I have a lot planed out for the rest of the example when it comes to the additional features phase of this example, in time I might complete that phase and have something that is even more interesting than what I have all ready, but I do also have a lot of competing ideas also so we will see if I get to the maintenance phase with this one.</p>
<p>Even if I do not complete the additional features planed out for this example, a whole lot has been created and improved that I will be taking with me to additional examples.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/" data-id="cliqa01w900q2bwv1hboyr432" class="article-share-link">Share</a>
      
        <a href="https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/01/21/lodash_thru/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Chains and the lodash thru method
        
      </div>
    </a>
  
  
    <a href="/2022/01/14/lodash_collection/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">lodash collection methods, and working with collection in general with javaScript</div>
    </a>
  
</nav>

  
</article>



<section id="comments">

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = 'https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/index.html';
    this.page.identifier = '952';
    this.page.title = 'Invaders Digital Art javaScript example';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://dustinpfister-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/api/">api</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/backbone/">backbone</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/discovery/">discovery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/electronjs/">electronjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grunt/">grunt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hapi/">hapi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/heroku/">heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jquery/">jquery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lodash/">lodash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/phaser/">phaser</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/statistics/">statistics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/three-js/">three.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/">JSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backbone/">backbone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/corejs/">corejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deterministic/">deterministic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discovery/">discovery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejs/">ejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electronjs/">electronjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/games/">games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hapi/">hapi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jimp/">jimp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js13k/">js13k</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phaser/">phaser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structured-data/">structured-data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/themes/">themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three-js/">three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JSON/" style="font-size: 12.27px;">JSON</a> <a href="/tags/SEO/" style="font-size: 10.45px;">SEO</a> <a href="/tags/angular/" style="font-size: 13.18px;">angular</a> <a href="/tags/animation/" style="font-size: 11.82px;">animation</a> <a href="/tags/automation/" style="font-size: 11.82px;">automation</a> <a href="/tags/backbone/" style="font-size: 12.27px;">backbone</a> <a href="/tags/blog/" style="font-size: 15.45px;">blog</a> <a href="/tags/canvas/" style="font-size: 18.64px;">canvas</a> <a href="/tags/corejs/" style="font-size: 12.73px;">corejs</a> <a href="/tags/deterministic/" style="font-size: 10px;">deterministic</a> <a href="/tags/discovery/" style="font-size: 10.91px;">discovery</a> <a href="/tags/ejs/" style="font-size: 11.36px;">ejs</a> <a href="/tags/electronjs/" style="font-size: 13.64px;">electronjs</a> <a href="/tags/express/" style="font-size: 16.82px;">express</a> <a href="/tags/games/" style="font-size: 17.27px;">games</a> <a href="/tags/git/" style="font-size: 13.64px;">git</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hapi/" style="font-size: 15px;">hapi</a> <a href="/tags/heroku/" style="font-size: 11.82px;">heroku</a> <a href="/tags/hexo/" style="font-size: 14.55px;">hexo</a> <a href="/tags/jimp/" style="font-size: 10.45px;">jimp</a> <a href="/tags/jquery/" style="font-size: 11.36px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js13k/" style="font-size: 10px;">js13k</a> <a href="/tags/linux/" style="font-size: 17.73px;">linux</a> <a href="/tags/lodash/" style="font-size: 18.64px;">lodash</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mongodb/" style="font-size: 14.55px;">mongodb</a> <a href="/tags/node-js/" style="font-size: 19.55px;">node.js</a> <a href="/tags/phaser/" style="font-size: 18.18px;">phaser</a> <a href="/tags/python/" style="font-size: 15.91px;">python</a> <a href="/tags/statistics/" style="font-size: 14.09px;">statistics</a> <a href="/tags/structured-data/" style="font-size: 10px;">structured-data</a> <a href="/tags/themes/" style="font-size: 10px;">themes</a> <a href="/tags/three-js/" style="font-size: 19.09px;">three.js</a> <a href="/tags/vuejs/" style="font-size: 16.36px;">vuejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/07/23/threejs-lathe-geometry/">Lathe Geometry in threejs</a>
          </li>
        
          <li>
            <a href="/2023/06/09/threejs-vector2/">The Vector2 class for 2D curves, mouse pointers, ect</a>
          </li>
        
          <li>
            <a href="/2023/06/08/linux-dd/">Linux dd command and files</a>
          </li>
        
          <li>
            <a href="/2023/06/06/linux-sysbench/">Linux sysbench command for benchmarking a file system</a>
          </li>
        
          <li>
            <a href="/2023/06/02/threejs-tube-geometry/">Tube Geometry in threejs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Dustin Pfister<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br>
      <br>
      <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/2021/02/19/threejs-examples/" class="mobile-nav-link">ThreeJS</a>
  
    <a href="/2020/03/23/canvas-example/" class="mobile-nav-link">Canvas</a>
  
    <a href="https://www.youtube.com/user/javaweaver" class="mobile-nav-link">Youtube</a>
  
    <a href="https://github.com/dustinpfister" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'dustinpfister-github-io';
  
  var disqus_url = 'https://dustinpfister.github.io/2022/01/17/js-javascript-example-digital-art-invaders/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>